require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({253:[function(require,module,exports){"use strict";function preBootstrapWorkarounds(){function getTargetFromTrigger($trigger){var href,target=$trigger.attr("data-target")||(href=$trigger.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");return $(target)}$(document).on("click.bs.collapse.data-api.workaround",'[data-toggle="collapse"]',function(){var $t=$(this),$target=getTargetFromTrigger($t),data=$target&&$target.data("bs.collapse");data&&(data.$trigger=$t)})}var $=require("jquery");window.$=window.jQuery=$;require("detect_swipe");var ko=require("knockout");ko.bindingHandlers.format=require("ko/formatBinding").formatBinding;ko.bindingHandlers.domElement=require("ko/domElementBinding").domElementBinding;var bootknock=require("./utils/bootknockBindingHelpers");require("./utils/Function.prototype._inherits");require("./utils/Function.prototype._delayed");require("./utils/Function.prototype.name-polyfill");require("es6-promise").polyfill();require("../../vendor/polyfills/Element.prototype.matches");require("../../vendor/polyfills/Element.prototype.closest");require("requestAnimationFrame");var layoutUpdateEvent=require("layoutUpdateEvent"),onboarding=require("./data/onboarding"),ga=require("./data/googleAnalytics");require("./locales/en-US-LC");var attachFastClick=require("fastclick").attach,showError=require("./modals/error").show,app={shell:require("./app.shell"),activities:require("./app.activities"),goDashboard:function goDashboard(){!0!==goDashboard._going&&setTimeout(function(){goDashboard._going=!0;onboarding.goIfEnabled()||this.shell.go("/dashboard");setTimeout(function(){goDashboard._going=!1},1)}.bind(this),1)}};require("./app-navbar").extend(app);require("./app-components").registerAll(app);app.getActivity=function getActivity(name){var activity=this.activities[name];if(activity){var $act=this.shell.items.find(name);if($act&&$act.length)return activity.init($act,this,name)}return null};app.getActivityControllerByRoute=function getActivityControllerByRoute(route){var actName=route.name||this.shell.indexName;return this.getActivity(actName)};app.shell.accessControl=require("./utils/accessControl")(app);app.UserType=require("./models/User").UserType;app.successSave=function successSave(settings){settings=$.extend({message:"Your changes have been saved",link:null},settings);this.showNavBarNotification(settings);settings.link?this.shell.go(settings.link):this.performsNavBarBack({silentMode:!0})};var appInit=function appInit(){var userProfile=require("./data/userProfile"),user=userProfile.data;attachFastClick(document.body);layoutUpdateEvent.on();var trigLayout=function trigLayout(){$(window).trigger("layoutUpdate")};window.addEventListener("native.keyboardshow",trigLayout);window.addEventListener("native.keyboardhide",trigLayout);window.addEventListener("native.keyboardshow",function(){window.scrollTo(0,0);setTimeout(function(){window.scrollTo(0,0)},100)});if(window.StatusBar){window.StatusBar.overlaysWebView(!1);window.StatusBar.backgroundColorByHexString("#ffffff");window.StatusBar.styleDefault();"android"==window.cordova.platformId&&window.StatusBar.backgroundColorByHexString("#00989a")}setTimeout(function(){$(window).trigger("layoutUpdate")},200);preBootstrapWorkarounds();require("bootstrap");bootknock.plugIn(ko);require("./utils/pressEnterBindingHandler").plugIn(ko);if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard){window.cordova.plugins.Keyboard.disableScroll(!1);window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1)}$(document).on("click","[data-shell]",function(e){var args=($(this).attr("data-shell")||"").split(" "),cmd=args[0];if(cmd&&"function"==typeof app.shell[cmd]){app.shell[cmd].apply(app.shell,args.slice(1));e.stopImmediatePropagation();e.preventDefault()}});window.cordova&&$(document).on("click",'[target="_blank"], [target="_system"]',function(e){window.open(this.getAttribute("href"),this.getAttribute("target"));e.preventDefault()});app.shell.on(app.shell.events.itemReady,function($act,state){var routeName=app.shell.currentRoute.name,actName=$act.data("activity");if(routeName===actName){var activity=app.getActivity(actName);activity.show(state);if((routeName=app.shell.currentRoute.name)===actName){var menuItem=activity.menuItem||actName;app.updateMenu(menuItem);app.updateAppNav(activity,state);app._currentActivity=activity}}});app.shell.on(app.shell.events.closed,function($act){var actName=$act.data("activity"),activity=app.getActivity(actName);activity.hide&&activity.hide()});app.shell.on("error",function(err){showError({error:err})});var scrollToElement=require("./utils/scrollToElement");app.shell.scrollTo=function(idOrHash,giveFocus){var id=idOrHash.replace(/^#/,""),target=$("#"+id);if(target.length){var opts={animation:{duration:300}},act=target.closest("[data-activity]");"home"===act.data("activity")&&(opts.topOffset=act.children("header").outerHeight());scrollToElement(target,opts);if(giveFocus){var noTabindex=!target.attr("tabindex");noTabindex&&target.attr("tabindex",-1);setTimeout(function(){target.focus();noTabindex&&target.removeAttr("tabindex")},100)}}};app.shell.on("fragmentNavigation",function(href){"#"===href?console.warn('Navigation to an empty fragment, this may be not wanted. For root links, use "/"; on script handled links, call event.preventDefault; A touch event was listened on a link, but not the click event.'):app.shell.scrollTo(href,!0)});app.setupNavBarBinding();require("./components/SmartNavBar").getAll().forEach(function(navbar){$(navbar.el).on("contentChange",function(){navbar.refresh()})});var togglingBackdrop=!1;$(document).on("show.bs.collapse hide.bs.collapse",".AppNav .navbar-collapse",function(e){if(!togglingBackdrop){togglingBackdrop=!0;var enabled="show"===e.type;$("body").toggleClass("has-appNav-open",enabled);$(".collapsing, .collapse.in").collapse("hide");togglingBackdrop=!1}});$(document).on("focus",'[data-autoselect="true"]',function(){$(this).select()});var alertError=function(err){showError({title:"There was an error loading",error:err})};require("./utils/toggleActionSheet").on();app.shell.baseUrl&&$("html").attr("data-site-url",app.shell.baseUrl.replace(/^\//,""));ga.setup(app.shell);var marketplaceProfile=require("./data/marketplaceProfile"),connectUserNavbar=function(){ko.computed(function(){app.navBarBinding.userName(user.firstName()||"Me");app.navBarBinding.isServiceProfessional(user.isServiceProfessional());app.navBarBinding.isClient(user.isClient())});ko.computed(function(){var p=user.photoUrl();p&&app.navBarBinding.photoUrl(p)});ko.computed(function(){var p=marketplaceProfile.data.photoUrl();p&&app.navBarBinding.photoUrl(p)})},setupOnboarding=function(){return onboarding.getLocalJobTitleID().then(function(jobTitleID){onboarding.init(app);onboarding.setup({isServiceProfessional:user.isServiceProfessional(),jobTitleID:jobTitleID,step:user.onboardingStep()||null})})},resumeOnboarding=function(){var r=window.document.referrer;r&&0===r.indexOf(window.document.location.origin)||onboarding.goIfEnabled()},setAppAsReady=function(){$("html").addClass("is-ready");window.navigator&&window.navigator.splashscreen&&window.navigator.splashscreen.hide()},preloadUserProfile=function(){return userProfile.loadFromLocal().then(function(){user.isAnonymous()||userProfile.sync()})};require("./data/session").restore().then(preloadUserProfile).then(setupOnboarding).then(app.shell.run.bind(app.shell)).then(connectUserNavbar).then(resumeOnboarding).then(setAppAsReady).catch(alertError);window.app=app};$(window.cordova?function(){$(document).on("deviceready",appInit)}:appInit)},{"../../vendor/polyfills/Element.prototype.closest":524,"../../vendor/polyfills/Element.prototype.matches":525,"./app-components":250,"./app-navbar":251,"./app.activities":252,"./app.shell":254,"./components/SmartNavBar":258,"./data/googleAnalytics":274,"./data/marketplaceProfile":289,"./data/onboarding":291,"./data/session":303,"./data/userProfile":309,"./locales/en-US-LC":340,"./modals/error":343,"./models/User":419,"./utils/Function.prototype._delayed":434,"./utils/Function.prototype._inherits":435,"./utils/Function.prototype.name-polyfill":436,"./utils/accessControl":443,"./utils/bootknockBindingHelpers":446,"./utils/pressEnterBindingHandler":466,"./utils/scrollToElement":468,"./utils/toggleActionSheet":482,bootstrap:516,detect_swipe:10,"es6-promise":11,fastclick:519,jquery:14,knockout:15,"ko/domElementBinding":520,"ko/formatBinding":521,layoutUpdateEvent:522,requestAnimationFrame:518}],518:[function(require,module,exports){Date.now||(Date.now=function(){return(new Date).getTime()});!function(){"use strict";for(var vendors=["webkit","moz"],i=0;i<vendors.length&&!window.requestAnimationFrame;++i){var vp=vendors[i];window.requestAnimationFrame=window[vp+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vp+"CancelAnimationFrame"]||window[vp+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var lastTime=0;window.requestAnimationFrame=function(callback){var now=Date.now(),nextTime=Math.max(lastTime+16,now);return setTimeout(function(){callback(lastTime=nextTime)},nextTime-now)};window.cancelAnimationFrame=clearTimeout}}()},{}],482:[function(require,module,exports){"use strict";var $=require("jquery");exports.on=function(){function closeActionSheet(el){(el=el||$(".ActionSheet")).attr("hidden","hidden").trigger("close.ActionSheet");$("body").removeClass("has-ActionSheet-open")}$(document).on("click","[data-toggle=ActionSheet]",function(){var t=$(this).data("target"),$t=$("#"+t);if($t.attr("hidden")){closeActionSheet();$t.removeAttr("hidden").trigger("open.ActionSheet");$("body").addClass("has-ActionSheet-open")}else closeActionSheet($t);$t.one("click",function(){closeActionSheet($t)})})}},{jquery:14}],466:[function(require,module,exports){"use strict";var $=require("jquery");exports.plugIn=function plugIn(ko){ko.bindingHandlers.pressEnter={init:function(element,valueAccessor,allBindings,viewModel){var callback=valueAccessor();$(element).keypress(function(event){if(13===(event.which?event.which:event.keyCode)){callback.call(viewModel);return!1}return!0})}}}},{jquery:14}],443:[function(require,module,exports){"use strict";var user=require("../data/userProfile").data;module.exports=function createAccessControl(app){return function accessControl(route){var activity=app.getActivityControllerByRoute(route),currentType=user.userType();return!activity||!activity.accessLevel||activity.accessLevel&currentType?null:{requiredLevel:activity.accessLevel,currentType:currentType}}}},{"../data/userProfile":309}],274:[function(require,module,exports){"use strict";var GA_TRACKER_ID="UA-72265353-4",session=require("./session"),$=require("jquery"),setUser=function(userAuthKey){window.ga&&(window.cordova?window.ga.setUserId(userAuthKey.userID):window.ga("set","userId",userAuthKey.userID))};session.on.opened.subscribe(setUser);session.on.restored.subscribe(setUser);exports.setup=function(shell){if(window.ga){var appId=$("html").data("app-id"),appName=$("html").data("app-name"),appVersion=$("html").data("app-version");appVersion=(window.device&&window.device.platform||"web")+"-"+appVersion;if(window.cordova){window.ga.startTrackerWithId(GA_TRACKER_ID);window.ga.setAppVersion(appVersion);window.ga.trackView("index")}else{window.ga("create",GA_TRACKER_ID,"auto");window.ga("set","appVersion",appVersion);window.ga("set","appName",appName);window.ga("set","appId",appId);window.ga("send","screenview",{screenName:"index"})}shell.on(shell.events.itemReady,function($act,state){var view=state.route.name;window.cordova?window.ga.trackView(view):window.ga("send","screenview",{screenName:view})})}}},{"./session":303,jquery:14}],258:[function(require,module,exports){var $=require("jquery"),clearNode=function(node){for(;node.firstChild;)node.removeChild(node.firstChild)},textboxResize=function textboxResize(el){var leftbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.left")[0],rightbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.right")[0];void 0===leftbtn&&(leftbtn={offsetWidth:0,className:""});void 0===rightbtn&&(rightbtn={offsetWidth:0,className:""});var margin=Math.max(leftbtn.offsetWidth,rightbtn.offsetWidth);el.style.marginLeft=margin+"px";el.style.marginRight=margin+"px";var tooLong=el.offsetWidth<el.scrollWidth;if(tooLong){if(leftbtn.offsetWidth<rightbtn.offsetWidth){el.style.marginLeft=leftbtn.offsetWidth+"px";el.style.textAlign="right"}else{el.style.marginRight=rightbtn.offsetWidth+"px";el.style.textAlign="left"}if(tooLong=el.offsetWidth<el.scrollWidth){if(new RegExp("arrow").test(leftbtn.className)){clearNode(leftbtn.childNodes[1]);el.style.marginLeft="26px"}if(new RegExp("arrow").test(rightbtn.className)){clearNode(rightbtn.childNodes[1]);el.style.marginRight="26px"}}}};exports.textboxResize=textboxResize;var SmartNavBar=function SmartNavBar(el){this.el=el;this.refresh=function refresh(){var h=$(el).children("h1").get(0);h&&textboxResize(h)};this.refresh()};exports.SmartNavBar=SmartNavBar;exports.getAll=function getAll(){var all=$(".SmartNavBar");return $.map(all,function(item){return new SmartNavBar(item)})};exports.refreshAll=function refreshAll(){$(".SmartNavBar > h1").each(function(){textboxResize(this)})}},{jquery:14}],254:[function(require,module,exports){"use strict";var baseUrl="",hashBang=!0;if(!window.cordova){var t=/^http.?:\/\/[^\/]+(\/[^#]*)/.exec(window.document.baseURI);if(t&&t[1]){baseUrl=t[1];hashBang=!1}}var History=require("./utils/shell/hashbangHistory"),shell=new(0,(shell=require("./utils/shell/index")).Shell)({root:"App-activities",baseUrl:baseUrl,forceHashbang:hashBang,indexName:"home",forbiddenAccessName:"login",linkEvent:"click",loader:null,history:History,domItemsManager:new(0,shell.DomItemsManager)({idAttributeName:"data-activity",root:".App-activities"})});module.exports=shell},{"./utils/shell/hashbangHistory":473,"./utils/shell/index":474}],474:[function(require,module,exports){"use strict";var deps=require("./dependencies"),DomItemsManager=require("./DomItemsManager"),parseUrl=require("./parseUrl"),absolutizeUrl=require("./absolutizeUrl"),$=require("jquery"),loader=require("./loader"),EventEmitter=require("events").EventEmitter;$.extend(deps,{parseUrl:parseUrl,absolutizeUrl:absolutizeUrl,jquery:$,loader:loader,EventEmitter:EventEmitter});var Shell=require("./Shell");exports.Shell=Shell;exports.DomItemsManager=DomItemsManager},{"./DomItemsManager":469,"./Shell":470,"./absolutizeUrl":471,"./dependencies":472,"./loader":475,"./parseUrl":476,events:12,jquery:14}],476:[function(require,module,exports){"use strict";function parseUrl(baseUrl,link){var rawUrl=link=link||"";link=(link=link.replace(/^#!/,"").replace(/^#/,"")).replace(/^\/|^\.\//,"");var query=getUrlQuery(link||"?");link=link.replace(/\?.*$/,"");baseUrl=baseUrl.replace(/^\//,"");var path=link.replace(new RegExp("^"+escapeRegExp(baseUrl),"i"),""),match=/^\/?([^\/\.]+)[^\/]*(\/.*)*$/.exec(path),parsed={root:!0,name:null,segments:null,path:null,url:rawUrl,query:query};if(match){parsed.root=!1;if(match[1]){parsed.name=match[1];if(match[2]){parsed.path=match[2];parsed.segments=match[2].replace(/^\//,"").split("/")}else{parsed.path="/";parsed.segments=[]}}}return parsed}var getUrlQuery=require("../getUrlQuery"),escapeRegExp=require("../escapeRegExp");module.exports=parseUrl},{"../escapeRegExp":451,"../getUrlQuery":456}],475:[function(require,module,exports){"use strict";var $=require("jquery");module.exports={baseUrl:"/",load:function load(route){return new Promise(function(resolve,reject){console.log("Shell loading on demand",route.name,route);$.ajax({url:module.exports.baseUrl+route.name+".html",cache:!1}).then(resolve,reject)})}}},{jquery:14}],471:[function(require,module,exports){"use strict";function absolutizeUrl(baseUrl,url){url=sanitizeUrl(url);return new RegExp("^"+escapeRegExp(baseUrl),"i").test(url)?url:sanitizeUrl(baseUrl+url)}var sanitizeUrl=require("./sanitizeUrl"),escapeRegExp=require("../escapeRegExp");module.exports=absolutizeUrl},{"../escapeRegExp":451,"./sanitizeUrl":477}],451:[function(require,module,exports){"use strict";var specials=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],regex=RegExp("["+specials.join("\\")+"]","g"),escapeRegExp=function(str){return str.replace(regex,"\\$&")};module.exports=escapeRegExp},{}],470:[function(require,module,exports){"use strict";function Shell(settings){deps.EventEmitter.call(this);this.$=settings.jquery||deps.jquery;this.$root=this.$(settings.root);this.baseUrl=settings.baseUrl||"";this.forceHashbang=settings.forceHashbang||!1;this.useSingleHashForRouting=!this.forceHashbang&&(settings.useSingleHashForRouting||!1);this.linkEvent=settings.linkEvent||"click";this.parseUrl=(settings.parseUrl||deps.parseUrl).bind(this,this.baseUrl);this.absolutizeUrl=(settings.absolutizeUrl||deps.absolutizeUrl).bind(this,this.baseUrl);this.history=settings.history||window.history;this.indexName=settings.indexName||"index";this.items=settings.domItemsManager;this.loader=void 0===settings.loader?deps.loader:settings.loader;this.loader&&(this.loader.baseUrl=this.baseUrl);this.events={willOpen:"shell-will-open",willClose:"shell-will-close",itemReady:"shell-item-ready",closed:"shell-closed",opened:"shell-opened"};this.accessControl=settings.accessControl||deps.accessControl;this.forbiddenAccessName=settings.forbiddenAccessName||this.indexName;this.currentRoute=null;this.currentRouteObservable=ko.observable();this.referrerRoute=null}var deps=require("./dependencies"),ko=require("knockout");Shell.prototype=Object.create(deps.EventEmitter.prototype,{constructor:{value:Shell,enumerable:!1,writable:!0,configurable:!0}});module.exports=Shell;Shell.prototype.go=function go(url,state,useReplace){if("string"==typeof url){this.forceHashbang?/^#!/.test(url)||(url="#!"+url):url=this.absolutizeUrl(url);useReplace?this.history.replaceState(state,void 0,url):this.history.pushState(state,void 0,url);return this.replace(state)}console.error("Shell.go aborted. It needs a string as URL, given:",url)};Shell.prototype.goBack=function goBack(state,steps){if((steps=0-(steps||1))<0&&Math.abs(steps)>=this.history.length)this.go(this.indexName);else{this._pendingStateUpdate=state;this.history.go(steps)}};Shell.prototype.getUpdatedState=function getUpdatedState(state){state=this._pendingStateUpdate||state||this.history.state||{};this._pendingStateUpdate=null;var link=/#!/.test(location.href)||this.forceHashbang?location.hash:location.pathname;location.search&&(link+=(-1!==link.indexOf("?")?"&":"?")+location.search.substr(1));state.route=this.parseUrl(link);return state};Shell.prototype._getLocationRoutedUrl=function(){return/^#!/.test(window.location.hash)?window.location.hash:window.location.pathname+window.location.search+window.location.hash};Shell.prototype._refreshReferrer=function(){this.referrerRoute=this.parseUrl(this._getLocationRoutedUrl())};Shell.prototype._refreshCurrent=function(){this.currentRoute=this.parseUrl(this._getLocationRoutedUrl());this.currentRouteObservable(this.currentRoute)};Shell.prototype.replaceState=function replaceState(state,title,url){this._refreshReferrer();this.history.replaceState(state,title,url);this._refreshCurrent()};Shell.prototype.pushState=function pushState(state,title,url){this._refreshReferrer();this.history.pushState(state,title,url);this._refreshCurrent()};Shell.prototype.replace=function replace(state){!0===(state=this.getUpdatedState(state)).route.root&&(state.route=this.parseUrl(this.indexName));this.referrerRoute=this.currentRoute;this.currentRoute=state.route;this.currentRouteObservable(this.currentRoute);var accessError=this.accessControl(state.route);if(accessError&&this.currentRoute.name!==this.forbiddenAccessName)return this.go(this.forbiddenAccessName,accessError,!0);var $cont=this.items.find(state.route.name),shell=this,promise=null;if($cont&&$cont.length)promise=new Promise(function(resolve,reject){try{var $oldCont=shell.items.getActive();$oldCont=$oldCont.not($cont);shell.items.switch($oldCont,$cont,shell,state,!shell.referrerRoute);resolve()}catch(ex){reject(ex)}});else if(this.loader)promise=this.loader.load(state.route).then(function(html){shell.items.inject(state.route.name,html);if(shell.items.find(state.route.name).length)return shell.replace(state)});else{var err=new Error("Page not found ("+state.route.name+")");console.warn("Shell Page not found, state:",state);promise=Promise.reject(err);setTimeout(function(){this.goBack()}.bind(this),1)}var thisShell=this;promise.catch(function(err){err instanceof Error||(err=new Error(err));console.error("Shell, unexpected error.",err);thisShell.emit("error",err);throw err});return promise};Shell.prototype.run=function run(){var shell=this;this.$(window).on(this.history.popstateEvent||"popstate",function(event){var state=event.state||event.originalEvent&&event.originalEvent.state||shell.history.state;shell.replace(state)});var linkWorking=null,linkWorkingDelay=80;this.$(document).on(this.linkEvent,"[href], [data-href]",function(e){if(linkWorking)return!1;linkWorking=setTimeout(function(){linkWorking=null},80);var $t=shell.$(this),href=$t.attr("href")||$t.data("href");if(href){var target=$t.attr("target");if(!/^[a-z]+:/i.test(href)&&!target)if(this.useSingleHashForRouting||!/^#([^!]|$)/.test(href)){e.preventDefault();setTimeout(function(){shell.go(href)},1)}else{e.preventDefault();shell.emit("fragmentNavigation",href,this,e)}}else e.preventDefault()});this.items.init();this.replace()};Shell.prototype.getCurrentObservableRoute=function(){var route=this.currentRouteObservable,lastValue=route(),scopedName=lastValue.name;return ko.pureComputed(function(){var updatedRoute=route();if(updatedRoute.name===scopedName){lastValue=updatedRoute;return updatedRoute}return lastValue})}},{"./dependencies":472,knockout:15}],472:[function(require,module,exports){"use strict";module.exports={parseUrl:null,absolutizeUrl:null,jquery:null,loader:null,accessControl:function allowAll(){return null},EventEmitter:null}},{}],469:[function(require,module,exports){"use strict";function DomItemsManager(settings){this.idAttributeName=settings.idAttributeName||"id";this.allowDuplicates=!!settings.allowDuplicates||!1;this.root=settings.root||"body";this.$root=null;var defaultDelay=140,flags=getFlags();(!flags.isMobile||flags.isChrome||flags.isWkWebview)&&(defaultDelay=40);this.switchDelay=settings.switchDelay||defaultDelay;this.autofocusElementSelector=settings.autofocusElementSelector||"h1:first"}var $=require("jquery"),escapeSelector=require("../escapeSelector"),getFlags=require("../userAgentFlags");module.exports=DomItemsManager;DomItemsManager.prototype.getAllItems=function getAllItems(){return this.$root.children("["+this.idAttributeName+"]")};DomItemsManager.prototype.find=function find(containerName,root){return $(root||this.$root).children("["+this.idAttributeName+'="'+escapeSelector(containerName)+'"]')};DomItemsManager.prototype.getActive=function getActive(){return this.$root.children("["+this.idAttributeName+"]:visible")};DomItemsManager.prototype.inject=function inject(name,html){html=html.replace(/^[\s\S]*<body.*?>|<\/body>[\s\S]*$/g,"");var $html=$("<div/>",{html:html}),$c=this.find(name,$html);0===$c.length&&($c=$html.attr(this.idAttributeName,name));if(!this.allowDuplicates){var $prev=this.find(name);if($prev.length>0){$prev.replaceWith($c);$c=$prev}}$c.appendTo(this.$root)};DomItemsManager.prototype.switch=function switchActiveItem($from,$to,shell,state,preventChangeFocus){function hideit(){var fromIsHidden=$from.is("[hidden]");if($from.length>0&&!fromIsHidden){shell.emit(shell.events.willClose,$from,state);$from.find(":focus").blur();$from.attr("hidden","hidden").css("display","none").css("z-index","");shell.emit(shell.events.closed,$from,state)}else $from.find(":focus").blur()}var toName=state.route.name;this.disableAccess();var moveFocus=function moveFocus(){if(!preventChangeFocus){var focusedElement=$to;if(this.autofocusElementSelector){var found=$to.find(this.autofocusElementSelector);found.length>0&&(focusedElement=found.first())}focusedElement.attr("tabindex")||focusedElement.attr("tabindex",-1);focusedElement.is(":focus")&&this.$backstage.focus();setTimeout(function(){focusedElement.focus()},1e3)}}.bind(this);if($to.is("[hidden]")){shell.emit(shell.events.willOpen,$to,state);$to.css("zIndex",-1);$to.removeAttr("hidden").css("display","block");shell.emit(shell.events.itemReady,$to,state);setTimeout(function(){if(toName===shell.currentRoute.name){hideit();$to.css("zIndex",201);this.enableAccess();shell.emit(shell.events.opened,$to,state);moveFocus()}}.bind(this),this.switchDelay)}else{if(toName!==shell.currentRoute.name)return;shell.emit(shell.events.itemReady,$to,state);this.enableAccess();hideit();moveFocus()}};DomItemsManager.prototype.init=function init(){this.$root=$(this.root||"body");this.getAllItems().attr("hidden","hidden").css("display","none");this.$backstage=$('<div class="items-backstage"/>').css({background:this.$root.css("background-color")||"white",position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:0}).appendTo(this.$root);var $disableLayer=$('<div class="items-disable-layer"/>').css({background:"White",opacity:0,position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:-1}).appendTo(this.$root);this.disableAccess=function(){$disableLayer.css("zIndex",90900)};this.enableAccess=function(){$disableLayer.css("zIndex",-2)}}},{"../escapeSelector":452,"../userAgentFlags":483,jquery:14}],473:[function(require,module,exports){"use strict";function getSuid(hash){var suid=+getUrlQuery(hash)._suid;return isNaN(suid)?null:suid}function setSuid(hash,suid){var qs=getUrlQuery(hash);qs.push("_suid");qs._suid=suid;for(var query=[],i=0;i<qs.length;i++)query.push(qs[i]+"="+encodeURIComponent(qs[qs[i]]));if(query=query.join("&")){var index=hash.indexOf("?");index>-1&&(hash=hash.substr(0,index));hash+="?"+query}return hash}function persist(){setTimeout(function(){sessionStorage.setItem("hashbangHistory.store",JSON.stringify(session))},1500)}function checkState(state){return state?Object.keys(state).length>0?state:null:state}function cannonicalUrl(url){var ihash=(url=sanitizeUrl(url||"")).indexOf("#");ihash>-1&&(url=url.substr(ihash+1));return url=url.replace(/^!/,"")}var $=require("jquery"),sanitizeUrl=require("./sanitizeUrl"),getUrlQuery=require("../getUrlQuery"),session=sessionStorage.getItem("hashbangHistory.store");session=session?JSON.parse(session):{states:[]};var hashchangeTriggeredManually=!1,hashbangHistory={pushState:function pushState(state,title,url){url=cannonicalUrl(url);if(null!==(state=checkState(state)||null)){session.states.push(state);url=setSuid(url,session.states.length-1);persist()}hashchangeTriggeredManually=!0;location.hash="#!"+url},replaceState:function replaceState(state,title,url){var suid=getSuid(url=cannonicalUrl(url)),hasOldState=null!==suid;if(null!==(state=checkState(state)||null)||hasOldState){if(hasOldState)session.states[suid]=state;else{session.states.push(state);url=setSuid(url,suid=session.states.length-1)}persist()}var hash="#!"+url;window.history.replaceState(state,title,location.origin+location.pathname+hash)},get state(){var suid=getSuid(location.hash);return null!==suid?session.states[suid]:null},get length(){return window.history.length},go:function go(offset){window.history.go(offset)},back:function back(){window.history.back()},forward:function forward(){window.history.forward()}},$w=$(window);$w.on("hashchange",function(e){var url=e.originalEvent.newURL;url=cannonicalUrl(url);if(hashchangeTriggeredManually)hashchangeTriggeredManually=!1;else{var suid=getSuid(url),state=null;null!==suid&&(state=session.states[suid]);$w.trigger(new $.Event("popstate",{state:state}),"hashbangHistory")}});$w.on("popstate",function(e,source){if("hashbangHistory"!==source){e.preventDefault();e.stopImmediatePropagation()}});module.exports=hashbangHistory},{"../getUrlQuery":456,"./sanitizeUrl":477,jquery:14}],477:[function(require,module,exports){"use strict";function sanitizeUrl(url){return url.replace(/\.{2,}/g,"").replace(/\/{2,}/g,"/")}module.exports=sanitizeUrl},{}],252:[function(require,module,exports){"use strict";var Activity=require("./components/Activity"),EmptyActivity=Activity.extend(function EmptyActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar()});module.exports={_test:EmptyActivity,_styleGuide:require("./activities/_styleGuide"),_modals:require("./activities/_modals"),downloadApp:require("./activities/downloadApp"),calendar:require("./activities/calendar"),datetimePicker:require("./activities/datetimePicker"),clients:require("./activities/clients"),serviceProfessionalService:require("./activities/serviceProfessionalService"),serviceAddresses:require("./activities/serviceAddresses"),dashboard:require("./activities/dashboard"),appointment:require("./activities/appointment"),login:require("./activities/login"),logout:require("./activities/logout"),signup:require("./activities/signup"),welcome:require("./activities/welcome"),addressEditor:require("./activities/addressEditor"),account:require("./activities/account"),inbox:require("./activities/inbox"),conversation:require("./activities/conversation"),help:require("./activities/help"),feedbackForm:require("./activities/feedbackForm"),contactForm:require("./activities/contactForm"),cms:require("./activities/cms"),clientEditor:require("./activities/clientEditor"),schedulingPreferences:require("./activities/schedulingPreferences"),calendarSyncing:require("./activities/calendarSyncing"),bookMeButton:require("./activities/bookMeButton"),ownerInfo:require("./activities/ownerInfo"),privacySettings:require("./activities/privacySettings"),addJobTitle:require("./activities/addJobTitle"),serviceProfessionalServiceEditor:require("./activities/serviceProfessionalServiceEditor"),marketplaceProfile:require("./activities/marketplaceProfile"),servicesOverview:require("./activities/servicesOverview"),verifications:require("./activities/verifications"),education:require("./activities/education"),backgroundCheck:require("./activities/backgroundCheck"),educationForm:require("./activities/educationForm"),bookingPolicies:require("./activities/bookingPolicies"),licensesCertifications:require("./activities/licensesCertifications"),licensesCertificationsForm:require("./activities/licensesCertificationsForm"),workPhotos:require("./activities/workPhotos"),home:require("./activities/home"),learnMoreProfessionals:require("./activities/learnMoreProfessionals"),booking:require("./activities/booking"),terms:require("./activities/terms"),about:require("./activities/about"),payments:require("./activities/payments"),userFees:require("./activities/userFees"),performance:require("./activities/performance"),searchJobTitle:require("./activities/searchJobTitle"),searchCategory:require("./activities/searchCategory"),boardMemberNominations:require("./activities/boardMemberNominations"),paymentAccount:require("./activities/paymentAccount"),payoutPreference:require("./activities/payoutPreference"),myAppointments:require("./activities/myAppointments"),clientAppointment:require("./activities/clientAppointment"),viewBooking:require("./activities/viewBooking"),blog:require("./activities/blog"),ownerPerks:require("./activities/ownerPerks"),cancellationPolicies:require("./activities/cancellationPolicies"),mockupHouseCleanerServiceEditor:require("./activities/mockupHouseCleanerServiceEditor"),userFeePayments:require("./activities/userFeePayments"),ownerAcknowledgment:require("./activities/ownerAcknowledgment"),userProfile:require("./activities/userProfile"),upgrade:require("./activities/upgrade"),listingEditor:require("./activities/listingEditor"),publicContactInfo:require("./activities/publicContactInfo"),publicBio:require("./activities/publicBio"),publicProfilePicture:require("./activities/publicProfilePicture"),serviceProfessionalCustomURL:require("./activities/serviceProfessionalCustomURL"),serviceProfessionalBusinessInfo:require("./activities/serviceProfessionalBusinessInfo"),userBirthDay:require("./activities/userBirthDay"),listing:require("./activities/listing")}},{"./activities/_modals":177,"./activities/_styleGuide":178,"./activities/about":179,"./activities/account":180,"./activities/addJobTitle":181,"./activities/addressEditor":182,"./activities/appointment":183,"./activities/backgroundCheck":184,"./activities/blog":185,"./activities/boardMemberNominations":186,"./activities/bookMeButton":187,"./activities/booking":188,"./activities/bookingPolicies":189,"./activities/calendar":190,"./activities/calendarSyncing":191,"./activities/cancellationPolicies":192,"./activities/clientAppointment":193,"./activities/clientEditor":194,"./activities/clients":195,"./activities/cms":196,"./activities/contactForm":197,"./activities/conversation":198,"./activities/dashboard":199,"./activities/datetimePicker":200,"./activities/downloadApp":201,"./activities/education":202,"./activities/educationForm":203,"./activities/feedbackForm":204,"./activities/help":205,"./activities/home":206,"./activities/inbox":207,"./activities/learnMoreProfessionals":209,"./activities/licensesCertifications":210,"./activities/licensesCertificationsForm":211,"./activities/listing":212,"./activities/listingEditor":213,"./activities/login":214,"./activities/logout":215,"./activities/marketplaceProfile":216,"./activities/mockupHouseCleanerServiceEditor":217,"./activities/myAppointments":218,"./activities/ownerAcknowledgment":219,"./activities/ownerInfo":220,"./activities/ownerPerks":221,"./activities/paymentAccount":222,"./activities/payments":223,"./activities/payoutPreference":224,"./activities/performance":225,"./activities/privacySettings":226,"./activities/publicBio":227,"./activities/publicContactInfo":228,"./activities/publicProfilePicture":229,"./activities/schedulingPreferences":230,"./activities/searchCategory":231,"./activities/searchJobTitle":232,"./activities/serviceAddresses":233,"./activities/serviceProfessionalBusinessInfo":234,"./activities/serviceProfessionalCustomURL":235,"./activities/serviceProfessionalService":236,"./activities/serviceProfessionalServiceEditor":237,"./activities/servicesOverview":238,"./activities/signup":239,"./activities/terms":240,"./activities/upgrade":241,"./activities/userBirthDay":242,"./activities/userFeePayments":243,"./activities/userFees":244,"./activities/userProfile":245,"./activities/verifications":246,"./activities/viewBooking":247,"./activities/welcome":248,"./activities/workPhotos":249,"./components/Activity":255}],251:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),NavBar=require("./viewmodels/NavBar"),NavAction=require("./viewmodels/NavAction"),user=require("./data/userProfile").data;require("./kocomponents/smart-nav-bar-action");exports.extend=function(app){function adjustUserBar(){if(user.isAnonymous()){var prev=app.navBar().leftAction();if(prev!==NavAction.menuIn){app.navBar().leftAction(NavAction.menuIn);app.navBar().prevLeftAction=prev}var prevRight=app.navBar().rightAction();if(prevRight===NavAction.menuNewItem){app.navBar().rightAction(null);app.navBar().prevRightAction=prevRight}}else{if(app.navBar().prevLeftAction){app.navBar().leftAction(app.navBar().prevLeftAction);app.navBar().prevLeftAction=null}if(user.isServiceProfessional()){if(app.navBar().preRightAction){app.navBar().rightAction(app.navBar().preRightAction);app.navBar().preRightAction=null}}else if(app.navBar().rightAction()===NavAction.menuNewItem){app.navBar().preRightAction=app.navBar().rightAction();app.navBar().rightAction(NavAction.goMarketplace)}}}app.navBar=ko.observable(null);var refreshNav=function refreshNav(){$(".AppNav").trigger("contentChange")},autoRefreshNav=function autoRefreshNav(action){if(action){action.text.subscribe(refreshNav);action.isTitle.subscribe(refreshNav);action.icon.subscribe(refreshNav);action.isMenu.subscribe(refreshNav)}};app.updateAppNav=function updateAppNav(activity,state){"navBar"in activity?null===activity.navBar?app.navBar(new NavBar({hidden:!0})):app.navBar(activity.navBar):app.navBar(new NavBar);app.applyNavbarMustReturn(state)||adjustUserBar();refreshNav();autoRefreshNav(app.navBar().leftAction());autoRefreshNav(app.navBar().rightAction())};app.getReturnRequestInfo=function(state){var q=state&&state.route&&state.route.query;if(q.mustReturn){var data={link:null,label:null,isGoBack:!1},returnLink=decodeURIComponent(q.mustReturn);"1"===returnLink||"true"===returnLink?data.isGoBack=!0:data.link=returnLink;data.label=decodeURIComponent(q.returnText||"");return data}return null};app.applyNavbarMustReturn=function(state){var info=app.getReturnRequestInfo(state);if(info){info.isGoBack?app.navBar().leftAction(NavAction.goBack.model.clone({text:info.label,isShell:!0,isTitle:!0})):app.navBar().leftAction(NavAction.goBack.model.clone({link:info.link,text:info.label,isShell:!1,isTitle:!0}));return!0}return!1};app.updateMenu=function updateMenu(){$(".App-menus .navbar-collapse").filter(":visible").collapse("hide")};app.navBarBinding={navBar:app.navBar,photoUrl:ko.observable("about:blank"),userName:ko.observable("Me"),isServiceProfessional:ko.observable(!1),isClient:ko.observable(!1),isApp:ko.observable(!!window.cordova),isInOnboarding:ko.observable(!1),isAtCurrentOnboardingStep:ko.observable(!1),active:ko.observable("")};var onboarding=require("./data/onboarding");ko.computed(function(){app.navBarBinding.isInOnboarding(onboarding.inProgress());app.navBarBinding.isAtCurrentOnboardingStep(onboarding.isAtCurrentStep())});app.navBarBinding.continueOnboarding=function(){onboarding.goCurrentStep()};app.shell.on(app.shell.events.itemReady,function(){app.navBarBinding.active(app.shell.currentRoute.name)});app.navBarBinding.isAnonymous=ko.pureComputed(function(){return!this.isServiceProfessional()&&!this.isClient()},app.navBarBinding);app.navBarBinding.cssIfActive=function(activityName){return ko.computed(function(){return activityName===app.navBarBinding.active()?"active":""})};app.setupNavBarBinding=function setupNavBarBinding(){app.navBarBinding.isApp(!!window.cordova);ko.applyBindings(app.navBarBinding,$(".AppNav").get(0))};app.performsNavBarBack=function performsNavBarBack(options){var nav=this.navBar(),left=nav&&nav.leftAction(),$btn=$(".AppNav .SmartNavBar-edge.left > a.SmartNavBar-btn");if(left&&!left.isMenu()){var event=$.Event("click");event.options=options||{};$btn.trigger(event)}else this.shell&&this.shell.goBack()};var lastNotificationTimer=null;app.showNavBarNotification=function showNavBarNotification(settings){var msg=settings&&settings.message||"Hello World!",duration=settings&&settings.duration||2e3,transitionDuration=settings&&settings.transitionDuration||400,$el=$(".AppNav .SmartNavBar-notification");$el.text(msg);$el.fadeIn(transitionDuration).queue(function(){$el.off("click.manualHide").on("click.manualHide",function(){$el.fadeOut(transitionDuration)});clearTimeout(lastNotificationTimer);lastNotificationTimer=setTimeout(function(){$el.fadeOut(transitionDuration)},duration);$(this).dequeue()})}}},{"./data/onboarding":291,"./data/userProfile":309,"./kocomponents/smart-nav-bar-action":335,"./viewmodels/NavAction":496,"./viewmodels/NavBar":497,jquery:14,knockout:15}],335:[function(require,module,exports){"use strict";function ViewModel(params){propTools.defineGetter(this,"action",function(){return params.action&&params.navBar()?params.navBar()[params.action]():null})}var TAG_NAME="smart-nav-bar-action",TEMPLATE=require("../../html/kocomponents/smart-nav-bar-action.html"),ko=require("knockout"),propTools=require("../utils/jsPropertiesTools");ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:ViewModel})},{"../../html/kocomponents/smart-nav-bar-action.html":161,"../utils/jsPropertiesTools":461,knockout:15}],249:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201964193-showcase-your-work-with-photos";this.jobTitleID=ko.observable(0);this.list=ko.observableArray([]);this.removedItems=ko.observableArray([]);this.takePhotoSupported=ko.observable(photoTools.takePhotoSupported());this.state=workPhotos.state;this.inputElement=ko.observable();this.saveBtnText=ko.pureComputed(function(){return this.state.isSaving()?"Saving..":this.state.isLoading()?"Loading..":this.state.isDeleting()?"Deleting..":"Save"},this);var cameraSettings={targetWidth:1326,targetHeight:996,correctOrientation:!0},addNew=function(fromCamera){this.openPhotoPicker(fromCamera).then(function(data){var newItem=new WorkPhoto({workPhotoID:0,jobTitleID:this.jobTitleID(),url:data.previewUrl,localTempFilePath:data.localUrl,caption:""});this.list.push(newItem)}.bind(this)).catch(function(err){err&&"no image selected"!==err&&"has no access to camera"!==err&&showError({error:err,title:"Error getting photo."})})}.bind(this);this.takePhotoForNew=function(){addNew(!0)}.bind(this);this.pickPhotoForNew=function(){addNew(!1)}.bind(this);this.removeImg=function(item){this.removedItems.push(item);this.list.remove(item)}.bind(this);this.rotateImg=function(item){var d=0|item.rotationAngle();item.rotationAngle((d+90)%360)}.bind(this);this.openPhotoPicker=function(fromCamera){var settings=$.extend({},cameraSettings,{sourceType:fromCamera?window.Camera&&window.Camera.PictureSourceType.CAMERA:window.Camera&&window.Camera.PictureSourceType.PHOTOLIBRARY});return photoTools.takePhotoSupported()?photoTools.cameraGetPicture(settings).then(function(imgLocalUrl){return{localUrl:imgLocalUrl,previewUrl:photoTools.getPreviewPhotoUrl(imgLocalUrl)}}):Promise.reject("Take photo is not supported on the web right now")};var remoteDeleteFlaggedItems=function(){return this.removedItems().reduce(function(cur,next){return cur.then(function(){return workPhotos.delItem(next.jobTitleID(),next.workPhotoID())})},Promise.resolve())}.bind(this),uploadAllItems=function(){return this.list().reduce(function(cur,next){return cur.then(function(){return workPhotos.setItem(next.model.toPlainObject(!0))})},Promise.resolve())}.bind(this);this.save=function(){remoteDeleteFlaggedItems().then(uploadAllItems).then(function(){app.successSave();this.removedItems.removeAll()}.bind(this)).catch(function(err){showError({title:"Error saving your photos",error:err})})}.bind(this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),WorkPhoto=require("../models/WorkPhoto"),photoTools=require("../utils/photoTools");require("jquery.fileupload-image");var workPhotos=require("../data/workPhotos");require("../kocomponents/button-file");var showError=require("../modals/error").show,A=Activity.extend(function WorkPhotosActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/marketplaceProfile",helpLink:this.viewModel.helpLink});this.title("Your work photos");photoTools.takePhotoSupported()||this.viewModel.inputElement.subscribe(function(input){if(input){var PHOTO_WIDTH=442,PHOTO_HEIGHT=332;$(input).fileupload({dataType:"json",autoUpload:!1,acceptFileTypes:/(\.|\/)(jpe?g)$/i,maxFileSize:5e6,disableImageResize:!0,previewMaxWidth:442,previewMaxHeight:332,previewCrop:!1}).on("fileuploadprocessalways",function(e,data){var file=data.files[data.index];if(file.error)console.error("Photo Preview",file.error);else if(file.preview){var newItem=new WorkPhoto({workPhotoID:0,jobTitleID:this.viewModel.jobTitleID(),url:null,localTempFileData:data,localTempPhotoPreview:file.preview,caption:""});this.viewModel.list.push(newItem);setTimeout(function(){this.$activity.find(".WorkPhotos > li:last-child input[type=text]").focus()}.bind(this))}}.bind(this))}}.bind(this))});exports.init=A.init;A.prototype.show=function show(options){this.viewModel.list.removeAll();this.viewModel.removedItems.removeAll();this.viewModel.jobTitleID(0);Activity.prototype.show.call(this,options);var jobTitleID=0|(options&&options.route&&options.route.segments)[0];this.viewModel.jobTitleID(jobTitleID);jobTitleID?workPhotos.getList(jobTitleID).then(function(list){this.viewModel.list(workPhotos.asModel(list))}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err})}):this.viewModel.list([])}},{"../components/Activity":255,"../data/workPhotos":313,"../kocomponents/button-file":314,"../modals/error":343,"../models/WorkPhoto":431,"../utils/photoTools":465,jquery:14,"jquery.fileupload-image":2,knockout:15}],313:[function(require,module,exports){"use strict";var WorkPhoto=require("../models/WorkPhoto"),GroupListRemoteModel=require("./helpers/GroupListRemoteModel"),photoTools=require("../utils/photoTools"),extend=require("jquery").extend,$=require("jquery"),session=require("./session"),remote=require("./drivers/restClient"),baseUrl="me/work-photos/",api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"workPhotoID",Model:WorkPhoto});module.exports=api;api.addLocalforageSupport("workPhotos");api.addRestSupport(remote,baseUrl);session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()});var pushJustBasicDataToRemote=api.pushItemToRemote.bind(api),photoUploadFieldName="photo",pushWithoutFile=function(data){return 0===data.workPhotoID?Promise.resolve(null):pushJustBasicDataToRemote(data)},nativeUploadFile=function pushToRemote(data,options){if(data.localTempFilePath){var uploadSettings={fileKey:"photo",mimeType:"image/jpeg",httpMethod:options.method,params:data,headers:extend(!0,{},remote.extraHeaders)};return photoTools.uploadLocalFileJson(data.localTempFilePath,options.url,uploadSettings)}return pushWithoutFile(data)}.bind(api),webUploadFile=function(data,options){if(data.localTempFileData){var fd=data.localTempFileData;if(!fd)return Promise.resolve(null);fd.url=options.url;fd.type=options.method;fd.paramName="photo";fd.formData=Object.keys(data).filter(function(k){return"localTempFileData"!==k&&"localTempPhotoPreview"!==k}).map(function(k){return{name:k,value:data[k]}});fd.headers=$.extend(!0,{},remote.extraHeaders);return Promise.resolve(fd.submit())}return pushWithoutFile(data)};api.pushItemToRemote=function(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],options={method:itemID?"put":"post",url:remote.baseUrl+baseUrl+groupID+(itemID?"/"+itemID:"")};return photoTools.takePhotoSupported()?nativeUploadFile(data,options):webUploadFile(data,options)}.bind(api)},{"../models/WorkPhoto":431,"../utils/photoTools":465,"./drivers/restClient":271,"./helpers/GroupListRemoteModel":278,"./session":303,jquery:14}],248:[function(require,module,exports){"use strict";function ViewModel(){this.isInOnboarding=onboarding.inProgress;this.user=user;this.isServiceProfessional=user.isServiceProfessional;this.helpLinkProfessionals="/help/relatedArticles/201211855-getting-started";this.helpLinkClients="/help/relatedArticles/201313875-getting-started";this.helpLink=ko.pureComputed(function(){return this.user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);this.startProffesionalOnboarding=function startOnboarding(){userProfile.becomeServiceProfessional();onboarding.isServiceProfessional(!0);onboarding.goNext()};this.startClientOnboarding=function startOnboarding(){onboarding.isServiceProfessional(!1);onboarding.goNext()}}var Activity=require("../components/Activity"),ko=require("knockout"),userProfile=require("../data/userProfile"),user=userProfile.data,onboarding=require("../data/onboarding"),A=Activity.extend(function WelcomeActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);var serviceProfessionalNavBar=Activity.createSubsectionNavBar(onboarding.navbarTitle(),{leftAction:Activity.NavAction.goLogout,helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar(onboarding.navbarTitle(),{leftAction:Activity.NavAction.goLogout,helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar;this.title=ko.pureComputed(function(){return this.user.firstName()?"Welcome, "+this.user.firstName()+"!":" Welcome!"},this.viewModel)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.updateNavBarState();if(!user.isUSUser()){onboarding.finish();userProfile.saveOnboardingStep(onboarding.stepName())}}},{"../components/Activity":255,"../data/onboarding":291,"../data/userProfile":309,knockout:15}],247:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),user=require("../data/userProfile").data,bookings=require("../data/bookings"),showError=require("../modals/error").show,A=Activity.extend(function ViewBookingActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var bookingID=state&&state.route.segments&&state.route.segments[0],currentUserID=user.userID();bookings.getBooking(bookingID).then(function(booking){booking.serviceProfessionalUserID()===currentUserID?this.app.shell.go("/appointment/"+booking.serviceDateID(),null,!0):this.app.shell.go("/clientAppointment/"+bookingID,null,!0)}.bind(this)).catch(function(err){showError({title:"Booking",error:err}).then(function(){this.app.goDashboard()}.bind(this))}.bind(this))}},{"../components/Activity":255,"../data/bookings":262,"../data/userProfile":309,"../modals/error":343}],246:[function(require,module,exports){"use strict";function ViewModel(){this.helpLink="/help/relatedArticles/201967776-adding-verifications-to-your-profile";this.isSyncing=userVerifications.state.isSyncing;this.isLoading=userVerifications.state.isLoading;this.isSaving=userVerifications.state.isSaving;this.userVerifications=ko.observableArray();this.emailInfo=ko.observable('Please click on "Verify my account" in the e-mail we sent you to verify your address. <a class="btn btn-link btn-block"  href="#resendEmailConfirmation">Click here to resend.</a>');this.facebookInfo=ko.pureComputed(function(){return'Letting potential __kind__ know you have a trusted online presence helps them know you\'re real. <a class="btn btn-link btn-block" href="#connectWithFacebook">Click here to connect your account.</a>'.replace(/__kind__/,user.isServiceProfessional()?"clients":"service professionals")})}var ko=require("knockout"),Activity=require("../components/Activity"),user=require("../data/userProfile").data,userVerifications=require("../data/userVerifications"),showNotification=require("../modals/notification").show,showError=require("../modals/error").show,A=Activity.extend(function VerificationsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel;this.navBar=Activity.createSubsectionNavBar("Marketplace profile",{backLink:"/marketplaceProfile",helpLink:this.viewModel.helpLink});this.title("Verifications");this.viewModel.navBar=this.navBar;this.registerHandler({target:this.$activity,event:"click",selector:'[href="#resendEmailConfirmation"]',handler:function(){showNotification({message:"TO-DO: resend email confirmation"})}});this.registerHandler({target:this.$activity,event:"click",selector:'[href="#connectWithFacebook"]',handler:function(){showNotification({message:"TO-DO: ask for connect with Facebook API"})}})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);userVerifications.getList().then(function(list){this.viewModel.userVerifications(list())}.bind(this)).catch(function(err){showError({title:"Error loading your verifications",error:err})}.bind(this))}},{"../components/Activity":255,"../data/userProfile":309,"../data/userVerifications":310,"../modals/error":343,"../modals/notification":344,knockout:15}],310:[function(require,module,exports){"use strict";var UserVerification=require("../models/UserVerification"),ListRemoteModel=require("./helpers/ListRemoteModel"),session=require("./session"),remote=require("./drivers/restClient"),api=new ListRemoteModel({listTtl:{minutes:10},itemIdField:"verificationID",Model:UserVerification});module.exports=api;api.addLocalforageSupport("user-verifications");api.addRestSupport(remote,"me/verifications");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/UserVerification":426,"./drivers/restClient":271,"./helpers/ListRemoteModel":282,"./session":303}],245:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),user=require("../data/userProfile").data,A=Activity.extend(function UserProfileActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=user;this.navBar=Activity.createSectionNavBar(null);this.title("Profile")});exports.init=A.init},{"../components/Activity":255,"../data/userProfile":309}],244:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201964153-how-owner-user-fees-work";this.plans=paymentPlans.list;this.activeUserPaymentPlan=userPaymentPlan.data;this.selectedPaymentPlanID=ko.observable("");this.paymentMethod=new InputPaymentMethod;this.paymentMethod.billingAddress(new Address);this.reset=function(){this.selectedPaymentPlanID("");this.paymentMethod.model.reset()}.bind(this);this.isLoading=ko.pureComputed(function(){return paymentPlans.state.isLoading()||userPaymentPlan.isLoading()});this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.isNew=this.activeUserPaymentPlan.isNew;this.activePaymentPlan=ko.pureComputed(function(){var id=this.activeUserPaymentPlan.paymentPlan();return id?paymentPlans.getObservableItem(id)():null},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);var createSubscription=function(){var plain={paymentPlan:this.selectedPaymentPlanID(),paymentMethod:this.paymentMethod.model.toPlainObject(!0)};userPaymentPlan.createSubscription(plain).then(function(){this.isSaving(!1);showNotification({title:"Payment plan saved",message:"Thank you"}).then(function(){app.successSave()})}.bind(this)).catch(function(err){this.isSaving(!1);showError({title:"Error creating your subscription",error:err})}.bind(this))}.bind(this);this.save=function(){this.isSaving(!0);if(!this.isNew())throw{name:"NotImplemented",description:"Change active plan"};createSubscription()}.bind(this);this.changePlan=function(){showNotification({title:"Not Implemented",message:"Not Implemented"})}}var Activity=require("../components/Activity"),ko=require("knockout"),InputPaymentMethod=require("../models/InputPaymentMethod"),Address=require("../models/Address"),paymentPlans=require("../data/paymentPlans"),userPaymentPlan=require("../data/userPaymentPlan"),showNotification=require("../modals/notification").show,showError=require("../modals/error").show,A=Activity.extend(function UserFeesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLink});this.title("Loconomics plans")});module.exports=A;A.prototype.show=function show(state){this.viewModel.reset();Activity.prototype.show.call(this,state);paymentPlans.sync();userPaymentPlan.sync()}},{"../components/Activity":255,"../data/paymentPlans":294,"../data/userPaymentPlan":308,"../modals/error":343,"../modals/notification":344,"../models/Address":353,"../models/InputPaymentMethod":370,knockout:15}],294:[function(require,module,exports){"use strict";var PaymentPlan=require("../models/PaymentPlan"),ListRemoteModel=require("./helpers/ListRemoteModel"),session=require("./session"),data=[{paymentPlanID:"",name:"Free",summary:"$0",description:require("../../html/parts/PaymentPlanFree.html")},{paymentPlanID:"OwnerGrowth",name:"Owner Growth",summary:"$19 charged once a month",description:require("../../html/parts/PaymentPlanGrowth.html")},{paymentPlanID:"OwnerPro",name:"Owner Pro",summary:"$39 charged once a month",description:require("../../html/parts/PaymentPlanPro.html")},{paymentPlanID:"OwnerProAnnual",name:"Owner Pro Annual",summary:"$390 charged once a year (Save $78 with this option)",description:require("../../html/parts/PaymentPlanProAnnual.html")}],api=new ListRemoteModel({listTtl:{days:1},itemIdField:"paymentPlanID",Model:PaymentPlan});module.exports=api;session.on.cacheCleaningRequested.subscribe(function(){});api.list=data;api.getList=function(){return Promise.resolve(api.list())}},{"../../html/parts/PaymentPlanFree.html":173,"../../html/parts/PaymentPlanGrowth.html":174,"../../html/parts/PaymentPlanPro.html":175,"../../html/parts/PaymentPlanProAnnual.html":176,"../models/PaymentPlan":389,"./helpers/ListRemoteModel":282,"./session":303}],389:[function(require,module,exports){"use strict";function PaymentPlan(values){Model(this);this.model.defProperties({paymentPlanID:"",name:"",summary:"",description:""},values)}var Model=require("../models/Model");module.exports=PaymentPlan},{"../models/Model":386}],243:[function(require,module,exports){"use strict";function ViewModel(){this.helpLink="/help/relatedArticles/201964153-how-owner-user-fees-work";this.isLoading=userFeePayments.state.isLoading;this.isSyncing=userFeePayments.state.isSyncing;this.payments=ko.observableArray([])}var Activity=require("../components/Activity"),ko=require("knockout"),userFeePayments=require("../data/userFeePayments"),showError=require("../modals/error").show,A=Activity.extend(function UserFeePaymentsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel;this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLink});this.title("Payment history")});module.exports=A;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);userFeePayments.getList().then(function(threads){this.viewModel.payments(threads())}.bind(this)).catch(function(err){showError({title:"Error loading payments",error:err})})}},{"../components/Activity":255,"../data/userFeePayments":305,"../modals/error":343,knockout:15}],305:[function(require,module,exports){"use strict";var UserFeePayment=require("../models/UserFeePayment"),ListRemoteModel=require("./helpers/ListRemoteModel"),session=require("./session"),remote=require("./drivers/restClient"),api=new ListRemoteModel({listTtl:{minutes:10},itemIdField:"userFeePaymentID",Model:UserFeePayment});module.exports=api;api.addLocalforageSupport("user-fee-payments");api.addRestSupport(remote,"me/fee-payments");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/UserFeePayment":421,"./drivers/restClient":271,"./helpers/ListRemoteModel":282,"./session":303}],421:[function(require,module,exports){"use strict";function UserFeePayment(values){Model(this);this.model.defProperties({userFeePaymentID:0,userID:0,paymentTransactionID:"",subscriptionID:"",paymentDate:null,paymentPlan:"",paymentAmount:0,paymentMethod:"",paymentStatus:"",createdDate:null,updatedDate:null},values)}var Model=require("../models/Model");module.exports=UserFeePayment},{"../models/Model":386}],242:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967756-telling-the-community-about-yourself";this.submitText=ko.pureComputed(function(){return this.isLoading()?"Loading...":this.isSaving()?"Saving...":"Save"},this);this.isLoading=userProfile.isLoading;this.isSaving=userProfile.isSaving;this.isSyncing=userProfile.isSyncing;this.isLocked=userProfile.isLocked;var profileVersion=userProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})});this.profile=profileVersion.version;this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]);this.selectedBirthMonth=ko.computed({read:function(){var birthMonth=this.profile.birthMonth();return birthMonth?this.months()[birthMonth-1]:null},write:function(month){this.profile.birthMonth(month&&month.id||null)},owner:this});this.monthDays=ko.observableArray([]);for(var iday=1;iday<=31;iday++)this.monthDays.push(iday);this.save=function(){profileVersion.pushSave().then(function(){app.successSave()}).catch(function(){})}.bind(this);this.discard=function(){profileVersion.pull({evenIfNewer:!0})};this.sync=function(){userProfile.sync()}}var Activity=require("../components/Activity"),ko=require("knockout"),userProfile=require("../data/userProfile"),user=userProfile.data,A=Activity.extend(function UserBirthDay(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;var backLink=user.isServiceProfessional()?"/listingEditor":"/userProfile";this.navBar=Activity.createSubsectionNavBar("Edit listing",{backLink:backLink,helpLink:this.viewModel.helpLink});this.viewModel.navBar=this.navBar;this.title=ko.pureComputed(function(){return" Your birthday"},this.viewModel)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.discard();this.viewModel.sync()}},{"../components/Activity":255,"../data/userProfile":309,knockout:15}],241:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function UpgradeActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.navBar=new Activity.NavBar({title:null,leftAction:Activity.NavAction.menuIn});this.title("Become a member of Loconomics")});exports.init=A.init},{"../components/Activity":255}],240:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),DEFAULT_TAB="terms-of-service";require("../kocomponents/tab-list");var A=Activity.extend(function TermsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);var shell=this.app.shell,observableRoute=shell.getCurrentObservableRoute();this.activeTabName=ko.pureComputed({read:function(){var route=observableRoute();return route&&route.segments&&route.segments[0]},write:function(tabName){shell.replaceState(null,null,"#!terms/"+tabName)},owner:this});this.title=ko.pureComputed(function(){switch(this.activeTabName()){case"privacy-policy":return"PRIVACY POLICY";case"background-check-policy":return"BACKGROUND CHECK AND LICENSE VERIFICATION POLICY";case"fees":return"FEES";case"business-associate-agreement":return"BUSINESS ASSOCIATE AGREEMENT";case"accessibility-policy":return"ACCESSIBILITY POLICY";default:return"TERMS OF SERVICE"}},this)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.activeTabName()||this.activeTabName(DEFAULT_TAB)}},{"../components/Activity":255,"../kocomponents/tab-list":337,knockout:15}],239:[function(require,module,exports){"use strict";function ViewModel(app){this.signup=ko.observable();this.reset=function(){var signup=this.signup();signup instanceof SignupVM&&signup.reset()};this.signup.subscribe(this.reset.bind(this));this.redirect=function(){app.goDashboard()};this.setupWith=function(options){var signup=this.signup();if(signup instanceof SignupVM){signup.email(options.email||void 0);signup.emailIsLocked(!!options.email);signup.confirmationCode(options.confirmationCode||void 0)}};this.inApp=ko.observable(!!window.cordova)}var Activity=require("../components/Activity"),SignupVM=require("../viewmodels/Signup"),A=Activity.extend(function SignupActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);this.title("Welcome to Loconomics");this.viewModel.focusWrongField=function(){var $el=this.$activity.find(".form-group.has-error:first").find("input");setTimeout(function(){$el.focus()},100)}.bind(this)});exports.init=A.init;A.prototype.show=function show(options){this.viewModel.reset();Activity.prototype.show.call(this,options);var q=options&&options.route&&options.route.query||{};this.viewModel.setupWith({email:q.email,confirmationCode:q.confirmationCode})};var ko=require("knockout")},{"../components/Activity":255,"../viewmodels/Signup":510,knockout:15}],238:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967766-describing-your-services-to-clients";this.jobTitleID=ko.observable(0);this.isLoadingUserJobTitle=ko.observable(!1);this.userJobTitle=ko.observable(null);this.jobTitleName=ko.observable("Job Title");this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/servicesOverview");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.intro=ko.observable(null);this.serviceAttributesControl=serviceAttributes.newItemVersion();this.serviceAttributes=this.serviceAttributesControl.version;this.jobTitleServiceAttributesControl=jobTitleServiceAttributes.newItemVersion();this.jobTitleServiceAttributes=this.jobTitleServiceAttributesControl.original;this.isLoading=ko.pureComputed(function(){return this.isLoadingUserJobTitle()||this.serviceAttributesControl.state.isLoading()||this.jobTitleServiceAttributesControl.state.isLoading()},this);this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.categoriesView=ko.pureComputed(function(){var userAtts=this.serviceAttributes;return this.jobTitleServiceAttributes.serviceAttributes().map(function(cat){return new AttributesCategoryVM(cat,userAtts)})},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.save=function(){var ujt=this.userJobTitle();if(ujt){this.isSaving(!0);var plain=ujt.model.toPlainObject();plain.intro=this.intro();Promise.all([this.serviceAttributesControl.save(),userJobProfile.setUserJobTitle(plain)]).then(function(){this.isSaving(!1);var props=this.serviceAttributes.proposedServiceAttributes(),propCats=props&&Object.keys(props);propCats&&propCats.length&&propCats.reduce(function(sum,k){var cat=props[k];return sum+(cat&&cat.length||0)},0)>0&&this.jobTitleServiceAttributesControl.load(void 0,!0);this.serviceAttributes.proposedServiceAttributes({});app.successSave()}.bind(this)).catch(function(err){this.isSaving(!1);showError({title:"Error saving your Services Overview",error:err})}.bind(this))}}.bind(this)}function AttributesCategoryVM(cat,userAtts){var catID=cat.serviceAttributeCategoryID(),selectedAttsIds=userAtts.serviceAttributes.getServiceCategoryAttributes(catID);this.category=ko.observable(cat);this.proposedServiceAttributes=ko.pureComputed(function(){var props=userAtts.proposedServiceAttributes();return props&&props[catID]&&props[catID].length?props[catID].map(function(name){return new ServiceAttribute({name:name})}):[]},this);this.selectedAttributes=ko.pureComputed(function(){var atts=cat.serviceAttributes().filter(function(att){return selectedAttsIds().indexOf(att.serviceAttributeID())>-1});return atts.concat.apply(atts,this.proposedServiceAttributes())},this);this.availableAttributes=ko.computed(function(){var props=this.proposedServiceAttributes(),atts=selectedAttsIds();return cat.serviceAttributes().filter(function(att){return!1!=(-1===atts.indexOf(att.serviceAttributeID()))&&props.every(function(propAtt){return att.name()!==propAtt.name()})})},this);var foundAttItem=function(att,item){return item.name()===att.name};this.pushAttributeName=function(attName){var newOne=attName||"",isEmpty=/^\s*$/.test(newOne),wasFound=this.selectedAttributes().some(foundAttItem.bind(null,{name:newOne}));isEmpty||wasFound||userAtts.proposedServiceAttributes.push(catID,newOne)}.bind(this);this.pushAttribute=function(att){att.serviceAttributeID()&&userAtts.serviceAttributes.push(catID,att.serviceAttributeID())};this.removeAttribute=function(att){var id=att.serviceAttributeID();id?userAtts.serviceAttributes.remove(catID,id):userAtts.proposedServiceAttributes.remove(catID,att.name())}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),jobTitles=require("../data/jobTitles"),userJobProfile=require("../data/userJobProfile"),serviceAttributes=require("../data/serviceAttributes"),jobTitleServiceAttributes=require("../data/jobTitleServiceAttributes"),DEFAULT_BACK_LINK="/listingEditor",DEFAULT_BACK_TEXT="Back";require("../kocomponents/servicesOverview/attributes-combobox");var showError=require("../modals/error").show,A=Activity.extend(function ServicesOverviewActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.title("Overview of your services");this.navBar=Activity.createSubsectionNavBar("Back",{backLink:"/listingEditor",helpLink:this.viewModel.helpLink});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName());this.updateNavBarState()}.bind(this)).catch(function(err){showError({title:"There was an error while loading the job title.",error:err})});this.viewModel.isLoadingUserJobTitle(!0);Promise.all([userJobProfile.getUserJobTitle(jobTitleID),this.viewModel.serviceAttributesControl.load(jobTitleID),this.viewModel.jobTitleServiceAttributesControl.load(jobTitleID)]).then(function(datas){var userJobTitle=datas&&datas[0];this.viewModel.userJobTitle(userJobTitle);this.viewModel.intro(userJobTitle.intro());this.viewModel.isLoadingUserJobTitle(!1)}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err});this.viewModel.isLoadingUserJobTitle(!1)});var found=/servicesOverview\/(\d+)/i.exec(window.location);if((found&&0|found[1])!==jobTitleID){var url="/servicesOverview/"+jobTitleID;this.app.shell.replaceState(null,null,url)}}else{this.viewModel.jobTitleName("Job Title");this.viewModel.serviceAttributesControl.reset();this.viewModel.jobTitleServiceAttributesControl.reset();this.updateNavBarState()}}.bind(this)})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!this.app.applyNavbarMustReturn(this.requestData)){var text=this.viewModel.jobTitleName()||"Back",id=this.viewModel.jobTitleID(),link=id?"/listingEditor/"+id:"/listingEditor";this.navBar.leftAction().model.updateWith({text:text,link:link})}};A.prototype.show=function show(state){this.viewModel.jobTitleID(null);this.viewModel.intro(null);this.viewModel.serviceAttributes.proposedServiceAttributes({});Activity.prototype.show.call(this,state);var jid=0|(state&&state.route&&state.route.segments)[0];this.viewModel.jobTitleID(jid);jid||this.viewModel.jobTitles.sync()};var UserJobProfile=require("../viewmodels/UserJobProfile"),ServiceAttribute=require("../models/ServiceAttribute")},{"../components/Activity":255,"../data/jobTitleServiceAttributes":285,"../data/jobTitles":286,"../data/serviceAttributes":301,"../data/userJobProfile":306,"../kocomponents/servicesOverview/attributes-combobox":334,"../modals/error":343,"../models/ServiceAttribute":410,"../viewmodels/UserJobProfile":512,knockout:15}],334:[function(require,module,exports){"use strict";function ViewModel(params,refs){this.id=ko.unwrap(params.id);this.name=ko.unwrap(params.name)||this.id;this.isDisabled=getObservable(params.isDisabled);this.availableAttributes=getObservable(params.availableAttributes);this.onSelectAttribute=params.onSelectAttribute;this.onSelectAttributeName=params.onSelectAttributeName;this.value=ko.observable("");this.expandedByUser=ko.observable(!1);this.getInputElement=function getInputElement(){return getInputElement._cached?getInputElement._cached:getInputElement._cached=refs.root.querySelector("input")};var textSearch=require("../../utils/textSearch");this.suggestions=ko.pureComputed(function(){var s=this.value(),a=this.availableAttributes(),attributes;s?(attributes=a.filter(function(att){return textSearch(s,att.name())})).unshift(new ServiceAttribute({serviceAttributeID:0,name:s})):attributes=this.expandedByUser()?a:[];return attributes},this);this.selectAttribute=function(value,attribute){if(attribute&&attribute.serviceAttributeID()){this.onSelectAttribute(attribute);return{value:ActionForValue.keepUserInput,keepExpanded:!0}}this.onSelectAttributeName(value);return{value:ActionForValue.clear,keepExpanded:!1}}.bind(this);this.clearValue=function(){this.value("");this.expandedByUser(!1)}.bind(this);this.expandAutocomplete=function(){this.expandedByUser(!0);this.getInputElement().focus()}.bind(this);this.collapseAutocomplete=function(){this.expandedByUser(!1)}.bind(this)}var TAG_NAME="servicesoverview-attributes-combobox",TEMPLATE=require("../../../html/kocomponents/servicesOverview/attributes-combobox.html"),ko=require("knockout"),getObservable=require("../../utils/getObservable"),ActionForValue=require("../input-autocomplete").ActionForValue,ServiceAttribute=require("../../models/ServiceAttribute"),create=function(params,componentInfo){return new ViewModel(params,{root:componentInfo.element})};ko.components.register(TAG_NAME,{template:TEMPLATE,synchronous:!0,viewModel:{createViewModel:create}})},{"../../../html/kocomponents/servicesOverview/attributes-combobox.html":160,"../../models/ServiceAttribute":410,"../../utils/getObservable":455,"../../utils/textSearch":480,"../input-autocomplete":315,knockout:15}],301:[function(require,module,exports){"use strict";var UserJobTitleServiceAttributes=require("../models/UserJobTitleServiceAttributes"),session=require("./session"),GroupRemoteModel=require("./helpers/GroupRemoteModel"),remote=require("./drivers/restClient"),api=new GroupRemoteModel({ttl:{minutes:1},itemIdField:"jobTitleID",Model:UserJobTitleServiceAttributes});module.exports=api;api.addLocalforageSupport("service-attributes/");api.addRestSupport(remote,"me/service-attributes/");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/UserJobTitleServiceAttributes":423,"./drivers/restClient":271,"./helpers/GroupRemoteModel":279,"./session":303}],423:[function(require,module,exports){"use strict";function extendValuesByCategory(obs){obs.serviceAttributeCategoriesIDs=ko.pureComputed(function(){return Object.keys(obs()||{}).filter(function(key){return 0==(0|key)})});var catsObs={};obs.getServiceCategoryAttributes=function(catID){var catObs=catsObs[catID]=catsObs[catID]||ko.observable({});return ko.computed(function(){var base=obs.peek();catObs();return base&&base[catID]||[]})};var prevValue=obs();obs.subscribe(function(v){if(v!==prevValue){prevValue=v;Object.keys(catsObs).forEach(function(a){a.valueHasMutated&&a.valueHasMutated()})}});obs.push=function(catID,attID){var v=obs();if(v){var cat=v[catID]||(v[catID]=[]);if(-1===cat.indexOf(attID)){cat.push(attID);obs.valueHasMutated();catsObs[catID]&&catsObs[catID].valueHasMutated()}}else{(v={})[catID]=[attID];obs(v);catsObs[catID]&&catsObs[catID].valueHasMutated()}};obs.remove=function(catID,attID){var v=obs(),cat=v&&v[catID];if(cat){var i=cat.indexOf(attID);if(i>-1){cat.splice(i,1);obs.valueHasMutated();catsObs[catID]&&catsObs[catID].valueHasMutated()}}}}function UserJobTitleServiceAttributes(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,serviceAttributes:{},proposedServiceAttributes:{},experienceLevelID:!1,languageID:0,countryID:0},values);extendValuesByCategory(this.serviceAttributes);extendValuesByCategory(this.proposedServiceAttributes)}var Model=require("./Model"),ko=require("knockout");module.exports=UserJobTitleServiceAttributes},{"./Model":386,knockout:15}],285:[function(require,module,exports){"use strict";var JobTitleServiceAttributes=require("../models/JobTitleServiceAttributes"),session=require("./session"),GroupRemoteModel=require("./helpers/GroupRemoteModel"),remote=require("./drivers/restClient"),api=new GroupRemoteModel({ttl:{hours:1},itemIdField:"jobTitleID",Model:JobTitleServiceAttributes});module.exports=api;api.addLocalforageSupport("job-title-service-attributes/");api.addRestSupport(remote,"job-title-service-attributes/");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/JobTitleServiceAttributes":378,"./drivers/restClient":271,"./helpers/GroupRemoteModel":279,"./session":303}],378:[function(require,module,exports){"use strict";function JobTitleServiceAttributes(values){Model(this);this.model.defProperties({jobTitleID:0,serviceAttributes:{isArray:!0,Model:ServiceAttributeCategory},experienceLevels:{isArray:!0,Model:ExperienceLevel},languageID:0,countryID:0},values)}var Model=require("./Model"),ServiceAttributeCategory=require("./ServiceAttributeCategory"),ExperienceLevel=require("./ExperienceLevel");module.exports=JobTitleServiceAttributes},{"./ExperienceLevel":365,"./Model":386,"./ServiceAttributeCategory":411}],237:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967166-listing-and-pricing-your-services";this.isInOnboarding=onboarding.inProgress;this.isLoading=ko.observable(!1);this.isSaving=serviceProfessionalServices.state.isSaving;this.isSyncing=serviceProfessionalServices.state.isSyncing;this.isDeleting=serviceProfessionalServices.state.isDeleting;this.jobTitleID=ko.observable(0);this.serviceProfessionalServiceID=ko.observable(0);this.moneySymbol=ko.observable("$");this.pricingType=ko.observable(new PricingType);this.serviceProfessionalServiceVersion=ko.observable(null);this.serviceProfessionalService=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return v?v.version:null},this);this.client=ko.observable(null);this.current=ko.pureComputed(function(){var t=this.pricingType(),p=this.serviceProfessionalService();return t&&p?{type:t,pricing:p}:null},this);this.showFirstTimeClientsOnlyLabel=ko.pureComputed(function(){return this.pricingType()&&this.pricingType().firstTimeClientsOnlyLabel()&&!this.client()},this);this.wasRemoved=ko.observable(!1);this.isLocked=ko.computed(function(){return this.isDeleting()||serviceProfessionalServices.state.isLocked()},this);this.isNew=ko.pureComputed(function(){var p=this.serviceProfessionalService();return p&&!p.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){serviceProfessionalServices.setItem(this.serviceProfessionalService().model.toPlainObject()).then(function(serverData){this.serviceProfessionalService().model.updateWith(serverData);this.serviceProfessionalServiceVersion().push({evenIfObsolete:!0});this.onSave(serverData)}.bind(this)).catch(function(err){showError({title:"Unable to save the service.",error:err})})}.bind(this);this.confirmRemoval=function(){var p=this.pricingType();showConfirm({title:"Delete "+(p&&p.singularName()),message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){serviceProfessionalServices.delItem(this.jobTitleID(),this.serviceProfessionalServiceID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this)).catch(function(err){showError({title:"Unable to delete the service.",error:err})})}.bind(this)}var ko=require("knockout"),Activity=require("../components/Activity"),PricingType=require("../models/PricingType"),RouteMatcher=require("../utils/Router").RouteMatcher,Route=require("../utils/Router").Route,onboarding=require("../data/onboarding"),clients=require("../data/clients"),pricingTypes=require("../data/pricingTypes"),serviceProfessionalServices=require("../data/serviceProfessionalServices"),showConfirm=require("../modals/confirm").show,showError=require("../modals/error").show,A=Activity.extend(function ServiceProfessionalServiceEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Services",{helpLink:this.viewModel.helpLink});this.title=ko.pureComputed(function(){var pricingName=this.pricingType()&&this.pricingType().singularName()||"Service",prefix=this.isNew()?"New ":"",postfix=this.client()?" only for "+this.client().firstName():"";return this.isLoading()?"Loading...":this.serviceProfessionalServiceVersion()?prefix+pricingName+postfix:"Unable to load service"},this.viewModel);this.viewModel.onSave=function(pricing){if(this.requestData.selectedServices){this.requestData.selectedServices.push({serviceProfessionalServiceID:pricing.serviceProfessionalServiceID,totalPrice:pricing.totalPrice});this.app.shell.goBack(this.requestData)}else onboarding.inProgress()?this.app.shell.goBack():this.app.successSave()}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/serviceProfessionalService/"+this.viewModel.jobTitleID();this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.wasRemoved(!1);this.viewModel.serviceProfessionalServiceVersion(null);this.viewModel.pricingType(null);var paramsDefaults={jobTitleID:0,serviceID:0,pricingTypeID:0,clientID:0},params=new RouteMatcher([new Route("/:jobTitleID/pricingType/:pricingTypeID/client/:clientID/new"),new Route("/:jobTitleID/pricingType/:pricingTypeID/new"),new Route("/:jobTitleID/:serviceID")],paramsDefaults).match(options.route.path)||{},jobTitleID=0|params.jobTitleID,pricingTypeID=0|params.pricingTypeID,serviceProfessionalServiceID=0|params.serviceID,clientID=0|params.clientID;this.viewModel.jobTitleID(jobTitleID);this.viewModel.serviceProfessionalServiceID(serviceProfessionalServiceID);this.updateNavBarState();var pricingSetup=function pricingSetup(){var c=this.viewModel.current();if(c){c.pricing.name(c.type.fixedName()||c.pricing.name()||c.type.suggestedName());c.pricing.refreshNoPriceRate()}}.bind(this),showLoadingError=function(error){this.viewModel.isLoading(!1);showError({title:"Unable to load service",error:error}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this);this.viewModel.isLoading(!0);var loadClient=function(service){var clientID=service.clientID();if(clientID)return clients.getItem(clientID).then(function(client){this.viewModel.client(client)}.bind(this));this.viewModel.client(null);return Promise.resolve(service)}.bind(this);pricingTypeID?pricingTypes.getItem(pricingTypeID).then(function(type){this.viewModel.pricingType(type);var serviceVersion=serviceProfessionalServices.newItemVersion({jobTitleID:jobTitleID,pricingTypeID:pricingTypeID,visibleToClientID:clientID});this.viewModel.serviceProfessionalServiceVersion(serviceVersion);pricingSetup();return serviceVersion.version}.bind(this)).then(loadClient).catch(showLoadingError).then(function(){this.viewModel.isLoading(!1)}.bind(this)):serviceProfessionalServiceID?serviceProfessionalServices.getItemVersion(jobTitleID,serviceProfessionalServiceID).then(function(serviceProfessionalServiceVersion){if(!serviceProfessionalServiceVersion)throw new Error("Unable to load service");return pricingTypes.getItem(serviceProfessionalServiceVersion.version.pricingTypeID()).then(function(type){this.viewModel.pricingType(type);this.viewModel.serviceProfessionalServiceVersion(serviceProfessionalServiceVersion);pricingSetup();return serviceProfessionalServiceVersion.version}.bind(this))}.bind(this)).then(loadClient).catch(showLoadingError).then(function(){this.viewModel.isLoading(!1)}.bind(this)):showLoadingError("Unable to load service — missing parameters")}},{"../components/Activity":255,"../data/clients":269,"../data/onboarding":291,"../data/pricingTypes":296,"../data/serviceProfessionalServices":302,"../modals/confirm":342,"../modals/error":343,"../models/PricingType":395,"../utils/Router":440,knockout:15}],236:[function(require,module,exports){"use strict";function ViewModel(app){ServiceProfessionalServiceViewModel.call(this,app);this.clientID=ko.observable(null);this.client=ko.observable(null);this.requestData=ko.observable(null);this.serviceEditorCancelLink=ko.observable(null);this.helpLink="/help/relatedArticles/201967166-listing-and-pricing-your-services";this.isInOnboarding=onboarding.inProgress;this.isLocked=this.isLoading;this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/serviceProfessionalService");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());this.loadServicesData();return!1}.bind(this);this.loadServicesData=function(){var clientID=this.clientID(),jobTitleID=this.jobTitleID(),services=null;services=this.isSelectionMode()?serviceProfessionalServices.getServicesBookableByProvider(clientID,jobTitleID):clientID?serviceProfessionalServices.getClientSpecificServicesForJobTitle(clientID,jobTitleID):serviceProfessionalServices.getList(jobTitleID);return this.loadData(null,jobTitleID,services)}.bind(this);this.clientName=ko.pureComputed(function(){return this.client()&&this.client().firstName()||""},this);this.serviceListGroupsFactory=function(services,pricingTypes){var factories=serviceListGroupFactories,listGroupsFactory=this.isSelectionMode()?factories.providerBookedServices:factories.providerManagedServices,isClientSpecific=!!this.clientID();return listGroupsFactory(services=this.isAdditionMode()?[]:services,pricingTypes,this.clientName(),isClientSpecific)};this.clientFullName=ko.pureComputed(function(){return this.client()&&this.client().fullName()||""},this);this.clientManagerLink=ko.pureComputed(function(){return this.client()||this.isSelectionMode()||onboarding.inProgress()?null:"#!/clients"},this);this.jobTitleName=ko.pureComputed(function(){return this.jobTitle()&&this.jobTitle().singularName()||""},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":"Save and continue"},this);this.onboardingNextReady=ko.computed(function(){var isin=onboarding.inProgress(),hasPricing=this.list().length>0;return isin&&hasPricing},this);this.editServiceRequest=function(){return $.extend({cancelLink:this.serviceEditorCancelLink()},this.requestData())}.bind(this);this.newServiceRequest=function(){return $.extend({cancelLink:this.serviceEditorCancelLink()},this.requestData())}.bind(this);var baseNewServiceURL=this.newServiceURL.bind(this);this.newServiceURL=function(jobTitleID,pricingTypeID,isClientSpecific){return isClientSpecific?"#!serviceProfessionalServiceEditor/"+jobTitleID+"/pricingType/"+pricingTypeID+"/client/"+this.clientID()+"/new":baseNewServiceURL(jobTitleID,pricingTypeID)}.bind(this);this.endSelection=function(data,event){if(onboarding.inProgress()){onboarding.selectedJobTitleID(this.jobTitleID());onboarding.goNext()}else this.returnSelected(this.selectedServices().map(function(pricing){return pricing.model.toPlainObject(!0)}),this.jobTitleID());event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.selectedServiceRequest=function(pricing){return pricing.model.toPlainObject(!0)}}var ko=require("knockout"),Activity=require("../components/Activity"),ServiceProfessionalServiceViewModel=require("../viewmodels/ServiceProfessionalService"),$=require("jquery"),RouteMatcher=require("../utils/Router").RouteMatcher,Route=require("../utils/Router").Route,serviceListGroupFactories=require("../viewmodels/ServiceListGroupFactories"),onboarding=require("../data/onboarding"),clients=require("../data/clients"),serviceProfessionalServices=require("../data/serviceProfessionalServices"),DEFAULT_BACK_LINK="/listingEditor",showError=require("../modals/error").show,A=Activity.extend(function ServiceProfessionalServiceActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/listingEditor",helpLink:this.viewModel.helpLink});this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(!0);this.viewModel.navBar=this.navBar;this.title=ko.pureComputed(function(){return this.isInOnboarding()&&this.jobTitleName()?"Add your first "+this.jobTitleName()+" offering":this.jobTitleName()&&!this.isSelectionMode()?this.jobTitleName()+" offerings":this.jobTitleName()&&this.isSelectionMode()?"What's included in "+this.clientName()+"'s "+this.jobTitleName()+" appointment?":"Select a job title"},this.viewModel);this.registerHandler({target:this.viewModel.jobTitle,handler:function(){this.updateNavBarState();this.viewModel.serviceEditorCancelLink(this.serviceEditorCancelLink(this.viewModel.isAdditionMode()))}.bind(this)});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){var params=this.parseRoute(this.requestData.route.path),urlJobTitleID=0|params.jobTitleID,clientID=0|params.clientID;if(urlJobTitleID!==jobTitleID){var url=this.buildRoute(jobTitleID,clientID,params.isNew);this.app.shell.replaceState(this.requestData,null,url)}}}.bind(this)});this.registerHandler({target:this.viewModel.clientID,handler:function(clientID){var viewModel=this.viewModel;viewModel.client(null);clientID&&clients.getItem(clientID).then(function(client){viewModel.client(client)}).catch(function(error){showError({title:"Unable to load client.",error:error})})}.bind(this)});this.registerHandler({target:this.viewModel.client,handler:function(){this.updateNavBarState()}.bind(this)});this.viewModel.returnSelected=function(pricing,jobTitleID){this.requestData.selectedServices=pricing;this.requestData.selectedJobTitleID=jobTitleID;this.app.shell.goBack(this.requestData)}.bind(this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.applyOwnNavbarRules=function(){this.navBar.title(this.requestData.title||"");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink,this.requestData);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction,!0);this.navBar.leftAction().model.updateWith(this.newLeftAction(),!0)}};A.prototype.newLeftAction=function(){var leftAction={},jid=this.viewModel.jobTitleID(),url=this.mustReturnTo||"/listingEditor"+(jid?"/"+jid:""),handler=this.viewModel.isSelectionMode()?this.returnRequest:null;leftAction.link=url;leftAction.text=this.leftActionText();leftAction.handler=handler;return leftAction};A.prototype.leftActionText=function(){var clientName=this.viewModel.client()&&this.viewModel.clientFullName(),jobTitle=this.viewModel.jobTitle()&&this.viewModel.jobTitle().singularName();return this.requestData.navTitle||clientName||jobTitle||"Back"};A.prototype.updateNavBarState=function updateNavBarState(){onboarding.updateNavBar(this.navBar)||this.applyOwnNavbarRules()};A.prototype.referrerURL=function(){return this.app.shell.referrerRoute&&this.app.shell.referrerRoute.url||"/"};A.prototype.serviceEditorCancelLink=function(isAdditionMode){return isAdditionMode?this.referrerURL():"/serviceProfessionalService"+this.requestData.route.path};A.prototype.buildRoute=function(jobTitleID,clientID,isAdditionMode){return"/serviceProfessionalService"+("/"+jobTitleID)+(clientID>0?"/client/"+clientID:"")+(isAdditionMode?"/new":"")};A.prototype.parseRoute=function(url){var paramsDefaults={jobTitleID:0,isNew:!1,clientID:null};return new RouteMatcher([new Route("/:jobTitleID/new",{isNew:!0}),new Route("/:jobTitleID/client/:clientID/new",{isNew:!0}),new Route("/:jobTitleID/client/:clientID"),new Route("/new",{isNew:!0}),new Route("/:jobTitleID")],paramsDefaults).match(url)||paramsDefaults};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.mustReturnTo=this.requestData.route.query.mustReturn||this.mustReturnTo;this.viewModel.reset();this.viewModel.requestData(this.requestData);this.viewModel.preSelectedServices(this.requestData.selectedServices||[]);this.viewModel.isSelectionMode(!0===this.requestData.selectPricing);var params=this.parseRoute(options.route.path),jobTitleID=0|params.jobTitleID;0===jobTitleID&&options.selectedJobTitleID>0&&(jobTitleID=0|options.selectedJobTitleID);this.viewModel.clientID(0|params.clientID);var isAdditionMode=params.isNew;this.viewModel.serviceEditorCancelLink(this.serviceEditorCancelLink(isAdditionMode));isAdditionMode&&(this.requestData.cancelLink=this.referrerURL());this.viewModel.isAdditionMode(isAdditionMode);this.updateNavBarState();this.viewModel.jobTitleID(jobTitleID);if(0===jobTitleID){this.viewModel.clearData();this.viewModel.jobTitles.sync()}else this.viewModel.loadServicesData()};var UserJobProfile=require("../viewmodels/UserJobProfile");ViewModel._inherits(ServiceProfessionalServiceViewModel)},{"../components/Activity":255,"../data/clients":269,"../data/onboarding":291,"../data/serviceProfessionalServices":302,"../modals/error":343,"../utils/Router":440,"../viewmodels/ServiceListGroupFactories":508,"../viewmodels/ServiceProfessionalService":509,"../viewmodels/UserJobProfile":512,jquery:14,knockout:15}],235:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),ListingVM=require("../viewmodels/ListingVM"),A=Activity.extend(function ServiceProfessionalBusinessInfo(){Activity.apply(this,arguments);this.viewModel=new ListingVM(this.app);this.accessLevel=this.app.UserType.loggedUser;var helpLink="/help/relatedArticles/201967756-telling-the-community-about-yourself";this.navBar=Activity.createSubsectionNavBar("Edit listing",{backLink:"/listingEditor",helpLink:helpLink});this.viewModel.navBar=this.navBar;this.title=ko.pureComputed(function(){return" Your listing's custom URL"},this.viewModel);this.viewModel.helpLink=helpLink});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.sync()}},{"../components/Activity":255,"../viewmodels/ListingVM":494,knockout:15}],234:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),ListingVM=require("../viewmodels/ListingVM"),A=Activity.extend(function ServiceProfessionalBusinessInfo(){Activity.apply(this,arguments);this.viewModel=new ListingVM(this.app);this.accessLevel=this.app.UserType.loggedUser;var helpLink="/help/relatedArticles/201967756-telling-the-community-about-yourself";this.navBar=Activity.createSubsectionNavBar("Edit listing",{backLink:"/listingEditor",helpLink:helpLink});this.viewModel.navBar=this.navBar;this.title=ko.pureComputed(function(){return" Your business info"},this.viewModel);this.viewModel.helpLink=helpLink});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.sync()}},{"../components/Activity":255,"../viewmodels/ListingVM":494,knockout:15}],233:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201965996-setting-your-service-locations-areas";this.isInOnboarding=onboarding.inProgress;this.serviceAddresses=new ServiceAddresses;this.addLocationLabel=ko.pureComputed(function(){return this.isInOnboarding()?"Place clients come to see you":"Add a service location"},this);this.addAreaLabel=ko.pureComputed(function(){return this.isInOnboarding()?"Area where you go to clients":"Add a service area/radius"},this);this.jobTitleID=ko.observable(0);this.jobTitle=ko.observable(null);this.clientUserID=ko.observable(null);this.clientAddresses=new ServiceAddresses;this.clientAddresses.isSelectionMode(!0);this.showSupportingText=ko.pureComputed(function(){return!(this.clientAddresses.hasAddresses()||this.serviceAddresses.isSelectionMode())},this);this.jobTitleName=ko.observable("Job Title");this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/serviceAddress");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.isSyncing=serviceAddresses.state.isSyncing();this.isLoading=ko.computed(function(){var add=serviceAddresses.state.isLoading(),jobs=this.jobTitles.isLoading(),cli=clientAddresses.state.isLoading();return add||jobs||cli},this);this.goNext=function(){if(onboarding.inProgress()){onboarding.selectedJobTitleID(this.jobTitleID());onboarding.goNext()}}.bind(this);this.serviceAddresses.selectAddress=function(selectedAddress,event){!0===this.serviceAddresses.isSelectionMode()?this.returnSelected(selectedAddress.addressID(),selectedAddress.jobTitleID()):app.shell.go("addressEditor/service/"+this.jobTitleID()+"/"+selectedAddress.addressID());event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.clientAddresses.selectAddress=function(selectedAddress,event){!0===this.clientAddresses.isSelectionMode()&&this.returnAddress(selectedAddress.model.toPlainObject());event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.addServiceLocation=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/serviceLocation",request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.addServiceArea=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/serviceArea",request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.addClientLocation=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/clientLocation/"+this.clientUserID(),request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.onboardingNextReady=ko.computed(function(){var isin=onboarding.inProgress(),hasItems=this.serviceAddresses.sourceAddresses().length>0;return isin&&hasItems},this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),onboarding=require("../data/onboarding"),jobTitles=require("../data/jobTitles"),serviceAddresses=require("../data/serviceAddresses"),clientAddresses=require("../data/clientAddresses"),showError=require("../modals/error").show,UserJobProfile=require("../viewmodels/UserJobProfile"),ServiceAddresses=require("../viewmodels/ServiceAddresses"),A=Activity.extend(function ServiceAddressesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/scheduling",helpLink:this.viewModel.helpLink});this.viewModel.navBar=this.navBar;this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(!0);this.title=ko.pureComputed(function(){return this.isInOnboarding()&&0===this.serviceAddresses.sourceAddresses().length?"Where do you work as a "+this.jobTitleName()+"?":this.isInOnboarding()?"Location for your listing":this.serviceAddresses.isSelectionMode()?"Choose a place for this booking":"Location"},this.viewModel);this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitle(jobTitle);this.updateNavBarState();this.viewModel.jobTitleName(jobTitle.singularName());return serviceAddresses.getList(jobTitleID)}.bind(this)).then(function(list){list=serviceAddresses.asModel(list);this.viewModel.serviceAddresses.sourceAddresses(list);this.requestData.selectedAddressID&&this.viewModel.serviceAddresses.presetSelectedAddressID(this.requestData.selectedAddressID)}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err})});if(this.viewModel.serviceAddresses.isSelectionMode())return;var found=/serviceAddresses\/(\d+)/i.exec(window.location);if((found&&0|found[1])!==jobTitleID){var url="/serviceAddresses/"+jobTitleID;this.app.shell.replaceState(null,null,url)}}else{this.viewModel.serviceAddresses.sourceAddresses([]);this.viewModel.serviceAddresses.selectedAddress(null);this.viewModel.jobTitle(null);this.updateNavBarState();this.viewModel.jobTitleName("Job Title")}}.bind(this)});this.registerHandler({target:this.viewModel.clientUserID,handler:function(clientUserID){if(clientUserID)clientAddresses.getList(clientUserID).then(function(list){list=this.clientAddresses.asModel(list);this.viewModel.clientAddresses.sourceAddresses(list);this.requestData.selectedAddressID&&this.viewModel.clientAddresses.presetSelectedAddressID(this.requestData.selectedAddressID)}.bind(this));else{this.viewModel.clientAddresses.sourceAddresses([]);this.viewModel.clientAddresses.selectedAddress(null)}}.bind(this)});this.viewModel.returnSelected=function(addressID,jobTitleID){this.requestData.selectedAddressID=addressID;this.requestData.selectedJobTitleID=jobTitleID;this.app.shell.goBack(this.requestData)}.bind(this);this.viewModel.returnAddress=function(addressDetails){this.requestData.address=addressDetails;this.app.shell.goBack(this.requestData)}.bind(this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.applyOwnNavbarRules=function(){var itIs=this.viewModel.serviceAddresses.isSelectionMode();this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title("");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink,this.requestData);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction,!0);var jid=this.viewModel.jobTitleID(),jname=this.viewModel.jobTitle()&&this.viewModel.jobTitle().singularName()||"Scheduler",url=this.mustReturnTo||jid&&"/listingEditor/"+jid||"/schedulingPreferences";this.navBar.leftAction().link(url);this.navBar.leftAction().text(this.requestData.navTitle||jname)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):this.requestData.cancelLink||this.navBar.leftAction().handler(null)};A.prototype.updateNavBarState=function updateNavBarState(){onboarding.updateNavBar(this.navBar)||this.applyOwnNavbarRules()};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.mustReturnTo=this.requestData.route.query.mustReturn||this.mustReturnTo;this.viewModel.jobTitleID(0);this.viewModel.clientUserID(0);this.viewModel.requestData=this.requestData;this.viewModel.serviceAddresses.isSelectionMode(!0===options.selectAddress);this.viewModel.clientUserID(options.clientUserID||null);var jobTitleID=0|(options&&options.route&&options.route.segments)[0];if(!0!==options.returnNewAsSelected){this.viewModel.jobTitleID(jobTitleID);this.updateNavBarState();0===jobTitleID&&this.viewModel.jobTitles.sync()}else setTimeout(function(){delete options.returnNewAsSelected;options.address?this.viewModel.returnAddress(options.address):options.addressID&&this.viewModel.returnSelected(options.addressID,jobTitleID)}.bind(this),1)}},{"../components/Activity":255,"../data/clientAddresses":267,"../data/jobTitles":286,"../data/onboarding":291,"../data/serviceAddresses":300,"../modals/error":343,"../viewmodels/ServiceAddresses":505,"../viewmodels/UserJobProfile":512,jquery:14,knockout:15}],232:[function(require,module,exports){"use strict";function ViewModel(){this.isAnonymous=user.isAnonymous;this.isLoading=ko.observable(!1);this.isJobTitleLoading=ko.observable(!1);this.jobTitleID=ko.observable();this.origLat=ko.observable();this.origLong=ko.observable();this.searchDistance=ko.observable();this.serviceProfessionalSearchResult=ko.observableArray();this.jobTitleSearchResult=ko.observable();this.loadJobTitleData=function(jobTitleID,origLat,origLong,searchDistance){this.isJobTitleLoading(!0);return search.getJobTitle(jobTitleID,origLat,origLong,searchDistance).then(function(data){this.jobTitleSearchResult(data);this.isJobTitleLoading(!1)}.bind(this)).catch(function(){this.isJobTitleLoading(!1)}.bind(this))};this.loadData=function(jobTitleID,origLat,origLong,searchDistance){this.isLoading(!0);return search.serviceProfessionalsByJobTitle(jobTitleID,origLat,origLong,searchDistance).then(function(list){var listAsModel=list.map(function(item){return new ServiceProfessionalSearchResult(item)});this.serviceProfessionalSearchResult(listAsModel);this.isLoading(!1)}.bind(this)).catch(function(){this.isLoading(!1)}.bind(this))};this.searchFailureMessage=ko.computed(function(){var result=this.jobTitleSearchResult(),name=result&&ko.unwrap(result.pluralName);return result&&"We don't yet have "+name+" in your area. Help us grow by introducing us to professionals or signing up for our newsletter."},this)}var ServiceProfessionalSearchResult=require("../models/ServiceProfessionalSearchResult"),ko=require("knockout"),Activity=require("../components/Activity"),search=require("../data/search"),user=require("../data/userProfile").data;require("../kocomponents/lead-generation/newsletter");require("../kocomponents/lead-generation/refer");var A=Activity.extend(function SearchJobTitleActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel;this.navBar=Activity.createSubsectionNavBar("Back");this.title=ko.computed(function(){var result=this.jobTitleSearchResult();return result&&result.pluralName},this.viewModel)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],jobTitleID=params[0]||"",origLat=params[1]||"",origLong=params[2]||"",searchDistance=params[3]||"";this.viewModel.loadJobTitleData(jobTitleID,origLat,origLong,searchDistance);this.viewModel.loadData(jobTitleID,origLat,origLong,searchDistance)}},{"../components/Activity":255,"../data/search":299,"../data/userProfile":309,"../kocomponents/lead-generation/newsletter":317,"../kocomponents/lead-generation/refer":319,"../models/ServiceProfessionalSearchResult":413,knockout:15}],231:[function(require,module,exports){"use strict";function ViewModel(){this.isLoading=ko.observable(!1);this.isCategoryLoading=ko.observable(!1);this.categoryID=ko.observable();this.origLat=ko.observable();this.origLong=ko.observable();this.searchDistance=ko.observable();this.jobTitleSearchResult=ko.observableArray();this.categorySearchResult=ko.observable();this.categoryBackgroundImage=ko.pureComputed(function(){var id=this.categoryID();return id?"CategoryBackground-"+id:""},this);var loadCategoryData=function(categoryID,origLat,origLong,searchDistance){this.isCategoryLoading(!0);return search.getCategory(categoryID,origLat,origLong,searchDistance).then(function(data){this.categorySearchResult(data);this.isCategoryLoading(!1)}.bind(this)).catch(function(){this.isCategoryLoading(!1)}.bind(this))}.bind(this),loadData=function(categoryID,origLat,origLong,searchDistance){this.isLoading(!0);return search.jobTitlesByCategory(categoryID,origLat,origLong,searchDistance).then(function(list){this.jobTitleSearchResult(list);this.isLoading(!1)}.bind(this)).catch(function(){this.isLoading(!1)}.bind(this))}.bind(this);this.load=function(categoryID,origLat,origLong,searchDistance){this.categoryID(categoryID);this.origLat(origLat);this.origLong(origLong);this.searchDistance(searchDistance);return Promise.all([loadCategoryData(categoryID,origLat,origLong,searchDistance),loadData(categoryID,origLat,origLong,searchDistance)])};this.categories=[{id:1,name:"Home Care"},{id:2,name:"Self Care"},{id:3,name:"Child Care"},{id:4,name:"Senior Care"},{id:5,name:"Pet Care"},{id:6,name:"Celebration"},{id:7,name:"Transport"},{id:8,name:"Office"}]}var ko=require("knockout"),Activity=require("../components/Activity"),search=require("../data/search");require("../kocomponents/tab-list");var A=Activity.extend(function SearchCategoryActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);this.title=ko.computed(function(){var result=this.categorySearchResult();return result&&result.categoryName+" Professionals"},this.viewModel);this.getUrlForCategory=function(catID){var vm=this.viewModel;return"/searchCategory/"+catID+"/"+vm.origLat()+"/"+vm.origLong()+"/"+vm.searchDistance()};this.loadCategory=function(catID){var vm=this.viewModel;return vm.load(catID,vm.origLat(),vm.origLong(),vm.searchDistance())};var shell=this.app.shell,observableRoute=shell.getCurrentObservableRoute();this.viewModel.activeTabName=ko.pureComputed({read:function(){var route=observableRoute();return route&&route.segments&&route.segments[0]},write:function(tabName){this.loadCategory(tabName).then(function(){setTimeout(function(){shell.replaceState(null,null,this.getUrlForCategory(tabName))}.bind(this),1)}.bind(this))},owner:this})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],categoryID=params[0]||"",origLat=params[1]||"",origLong=params[2]||"",searchDistance=params[3]||"";this.viewModel.load(categoryID,origLat,origLong,searchDistance)}},{"../components/Activity":255,"../data/search":299,"../kocomponents/tab-list":337,knockout:15}],230:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201961423-setting-your-scheduling-preferences";this.goBackLink=ko.observable("");this.goBackLabel=ko.observable("");this.schedulingPreferences=new SchedulingPreferencesVM;this.weeklySchedule=new WeeklyScheduleVM;this.save=function save(){return Promise.all([this.schedulingPreferences.save(),this.weeklySchedule.save()]).then(function(){userJobProfile.clearCache();userJobProfile.syncList();app.successSave()}).catch(function(){})}.bind(this);this.discard=function discard(){this.schedulingPreferences.discard();this.weeklySchedule.discard()}.bind(this);this.isLoading=ko.pureComputed(function(){return this.schedulingPreferences.isLoading()||this.weeklySchedule.isLoading()},this);this.isSaving=ko.pureComputed(function(){return this.schedulingPreferences.isSaving()||this.weeklySchedule.isSaving()},this);this.isLocked=ko.pureComputed(function(){return this.schedulingPreferences.isLocked()||this.weeklySchedule.isLocked()},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"Saving...":"Save"},this)}function SchedulingPreferencesVM(){var prefsVersion=schedulingPreferences.newVersion();prefsVersion.isObsolete.subscribe(function(itIs){itIs&&prefsVersion.pull({evenIfNewer:!0})});this.prefs=prefsVersion.version;this.isLoading=schedulingPreferences.isLoading;this.isSaving=schedulingPreferences.isSaving;this.isLocked=schedulingPreferences.isLocked;this.discard=function discard(){prefsVersion.pull({evenIfNewer:!0})}.bind(this);this.save=function save(){return prefsVersion.pushSave()}.bind(this)}function WeeklyScheduleVM(){var scheduleVersion=weeklySchedule.newVersion();scheduleVersion.isObsolete.subscribe(function(itIs){itIs&&scheduleVersion.pull({evenIfNewer:!0})});this.schedule=scheduleVersion.version;this.isLoading=weeklySchedule.isLoading;this.isSaving=weeklySchedule.isSaving;this.isLocked=weeklySchedule.isLocked;this.discard=function discard(){scheduleVersion.pull({evenIfNewer:!0})};this.save=function save(){return scheduleVersion.pushSave()};var autoTz=timeZoneList.getUsAliasWhenPossible(timeZoneList.getLocalTimeZone()),autoLabel="Auto ("+timeZoneList.timeZoneToDisplayFormat(autoTz)+")";this.autoTimeZone=ko.observable({id:autoTz,label:autoLabel});this.timeZonesList=ko.observable(timeZoneList.getUserList());this.topUsTimeZones=ko.observable(timeZoneList.getTopUsZones())}var Activity=require("../components/Activity"),ko=require("knockout"),weeklySchedule=require("../data/weeklySchedule"),schedulingPreferences=require("../data/schedulingPreferences"),userJobProfile=require("../data/userJobProfile"),showError=require("../modals/error").show;require("../kocomponents/switch-checkbox");var A=Activity.extend(function SchedulingPreferencesActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Calendar",{backLink:"/calendar",helpLink:this.viewModel.helpLink});this.defaultNavBar=this.navBar.model.toPlainObject(!0);this.title("Availability settings");this.registerHandler({target:weeklySchedule,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save your weekly schedule.":"Unable to load your weekly schedule.";showError({title:msg,error:err&&err.task&&err.error||err})}});this.registerHandler({target:schedulingPreferences,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save scheduling preferences.":"Unable to load scheduling preferences.";showError({title:msg,error:err&&err.task&&err.error||err})}})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var info=this.app.getReturnRequestInfo(this.requestData);this.viewModel.goBackLink(info&&info.link||"/calendar");this.viewModel.goBackLabel(info&&info.label||"Calendar")};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.updateNavBarState();schedulingPreferences.sync();weeklySchedule.sync();this.viewModel.discard()};var timeZoneList=require("../utils/timeZoneList")},{"../components/Activity":255,"../data/schedulingPreferences":298,"../data/userJobProfile":306,"../data/weeklySchedule":312,"../kocomponents/switch-checkbox":336,"../modals/error":343,"../utils/timeZoneList":481,knockout:15}],336:[function(require,module,exports){"use strict";function ViewModel(params){this.disabled=getObservable(params.disabled);this.checked=getObservable(params.checked);this.id=getObservable(params.id)}var TAG_NAME="switch-checkbox",TEMPLATE=require("../../html/kocomponents/switch-checkbox.html"),CSS_CLASS="SwitchCheckbox",ko=require("knockout"),getObservable=require("../utils/getObservable"),create=function(params,componentInfo){componentInfo.element.classList.add(CSS_CLASS);return new ViewModel(params)};ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:{createViewModel:create}})},{"../../html/kocomponents/switch-checkbox.html":162,"../utils/getObservable":455,knockout:15}],229:[function(require,module,exports){"use strict";function ViewModel(app){this.profilePicture=new ProfilePictureBioVM(app);this.submitText=ko.pureComputed(function(){return this.isLoading()?"Loading...":this.isSaving()?"Saving...":"Save"},this);this.save=function(){this.profilePicture.save().then(function(){app.successSave()}).catch(function(){})}.bind(this);this.discard=function(){this.profilePicture.discard()};this.sync=function(){this.profilePicture.sync()};this.isLoading=this.profilePicture.isLoading;this.isSaving=this.profilePicture.isSaving;this.isSyncing=this.profilePicture.isSyncing;this.isLocked=this.profilePicture.isLocked}var Activity=require("../components/Activity"),ko=require("knockout"),ProfilePictureBioVM=require("../viewmodels/ProfilePictureBioVM"),A=Activity.extend(function PublicProfilePicture(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;var helpLink="/help/relatedArticles/201967756-telling-the-community-about-yourself";this.navBar=Activity.createSubsectionNavBar("Edit listing",{backLink:"/listingEditor",helpLink:helpLink});this.viewModel.navBar=this.navBar;this.title=ko.pureComputed(function(){return" Your profile picture"},this.viewModel);this.viewModel.helpLink=helpLink});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.discard();this.viewModel.sync()}},{"../components/Activity":255,"../viewmodels/ProfilePictureBioVM":503,knockout:15}],228:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967756-telling-the-community-about-yourself";this.isServiceProfessional=user.isServiceProfessional;this.isInOnboarding=onboarding.inProgress;var profileVersion=userProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})});this.profile=profileVersion.version;this.submitText=ko.pureComputed(function(){return onboarding.inProgress()?"Save and continue":this.isSaving()?"Saving...":"Save"},this);this.isFirstNameValid=ko.pureComputed(function(){return/^(\S{2,}\s*)+$/.test(this.profile.firstName())},this);this.isLastNameValid=ko.pureComputed(function(){return/^(\S{2,}\s*)+$/.test(this.profile.lastName())},this);this.isPhoneValid=ko.pureComputed(function(){return(this.profile.countryID()===countriesOptions.unitedStates.id?phoneValidationRegex.NORTH_AMERICA_PATTERN:phoneValidationRegex.GENERAL_VALID_CHARS).test(this.profile.phone())},this);this.isFormValidated=ko.observable(!1);this.validate=function(){var errors={};this.isFirstNameValid()||(errors.firstName="First name is two short");this.isLastNameValid()||(errors.lastName="Last name is too short");this.isPhoneValid()||(errors.phone=this.profile.phone()?"Given phone is not valid":"Phone is required");this.isFormValidated(!0);return 0===Object.keys(errors).length?null:{errorMessage:"Please fix these issues and try again:",errorSource:"validation",errors:errors}};this.isLoading=userProfile.isLoading;this.isSaving=userProfile.isSaving;this.isSyncing=userProfile.isSyncing;this.isLocked=userProfile.isLocked;this.discard=function discard(){profileVersion.pull({evenIfNewer:!0})}.bind(this);this.sync=function sync(){return userProfile.load().catch(function(err){return showError({title:"Unable to load your contact info",error:err})})};this.save=function save(){var errors=this.validate();return errors?showError({title:"Unable to save your contact info",error:errors}):profileVersion.pushSave().then(function(){onboarding.inProgress()?onboarding.goNext():app.successSave()}).catch(function(err){return showError({title:"Unable to save your contact info",error:err})})}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),userProfile=require("../data/userProfile"),user=userProfile.data,onboarding=require("../data/onboarding"),countriesOptions=require("../viewmodels/CountriesOptions"),phoneValidationRegex=require("../utils/phoneValidationRegex"),showError=require("../modals/error").show,A=Activity.extend(function PublicContactInfo(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;var backLink=user.isServiceProfessional()?"/listingEditor":"/userProfile";this.navBar=Activity.createSubsectionNavBar("Edit listing",{backLink:backLink,helpLink:this.viewModel.helpLink});this.viewModel.navBar=this.navBar;this.title=ko.pureComputed(function(){return" Your contact info"},this.viewModel)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);onboarding.updateNavBar(this.navBar);this.viewModel.discard();this.viewModel.sync()}},{"../components/Activity":255,"../data/onboarding":291,"../data/userProfile":309,"../modals/error":343,"../utils/phoneValidationRegex":464,"../viewmodels/CountriesOptions":489,knockout:15}],227:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),ProfilePictureBioVM=require("../viewmodels/ProfilePictureBioVM"),A=Activity.extend(function PublicBio(){Activity.apply(this,arguments);this.viewModel=new ProfilePictureBioVM(this.app);this.accessLevel=this.app.UserType.loggedUser;var helpLink="/help/relatedArticles/201967756-telling-the-community-about-yourself";this.navBar=Activity.createSubsectionNavBar("Edit listing",{backLink:"/listingEditor",helpLink:helpLink});this.viewModel.navBar=this.navBar;this.title=ko.pureComputed(function(){return" Your public bio"},this.viewModel);this.viewModel.helpLink=helpLink});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.discard();this.viewModel.sync()}},{"../components/Activity":255,"../viewmodels/ProfilePictureBioVM":503,knockout:15}],503:[function(require,module,exports){"use strict";var $=require("jquery"),ko=require("knockout"),photoTools=require("../utils/photoTools"),ListingVM=require("./ListingVM"),user=require("../data/userProfile").data,remote=require("../data/drivers/restClient");require("../kocomponents/button-file");require("jquery.fileupload-image");var showNotification=require("../modals/notification").show,showError=require("../modals/error").show;module.exports=function ProfilePictureBioVM(app){ListingVM.call(this,app);this.user=user;this.photoUploadUrl=remote.baseUrl+"me/profile-picture";this.photoEditRestUrl="me/profile-picture/edit";this.photoUploadFieldName="profilePicture";this.localPhotoData=ko.observable();this.localPhotoPreview=ko.observable();this.takePhotoSupported=ko.observable(photoTools.takePhotoSupported());this.inputElement=ko.observable();this.hasPreview=ko.pureComputed(function(){return!(!this.localPhotoPreview()&&!this.previewPhotoUrl())},this);this.hasPhoto=ko.pureComputed(function(){return this.hasPreview()||this.profile.hasUploadedPhoto()},this);this.uploadButtonText=ko.pureComputed(function(){return this.hasPhoto()?"Change photo":"Upload photo"},this);this.takePhotoSupported()||this.inputElement.subscribe(function(input){if(input){var $input=$(input),uploaderOptions={url:this.photoUploadUrl,dataType:"json",type:"PUT",paramName:this.photoUploadFieldName,autoUpload:!1,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:5e6,disableImageResize:!0,previewMaxWidth:120,previewMaxHeight:120,previewCrop:!0},uploaderEventHandlers={fileuploadadd:function(e,data){this.localPhotoData(data);this.rotationAngle(0)},fileuploadprocessalways:function(e,data){var file=data.files[data.index];file.error?console.error("Photo Preview",file.error):file.preview&&this.localPhotoPreview(file.preview)}};$input.fileupload(uploaderOptions);var vm=this;Object.keys(uploaderEventHandlers).forEach(function(eventName){$input.on(eventName,uploaderEventHandlers[eventName].bind(vm))})}}.bind(this));var baseDiscard=this.discard;this.discard=function discard(){baseDiscard();this.localPhotoUrl("");this.previewPhotoUrl("");this.localPhotoData(null);this.localPhotoPreview(null);this.rotationAngle(0)}.bind(this);var baseSave=this.save;this.save=function save(){this.isSaving(!0);return this.uploadPhoto().then(function(data){data&&$.get(data.profilePictureUrl);return baseSave()}).then(function(){this.isSaving(!1)}.bind(this)).catch(function(err){this.isSaving(!1);throw err}.bind(this))}.bind(this);var cameraSettings={targetWidth:600,targetHeight:600,quality:90};this.previewPhotoUrl=ko.observable("");this.localPhotoUrl=ko.observable("");var takePickPhoto=function takePhoto(fromCamera){var settings=$.extend({},cameraSettings,{sourceType:fromCamera?window.Camera&&window.Camera.PictureSourceType.CAMERA:window.Camera&&window.Camera.PictureSourceType.PHOTOLIBRARY});photoTools.takePhotoSupported()?photoTools.cameraGetPicture(settings).then(function(imgLocalUrl){this.localPhotoUrl(imgLocalUrl);this.previewPhotoUrl(photoTools.getPreviewPhotoUrl(imgLocalUrl));this.rotationAngle(0)}.bind(this)).catch(function(err){err&&"no image selected"!==err&&"has no access to camera"!==err&&showError({error:err,title:"Error getting photo."})}):showNotification({message:"Take photo is not supported on the web right now"})}.bind(this);this.takePhoto=function(){takePickPhoto(!0)}.bind(this);this.pickPhoto=function(){takePickPhoto(!1)}.bind(this);var editRemotePhoto=function(){var r=this.rotationAngle();return 0===r?Promise.resolve(null):remote.post(this.photoEditRestUrl,{rotationAngle:r})}.bind(this),nativeUploadPhoto=function(){if(!this.localPhotoUrl())return editRemotePhoto();var uploadSettings={fileKey:this.photoUploadFieldName,mimeType:"image/jpeg",httpMethod:"PUT",headers:$.extend(!0,{},remote.extraHeaders),params:{rotationAngle:this.rotationAngle()}};return photoTools.uploadLocalFileJson(this.localPhotoUrl(),this.photoUploadUrl,uploadSettings)}.bind(this),webUploadPhoto=function(){var fd=this.localPhotoData();if(!fd)return editRemotePhoto();fd.headers=$.extend(!0,{},remote.extraHeaders);fd.formData=[{name:"rotationAngle",value:this.rotationAngle()}];return Promise.resolve(fd.submit())}.bind(this);this.uploadPhoto=function(){return photoTools.takePhotoSupported()?nativeUploadPhoto():webUploadPhoto()}.bind(this);this.rotationAngle=ko.observable(0);this.rotatePhoto=function(){var d=0|this.rotationAngle();this.rotationAngle((d+90)%360)};this.photoRotationStyle=ko.pureComputed(function(){return"transform: rotate("+(0|this.rotationAngle())+"deg);"},this)};module.exports._inherits(ListingVM)},{"../data/drivers/restClient":271,"../data/userProfile":309,"../kocomponents/button-file":314,"../modals/error":343,"../modals/notification":344,"../utils/photoTools":465,"./ListingVM":494,jquery:14,"jquery.fileupload-image":2,knockout:15}],494:[function(require,module,exports){"use strict";var ko=require("knockout"),clipboard=require("../utils/clipboard"),listing=require("../data/marketplaceProfile"),showError=require("../modals/error").show;module.exports=function ListingVM(app){var profileVersion=listing.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})});this.profile=profileVersion.version;this.isLoading=listing.isLoading;this.isSaving=listing.isSaving;this.isLocked=listing.isLocked;this.discard=function discard(){profileVersion.pull({evenIfNewer:!0});this.copyCustomUrlButtonText("Copy")}.bind(this);this.save=function save(){return profileVersion.pushSave().then(function(){app.successSave()}).catch(function(error){showError({title:"Unable to save your data.",error:error})})};this.sync=function(){this.discard();return listing.load().catch(function(error){showError({title:"Unable to load your data.",error:error})})};this.customUrlProtocol=ko.observable("https://");this.customUrlDomainPrefix=ko.observable("www.loconomics.com/-");this.customUrlDraft=ko.pureComputed(function(){return this.customUrlProtocol()+this.customUrlDomainPrefix()+this.profile.serviceProfessionalProfileUrlSlug()},this);this.copyCustomUrlButtonText=ko.observable("Copy your listing's URL");this.profile.serviceProfessionalProfileUrlSlug.subscribe(function(){this.copyCustomUrlButtonText("Copy your listing's URL")}.bind(this));this.copyCustomUrl=function(){var url=this.customUrlDraft(),errMsg=clipboard.copy(url);errMsg?showError({error:errMsg}):this.copyCustomUrlButtonText("Copied!")}.bind(this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"Loading...":this.isSaving()?"Saving...":"Save"},this)}},{"../data/marketplaceProfile":289,"../modals/error":343,"../utils/clipboard":447,knockout:15}],314:[function(require,module,exports){"use strict";function ViewModel(params,refs){this.id=getObservable(params.id);this.disabled=getObservable(params.disabled);this.accept=getObservable(params.accept);ko.isWriteableObservable(params.inputElement)&&params.inputElement(refs.input)}var TAG_NAME="button-file",TEMPLATE=require("../../html/kocomponents/button-file.html"),CSS_CLASS="btn-file",FAKE_FOCUS_CSS_CLASS="is-focused",ko=require("knockout"),getObservable=require("../utils/getObservable"),create=function(params,componentInfo){var el=componentInfo.element;el.classList.add(CSS_CLASS);el.setAttribute("tabindex","0");el.setAttribute("role","button");var onInputFocus=function(){el.removeAttribute("tabindex")},latestInputElement=null,setupInput=function(){var input=el.querySelector("input[type=file]");input.focus();if(null!==input){input.addEventListener("focus",onInputFocus);var onEndFocus=function(){el.classList.remove("is-focused");el.setAttribute("tabindex","0")};input.addEventListener("focusout",onEndFocus);input.addEventListener("change",onEndFocus)}};el.addEventListener("focus",function(){el.classList.add("is-focused");setupInput()});return new ViewModel(params,{input:el.querySelector("input[type=file]")})};ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:{createViewModel:create}})},{"../../html/kocomponents/button-file.html":156,"../utils/getObservable":455,knockout:15}],226:[function(require,module,exports){"use strict";function ViewModel(app){this.user=user;this.helpLinkProfessionals="/help/relatedArticles/201967106-protecting-your-privacy";this.helpLinkClients="/help/relatedArticles/201960903-protecting-your-privacy";this.helpLink=ko.pureComputed(function(){return this.user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);var settingsVersion=privacySettings.newVersion();settingsVersion.isObsolete.subscribe(function(itIs){itIs&&settingsVersion.pull({evenIfNewer:!0})});this.settings=settingsVersion.version;this.isLocked=privacySettings.isLocked;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},privacySettings);this.discard=function discard(){settingsVersion.pull({evenIfNewer:!0})}.bind(this);this.save=function save(){settingsVersion.pushSave().then(function(){app.successSave()}).catch(function(){})}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),user=require("../data/userProfile").data,onboarding=require("../data/onboarding"),privacySettings=require("../data/privacySettings"),showError=require("../modals/error").show,A=Activity.extend(function PrivacySettingsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;var serviceProfessionalNavBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar;this.title("Privacy settings");this.registerHandler({target:privacySettings,event:"error",handler:function(err){var msg="save"===err.task?"Error saving privacy settings.":"Error loading privacy settings.";showError({title:msg,error:err&&err.task&&err.error||err})}})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);privacySettings.sync();this.viewModel.discard();this.updateNavBarState()}},{"../components/Activity":255,"../data/onboarding":291,"../data/privacySettings":297,"../data/userProfile":309,"../modals/error":343,knockout:15}],297:[function(require,module,exports){"use strict";var PrivacySettings=require("../models/PrivacySettings"),session=require("./session"),RemoteModel=require("./helpers/RemoteModel"),remote=require("./drivers/restClient"),api=new RemoteModel({data:new PrivacySettings,ttl:{minutes:1},localStorageName:"privacySettings",fetch:function fetch(){return remote.get("me/privacy-settings")},push:function push(){return remote.put("me/privacy-settings",this.data.model.toPlainObject())}});module.exports=api;session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/PrivacySettings":396,"./drivers/restClient":271,"./helpers/RemoteModel":283,"./session":303}],396:[function(require,module,exports){"use strict";function PrivacySettings(values){Model(this);this.model.defProperties({userID:0,smsBookingCommunication:!1,phoneBookingCommunication:!1,loconomicsCommunityCommunication:!1,loconomicsDbmCampaigns:!1,profileSeoPermission:!1,loconomicsMarketingCampaigns:!1,coBrandedPartnerPermissions:!1,createdDate:null,updatedDate:null},values);this.model.defID(["userID"])}var Model=require("./Model");module.exports=PrivacySettings},{"./Model":386}],225:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function PerformanceActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar("Performance");this.title("Coming soon")});module.exports=A},{"../components/Activity":255}],224:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");require("../kocomponents/payout/preference-view");var A=Activity.extend(function PaymentPreferenceActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.helpLink="/help/relatedArticles/201967096-accepting-and-receiving-payments";this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.helpLink});this.title="Payout preferences";this.onSaved=function(){this.app.successSave()}.bind(this)});exports.init=A.init},{"../components/Activity":255,"../kocomponents/payout/preference-view":326}],223:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function PaymentsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar("Payments");this.title("Coming soon")});module.exports=A},{"../components/Activity":255}],222:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967096-accepting-and-receiving-payments";this.isInOnboarding=onboarding.inProgress;this.simplifiedFormEnabled=ko.observable(!1);this.isInOnboarding.subscribe(function(itIs){this.simplifiedFormEnabled(itIs)}.bind(this));this.errorMessages=paymentAccount.errorMessages;var dataVersion=paymentAccount.newVersion();dataVersion.isObsolete.subscribe(function(itIs){if(itIs){dataVersion.pull({evenIfNewer:!0});this.formVisible(!dataVersion.version.status())}}.bind(this));this.paymentAccount=dataVersion.version;this.isLocked=paymentAccount.isLocked;this.submitText=ko.pureComputed(function(){return onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},paymentAccount);this.discard=function discard(){dataVersion.pull({evenIfNewer:!0});this.formVisible(!dataVersion.version.status());this.userSelectedAccount(null);this.simplifiedFormEnabled(this.isInOnboarding())}.bind(this);this.save=function save(){this.isInOnboarding()&&dataVersion.version.status()&&!this.formVisible()?onboarding.goNext():dataVersion.pushSave().then(function(){onboarding.inProgress()?onboarding.goNext():app.successSave()}.bind(this)).catch(function(){this.simplifiedFormEnabled(!1)}.bind(this))}.bind(this);this.onSkip=function(){app.model.onboarding.goNext()}.bind(this);this.errorMessages={postalCode:ko.observable()};this.postalCodeVM=new PostalCodeVM({address:this.paymentAccount,postalCodeError:this.errorMessages.postalCode});paymentAccount.isLoading.subscribe(function(isLoading){isLoading||this.postalCodeVM.onFormLoaded()},this);this.formVisible=ko.observable(!1);this.showForm=function(){this.formVisible(!0)};this.userSelectedAccount=ko.observable(null);this.isVenmoAccount=ko.pureComputed(function(){return this.userSelectedAccount()?"venmo"===this.userSelectedAccount():!!this.paymentAccount.status()&&!(this.paymentAccount.accountNumber()&&this.paymentAccount.routingNumber())},this);this.isBankAccount=ko.pureComputed(function(){return!this.isVenmoAccount()},this);this.chooseVenmoAccount=function(){this.userSelectedAccount("venmo")}.bind(this);this.chooseBankAccount=function(){this.userSelectedAccount("bank")}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),PostalCodeVM=require("../viewmodels/PostalCode"),onboarding=require("../data/onboarding"),paymentAccount=require("../data/paymentAccount"),showError=require("../modals/error").show,A=Activity.extend(function PaymentAccountActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLink});this.viewModel.navBar=this.navBar;this.defaultNavBar=this.navBar.model.toPlainObject(!0);this.registerHandler({target:paymentAccount,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save your payment account.":"Unable to load your payment account.";showError({title:msg,error:err&&err.task&&err.error||err})}})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){onboarding.updateNavBar(this.navBar)||this.navBar.model.updateWith(this.defaultNavBar,!0)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.updateNavBarState();this.viewModel.discard();paymentAccount.sync()}},{"../components/Activity":255,"../data/onboarding":291,"../data/paymentAccount":293,"../modals/error":343,"../viewmodels/PostalCode":502,knockout:15}],221:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function OwnerPerksActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={helpLink:"/help/relatedArticles/201973183-owner-perks-and-benefits"};this.navBar=Activity.createSubsectionNavBar("Cooperative",{backLink:"/ownerInfo",helpLink:this.viewModel.helpLink});this.title("Owner perks & benefits")});module.exports=A},{"../components/Activity":255}],220:[function(require,module,exports){"use strict";function ViewModel(){this.helpLink="/help/relatedArticles/201096629-ownership-in-loconomics";this.ownerStatus=ko.observable("pending");this.ownerStatusName=ko.observable("Pending");this.ownerStatusOK=ko.pureComputed(function(){return"active"===this.ownerStatus()},this)}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function OwnerInfoActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSectionNavBar(null);this.title("Cooperative")});exports.init=A.init},{"../components/Activity":255,knockout:15}],219:[function(require,module,exports){"use strict";function ViewModel(app){this.isLoading=ownerAcknowledgment.isLoading;this.isSaving=ownerAcknowledgment.isSaving;this.acknowledgment=ownerAcknowledgment.data;this.ownerFullName=ko.observable("");this.reset=function(){this.ownerFullName("")};this.acknowledge=function(){ownerAcknowledgment.acknowledge({ownerFullName:this.ownerFullName()}).then(function(){app.successSave()}).catch(function(err){showError({title:"Error saving",error:err})})}}var Activity=require("../components/Activity"),ko=require("knockout"),ownerAcknowledgment=require("../data/ownerAcknowledgment"),showError=require("../modals/error").show,A=Activity.extend(function OwnerAcknowledgmentActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.isServiceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Cooperative",{backLink:"/ownerInfo",helpLink:"/help/relatedArticles/201964153-how-owner-user-fees-work"});this.title("Cooperative Owner Disclosure")});module.exports=A;A.prototype.show=function show(state){this.viewModel.reset();Activity.prototype.show.call(this,state);ownerAcknowledgment.sync()}},{"../components/Activity":255,"../data/ownerAcknowledgment":292,"../modals/error":343,knockout:15}],292:[function(require,module,exports){"use strict";var OwnerAcknowledgment=require("../models/OwnerAcknowledgment"),RemoteModel=require("./helpers/RemoteModel"),session=require("./session"),local=require("./drivers/localforage"),remote=require("./drivers/restClient"),api=new RemoteModel({data:new OwnerAcknowledgment,ttl:{minutes:1},localStorageName:"ownerAcknowledgment",fetch:function fetch(){return remote.get("me/owner-acknowledgment").catch(function(err){if(!err||404!==err.status)throw err;api.data.model.reset()})},push:function push(){throw{name:"Raw update of payment plan is not supported; use specialized methods"}}});module.exports=api;session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()});api.acknowledge=function acknowledge(data){api.isSaving(!0);return remote.post("me/owner-acknowledgment",data).then(function(serverData){api.data.model.updateWith(serverData,!0);local.setItem(api.localStorageName,serverData);api.isSaving(!1)}).catch(function(err){api.isSaving(!1);throw err})}},{"../models/OwnerAcknowledgment":387,"./drivers/localforage":270,"./drivers/restClient":271,"./helpers/RemoteModel":283,"./session":303}],387:[function(require,module,exports){"use strict";function OwnerAcknowledgment(values){Model(this);this.model.defProperties({userID:null,dateAcknowledged:null,acknowledgedFromIP:null,createdDate:null,updatedDate:null},values);this.isSigned=ko.pureComputed(function(){return this.createdDate()&&this.dateAcknowledged()},this)}var Model=require("../models/Model"),ko=require("knockout");module.exports=OwnerAcknowledgment},{"../models/Model":386,knockout:15}],218:[function(require,module,exports){"use strict";function ViewModel(){this.upcomingAppointments=new UpcomingAppointmentsSummary;this.upcomingAppointments.isLoading=ko.observable(!1);this.upcomingAppointments.isSyncing=ko.observable(!1);this.pastAppointments={pastAppointments:ko.observable(!1),count:ko.observable(0)};this.getUrlTo=function(name){return ko.pureComputed(function(){return"/"+name+"/"+this.upcomingAppointments.nextBooking.bookingID+"?mustReturn=myAppointments/&returnText= My appointments"},this)}}var ko=require("knockout"),Activity=require("../components/Activity"),UpcomingAppointmentsSummary=require("../models/UpcomingAppointmentsSummary"),bookings=require("../data/bookings"),showError=require("../modals/error").show,A=Activity.extend(function MyAppointmentsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar(null);this.title("My appointments");this.prepareShowErrorFor=function prepareShowErrorFor(title){return function(err){showError({title:title,error:err})}}.bind(this)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.syncUpcomingAppointments()};A.prototype.syncUpcomingAppointments=function syncUpcomingAppointments(){var v=this.viewModel;v.upcomingAppointments.items().length?v.upcomingAppointments.isSyncing(!0):v.upcomingAppointments.isLoading(!0);bookings.getUpcomingAppointments().then(function(upcoming){v.upcomingAppointments.model.updateWith(upcoming,!0)}).catch(this.prepareShowErrorFor("Error loading upcoming appointments")).then(function(){v.upcomingAppointments.isLoading(!1);v.upcomingAppointments.isSyncing(!1)})}},{"../components/Activity":255,"../data/bookings":262,"../modals/error":343,"../models/UpcomingAppointmentsSummary":417,knockout:15}],217:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function mockupHouseCleanerServiceEditorActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSubsectionNavBar("Scheduler",{backLink:"/scheduling",helpLink:"/help/relatedArticles/201964153-how-owner-user-fees-work"})});module.exports=A},{"../components/Activity":255}],216:[function(require,module,exports){"use strict";function ViewModel(app){var jobVm=new UserJobProfileViewModel(app);jobVm.verificationsCount=ko.observable(3);jobVm.displayedVerificationsNumber=ko.computed(function(){return"("+this.verificationsCount()+")"},jobVm);jobVm.verificationsSecondaryText=ko.computed(function(){var verificationsLimit=10,remaining=10-this.verificationsCount();return remaining>0?"You can add up to "+remaining+" more":"You cannot add more"},jobVm);jobVm.displayedLastBackgroundCheck=ko.computed(function(){var lastDate=new Date(2014,10,14);return moment(lastDate).format("L")},jobVm);jobVm.user=user;jobVm.marketplaceProfileUrl=ko.computed(function(){var example="www.loconomics.com/YOURNAME",slug=marketplaceProfile.data.serviceProfessionalProfileUrlSlug(),url=marketplaceProfile.data.serviceProfessionalProfileUrl();return slug?url:example},jobVm);return jobVm}var Activity=require("../components/Activity"),UserJobProfileViewModel=require("../viewmodels/UserJobProfile"),ko=require("knockout"),moment=require("moment"),user=require("../data/userProfile").data,marketplaceProfile=require("../data/marketplaceProfile"),A=Activity.extend(function MarketplaceProfileActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.title("Your Listings");this.viewModel.showMarketplaceInfo(!0);this.viewModel.baseUrl("/listingEditor")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);if(this.viewModel.user.isServiceProfessional()){this.viewModel.sync();marketplaceProfile.sync()}}},{"../components/Activity":255,"../data/marketplaceProfile":289,"../data/userProfile":309,"../viewmodels/UserJobProfile":512,knockout:15,moment:145}],215:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),user=require("../data/userProfile").data,auth=require("../data/auth"),A=Activity.extend(function LogoutActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);auth.logout().then(function(){var newAnon=user.constructor.newAnonymous();user.model.updateWith(newAnon);this.app.shell.go("/")}.bind(this))}},{"../components/Activity":255,"../data/auth":260,"../data/userProfile":309}],214:[function(require,module,exports){"use strict";function ViewModel(app){fb.load();var credentials=new FormCredentials;this.username=credentials.username;this.password=credentials.password;this.validatedPassword=new ValidatedPasswordViewModel;this.resetToken=ko.observable("");this.view=ko.observable("login");this.requestResetMessage=ko.observable("");this.isWorking=ko.observable(!1);this.redirectUrl=ko.observable("");this.reset=function(){this.username("");this.password("");this.validatedPassword.reset();this.resetToken("");this.requestResetMessage("");this.isWorking(!1)};this.loginButtonText=ko.pureComputed(function(){return this.isWorking()?"Signing you in...":"Sign in"},this);this.requestResetButtonText=ko.pureComputed(function(){return this.isWorking()?"Requesting a reset code...":"Reset my password"},this);this.confirmResetButtonText=ko.pureComputed(function(){return this.isWorking()?"Resetting password...":"Reset my password"},this);this.facebookButtonText=ko.pureComputed(function(){return fb.isReady()?"Sign in with Facebook":"Loading Facebook..."},this);this.enableFacebookButton=ko.pureComputed(function(){return fb.isReady()},this);this.performLogin=function performLogin(){if(!this.username.error()&&!this.password.error()&&this.username()&&this.password()){this.isWorking(!0);auth.login(this.username(),this.password()).then(function(){this.reset();this.isWorking(!1);onboarding.setStep(user.onboardingStep());onboarding.goIfEnabled()||(this.redirectUrl()?app.shell.go(this.redirectUrl()):app.goDashboard())}.bind(this)).catch(function(err){this.isWorking(!1);var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid username or password";showError({title:"Error logging in",error:msg})}.bind(this))}else showError({title:"Validation",error:"Type a valid e-mail and a password"})}.bind(this);this.requestReset=function requestReset(){this.isWorking(!0);auth.resetPassword({username:this.username()}).then(function(result){this.requestResetMessage(result.message);this.isWorking(!1);this.goConfirm()}.bind(this)).catch(function(error){this.isWorking(!1);showError({title:"Error requesting a password reset",error:error})}.bind(this))}.bind(this);this.confirmReset=function confirmReset(){if(this.validatedPassword.isValid()){this.isWorking(!0);auth.confirmResetPassword({password:this.validatedPassword.password(),token:this.resetToken()}).then(function(result){showNotification({title:"Done!",message:result.message});this.isWorking(!1);this.goLogin()}.bind(this)).catch(function(error){this.isWorking(!1);showError({title:"Error resetting the password",error:error})}.bind(this))}else showError({title:"Validation",error:"Please create a valid password"})}.bind(this);this.facebook=function(){facebookLogin().then(function(result){var accessToken=result.authResponse&&result.authResponse.accessToken||result.auth&&result.auth.accessToken;this.isWorking(!0);return auth.facebookLogin(accessToken).then(function(){this.reset();this.isWorking(!1);this.redirectUrl()?app.shell.go(this.redirectUrl()):app.goDashboard()}.bind(this))}.bind(this)).catch(function(err){this.isWorking(!1);var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid Facebook login";showError({title:"Error logging in",error:msg})}.bind(this))}.bind(this);this.goLogin=function(){this.view("login")}.bind(this);this.goReset=function(){this.view("reset-password")}.bind(this);this.goConfirm=function(){this.view("confirm-reset")}.bind(this)}var ko=require("knockout"),Activity=require("../components/Activity"),ValidatedPasswordViewModel=require("../viewmodels/ValidatedPassword"),user=require("../data/userProfile").data,auth=require("../data/auth"),onboarding=require("../data/onboarding"),showNotification=require("../modals/notification").show,showError=require("../modals/error").show,A=Activity.extend(function LoginActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);this.title("Sign in to your account");var app=this.app,act=this;this.registerHandler({target:this.viewModel.view,handler:function(view){if(act.isNotFirstTime)switch(view){case"reset-password":app.shell.pushState(void 0,void 0,"/login/reset-password");break;case"confirm-reset":app.shell.pushState(void 0,void 0,"/login/reset-password/confirm");break;default:case"login":app.shell.pushState(void 0,void 0,"/login")}}})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.reset();var params=state&&state.route&&state.route.segments,query=state&&state.route&&state.route.query,redirectUrl=state.redirectUrl||query.redirectUrl;!redirectUrl&&state.requiredLevel&&(redirectUrl=this.app.shell.referrerRoute&&this.app.shell.referrerRoute.url);this.viewModel.redirectUrl(redirectUrl);if("reset-password"===params[0]){var t=query.token||"";this.viewModel.resetToken(t);"confirm"===params[1]?this.viewModel.goConfirm():this.viewModel.goReset()}else this.viewModel.goLogin();this.isNotFirstTime=!0};var FormCredentials=require("../viewmodels/FormCredentials"),fb=require("../utils/facebookUtils"),facebookLogin=function(){return window.facebookConnectPlugin?new Promise(function(s,e){window.facebookConnectPlugin.login(["email"],s,e)}):fb.login({scope:"email"})}},{"../components/Activity":255,"../data/auth":260,"../data/onboarding":291,"../data/userProfile":309,"../modals/error":343,"../modals/notification":344,"../utils/facebookUtils":453,"../viewmodels/FormCredentials":493,"../viewmodels/ValidatedPassword":513,knockout:15}],493:[function(require,module,exports){"use strict";function FormCredentials(){this.username=ko.observable("");this.password=ko.observable("");var emailRegexp=/^[-0-9A-Za-z!#$%&'*+/=?^_`{|}~.]+@[-0-9A-Za-z!#$%&'*+/=?^_`{|}~.]+$/;this.username.error=ko.observable("");this.username.subscribe(function(v){v?emailRegexp.test(v)?this.username.error(""):this.username.error("Is not a valid email"):this.username.error("Required")}.bind(this));this.password.error=ko.observable("");this.password.subscribe(function(v){var err="";v||(err="Required");this.password.error(err)}.bind(this))}var ko=require("knockout");module.exports=FormCredentials},{knockout:15}],213:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/202034083-managing-your-marketplace-profile";this.isLoading=ko.observable(!1);this.user=ko.observable(null);this.jobTitleID=ko.observable(0);this.jobTitle=ko.observable(null);this.userJobTitle=ko.observable(null);this.jobTitleName=ko.pureComputed(function(){return this.jobTitle()&&this.jobTitle().singularName()||"Job Title"},this);this.timeZone=ko.pureComputed(function(){var tz=this.user()&&this.user().weeklySchedule()&&this.user().weeklySchedule().timeZone();return tz&&tz.replace("US/","")||""},this);this.returnLinkGeneralActivity=ko.pureComputed(function(){return this.user()&&this.selectedJobTitle()&&"?mustReturn=listingEditor/"+this.selectedJobTitle().jobTitleID()+"&returnText=Edit listing"},this);this.returnLinkJobTitleActivity=ko.pureComputed(function(){return this.user()&&this.selectedJobTitle()&&this.selectedJobTitle().jobTitleID()+"?mustReturn=listingEditor/"+this.selectedJobTitle().jobTitleID()+"&returnText=Edit listing"},this);this.submittedUserLicensesCertifications=ko.observableArray([]);this.refreshTs=ko.observable(new Date);this.reset=function(){this.user(null)};var DEFAULT_WORKPHOTOS_LIMIT=2;this.isShowingAllPhotos=ko.observable(!1);this.workPhotos=ko.pureComputed(function(){var u=this.user(),ph=u&&u.selectedJobTitle()&&u.selectedJobTitle().workPhotos();if(ph){if(this.isShowingAllPhotos())return ph;var firsts=[];ph.some(function(p,i){if(i>1)return!0;firsts.push(p)});return firsts}return[]},this);this.viewMoreWorkPhotosLabel=ko.pureComputed(function(){var imgCount=this.user()&&this.user().selectedJobTitle()&&this.user().selectedJobTitle().workPhotos();imgCount=imgCount&&imgCount.length||0;return this.isShowingAllPhotos()||0===imgCount||imgCount<=2?"":"View all "+imgCount+" images"},this);this.viewAllPhotos=function(){this.isShowingAllPhotos(!0)}.bind(this);this.serviceAddresses=ko.pureComputed(function(){var u=this.user();return u&&u.selectedJobTitle()&&u.selectedJobTitle().serviceAddresses()||[]},this);this.changeJobTitle=function(jobTitle,event){this.user().selectedJobTitleID(jobTitle.jobTitleID());if(event){event.preventDefault();event.stopImmediatePropagation()}var url=event.target.getAttribute("href");app.shell.pushState(null,null,url)}.bind(this);this.getEmailLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"mailto:?body="+encodeURIComponent(u.profile().fullName()+": ")+url},this);this.getFacebookLink=ko.pureComputed(function(){var u=this.user();return u?"http://www.facebook.com/share.php?u="+encodeURIComponent(u.profile().serviceProfessionalProfileUrl())+"&t="+encodeURIComponent(u.profile().fullName()):""},this);this.getTwitterLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"http://twitter.com/intent/tweet?text="+encodeURIComponent(u.profile().fullName()+": "+url)},this);this.getGooglePlusLink=ko.pureComputed(function(){var u=this.user();return u?"https://plus.google.com/share?url="+encodeURIComponent(u.profile().serviceProfessionalProfileUrl()):""},this);this.getPinterestLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"http://pinterest.com/pin/create/button/?url="+url+"&media="+encodeURIComponent(u.profile().photoUrl())+"&description="+encodeURIComponent(u.profile().fullName()+": "+url)},this);this.getBookLink=ko.pureComputed(function(){var u=this.user();return u?"#!booking/"+u.profile().userID()+"/"+u.selectedJobTitleID():""},this);this.getSendMessageLink=ko.pureComputed(function(){var u=this.user();return u?"#!inbox/new/"+u.profile().userID():""},this);this.hasServicesOverview=ko.pureComputed(function(){var jobTitle=this.user()&&this.user().selectedJobTitle(),hasIntro=jobTitle&&jobTitle.hasIntro(),hasAttributes=jobTitle&&jobTitle.serviceAttributes().hasAttributes();return hasIntro||hasAttributes},this);this.jobTitleSingularName=ko.pureComputed(function(){return this.selectedJobTitle().jobTitleSingularName()},this);this.selectedJobTitle=ko.pureComputed(function(){return this.user()&&this.user().selectedJobTitle()||new PublicUserJobTitle},this);this.deleteJobTitle=function(){var jid=this.jobTitleID(),jname=this.jobTitleName();jid&&showConfirm({title:"Delete "+jname+" listing",message:"Are you sure you really want to delete your "+jname+" listing?",yes:"Delete",no:"Keep"}).then(function(){app.shell.goBack();return userJobProfile.deleteUserJobTitle(jid)}).catch(function(err){err&&showError({error:err,title:"Error while deleting your listing"})})}.bind(this);var UserJobTitle=require("../models/UserJobTitle");this.isToggleReady=ko.pureComputed(function(){return this.userJobTitle()&&this.userJobTitle().isComplete()},this);this.isActiveStatus=ko.pureComputed({read:function(){var j=this.userJobTitle();return j&&j.statusID()===UserJobTitle.status.on||!1},write:function(v){var status=this.userJobTitle()&&this.userJobTitle().statusID();if(!0===v&&status===UserJobTitle.status.off){this.userJobTitle().statusID(UserJobTitle.status.on);userJobProfile.reactivateUserJobTitle(this.jobTitleID()).catch(function(err){showError({title:"Error enabling your listing",error:err})})}else if(!1===v&&status===UserJobTitle.status.on){this.userJobTitle().statusID(UserJobTitle.status.off);userJobProfile.deactivateUserJobTitle(this.jobTitleID()).catch(function(err){showError({title:"Error disabling your listing",error:err})});showNotification({message:'Clients will no longer be able to find you in the marketplace. However, any "book me now" links you have posted will still be active.',buttonText:"Got it!"})}},owner:this});this.statusLabel=ko.pureComputed(function(){switch(this.userJobTitle()&&this.userJobTitle().statusID()){case UserJobTitle.status.on:return"This listing is active";case UserJobTitle.status.off:return"This listing is inactive";default:return"You're almost there!"}},this);this.requiredAlertLinks=ko.pureComputed(function(){var userJobTitle=this.userJobTitle(),jobTitleID=userJobTitle&&userJobTitle.jobTitleID();return(userJobTitle&&userJobTitle.requiredAlerts()||[]).map(function(profileAlert){return AlertLink.fromProfileAlert(profileAlert,{jobTitleID:jobTitleID})})},this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),PublicUser=require("../models/PublicUser"),user=require("../data/userProfile").data,users=require("../data/users"),PublicUserJobTitle=require("../models/PublicUserJobTitle"),userJobProfile=require("../data/userJobProfile"),showConfirm=require("../modals/confirm").show,showError=require("../modals/error").show,showNotification=require("../modals/notification").show,userLicensesCertifications=require("../data/userLicensesCertifications"),AlertLink=require("../viewmodels/AlertLink"),A=Activity.extend(function ListingEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Your listings",{backLink:"/marketplaceProfile",helpLink:this.viewModel.helpLink});this.title=ko.pureComputed(function(){var user=this.user();if(user)return"Edit your "+(user.selectedJobTitle()&&user.selectedJobTitle().jobTitleSingularName())+" listing"},this.viewModel);this.registerHandler({event:"layoutUpdate",target:$(window),handler:function(){this.viewModel.refreshTs(new Date)}.bind(this)})});exports.init=A.init;A.prototype.loadData=function(jobTitleID){this.viewModel.reset();if(user.userID()){this.viewModel.isLoading(!0);users.getUser(user.userID(),{includeFullJobTitleID:-1}).then(function(data){var pu=new PublicUser(data);this.viewModel.user(pu);return jobTitleID||pu.jobProfile()&&pu.jobProfile()[0]&&pu.jobProfile()[0].jobTitleID()}.bind(this)).then(function(jobTitleID){if(jobTitleID){userJobProfile.getUserJobTitleAndJobTitle(jobTitleID).then(function(job){this.viewModel.jobTitle(job.jobTitle);this.viewModel.userJobTitle(job.userJobTitle)}.bind(this)).catch(function(err){showError({title:"There was an error loading your listing.",error:err})});userLicensesCertifications.getList(jobTitleID).then(function(list){this.viewModel.submittedUserLicensesCertifications(userLicensesCertifications.asModel(list))}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err})});this.viewModel.user().selectedJobTitleID(jobTitleID)}}.bind(this)).catch(function(err){showError({error:err,title:"The user profile could not be loaded."})}.bind(this)).then(function(){this.viewModel.isLoading(!1)}.bind(this))}};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var jobTitleID=0|(options.route&&options.route.segments)[0];this.loadData(jobTitleID);this.viewModel.refreshTs(new Date);this.viewModel.jobTitleID(jobTitleID)}},{"../components/Activity":255,"../data/userJobProfile":306,"../data/userLicensesCertifications":307,"../data/userProfile":309,"../data/users":311,"../modals/confirm":342,"../modals/error":343,"../modals/notification":344,"../models/PublicUser":398,"../models/PublicUserJobTitle":400,"../models/UserJobTitle":422,"../viewmodels/AlertLink":484,jquery:14,knockout:15}],484:[function(require,module,exports){"use strict";var RouteParser=require("../utils/Router").RouteParser,alertPresets={positionservices:{label:"Add details to your listing",route:new RouteParser("/servicesOverview/:jobTitleID")},availability:{label:"What hours do you work?",route:new RouteParser("/schedulingPreferences?mustReturn=listingEditor/:jobTitleID")},personalinfo:{label:"How do clients reach you?",route:new RouteParser("/publicContactInfo?mustReturn=listingEditor/:jobTitleID")},photo:{label:"Add your profile photo",route:new RouteParser("/publicProfilePicture?mustReturn=listingEditor/:jobTitleID")},payment:{label:"How do you want to be paid?",route:new RouteParser("/payoutPreference?mustReturn=listingEditor/:jobTitleID")},pricingdetails:{label:"Create a bookable offering",route:new RouteParser("/serviceProfessionalService/:jobTitleID")},publicbio:{label:"Add a personal bio",route:new RouteParser("/publicBio?mustReturn=listingEditor/:jobTitleID")},professionallicense:{label:"Submit required credentials",route:new RouteParser("/licensesCertifications/:jobTitleID")},location:{label:"Where do you work?",route:new RouteParser("/serviceAddresses/:jobTitleID")},"add-education":{label:"Add training or education",route:new RouteParser("/education?mustReturn=listingEditor/:jobTitleID")},verifyemail:{label:"Verify your account (check your e-mail)",route:new RouteParser("/verifications?mustReturn=listingEditor/:jobTitleID")},showcasework:{label:"Add photos of your work",route:new RouteParser("/workPhotos/:jobTitleID")},"required-professionallicense":{label:"Verify your professional license or certification",route:new RouteParser("/licensesCertifications/:jobTitleID")}},undefinedPreset={label:"",route:{reverse:function(){return""}}},AlertLink=function(label,href){this._label=label;this._href=href};AlertLink.prototype.href=function(){return this._href};AlertLink.prototype.label=function(){return this._label};AlertLink.fromProfileAlert=function(profileAlert,options){var preset=alertPresets[profileAlert.alertName()]||undefinedPreset;return new AlertLink(preset.label,preset.route.reverse({jobTitleID:options.jobTitleID}))};module.exports=AlertLink},{"../utils/Router":440}],212:[function(require,module,exports){"use strict";function ViewModel(app){this.isLoading=ko.observable(!1);this.user=ko.observable(null);this.userID=ko.observable(null);this.reviews=new ReviewsVM;this.showMessageBar=ko.observable(!1);this.timeZone=ko.pureComputed(function(){var tz=this.user()&&this.user().weeklySchedule()&&this.user().weeklySchedule().timeZone();return tz&&tz.replace("US/","")||""},this);this.refreshTs=ko.observable(new Date);this.reset=function(){this.user(null);this.userID(null);this.showMessageBar(!1)};var DEFAULT_WORKPHOTOS_LIMIT=2;this.isShowingAllPhotos=ko.observable(!1);this.workPhotos=ko.pureComputed(function(){var u=this.user(),ph=u&&u.selectedJobTitle()&&u.selectedJobTitle().workPhotos();if(ph){if(this.isShowingAllPhotos())return ph;var firsts=[];ph.some(function(p,i){if(i>1)return!0;firsts.push(p)});return firsts}return[]},this);this.viewMoreWorkPhotosLabel=ko.pureComputed(function(){var imgCount=this.user()&&this.user().selectedJobTitle()&&this.user().selectedJobTitle().workPhotos();imgCount=imgCount&&imgCount.length||0;return this.isShowingAllPhotos()||0===imgCount||imgCount<=2?"":"View all "+imgCount+" images"},this);this.viewAllPhotos=function(){this.isShowingAllPhotos(!0)}.bind(this);this.serviceAddresses=ko.pureComputed(function(){var u=this.user();return u&&u.selectedJobTitle()&&u.selectedJobTitle().serviceAddresses()||[]},this);this.changeJobTitle=function(jobTitle,event){this.user().selectedJobTitleID(jobTitle.jobTitleID());this.reviews.reset(void 0,jobTitle.jobTitleID());this.reviews.load({limit:2});if(event){event.preventDefault();event.stopImmediatePropagation()}var url=event.target.getAttribute("href");app.shell.pushState(null,null,url)}.bind(this);this.getEmailLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"mailto:?body="+encodeURIComponent(u.profile().fullName()+": ")+url},this);this.getFacebookLink=ko.pureComputed(function(){var u=this.user();return u?"http://www.facebook.com/share.php?u="+encodeURIComponent(u.profile().serviceProfessionalProfileUrl())+"&t="+encodeURIComponent(u.profile().fullName()):""},this);this.getTwitterLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"http://twitter.com/intent/tweet?text="+encodeURIComponent(u.profile().fullName()+": "+url)},this);this.getGooglePlusLink=ko.pureComputed(function(){var u=this.user();return u?"https://plus.google.com/share?url="+encodeURIComponent(u.profile().serviceProfessionalProfileUrl()):""},this);this.getPinterestLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"http://pinterest.com/pin/create/button/?url="+url+"&media="+encodeURIComponent(u.profile().photoUrl())+"&description="+encodeURIComponent(u.profile().fullName()+": "+url)},this);this.getBookLink=ko.pureComputed(function(){var u=this.user();return u?"#!booking/"+u.profile().userID()+"/"+u.selectedJobTitleID():""},this);this.getSendMessageLink=ko.pureComputed(function(){var u=this.user();return u?"#!inbox/new/"+u.profile().userID():""},this);this.hasServicesOverview=ko.pureComputed(function(){var jobTitle=this.user()&&this.user().selectedJobTitle(),hasIntro=jobTitle&&jobTitle.hasIntro(),hasAttributes=jobTitle&&jobTitle.serviceAttributes().hasAttributes();return hasIntro||hasAttributes},this);this.hasVIPOfferingsForClient=ko.pureComputed(function(){return this.selectedJobTitle()&&this.selectedJobTitle().clientSpecificServices().length},this);this.hasCredentials=ko.pureComputed(function(){var hasEducation=this.user()&&this.user().education().length,hasLicenseCertification=this.selectedJobTitle()&&this.selectedJobTitle().licensesCertifications().length;return hasEducation||hasLicenseCertification},this);this.jobTitleSingularName=ko.pureComputed(function(){return this.selectedJobTitle().jobTitleSingularName()},this);this.selectedJobTitle=ko.pureComputed(function(){return this.user()&&this.user().selectedJobTitle()||new PublicUserJobTitle},this);this.editListing=function(){app.shell.go("/listingEditor/"+this.selectedJobTitle().jobTitleID())}.bind(this);this.listingIsActive=ko.pureComputed(function(){return this.selectedJobTitle().isActive()},this);this.isOwnProfile=ko.pureComputed(function(){var profileOwnerUserID=this.userID();return!user.isAnonymous()&&null!==profileOwnerUserID&&profileOwnerUserID==user.userID()},this);this.isMessageBarVisible=ko.pureComputed(function(){return this.isOwnProfile()&&this.showMessageBar()},this);this.messageBarTone=ko.pureComputed(function(){return this.listingIsActive()?MessageBar.tones.success:MessageBar.tones.warning},this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),PublicUser=require("../models/PublicUser"),user=require("../data/userProfile").data,users=require("../data/users"),MessageBar=require("../components/MessageBar"),PublicUserJobTitle=require("../models/PublicUserJobTitle"),ReviewsVM=require("../viewmodels/ReviewsVM"),showError=require("../modals/error").show,A=Activity.extend(function ListingActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.title=ko.pureComputed(function(){var user=this.user();if(user)return user.profile().firstNameLastInitial()+", "+(user.selectedJobTitle()&&user.selectedJobTitle().jobTitleSingularName())},this.viewModel);this.registerHandler({event:"layoutUpdate",target:$(window),handler:function(){this.viewModel.refreshTs(new Date)}.bind(this)})});exports.init=A.init;A.prototype.loadData=function(userID,jobTitleID){this.viewModel.reset();if(userID){this.viewModel.isLoading(!0);users.getUser(userID,{includeFullJobTitleID:-1}).then(function(data){var pu=new PublicUser(data);this.viewModel.user(pu);return jobTitleID||pu.jobProfile()&&pu.jobProfile()[0]&&pu.jobProfile()[0].jobTitleID()}.bind(this)).then(function(jobTitleID){if(jobTitleID){this.viewModel.user().selectedJobTitleID(jobTitleID);this.viewModel.reviews.load({limit:2})}}.bind(this)).catch(function(err){showError({error:err,title:"The user profile could not be loaded."})}.bind(this)).then(function(){this.viewModel.isLoading(!1)}.bind(this))}};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=options.route&&options.route.segments,userID=0|params[0]||user.userID(),jobTitleID=0|params[1];this.loadData(userID,jobTitleID);this.viewModel.reviews.reset(userID,jobTitleID);this.viewModel.refreshTs(new Date);this.viewModel.userID(userID);this.viewModel.showMessageBar(!0)};A.prototype.hide=function(){Activity.prototype.hide.call(this);this.viewModel.showMessageBar(!1)}},{"../components/Activity":255,"../components/MessageBar":257,"../data/userProfile":309,"../data/users":311,"../modals/error":343,"../models/PublicUser":398,"../models/PublicUserJobTitle":400,"../viewmodels/ReviewsVM":504,jquery:14,knockout:15}],504:[function(require,module,exports){"use stritct";var ko=require("knockout"),users=require("../data/users"),PublicUserReview=require("../models/PublicUserReview");module.exports=function ReviewsVM(){this.userID=ko.observable(null);this.jobTitleID=ko.observable(null);this.list=ko.observableArray([]);this.isLoading=ko.observable(!1);this.endReached=ko.observable(!1);var currentXhr=null;this.reset=function reset(userID,jobTitleID){this.list([]);userID&&this.userID(userID);this.jobTitleID(jobTitleID);this.endReached(!1);currentXhr&&currentXhr.abort&&currentXhr.abort()};this.load=function loadReviews(options){options=options||{};if(!this.isLoading()&&!this.endReached()&&this.userID()){this.isLoading(!0);var task=users.getReviews(this.userID(),this.jobTitleID(),options).then(function(newData){if(newData&&newData.length){newData.length<(options.limit||20)&&this.endReached(!0);newData=newData.map(function(d){return new PublicUserReview(d)});var list=this.list();if(options.since&&options.until)throw new Error("UNSUPPORTED SET-UP: since and until parameters at the same time");options.since?list=newData.concat.apply(newData,list):options.until?list.push.apply(list,newData):list=newData;this.list(list)}else this.endReached(!0);this.isLoading(!1);currentXhr=null}.bind(this)).catch(function(err){this.isLoading(!1);currentXhr=null;if(err&&"abort"!==err.statusText){console.error("Error loading user reviews",err);throw err}}.bind(this));currentXhr=task.xhr;return task}}.bind(this);this.loadOlder=function loadOlderReviews(){var l=this.list(),last=l[l.length-1];return this.load({limit:10,until:last&&last.updatedDate()})}.bind(this);this.loadNewer=function loadOlderReviews(){var first=this.list()[0];return this.load({limit:10,since:first&&first.updatedDate()})}.bind(this)}},{"../data/users":311,"../models/PublicUserReview":404,knockout:15}],404:[function(require,module,exports){"use strict";function PublicUserReview(values){Model(this);this.model.defProperties({bookingID:0,jobTitleID:0,reviewedUserID:0,reviewerUserID:0,reviewerUserSince:null,rating1:null,rating2:null,rating3:null,publicReview:"",serviceHours:null,helpfulReviewCount:0,updatedDate:null,reviewerName:"",reviewerPhotoUrl:""},values)}var Model=require("./Model");module.exports=PublicUserReview},{"./Model":386}],211:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=onboarding.inProgress;this.userLicenseCertificationID=ko.observable(0);this.licenseCertificationID=ko.observable(0);this.jobTitleID=ko.observable(0);this.jobTitleNamePlural=ko.observable();this.inputElement=ko.observable();this.isLoading=ko.pureComputed(function(){return userLicensesCertifications.state.isLoading()},this);this.isSaving=userLicensesCertifications.state.isSaving;this.isSyncing=userLicensesCertifications.state.isSyncing;this.isDeleting=userLicensesCertifications.state.isDeleting;this.isLocked=ko.pureComputed(function(){return userLicensesCertifications.state.isLocked()},this);this.isReady=ko.pureComputed(function(){var it=this.item();return!(!it||!it.localTempFilePath()&&!it.localTempFileData())},this);this.takePhotoSupported=ko.observable(photoTools.takePhotoSupported());this.submitText=ko.pureComputed(function(){return this.isLoading()||this.isSyncing()?"Loading..":this.isSaving()?"Saving..":this.isDeleting()?"Deleting..":"Save"},this);this.isNew=ko.pureComputed(function(){return!this.userLicenseCertificationID()},this);this.version=ko.observable(null);this.item=ko.pureComputed(function(){var v=this.version();return v?v.version:null},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.version();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){var data=this.item().model.toPlainObject(!0);userLicensesCertifications.setItem(data).then(function(serverData){this.item().model.updateWith(serverData);this.version().push({evenIfObsolete:!0});jobTitleLicenses.clearCache();userLicensesCertifications.clearCache();onboarding.inProgress()?app.shell.goBack():app.successSave()}.bind(this)).catch(function(err){showError({title:"Unable to save.",error:err})})}.bind(this);this.confirmRemoval=function(){showConfirm({title:"Delete",message:"Are you sure? This cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){userLicensesCertifications.delItem(this.jobTitleID(),this.userLicenseCertificationID()).then(function(){app.shell.goBack()}.bind(this)).catch(function(err){showError({title:"Unable to delete.",error:err})})}.bind(this);var addNew=function(fromCamera){var settings={sourceType:fromCamera?window.Camera&&window.Camera.PictureSourceType.CAMERA:window.Camera&&window.Camera.PictureSourceType.PHOTOLIBRARY};if(photoTools.takePhotoSupported())return photoTools.cameraGetPicture(settings).then(function(imgLocalUrl){this.item().localTempFilePath(imgLocalUrl);this.item().localTempPhotoPreviewUrl(photoTools.getPreviewPhotoUrl(imgLocalUrl))}.bind(this)).catch(function(err){err&&"no image selected"!==err&&"has no access to camera"!==err&&showError({error:err,title:"Error selecting photo."})});showError({error:"This feature is currently only available on mobile devices"})}.bind(this);this.takePhotoForNew=function(){addNew(!0)}.bind(this);this.pickPhotoForNew=function(){addNew(!1)}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),photoTools=require("../utils/photoTools");require("jquery.fileupload-image");var onboarding=require("../data/onboarding"),userLicensesCertifications=require("../data/userLicensesCertifications"),licenseCertification=require("../data/licenseCertification"),jobTitleLicenses=require("../data/jobTitleLicenses"),$=require("jquery"),showConfirm=require("../modals/confirm").show,showError=require("../modals/error").show,A=Activity.extend(function LicensesCertificationsFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/marketplaceProfile",helpLink:"/help/relatedArticles/201967966-adding-professional-licenses-and-certifications"});this.title("Your credentials");this.defaultNavBarSettings=this.navBar.model.toPlainObject(!0);photoTools.takePhotoSupported()||this.viewModel.inputElement.subscribe(function(input){if(input){var PHOTO_WIDTH=442,PHOTO_HEIGHT=332;$(input).fileupload({dataType:"json",autoUpload:!1,acceptFileTypes:/(\.|\/)(png|gif|tiff|pdf|jpe?g)$/i,maxFileSize:2e7,disableImageResize:!0,previewMaxWidth:442,previewMaxHeight:332,previewCrop:!0}).on("fileuploadadd",function(e,data){this.viewModel.item().localTempFileData(data);data.originalFiles.length&&/^image\//.test(data.originalFiles[0].type)||this.viewModel.item().localTempPhotoPreview(null);this.viewModel.item().localTempFileName(data.originalFiles[0]&&data.originalFiles[0].name)}.bind(this)).on("fileuploadprocessalways",function(e,data){var file=data.files[data.index];if(file.error){this.viewModel.item().localTempPhotoPreview(null);console.error("Photo Preview",file.error)}else file.preview&&this.viewModel.item().localTempPhotoPreview(file.preview)}.bind(this))}}.bind(this))});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/licensesCertifications/";this.viewModel.isNew()?this.convertToCancelAction(this.navBar.leftAction(),link):this.navBar.model.updateWith(this.defaultNavBarSettings,!0)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.version(null);var params=state&&state.route&&state.route.segments||[],query=state&&state.route&&state.route.query||{};this.viewModel.jobTitleID(0|params[0]);this.viewModel.userLicenseCertificationID(0|params[1]);this.viewModel.licenseCertificationID(0|query.licenseCertificationID);this.updateNavBarState();var ModelVersion=require("../utils/ModelVersion"),UserLicenseCertification=require("../models/UserLicenseCertification");this.viewModel.isNew()?licenseCertification.getItem(this.viewModel.licenseCertificationID()).then(function(data){var item=new UserLicenseCertification({jobTitleID:this.viewModel.jobTitleID(),licenseCertificationID:this.viewModel.licenseCertificationID()});item.licenseCertification().model.updateWith(data);this.viewModel.version(new ModelVersion(item))}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this)):userLicensesCertifications.getItem(this.viewModel.jobTitleID(),this.viewModel.userLicenseCertificationID()).then(function(data){this.viewModel.version(new ModelVersion(new UserLicenseCertification(data)))}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this))}},{"../components/Activity":255,"../data/jobTitleLicenses":284,"../data/licenseCertification":288,"../data/onboarding":291,"../data/userLicensesCertifications":307,"../modals/confirm":342,"../modals/error":343,"../models/UserLicenseCertification":424,"../utils/ModelVersion":437,"../utils/photoTools":465,jquery:14,"jquery.fileupload-image":2,knockout:15}],288:[function(require,module,exports){"use strict";var LicenseCertification=require("../models/LicenseCertification"),session=require("./session"),GroupRemoteModel=require("./helpers/GroupRemoteModel"),remote=require("./drivers/restClient"),api=new GroupRemoteModel({ttl:{month:1},itemIdField:"licenseCertificationID",Model:LicenseCertification});module.exports=api;api.addLocalforageSupport("license-certification/");api.addRestSupport(remote,"license-certification/");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/LicenseCertification":380,"./drivers/restClient":271,"./helpers/GroupRemoteModel":279,"./session":303}],210:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967966-adding-credentials";this.isInOnboarding=onboarding.inProgress;this.jobTitleID=ko.observable(0);this.submittedUserLicensesCertifications=ko.observableArray([]);this.jobTitleApplicableLicences=ko.observable(null);this.jobTitleName=ko.observable("Job Title");this.isSyncing=userLicensesCertifications.state.isSyncing();this.isLoading=userLicensesCertifications.state.isLoading();this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/licensesCertifications");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.addNew=function(item){var url="#!licensesCertificationsForm/"+this.jobTitleID()+"/0?licenseCertificationID="+item.licenseCertificationID(),cancelUrl=app.shell.currentRoute.url,request=$.extend({},this.requestData,{cancelLink:cancelUrl});app.shell.go(url,request)}.bind(this);this.selectItem=function(item){var url="/licensesCertificationsForm/"+this.jobTitleID()+"/"+item.userLicenseCertificationID()+"?mustReturn="+encodeURIComponent(app.shell.currentRoute.url)+"&returnText="+encodeURIComponent("Licenses/certifications");app.shell.go(url,this.requestData)}.bind(this);this.onboardingNextReady=ko.computed(function(){if(!onboarding.inProgress())return!1;var groups=this.jobTitleApplicableLicences();if(!groups)return!1;var hasAllRequiredOfGroup=function(group){return!group||!group.length||!group.some(function(credential){if(credential.required())return!credential.submitted()})};return hasAllRequiredOfGroup(groups.municipality())&&hasAllRequiredOfGroup(groups.county())&&hasAllRequiredOfGroup(groups.stateProvince())&&hasAllRequiredOfGroup(groups.country())},this);this.goNext=function(){if(onboarding.inProgress()){onboarding.selectedJobTitleID(this.jobTitleID());onboarding.goNext()}}.bind(this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),onboarding=require("../data/onboarding"),jobTitles=require("../data/jobTitles"),userLicensesCertifications=require("../data/userLicensesCertifications"),jobTitleLicenses=require("../data/jobTitleLicenses"),DEFAULT_BACK_LINK="/listingEditor",DEFAULT_BACK_TEXT="Back",showError=require("../modals/error").show,A=Activity.extend(function LicensesCertificationsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Back",{backLink:"/listingEditor",helpLink:this.viewModel.helpLink});this.title("Professional credentials");this.defaultNavBar=this.navBar.model.toPlainObject(!0);this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName());this.updateNavBarState()}.bind(this)).catch(function(err){showError({title:"Unable to load listing details.",error:err})});userLicensesCertifications.getList(jobTitleID).then(function(list){this.viewModel.submittedUserLicensesCertifications(userLicensesCertifications.asModel(list))}.bind(this)).catch(function(err){showError({title:"Unable to load submitted licenses and credentials.",error:err})});jobTitleLicenses.getItem(jobTitleID).then(function(item){this.viewModel.jobTitleApplicableLicences(item);this.viewModel.onboardingNextReady()&&this.viewModel.goNext()}.bind(this)).catch(function(err){showError({title:"Unable to load license requirements.",error:err})});var found=/licensesCertifications\/(\d+)/i.exec(window.location);if((found&&0|found[1])!==jobTitleID){var url="/licensesCertifications/"+jobTitleID;this.app.shell.replaceState(null,null,url)}}else{this.viewModel.jobTitleName("Job Title");this.viewModel.submittedUserLicensesCertifications([]);this.viewModel.jobTitleApplicableLicences(null);this.updateNavBarState()}}.bind(this)})});exports.init=A.init;A.prototype.useJobTitleInNavBar=function(){this.navBar.model.updateWith(this.defaultNavBar,!0);var text=this.viewModel.jobTitleName()||"Back",id=this.viewModel.jobTitleID(),link=id?"/listingEditor/"+id:"/listingEditor";this.navBar.leftAction().model.updateWith({text:text,link:link})};A.prototype.updateNavBarState=function updateNavBarState(){var done=onboarding.updateNavBar(this.navBar);done||(done=this.app.applyNavbarMustReturn(this.requestData));done||this.useJobTitleInNavBar()};A.prototype.show=function show(options){this.viewModel.jobTitleID(0);Activity.prototype.show.call(this,options);this.updateNavBarState();var jobTitleID=0|(options&&options.route&&options.route.segments)[0];this.viewModel.jobTitleID(jobTitleID);jobTitleID||this.viewModel.jobTitles.sync()};var UserJobProfile=require("../viewmodels/UserJobProfile")},{"../components/Activity":255,"../data/jobTitleLicenses":284,"../data/jobTitles":286,"../data/onboarding":291,"../data/userLicensesCertifications":307,"../modals/error":343,"../viewmodels/UserJobProfile":512,jquery:14,knockout:15}],307:[function(require,module,exports){"use strict";var UserLicenseCertification=require("../models/UserLicenseCertification"),GroupListRemoteModel=require("./helpers/GroupListRemoteModel"),photoTools=require("../utils/photoTools"),$=require("jquery"),extend=$.extend,session=require("./session"),remote=require("./drivers/restClient"),baseUrl="me/licenses-certifications/",api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"userLicenseCertificationID",Model:UserLicenseCertification});module.exports=api;api.addLocalforageSupport("userLicensesCertifications/");api.addRestSupport(remote,baseUrl);session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()});var pushJustBasicDataToRemote=api.pushItemToRemote.bind(api),photoUploadFieldName="photo",pushWithoutFile=function(data){return 0===data.userLicenseCertificationID?Promise.reject("An image of the license/certification is required"):pushJustBasicDataToRemote(data)},nativeUploadFile=function pushToRemote(data,options){if(data.localTempFilePath){var uploadSettings={fileKey:"photo",httpMethod:options.method,params:data,headers:extend(!0,{},remote.extraHeaders)};return photoTools.uploadLocalFileJson(data.localTempFilePath,options.url,uploadSettings)}return pushWithoutFile(data)}.bind(api),webUploadFile=function(data,options){if(data.localTempFileData){var fd=data.localTempFileData;if(!fd)return Promise.resolve(null);fd.url=options.url;fd.type=options.method;fd.paramName="photo";fd.formData=Object.keys(data).filter(function(k){return!/^local/.test(k)}).map(function(k){return{name:k,value:data[k]}});fd.headers=$.extend(!0,{},remote.extraHeaders);return Promise.resolve(fd.submit())}return pushWithoutFile(data)};api.pushItemToRemote=function pushToRemote(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],options={method:itemID?"put":"post",url:remote.baseUrl+baseUrl+groupID+(itemID?"/"+itemID:"")},after=function(serverData){api._pushItemToCache(serverData);return serverData};return photoTools.takePhotoSupported()?nativeUploadFile(data,options).then(after):webUploadFile(data,options).then(after)}.bind(api)},{"../models/UserLicenseCertification":424,"../utils/photoTools":465,"./drivers/restClient":271,"./helpers/GroupListRemoteModel":278,"./session":303,jquery:14}],465:[function(require,module,exports){"use strict";function takePhotoSupported(){return navigator.camera&&navigator.camera.getPicture}function getPreviewPhotoUrl(url){if(!url)return null;var iFile=url.indexOf("file://");if(userAgentFlags.isWkWebview&&0===window.location.protocol.indexOf("http")&&0===iFile){var m=/\/Application\/[^\/]+(.+)$/.exec(url);return m&&2===m.length?m[1]:url.substr(iFile)}return url}function cameraGetPicture(settings){return new Promise(function(resolve,reject){navigator.camera.getPicture(resolve,reject,extend(!0,{},defaultPhotoSettings,settings))})}function moveLocalPhoto(uri,destFolder,destName){return new Promise(function(resolve,reject){var onTempEntry=function(entry){var n=(new Date).getTime(),newFileName=(destName||n)+".jpg";window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,function(fileSys){fileSys.root.getDirectory(destFolder,{create:!0},function(directory){entry.moveTo(directory,newFileName,function(new_entry){var path=new_entry.fullPath,url=new_entry.toURL();resolve({path:path,url:url})},reject)},reject)},reject)};window.resolveLocalFileSystemURI(uri,onTempEntry,reject)})}function uploadLocalFile(localFileUri,remoteUri,options){return new Promise(function(resolve,reject){remoteUri=encodeURI(remoteUri);var fuopts=new FileUploadOptions;Object.keys(options).forEach(function(option){fuopts[option]=options[option]});fuopts.fileKey||(fuopts.fileKey="file");fuopts.fileName||(fuopts.fileName=localFileUri.substr(localFileUri.lastIndexOf("/")+1));fuopts.mimeType||(fuopts.mimeType="image/jpeg");fuopts.headers=fuopts.headers||{};fuopts.headers.Connection="close";(new FileTransfer).upload(localFileUri,remoteUri,resolve,reject,fuopts)})}var extend=require("jquery").extend,userAgentFlags=require("./userAgentFlags")(),defaultPhotoSettings={destinationType:window.Camera&&window.Camera.DestinationType.FILE_URI,quality:78,mediaType:window.Camera&&window.Camera.MediaType.PICTURE,saveToPhotoAlbum:!1};exports.defaultPhotoSettings=defaultPhotoSettings;exports.takePhotoSupported=takePhotoSupported;exports.getPreviewPhotoUrl=getPreviewPhotoUrl;exports.cameraGetPicture=cameraGetPicture;exports.moveLocalPhoto=moveLocalPhoto;exports.uploadLocalFile=uploadLocalFile;exports.uploadLocalFileJson=function(localFileUri,remoteUri,options){return uploadLocalFile(localFileUri,remoteUri,options).then(function(data){if(data&&data.response&&"string"==typeof data.response)try{return JSON.parse(data.response)}catch(ex){}return null})}},{"./userAgentFlags":483,jquery:14}],483:[function(require,module,exports){"use strict";module.exports=function getFlags(){if(window.navigator&&window.navigator.userAgent){var ua=window.navigator.userAgent,iOsWebview=/iOS|iPad|iPhone|iPod/.test(ua),iOsVersion=/OS ((\d+_?){2,3})\s/.exec(ua);if(iOsVersion&&iOsVersion.length>1){(iOsVersion={full:iOsVersion[1]||""}).parts=iOsVersion.full.split("_");iOsVersion.major=0|iOsVersion.parts[0];iOsVersion.minor=0|iOsVersion.parts[1];iOsVersion.revision=0|iOsVersion.parts[2]}var isWkWebview=!!(iOsWebview&&window.cordova&&window.indexedDB),isAndroid=/Android/.test(ua);return{isIos:iOsWebview,iOsVersion:iOsVersion,isWkWebview:isWkWebview,isAndroid:isAndroid,isChrome:/Chrome\//.test(ua),isMobile:iOsWebview||isAndroid}}return{}}},{}],284:[function(require,module,exports){"use strict";var JobTitleLicense=require("../models/JobTitleLicense"),session=require("./session"),GroupRemoteModel=require("./helpers/GroupRemoteModel"),remote=require("./drivers/restClient"),api=new GroupRemoteModel({ttl:{minutes:1},itemIdField:"jobTitleID",Model:JobTitleLicense});module.exports=api;api.addLocalforageSupport("job-title-licenses/");api.addRestSupport(remote,"me/job-title-licenses/");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/JobTitleLicense":374,"./drivers/restClient":271,"./helpers/GroupRemoteModel":279,"./session":303}],374:[function(require,module,exports){"use strict";function JobTitleLicenses(values){Model(this);this.model.defProperties({municipality:{isArray:!0,Model:JobTitleMunicipalLicense},county:{isArray:!0,Model:JobTitleCountyLicense},stateProvince:{isArray:!0,Model:JobTitleStateProvinceLicense},country:{isArray:!0,Model:JobTitleCountryLicense}},values)}var Model=require("./Model"),JobTitleMunicipalLicense=require("./JobTitleMunicipalLicense"),JobTitleCountyLicense=require("./JobTitleCountyLicense"),JobTitleStateProvinceLicense=require("./JobTitleStateProvinceLicense"),JobTitleCountryLicense=require("./JobTitleCountryLicense");module.exports=JobTitleLicenses},{"./JobTitleCountryLicense":372,"./JobTitleCountyLicense":373,"./JobTitleMunicipalLicense":375,"./JobTitleStateProvinceLicense":379,"./Model":386}],379:[function(require,module,exports){"use strict";function JobTitleStateProvinceLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,stateProvinceID:0,stateProvinceName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleStateProvinceLicense},{"./LicenseCertification":380,"./Model":386}],375:[function(require,module,exports){"use strict";function JobTitleMunicipalLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,municipalityID:0,municipalityName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleMunicipalLicense},{"./LicenseCertification":380,"./Model":386}],373:[function(require,module,exports){"use strict";function JobTitleCountyLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,countyID:0,countyName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleCountyLicense},{"./LicenseCertification":380,"./Model":386}],372:[function(require,module,exports){"use strict";function JobTitleCountryLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,countryID:0,countryName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleCountryLicense},{"./LicenseCertification":380,"./Model":386}],209:[function(require,module,exports){"use strict";function ViewModel(app){this.isServiceProfessional=user.isServiceProfessional;this.isClient=user.isClient;this.signup=ko.observable();this.resetSignup=function(){var signup=this.signup();if(signup instanceof SignupVM){signup.reset();signup.profile(SignupVM.profileType.serviceProfessional);signup.isCountryVisible(!1)}};this.signup.subscribe(this.resetSignup.bind(this));this.signupRedirect=function(){app.goDashboard()};this.setSignupJobTitle=function(id,name){var signup=this.signup();if(signup instanceof SignupVM){signup.jobTitleID(id||void 0);signup.jobTitleName(name||void 0)}};this.inApp=ko.observable(!!window.cordova);this.reset=function(){this.resetSignup()}.bind(this);this.suggestionButtonText=ko.pureComputed(function(){return user.isAnonymous()?"Sign up":"Add"},this);this.onSelectJobTitle=function(jobTitleName,jobTitle){var url;if(jobTitle&&jobTitle.jobTitleID)if(user.isAnonymous()){this.setSignupJobTitle(jobTitle.jobTitleID());app.shell.scrollTo(SIGNUP_ELEMENT_SELECTOR,!0)}else{url="addJobTitle?s="+encodeURIComponent(jobTitle.singularName())+"&id="+encodeURIComponent(jobTitle.jobTitleID())+"&autoAddNew=true";app.shell.go(url)}else if(user.isAnonymous()){this.setSignupJobTitle(null,jobTitleName);app.shell.scrollTo(SIGNUP_ELEMENT_SELECTOR,!0)}else{url="addJobTitle?s="+encodeURIComponent(jobTitleName)+"&autoAddNew=true";app.shell.go(url)}return{value:ActionForValue.clear}}.bind(this)}var ko=require("knockout"),Activity=require("../components/Activity"),SignupVM=require("../viewmodels/Signup"),user=require("../data/userProfile").data,ActionForValue=require("../kocomponents/job-title-autocomplete").ActionForValue,SIGNUP_ELEMENT_SELECTOR="#learnMoreProfessionals-signup",A=Activity.extend(function LearnMoreProfessionalsActivity(){Activity.apply(this,arguments);this.navBar=Activity.createSectionNavBar(null);this.navBar.additionalNavClasses("AppNav--home");this.title("List your services");this.accessLevel=null;this.viewModel=new ViewModel(this.app);this.viewModel.nav=this.app.navBarBinding});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.reset()}},{"../components/Activity":255,"../data/userProfile":309,"../kocomponents/job-title-autocomplete":316,"../viewmodels/Signup":510,knockout:15}],207:[function(require,module,exports){"use strict";function ViewModel(app){this.isLoading=messaging.state.isLoading;this.isSyncing=messaging.state.isSyncing;this.sourceThreads=ko.observableArray([]);this.searchText=ko.observable("");this.threads=ko.pureComputed(function(){var t=this.sourceThreads(),s=this.searchText();return t?s?t.filter(function(thread){var found=!1;(found=textSearch(s,thread.subject()))||thread.messages().some(function(msg){return found=textSearch(s,msg.bodyText())});return found}).map(MessageView.fromThread.bind(null,app)):t.map(MessageView.fromThread.bind(null,app)):[]},this)}var Activity=require("../components/Activity"),ko=require("knockout"),MessageView=require("../models/MessageView"),textSearch=require("../utils/textSearch"),messaging=require("../data/messaging"),showError=require("../modals/error").show,A=Activity.extend(function InboxActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar(null);this.title("Your Inbox")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);messaging.getList().then(function(threads){this.viewModel.sourceThreads(threads())}.bind(this)).catch(function(err){showError({title:"Error loading messages",error:err})})}},{"../components/Activity":255,"../data/messaging":290,"../modals/error":343,"../models/MessageView":385,"../utils/textSearch":480,knockout:15}],206:[function(require,module,exports){"use strict";function ViewModel(shell){this.isAnonymous=user.isAnonymous;MarketplaceSearchVM.call(this);this.getJobTitleUrl=function(id){return"/searchJobTitle/"+id+"/"+this.lat()+"/"+this.lng()+"/"+this.searchDistance()}.bind(this);this.getServiceProfessionalUrl=function(id){return"/listing/"+id}.bind(this);this.getSearchCategoryUrl=function(categoryID){return"/searchCategory/"+categoryID+"/"+this.lat()+"/"+this.lng()+"/"+this.searchDistance()}.bind(this);this.onSelect=function(textValue,data){if(data){data.jobTitleID?shell.go(this.getJobTitleUrl(data.jobTitleID())):data.userID?shell.go(this.getServiceProfessionalUrl(data.userID())):data.categoryID&&shell.go(this.getSearchCategoryUrl(data.categoryID()));return{value:ActionForValue.clear}}}.bind(this);this.onPlaceSelect=function(place){this.lat(place.geometry.location.lat());this.lng(place.geometry.location.lng());this.city(place.formatted_address)}.bind(this)}var $=require("jquery"),MarketplaceSearchVM=require("../viewmodels/MarketplaceSearch"),Activity=require("../components/Activity"),snapPoints=require("../utils/snapPoints"),showAnnouncement=require("../modals/announcement").show,user=require("../data/userProfile").data,ActionForValue=require("../kocomponents/job-title-autocomplete").ActionForValue;require("../kocomponents/location-autocomplete");require("../kocomponents/lead-generation/newsletter");require("../kocomponents/lead-generation/refer");var A=Activity.extend(function HomeActivity(){Activity.apply(this,arguments);this.navBar=Activity.createSectionNavBar(null);var navBar=this.navBar;navBar.additionalNavClasses("AppNav--home");this.accessLevel=null;this.title("Find and schedule local services.");this.viewModel=new ViewModel(this.app.shell);this.viewModel.nav=this.app.navBarBinding;this.$header=$(".AppNav");this.registerHandler({target:this.$activity,event:"scroll-fixed-header",handler:function(e,what){var cs=navBar.additionalNavClasses();"after"===what?navBar.additionalNavClasses(cs+" is-fixed"):navBar.additionalNavClasses(cs.replace("is-fixed",""))}});this.registerHandler({target:this.$activity,event:"scroll-search",handler:function(e,what){var cs=navBar.additionalNavClasses();"after"===what?navBar.additionalNavClasses(cs+" is-search"):navBar.additionalNavClasses(cs.replace("is-search",""))}})});exports.init=A.init;A.prototype._registerSnapPoints=function(){var $searchBox=this.$activity.find("#home-jobTitleAutocomplete"),pointsEvents={0:"scroll-fixed-header"};pointsEvents[Math.max(1,$searchBox.offset().top+this.$activity.scrollTop()+$searchBox.outerHeight()-this.$header.outerHeight()|0)]="scroll-search";snapPoints(this.$activity,pointsEvents)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);if(!this._notFirstShow){this._registerSnapPoints();this._notFirstShow=!0;!localStorage.sanFranciscoLaunchPopup&&user.isAnonymous()&&showAnnouncement({message:"We're an app for booking local services that's cooperatively owned by service professionals. Right now we're busy recruiting service professional owners in San Francisco and Oakland. Click below to learn more.",primaryButtonText:"I'm a service professional",primaryButtonLink:"#!/learnMoreProfessionals",secondaryButtonText:"I'm a potential client",secondaryButtonLink:"#!/"}).then(function(){localStorage.sanFranciscoLaunchPopup=!0})}this.viewModel.searchTerm("")}},{"../components/Activity":255,"../data/userProfile":309,"../kocomponents/job-title-autocomplete":316,"../kocomponents/lead-generation/newsletter":317,"../kocomponents/lead-generation/refer":319,"../kocomponents/location-autocomplete":321,"../modals/announcement":341,"../utils/snapPoints":479,"../viewmodels/MarketplaceSearch":495,jquery:14}],495:[function(require,module,exports){"use strict";var ko=require("knockout"),search=require("../data/search"),SearchResults=require("../models/SearchResults"),MIN_LENGTH=3;module.exports=function MarketplaceSearchVM(){this.isLoading=ko.observable(!1);this.searchTerm=ko.observable();this.value=this.searchTerm;this.lat=ko.observable(search.DEFAULT_LOCATION.lat);this.lng=ko.observable(search.DEFAULT_LOCATION.lng);this.city=ko.observable();this.searchDistance=ko.observable(search.DEFAULT_LOCATION.searchDistance);this.searchResults=new SearchResults;this.queryTerm=ko.pureComputed(function(){var s=this.value();return s&&s.length>=3?s:null},this);this.loadData=function(searchTerm,lat,lng){this.isLoading(!0);return search.byTerm(searchTerm,lat,lng).then(function(searchResults){searchResults?this.searchResults.model.updateWith(searchResults,!0):this.searchResults.model.reset();this.isLoading(!1)}.bind(this)).catch(function(err){this.isLoading(!1);if(err&&"abort"===err.statusText)return null}.bind(this))};this.search=function(){var s=this.queryTerm();s?this.loadData(s,this.lat(),this.lng()):this.searchResults.model.reset()};ko.computed(function(){this.search()},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:120}})}},{"../data/search":299,"../models/SearchResults":409,knockout:15}],409:[function(require,module,exports){"use strict";function SearchResults(values){Model(this);this.model.defProperties({jobTitles:{isArray:!0,Model:JobTitleSearchResult},serviceProfessionals:{isArray:!0,Model:ServiceProfessionalSearchResult},categories:{isArray:!0,Model:CategorySearchResult}},values);this.length=ko.pureComputed(function(){return this.jobTitles().length+this.serviceProfessionals().length+this.categories().length},this)}var Model=require("./Model"),JobTitleSearchResult=require("./JobTitleSearchResult"),ServiceProfessionalSearchResult=require("./ServiceProfessionalSearchResult"),CategorySearchResult=require("./CategorySearchResult"),ko=require("knockout");module.exports=SearchResults},{"./CategorySearchResult":361,"./JobTitleSearchResult":377,"./Model":386,"./ServiceProfessionalSearchResult":413,knockout:15}],413:[function(require,module,exports){"use strict";function ServiceProfessionalSearchResult(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,firstName:"",lastName:"",lastInitial:"",publicBio:"",businessName:"",instantBooking:"",jobTitleNameSingular:"",otherJobTitles:"",allJobTitles:"",distance:0,rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary},stats:{Model:PublicUserStats},jobStats:{Model:PublicUserJobStats},photoUrl:""},values);var valueAsBoolean=function(a){return!!a};this.fullName=ko.pureComputed(function(){return[this.firstName(),this.lastName()].filter(valueAsBoolean).join(" ")},this)}var Model=require("./Model"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary"),PublicUserStats=require("./PublicUserStats"),PublicUserJobStats=require("./PublicUserJobStats"),ko=require("knockout");module.exports=ServiceProfessionalSearchResult},{"./Model":386,"./PublicUserJobStats":399,"./PublicUserRating":403,"./PublicUserStats":405,"./PublicUserVerificationsSummary":407,knockout:15}],399:[function(require,module,exports){"use strict";function PublicUserJobStats(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,servicesCount:0,minServicePrice:0,minUnitRate:0,priceRateUnit:"",minServiceValue:""},values)}var Model=require("./Model");module.exports=PublicUserJobStats},{"./Model":386}],361:[function(require,module,exports){"use strict";function CategorySearchResult(values){Model(this);this.model.defProperties({categoryID:0,categoryName:"",searchDescription:"",averageRating:"",totalRatings:"",averageResponseTimeMinutes:0,averageHourlyRate:0,serviceProfessionalsCount:0},values)}var Model=require("./Model");module.exports=CategorySearchResult},{"./Model":386}],479:[function(require,module,exports){var $=require("jquery"),throttle=require("iagosrl/throttle");module.exports=function snapPoints($scrollerElement,points,precision){if(points&&Object.keys(points).length){$scrollerElement=$scrollerElement||$(window);var record={},checkScroll=function(){var top=$scrollerElement.scrollTop();Object.keys(points).forEach(function(point){var type;(point|=0)===top?"there"!==record[point]&&(type="there"):top>point?"after"!==record[point]&&(type="after"):"before"!==record[point]&&(type="before");if(type){$scrollerElement.trigger(points[point],[type]);record[point]=type}})};(precision=0===precision?0:Math.abs(0|precision)||16)>0&&(checkScroll=throttle(checkScroll,precision));$scrollerElement.scroll(checkScroll);checkScroll()}}},{"iagosrl/throttle":523,jquery:14}],321:[function(require,module,exports){"use strict";function ViewModel(params){this.value=ko.observable(ko.unwrap(params.value));this.suggestions=ko.observableArray();var google=null;this.onSelect=function(text,result){"function"==typeof params.onSelect&&new google.maps.places.PlacesService(document.querySelector("#google-maps-places-attribution")).getDetails({placeId:result.place_id},function(place){place&&params.onSelect(place)})};var self=this;googleMapReady(function(goog){var autocomplete=new(google=goog).maps.places.AutocompleteService;self.value.subscribe(function(newValue){newValue?autocomplete.getPlacePredictions({input:newValue,componentRestrictions:{country:"US"}},function(results){self.suggestions(results)}):self.suggestions([])})})}var TAG_NAME="location-autocomplete",TEMPLATE=require("../../html/kocomponents/location-autocomplete.html"),googleMapReady=require("../utils/googleMapReady"),ko=require("knockout");require("./input-autocomplete");ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:ViewModel,synchronous:!0})},{"../../html/kocomponents/location-autocomplete.html":159,"../utils/googleMapReady":457,"./input-autocomplete":315,knockout:15}],319:[function(require,module,exports){"use strict";function ViewModel(){this.disposables=[];this.referredByUserID=ko.observable(0);this.referredByEmail=ko.observable("");this.email=ko.observable("");this.isServiceProfessional=ko.observable(!1);this.firstName=ko.observable("");this.lastName=ko.observable("");this.phone=ko.observable("");this.currentStep=ko.observable(1);this.isAtStepOne=ko.pureComputed(function(){return 1===this.currentStep()},this);this.isAtStepTwo=ko.pureComputed(function(){return 2===this.currentStep()},this);this.isAtStepThree=ko.pureComputed(function(){return 3===this.currentStep()},this);this.isAnonymous=user.isAnonymous;this.isDone=ko.observable(!1);this.errorMessage=ko.observable("");this.isSaving=ko.observable(!1);this.isLocked=this.isSaving;this.isEmailValid=ko.pureComputed(function(){return/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(this.email())},this);this.resetForm=function(){this.email("");this.firstName("");this.lastName("");this.phone("");this.isServiceProfessional(!1)}.bind(this);this.disposables.push(ko.computed(function(){this.email();this.firstName();this.lastName();this.phone();this.isDone(!1)},this));this.disposables.push(ko.computed(function(){if(!user.isAnonymous()&&2===this.currentStep()){this.firstName(user.firstName());this.lastName(user.lastName())}},this));var prepareSave=function(){this.isSaving(!0);this.errorMessage(null)}.bind(this),onSuccessSave=function(){this.isSaving(!1);var step=this.currentStep();if(step===LAST_STEP){this.resetForm();this.isDone(!0)}else{this.resetForm();this.currentStep(step+1)}}.bind(this),onSaveError=function(err){this.isSaving(!1);return showError({error:err}).then(function(errorMessage){this.errorMessage(errorMessage)}.bind(this))}.bind(this);this.saveStepOne=function(){if(this.isAtStepOne()){prepareSave();var data={email:this.email(),isServiceProfessional:this.isServiceProfessional()};return leadGenerationApi.subscribeReferral(data).then(function(data){this.referredByEmail(this.email());this.referredByUserID(data.userID);onSuccessSave()}.bind(this)).catch(onSaveError)}}.bind(this);this.saveStepTwo=function(){if(this.isAtStepTwo()){prepareSave();var data={userID:this.referredByUserID(),email:this.referredByEmail(),firstName:this.firstName(),lastName:this.lastName()};return leadGenerationApi.updateSubscription(data).then(onSuccessSave).catch(onSaveError)}}.bind(this);this.saveStepThree=function(){if(this.isAtStepThree()){prepareSave();var data={referredByUserID:this.referredByUserID(),referredByEmail:this.referredByEmail(),email:this.email(),firstName:this.firstName(),lastName:this.lastName(),phone:this.phone()};return leadGenerationApi.referAServiceProfessional(data).then(onSuccessSave).catch(onSaveError)}}.bind(this);this.goStepTwo=function(){user.isAnonymous()||this.currentStep(2)}.bind(this)}var TAG_NAME="lead-generation-refer",TEMPLATE=require("./template.html"),ko=require("knockout");require("../../../utils/autofocusBindingHandler");var leadGenerationApi=require("../../../data/leadGeneration"),showError=require("../../../modals/error").show,user=require("../../../data/userProfile").data,LAST_STEP=3;ViewModel.prototype.dispose=function(){this.disposables.forEach(function(value){try{value.dispose()}catch(ex){}})};ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:ViewModel})},{"../../../data/leadGeneration":287,"../../../data/userProfile":309,"../../../modals/error":343,"../../../utils/autofocusBindingHandler":444,"./template.html":320,knockout:15}],320:[function(require,module,exports){module.exports='<form id=referProfessionalForm class=LeadGeneration aria-describedby=referProfessionalFormInstructions> <fieldset id=referProfessionalsForm-StepOne class=refer-step data-bind="visible: isAtStepOne() && !isAnonymous(), if: isAtStepOne"> <div class=col-xs-12> <legend>Know a professional?</legend> <p class=LeadGeneration-loggedInMessage>Know a service professional in your community who could benefit from the power of Loconomics?</p> <button type=button class="btn btn-secondary btn-block btn-lg LeadGeneration-buttonLarge" data-bind="disable: isLocked, click: goStepTwo">Introduce us</button> </div> </fieldset> <fieldset id=referProfessionalsForm-StepOne class=refer-step data-bind="visible: isAtStepOne() && isAnonymous(), if: isAtStepOne, css: { \'has-error\': errorMessage }"> <div class=col-xs-12> <legend>Make an introduction</legend> <label for=referrerEmailAddress>Your email address</label> </div> <div class="col-xs-9 col-sm-10 col-md-9"> <div class=form-group data-bind="css: { \'has-feedback\': isEmailValid }"> <input class=form-control id=referrerEmailAddress type=email placeholder=example@address.com data-bind="\r\n                        textInput: email,\r\n                        popover: { content: errorMessage, trigger: \'focus\', container: \'body\', placement: \'top\' },\r\n                        disable: isLocked,\r\n                        css: { \'is-valid\': isEmailValid }\r\n                    "> <i class="form-control-feedback text-success ion-android-done" data-bind="visible: isEmailValid" aria-hidden=true></i> </div> </div> <div class="col-xs-3 col-sm-2 col-md-3 col-lg-2"> <button type=submit class="btn btn-secondary btn-block LeadGeneration-buttonSmall" data-bind="disable: isLocked, click: saveStepOne" aria-label="Continue to step two"> <icon-dec data-bind="visible: !isSaving()" params="icon: \'ion-arrow-right-c\'"></icon-dec> <icon-dec data-bind="visible: isSaving()" params="icon: \'ion-android-sync fa-spin\'"></icon-dec> </button> </div> <div class="checkbox-inline col-xs-10 col-offset-1"> <input id=isServiceProfessional type=checkbox data-bind="checked: isServiceProfessional, disable: isLocked"> <label for=isServiceProfessional>I also offer local services</label> </div> <p id=referProfessionalFormInstructions class="help-block col-xs-12">Know a service professional in your community who could benefit from the power of Loconomics?</p> </fieldset> <fieldset id=referProfessionalsForm-StepTwo class=refer-step data-bind="visible: isAtStepTwo, if: isAtStepTwo, autofocus: isAtStepTwo, css: { \'has-error\': errorMessage }"> <legend>Your name</legend> <label for=referrerFirstName>Your first name</label> <div class=form-group> <input class=form-control id=referrerFirstName type=text data-bind="\r\n                    textInput: firstName,\r\n                    disable: isLocked\r\n                "> </div> <label for=referrerLastName>Your last name</label> <div class=form-group> <input class=form-control id=referrerLastName type=text data-bind="\r\n                    textInput: lastName,\r\n                    disable: isLocked\r\n                "> </div> <button type=submit class="btn btn-secondary btn-block btn-lg LeadGeneration-buttonLarge" data-bind="disable: isLocked, click: saveStepTwo"> <span data-bind="visible: !isSaving()">Continue</span> <span data-bind="visible: isSaving()">Saving</span> </button> <p class=help-block>We\'ll need your name so we can say who\'s referring them.</p> </fieldset> <fieldset id=referProfessionalsForm-StepThree class=refer-step data-bind="visible: isAtStepThree, if: isAtStepThree, autofocus: isAtStepThree, css: { \'has-error\': errorMessage }"> <legend data-bind="visible: !isDone()">Who\'s the service professional?</legend> <legend data-bind="visible: isDone, autofocus: isDone">You\'re amazing – thanks! Know another?</legend> <label for=referredFirstName>Their first name</label> <div class=form-group> <input class=form-control id=referredFirstName type=text data-bind="\r\n                    textInput: firstName,\r\n                    disable: isLocked\r\n                "> </div> <div class="form-group has-feedback"> <label for=referredLastName>Their last name</label> <div class=form-group> <input class=form-control id=referredLastName type=text data-bind="\r\n                        textInput: lastName,\r\n                        disable: isLocked\r\n                    "> </div> </div> <div class="form-group has-feedback"> <label for=referredLastName>Their email address</label> <div class=form-group data-bind="css: { \'has-feedback\': isEmailValid }"> <input class=form-control id=referredEmailAddress type=email placeholder=example@address.com data-bind="\r\n                        textInput: email,\r\n                        popover: { content: errorMessage, trigger: \'focus\', container: \'body\', placement: \'top\' },\r\n                        disable: isLocked,\r\n                        css: { \'is-valid\': isEmailValid }\r\n                    "> <i class="form-control-feedback text-success ion-android-done" data-bind="visible: isEmailValid" aria-hidden=true></i> </div> </div> <div class="form-group has-feedback"> <label for=referredPhoneNumber>Their phone number</label> <div class=form-group> <input class=form-control id=referredPhoneNumber type=tel data-bind="\r\n                        textInput: phone,\r\n                        disable: isLocked\r\n                    "> </div> </div> <button type=submit class="btn btn-secondary btn-block btn-lg LeadGeneration-buttonLarge" data-bind="disable: isLocked, click: saveStepThree">Make introduction </button> <p class=help-block>Fear not, we will not spam.</p> </fieldset> </form>'},{}],317:[function(require,module,exports){"use strict";function ViewModel(){this.email=ko.observable("");this.isServiceProfessional=ko.observable(!1);this.isDone=ko.observable(!1);this.errorMessage=ko.observable("");this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isSaving()||this.isDone()},this);this.isEmailValid=ko.pureComputed(function(){return/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(this.email())},this);this.save=function(){if(!this.isDone()){this.isSaving(!0);var data={email:this.email(),isServiceProfessional:this.isServiceProfessional()};return leadGenerationApi.subscribeNewsletter(data).then(function(){this.isSaving(!1);this.errorMessage(null);this.isDone(!0)}.bind(this)).catch(function(err){this.isSaving(!1);return showError({error:err}).then(function(errorMessage){this.errorMessage(errorMessage)}.bind(this))}.bind(this))}}.bind(this)}var TAG_NAME="lead-generation-newsletter",template=require("./template.html"),ko=require("knockout");require("../../../utils/autofocusBindingHandler");var leadGenerationApi=require("../../../data/leadGeneration"),showError=require("../../../modals/error").show;ko.components.register(TAG_NAME,{template:template,viewModel:ViewModel})},{"../../../data/leadGeneration":287,"../../../modals/error":343,"../../../utils/autofocusBindingHandler":444,"./template.html":318,knockout:15}],444:[function(require,module,exports){"use strict";var $=require("jquery"),ko=require("knockout");exports.delayInMiliseconds=100;ko.bindingHandlers.autofocus={init:function(element,valueAccessor){var $el=$(element);$el.is(":input")||$el.attr("tabindex","-1");var observableFlag=valueAccessor(),timer=null,subscription=ko.computed(function(){var isTrue=observableFlag();clearTimeout(timer);isTrue&&(timer=setTimeout(function(){$el.focus()},exports.delayInMiliseconds))});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){subscription.dispose();clearTimeout(timer)})}}},{jquery:14,knockout:15}],318:[function(require,module,exports){module.exports='<form id=newsletterSignupForm class=LeadGeneration aria-describedby=newsletterSignupFormInstructions> <fieldset data-bind="visible: isDone, if: isDone, autofocus: isDone"> <div class=col-xs-12> <legend>Thank you</legend> <p id=newsletterSignupFormThankYou>We\'ll keep you in the loop!</p> </div> </fieldset> <fieldset data-bind="visible: !isDone(), if: !isDone()"> <div class=col-xs-12> <legend>Stay informed</legend> <label for=signupNewsletterEmail>Your email address</label> </div> <div class="col-xs-9 col-sm-10 col-md-9"> <div class=form-group data-bind="css: { \'has-error\': errorMessage, \'has-feedback\': isEmailValid }"> <input class=form-control id=signupNewsletterEmail type=email placeholder=example@address.com data-bind="\r\n                        textInput: email,\r\n                        popover: { content: errorMessage, trigger: \'focus\', container: \'body\', placement: \'top\' },\r\n                        disable: isLocked,\r\n                        css: { \'is-valid\': isEmailValid }\r\n                    "> <i class="form-control-feedback text-success ion-android-done" data-bind="visible: isEmailValid" aria-hidden=true></i> </div> </div> <div class="col-xs-3 col-sm-2 col-md-3 col-lg-2"> <button type=submit class="btn btn-secondary btn-block LeadGeneration-buttonSmall" data-bind="disable: isLocked, click: save" aria-label="Sign up for newsletter"> <icon-dec data-bind="visible: !isSaving()" params="icon: \'ion-arrow-right-c\'"></icon-dec> <icon-dec data-bind="visible: isSaving()" params="icon: \'ion-android-sync fa-spin\'"></icon-dec> </button> </div> <div class="checkbox-inline col-xs-10 col-offset-1"> <input id=newsletterSignupForm-isServiceProfessional type=checkbox data-bind="checked: isServiceProfessional, disable: isLocked"> <label for=newsletterSignupForm-isServiceProfessional>I offer local services</label> </div> <p id=newsletterSignupFormInstructions class="help-block col-xs-12">Spam-free information – you can unsubscribe at any time.</p> </fieldset> </form>'},{}],287:[function(require,module,exports){"use strict";var remote=require("./drivers/restClient");exports.subscribeNewsletter=function(data){return remote.post("lead-generation/newsletter/subscribe",data)};exports.subscribeReferral=function(data){return remote.post("lead-generation/referral/subscribe",data)};exports.updateSubscription=function(data){return remote.put("lead-generation/referral/subscribe",data)};exports.referAServiceProfessional=function(data){return remote.post("lead-generation/referral/refer",data)}},{"./drivers/restClient":271}],205:[function(require,module,exports){"use strict";function ViewModel(){this.isInOnboarding=onboarding.inProgress;this.articles=ko.observableArray([]);this.searchText=ko.observable("");this.isLoading=ko.observable(!1);this.params=ko.observable("");this.viewType=ko.observable("");this.tailId=ko.observable("");this.categories=ko.observableArray([]);this.sections=ko.observableArray([]);this.selectedArticleId=ko.observable(0);this.selectedCategoryId=ko.observable(0);this.selectedSectionId=ko.observable(0);this.fullArticleData=ko.pureComputed(function(){return help.findByIdAt(this.selectedArticleId(),this.articles())},this);this.selectedSection=ko.pureComputed(function(){return help.findByIdAt(this.selectedSectionId(),this.sections())},this);this.selectedCategory=ko.pureComputed(function(){return help.findByIdAt(this.selectedCategoryId(),this.categories())},this);this.filteredSectionArticles=ko.pureComputed(function(){var selectedSectionId=this.selectedSectionId(),result=this.articles().filter(function(article){return article.section_id()===selectedSectionId});return result.length?result:null},this);this.filteredCategorySections=ko.pureComputed(function(){var selectedCategoryId=this.selectedCategoryId(),result=this.sections().filter(function(section){return section.category_id()===selectedCategoryId});return result.length?result:null},this);this.filteredArticles=ko.pureComputed(function(){var s=this.searchText().toLowerCase(),result=this.articles().filter(function(v){var n=v&&v.title()||"";return(n=(n+=v&&v.description()||"").toLowerCase()).indexOf(s)>-1});return result.length?result:null},this);this.nothingFound=ko.pureComputed(function(){return this.filteredArticles()===null+("404"==this.viewType())+("viewAllSections"==this.viewType()&&null===this.sections())+("categoryView"==this.viewType()&&null===this.filteredCategorySections())+("sectionView"==this.viewType()&&null===this.filteredSectionArticles())+("viewAllArticles"==this.viewType()&&null===this.articles())+("articleView"==this.viewType()&&null===this.fullArticleData())+("helpView"==this.viewType()&&null===this.filteredSectionArticles())},this)}var Activity=require("../components/Activity"),onboarding=require("../data/onboarding"),help=require("../data/help"),A=Activity.extend(function HelpActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=null;this.navBar=Activity.createSubsectionNavBar("Back");this.title("We're here to help");this.currentLabels="";this.loadArticles=function(){if(!this.viewModel.articles().length||!this.viewModel.sections().length){this.viewModel.isLoading(!0);Promise.all([help.getArticles(),help.getCategories(),help.getSections()]).then(function(res){this.viewModel.articles(res[0]);this.viewModel.categories(res[1]);this.viewModel.sections(res[2]);this.viewModel.isLoading(!1)}.bind(this)).catch(function(){this.viewModel.isLoading(!1)}.bind(this))}}.bind(this);this.subSectionFunction={categories:function(tailId){this.viewModel.selectedCategoryId(parseInt(tailId,10));this.viewModel.viewType("categoryView")}.bind(this),sections:function(tailId){this.viewModel.selectedSectionId(parseInt(tailId,10));this.viewModel.viewType("sectionView")}.bind(this),articles:function(tailId){this.viewModel.selectedArticleId(parseInt(tailId,10));this.viewModel.viewType("articleView")}.bind(this),relatedArticles:function(tailId){this.viewModel.selectedSectionId(parseInt(tailId,10));this.viewModel.viewType("helpView")}.bind(this)};this.renderSubSection=function(subSectionPath,tail){var tailId=tail.split("-")[0];if(""===tailId){"categories"===subSectionPath&&this.viewModel.viewType("viewAllCategories");"sections"===subSectionPath&&this.viewModel.viewType("viewAllSections");"articles"===subSectionPath&&this.viewModel.viewType("articleView");"relatedArticles"===subSectionPath?this.viewModel.viewType("helpView"):this.viewModel.viewType("viewAllArticles")}else this.subSectionFunction[subSectionPath](tailId)}});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.loadArticles();var params=state&&state.route&&state.route.segments,subSections=["articles","sections","categories","relatedArticles"];this.viewModel.viewType("");if(params){var subSectionPath=params[0]||"",tail=params[1]||"";subSections.indexOf(subSectionPath)>-1?this.renderSubSection(subSectionPath,tail):""===subSectionPath?this.viewModel.viewType("viewAllCategories"):this.viewModel.viewType("404")}};var ko=require("knockout")},{"../components/Activity":255,"../data/help":275,"../data/onboarding":291,knockout:15}],204:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=onboarding.inProgress;this.user=user;this.helpLinkProfessionals="/help/relatedArticles/201960863-providing-feedback-to-us";this.helpLinkClients="/help/relatedArticles/202894686-providing-feedback-to-us";this.helpLink=ko.pureComputed(function(){return this.user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);this.message=ko.observable("");this.becomeCollaborator=ko.observable(!1);this.isCollaborator=user.isCollaborator;this.isSending=ko.observable(!1);this.vocElementID=ko.observable(0);this.emailSubject=ko.observable("");this.submitText=ko.pureComputed(function(){return this.isSending()?"Sending..":"Send"},this);this.isValid=ko.pureComputed(function(){var m=this.message();return m&&!/^\s*$/.test(m)},this);this.anonymousButtonUrl=ko.pureComputed(function(){return user.isAnonymous()?"mailto:support@loconomics.com?subject="+encodeURIComponent("Feedback")+"&body="+encodeURIComponent(this.message()):""},this);this.send=function send(){if(this.isValid()&&!user.isAnonymous()){this.isSending(!0);feedback.postIdea({message:this.message(),becomeCollaborator:this.becomeCollaborator(),vocElementID:this.vocElementID()}).then(function(){if(!this.isCollaborator()&&this.becomeCollaborator()){this.isCollaborator(!0);userProfile.save()}app.successSave({message:"Sent! Thank you for your input."});this.message("");this.becomeCollaborator(!1)}.bind(this)).catch(function(err){showError({title:"There was an error sending your feedback",error:err})}).then(function(){this.isSending(!1)}.bind(this))}}.bind(this)}var Activity=require("../components/Activity"),VocElementEnum=require("../models/VocElementEnum"),userProfile=require("../data/userProfile"),user=userProfile.data,onboarding=require("../data/onboarding"),feedback=require("../data/feedback"),showError=require("../modals/error").show,A=Activity.extend(function FeedbackFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=null;var serviceProfessionalNavBar=Activity.createSubsectionNavBar("Back",{helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar("Back",{helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar;this.title("Send us feedback")});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.updateNavBarState();var elementName=(this.requestData.route.segments||[])[0]||"",elementID=0|VocElementEnum[elementName];this.viewModel.message(this.requestData.route.query.body||this.requestData.route.query.message||"");elementName?VocElementEnum.hasOwnProperty(elementName)||console.error("Feedback Ideas: given a bad VOC Element name:",elementName):console.log("Feedback Ideas: Accessing feedback without specify an element, using General (0)");this.viewModel.vocElementID(elementID)};var ko=require("knockout")},{"../components/Activity":255,"../data/feedback":273,"../data/onboarding":291,"../data/userProfile":309,"../modals/error":343,"../models/VocElementEnum":428,knockout:15}],203:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201960833-adding-education-to-your-profile";this.educationID=ko.observable(0);this.isLoading=education.state.isLoading;this.isSaving=education.state.isSaving;this.isSyncing=education.state.isSyncing;this.isDeleting=education.state.isDeleting;this.isLocked=ko.computed(function(){return this.isDeleting()||education.state.isLocked()},this);this.version=ko.observable(null);this.item=ko.pureComputed(function(){var v=this.version();return v?v.version:null},this);this.isNew=ko.pureComputed(function(){var p=this.item();return p&&!p.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.version();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.version();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){education.setItem(this.item().model.toPlainObject()).then(function(serverData){this.item().model.updateWith(serverData);this.version().push({evenIfObsolete:!0});app.successSave()}.bind(this)).catch(function(err){showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){showConfirm({title:"Delete",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){education.delItem(this.educationID()).then(function(){app.successSave()}.bind(this)).catch(function(err){showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.yearsOptions=ko.computed(function(){for(var l=[],i=(new Date).getFullYear();i>1900;i--)l.push(i);return l})}var Activity=require("../components/Activity"),ko=require("knockout"),education=require("../data/education"),showConfirm=require("../modals/confirm").show,showError=require("../modals/error").show,A=Activity.extend(function EducationFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Education",{backLink:"/education",helpLink:this.viewModel.helpLink});this.title=ko.pureComputed(function(){return this.educationID()>0?"Edit training/education":"Add training or education"},this.viewModel)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/education/";this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.version(null);var params=state&&state.route&&state.route.segments||[];this.viewModel.educationID(0|params[0]);this.updateNavBarState();0===this.viewModel.educationID()?this.viewModel.version(education.newItem()):education.createItemVersion(this.viewModel.educationID()).then(function(educationVersion){if(!educationVersion)throw new Error("No data");this.viewModel.version(educationVersion)}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this))}},{"../components/Activity":255,"../data/education":272,"../modals/confirm":342,"../modals/error":343,knockout:15}],202:[function(require,module,exports){"use strict";function ViewModel(){this.helpLink="/help/relatedArticles/201960833-adding-education-to-your-profile";this.isLoading=education.state.isLoading;this.isSyncing=education.state.isSyncing;this.list=education.list}var Activity=require("../components/Activity"),education=require("../data/education"),showError=require("../modals/error").show,A=Activity.extend(function EducationActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Profile",{backLink:"/userProfile",helpLink:this.viewModel.helpLink});this.title("Education");this.viewModel.navBar=this.navBar});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);education.sync().catch(function(err){showError({title:"Error loading education information",error:err})}.bind(this))}},{"../components/Activity":255,"../data/education":272,"../modals/error":343}],272:[function(require,module,exports){"use strict";var UserEducation=require("../models/UserEducation"),ListRemoteModel=require("./helpers/ListRemoteModel"),session=require("./session"),remote=require("./drivers/restClient"),api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"educationID",Model:UserEducation});module.exports=api;api.addLocalforageSupport("education");api.addRestSupport(remote,"me/education");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/UserEducation":420,"./drivers/restClient":271,"./helpers/ListRemoteModel":282,"./session":303}],201:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function DownloadAppActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar("Download the App");this.navBar.rightAction(null);this.title("Download our app")});exports.init=A.init},{"../components/Activity":255}],200:[function(require,module,exports){"use strict";function ViewModel(){this.headerText=ko.observable("Select a time");this.component=ko.observable(null)}var ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime"),Activity=require("../components/Activity"),user=require("../data/userProfile").data,A=Activity.extend(function DatetimePickerActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel;this.navBar=Activity.createSubsectionNavBar("");this.viewModel.navBar=this.navBar;this.title("Chosse an appointment time");this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject();ko.computed(function(){var datetime=this.viewModel.component()&&this.viewModel.component().selectedDatetime();if(datetime){this.requestData.selectedDatetime=datetime;this.requestData.allowBookUnavailableTime=this.viewModel.component().allowBookUnavailableTime();this.app.shell.goBack(this.requestData)}},this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var header=this.requestData.headerText;this.viewModel.headerText(header||"Select date and time");if(this.requestData.title)this.navBar.title(this.requestData.title);else{this.navBar.title("");this.navBar.leftAction().text(this.requestData.navTitle||"")}if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction);this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle);this.navBar.leftAction().handler(this.returnRequest)}};A.prototype.show=function show(state){this.viewModel.component()&&this.viewModel.component().reset();Activity.prototype.show.call(this,state);this.viewModel.component().requiredDurationMinutes(0|this.requestData.requiredDuration||15);this.viewModel.component().includeEndTime(!!this.requestData.includeEndTime);this.viewModel.component().userID(user.userID());var selDate=getDateWithoutTime(this.requestData.selectedDatetime);this.viewModel.component().selectedDate(selDate);this.updateNavBarState()}},{"../components/Activity":255,"../data/userProfile":309,"../utils/getDateWithoutTime":454,knockout:15}],199:[function(require,module,exports){"use strict";function ViewModel(){this.upcomingBookings=new UpcomingBookingsSummary;this.upcomingBookings.isLoading=ko.observable(!1);this.upcomingBookings.isSyncing=ko.observable(!1);this.upcomingAppointments=new UpcomingAppointmentsSummary;this.upcomingAppointments.isLoading=ko.observable(!1);this.upcomingAppointments.isSyncing=ko.observable(!1);this.nextAppointmentServiceProfessionalInfo=ko.observable(null);this.nextBooking=ko.observable(null);this.inbox=new MailFolder({topNumber:4});this.inbox.isLoading=ko.observable(!1);this.inbox.isSyncing=ko.observable(!1);this.performance=new PerformanceSummary;this.getMore=new GetMore;this.user=user;this.getMapUrlFor=function(address){var lat=ko.unwrap(address.latitude),lng=ko.unwrap(address.longitude),place=address.singleLine?address.singleLine():"";return"https://www.google.com/maps/?q="+encodeURIComponent(lat)+","+encodeURIComponent(lng)+"&near="+encodeURIComponent(place)+"&z=16"};this.getUrlTo=function(name){return ko.pureComputed(function(){return"/"+name+"/"+this.upcomingAppointments.nextBooking.bookingID+"?mustReturn=/dashboard/&returnText= Dashboard"},this)}}function setSomeTestingData(viewModel){var moreData={};moreData=viewModel.user.isServiceProfessional()?{availability:!1,payments:!1,profile:!1,coop:!1}:{availability:!1,payments:!1,profile:!1,coop:!0};viewModel.getMore.model.updateWith(moreData)}var ko=require("knockout"),Activity=require("../components/Activity"),AppointmentView=require("../viewmodels/AppointmentView"),Appointment=require("../models/Appointment"),UserJobTitle=require("../models/UserJobTitle"),PublicUser=require("../models/PublicUser"),user=require("../data/userProfile").data,bookings=require("../data/bookings"),users=require("../data/users"),messaging=require("../data/messaging"),userJobProfile=require("../data/userJobProfile"),showError=require("../modals/error").show,A=Activity.extend(function DashboardActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel;this.navBar=Activity.createSectionNavBar(null);this.title("Your Dashboard");this.prepareShowErrorFor=function prepareShowErrorFor(title){return function(err){showError({title:title,error:err})}}.bind(this);this.getUserData=function(userID,jobTitleID){return users.getUser(userID).then(function(info){info.selectedJobTitleID=jobTitleID;return new PublicUser(info)}.bind(this))};setSomeTestingData(this.viewModel)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);user.isServiceProfessional()&&this.syncUpcomingBookings();user.isClient()&&this.syncUpcomingAppointments();this.syncMessages();this.syncGetMore()};A.prototype.syncMessages=function syncMessages(){var v=this.viewModel,app=this.app,MessageView=require("../models/MessageView");v.inbox.messages().length?v.inbox.isSyncing(!0):v.inbox.isLoading(!0);messaging.getList().then(function(threads){v.inbox.messages(threads().map(MessageView.fromThread.bind(null,app)))}).catch(this.prepareShowErrorFor("Error loading latest messages")).then(function(){v.inbox.isLoading(!1);v.inbox.isSyncing(!1)})};A.prototype.syncUpcomingBookings=function syncUpcomingBookings(){var v=this.viewModel;v.upcomingBookings.items().length?v.upcomingBookings.isSyncing(!0):v.upcomingBookings.isLoading(!0);bookings.getUpcomingBookings().then(function(upcoming){v.upcomingBookings.model.updateWith(upcoming,!0);var b=v.upcomingBookings.nextBooking();b?v.nextBooking(new AppointmentView(Appointment.fromBooking(b))):v.nextBooking(null)}.bind(this)).catch(this.prepareShowErrorFor("Error loading upcoming bookings")).then(function(){v.upcomingBookings.isLoading(!1);v.upcomingBookings.isSyncing(!1)})};A.prototype.syncUpcomingAppointments=function syncUpcomingAppointments(){var v=this.viewModel;v.upcomingAppointments.items().length?v.upcomingAppointments.isSyncing(!0):v.upcomingAppointments.isLoading(!0);bookings.getUpcomingAppointments().then(function(upcoming){v.upcomingAppointments.model.updateWith(upcoming,!0);return upcoming.nextBooking?this.getUserData(upcoming.nextBooking.serviceProfessionalUserID,upcoming.nextBooking.jobTitleID):null}.bind(this)).then(function(user){v.nextAppointmentServiceProfessionalInfo(user)}).catch(this.prepareShowErrorFor("Error loading upcoming appointments")).then(function(){v.upcomingAppointments.isLoading(!1);v.upcomingAppointments.isSyncing(!1)})};A.prototype.syncGetMore=function syncGetMore(){user.isServiceProfessional()&&userJobProfile.syncList().then(function(list){var yep=list.some(function(job){if(job.statusID()!==UserJobTitle.status.on)return!0});this.viewModel.getMore.profile(!!yep)}.bind(this))};var UpcomingBookingsSummary=require("../models/UpcomingBookingsSummary"),MailFolder=require("../models/MailFolder"),PerformanceSummary=require("../models/PerformanceSummary"),GetMore=require("../models/GetMore"),UpcomingAppointmentsSummary=require("../models/UpcomingAppointmentsSummary")},{"../components/Activity":255,"../data/bookings":262,"../data/messaging":290,"../data/userJobProfile":306,"../data/userProfile":309,"../data/users":311,"../modals/error":343,"../models/Appointment":354,"../models/GetMore":366,"../models/MailFolder":382,"../models/MessageView":385,"../models/PerformanceSummary":391,"../models/PublicUser":398,"../models/UpcomingAppointmentsSummary":417,"../models/UpcomingBookingsSummary":418,"../models/UserJobTitle":422,"../viewmodels/AppointmentView":486,knockout:15}],418:[function(require,module,exports){"use strict";function UpcomingBookingsSummary(values){Model(this);this.model.defProperties({today:new BookingSummary({concept:"left today",timeFormat:" [ending @] h:mma"}),tomorrow:new BookingSummary({concept:"tomorrow",timeFormat:" [starting @] h:mma"}),thisWeek:new BookingSummary({concept:"this week",timeFormat:null}),nextWeek:new BookingSummary({concept:"next week",timeFormat:null}),nextBooking:{Model:Booking}},values);this.items=ko.pureComputed(function(){var items=[];this.today().quantity()&&items.push(this.today());this.tomorrow().quantity()&&items.push(this.tomorrow);this.thisWeek().quantity()&&items.push(this.thisWeek());this.nextWeek().quantity()&&items.push(this.nextWeek());return items},this)}var ko=require("knockout"),Model=require("./Model"),BookingSummary=require("./BookingSummary"),Booking=require("./Booking");module.exports=UpcomingBookingsSummary},{"./Booking":356,"./BookingSummary":357,"./Model":386,knockout:15}],417:[function(require,module,exports){"use strict";function UpcomingAppointmentsSummary(values){Model(this);this.model.defProperties({pendingRequests:new BookingSummary({concept:"pending appointment requests",timeFormat:null}),nextOnes:new BookingSummary({concept:"more appointments coming up",timeFormat:" [Next is] MMMM Do [@] h:mma"}),pendingScheduling:new BookingSummary({concept:"to be scheduled",timeFormat:null}),nextBooking:{Model:Booking}},values);this.items=ko.pureComputed(function(){var items=[];this.pendingRequests().quantity()&&items.push(this.pendingRequests());this.nextOnes().quantity()&&items.push(this.nextOnes());this.pendingScheduling().quantity()&&items.push(this.pendingScheduling());return items},this);this.currentAppointment=ko.pureComputed(function(){var b=this.nextBooking();if(b){var today=(new Date).toISOString().substr(0,10),bookday=b.serviceDate()&&b.serviceDate().startTime()||"";if((bookday=("string"==typeof bookday?bookday:bookday.toISOString()).substr(0,10))===today)return b}return null},this)}var ko=require("knockout"),Model=require("./Model"),BookingSummary=require("./BookingSummary"),Booking=require("./Booking");module.exports=UpcomingAppointmentsSummary},{"./Booking":356,"./BookingSummary":357,"./Model":386,knockout:15}],357:[function(require,module,exports){"use strict";function BookingSummary(values){Model(this);this.model.defProperties({quantity:0,concept:"",time:{isDate:!0},timeFormat:" [@] h:mma"},values);this.timePhrase=ko.pureComputed(function(){return this.timeFormat()&&this.time()&&moment(this.time()).format(this.timeFormat())||""},this);this.phrase=ko.pureComputed(function(){return this.concept()+this.timePhrase()},this);this.url=ko.pureComputed(function(){return this.time()&&"/calendar/"+this.time().toISOString()},this)}var ko=require("knockout"),Model=require("./Model"),moment=require("moment");module.exports=BookingSummary},{"./Model":386,knockout:15,moment:145}],391:[function(require,module,exports){"use strict";function PerformanceSummary(values){Model(this);values=values||{};this.earnings=new Earnings(values.earnings);var earningsLine=new ListViewItem;earningsLine.markerLine1=ko.computed(function(){return numeral(this.currentAmount()).format("$0,0")},this.earnings);earningsLine.contentLine1=ko.computed(function(){return this.currentConcept()},this.earnings);earningsLine.markerLine2=ko.computed(function(){return numeral(this.nextAmount()).format("$0,0")},this.earnings);earningsLine.contentLine2=ko.computed(function(){return this.nextConcept()},this.earnings);this.timeBooked=new TimeBooked(values.timeBooked);var timeBookedLine=new ListViewItem;timeBookedLine.markerLine1=ko.computed(function(){return numeral(this.percent()).format("0%")},this.timeBooked);timeBookedLine.contentLine1=ko.computed(function(){return this.concept()},this.timeBooked);this.items=ko.pureComputed(function(){var items=[];items.push(earningsLine);items.push(timeBookedLine);return items},this)}function Earnings(values){Model(this);this.model.defProperties({currentAmount:0,currentConceptTemplate:"already paid this month",nextAmount:0,nextConceptTemplate:"projected {month} earnings"},values);this.currentConcept=ko.pureComputed(function(){var month=moment().format("MMMM");return this.currentConceptTemplate().replace(/\{month\}/,month)},this);this.nextConcept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.nextConceptTemplate().replace(/\{month\}/,month)},this)}function TimeBooked(values){Model(this);this.model.defProperties({percent:0,conceptTemplate:"of available time booked in {month}"},values);this.concept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.conceptTemplate().replace(/\{month\}/,month)},this)}var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem"),moment=require("moment"),numeral=require("numeral");module.exports=PerformanceSummary},{"./ListViewItem":381,"./Model":386,knockout:15,moment:145,numeral:146}],385:[function(require,module,exports){"use strict";function MessageView(values,app){Model(this);this.model.defProperties({id:0,createdDate:null,updatedDate:null,subject:"",content:null,link:"#",tag:"",classNames:"",sourceThread:null,sourceMessage:null},values);this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this);this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this);this.quickDateTime=ko.pureComputed(function(){var date=this.createdDate(),m=moment(date).locale("en-US-LC"),t=moment().startOf("day");return m.isAfter(t)?m.format("LT"):m.fromNow()},this);var getUserData=function(userID){if(userID){if(userID===user.userID())return user;var publicUser=new PublicUserProfile;users.getProfile(userID).then(function(d){publicUser.model.updateWith(d,!0)});return publicUser}return new PublicUserProfile({firstName:"Loconomics",lastName:"Cooperative Inc."})};this.client=ko.pureComputed(function(){var t=this.sourceThread();return t&&app?getUserData(t.clientUserID()):null},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.serviceProfessional=ko.pureComputed(function(){var t=this.sourceThread();return t&&app?getUserData(t.serviceProfessionalUserID()):null},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.sender=ko.pureComputed(function(){var m=this.sourceMessage();return m&&app?getUserData(m.sentByUserID()):null},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}var ko=require("knockout"),Model=require("./Model"),moment=require("moment"),PublicUserProfile=require("./PublicUserProfile"),user=require("../data/userProfile").data,users=require("../data/users");module.exports=MessageView;MessageView.fromThread=function(app,thread){var msg=thread.messages(),tag,classNames;if(msg=msg&&msg[0]||null){if("Booking"===msg.auxT()){tag="Booking";classNames="text-success"}}else console.error("Thread is empty",thread);return new MessageView({sourceThread:thread,sourceMessage:msg,id:thread.threadID(),createdDate:thread.createdDate(),updatedDate:thread.updatedDate(),subject:thread.subject(),content:msg&&msg.bodyText()||"",link:"#!/conversation/"+thread.threadID(),tag:tag,classNames:classNames},app)}},{"../data/userProfile":309,"../data/users":311,"./Model":386,"./PublicUserProfile":402,knockout:15,moment:145}],382:[function(require,module,exports){"use strict";function MailFolder(values){Model(this);this.model.defProperties({messages:[],topNumber:10},values);this.top=ko.pureComputed(function top(num){num&&this.topNumber(num);var t=this.topNumber()-1,ret=[];this.messages().some(function(e,i){if(i>=t)return!0;ret.push(e)});return ret},this)}var ko=require("knockout"),Model=require("./Model");module.exports=MailFolder},{"./Model":386,knockout:15}],366:[function(require,module,exports){"use strict";function GetMore(values){Model(this);this.model.defProperties({availability:!1,payments:!1,profile:!1,coop:!0},values);var availableItems={availability:new ListViewItem({contentLine1:"Complete your availability to create a cleaner calendar",markerIcon:"fa fa-fw fa-calendar"}),payments:new ListViewItem({contentLine1:"Start accepting payments through Loconomics",markerIcon:"fa ion ion-card"}),profile:new ListViewItem({contentLine1:"Activate your profile in the marketplace",markerIcon:"fa ion ion-cash",link:"/marketplaceProfile"}),coop:new ListViewItem({contentLine1:"Learn more about our cooperative",markerIcon:"fa fa-gavel"})};this.items=ko.pureComputed(function(){var items=[];Object.keys(availableItems).forEach(function(key){this[key]()&&items.push(availableItems[key])}.bind(this));return items},this)}var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem");module.exports=GetMore},{"./ListViewItem":381,"./Model":386,knockout:15}],381:[function(require,module,exports){"use strict";function ListViewItem(values){Model(this);this.model.defProperties({markerLine1:null,markerLine2:null,markerIcon:null,contentLine1:"",contentLine2:null,link:"#",actionIcon:null,actionText:null,classNames:""},values)}var Model=require("./Model");module.exports=ListViewItem},{"./Model":386}],198:[function(require,module,exports){"use strict";function ViewModel(){this.user=user;this.helpLinkProfessionals="/help/relatedArticles/201966986-sending-and-receiving-messages";this.helpLinkClients="/help/relatedArticles/201966996-sending-and-receiving-messages";this.helpLink=ko.pureComputed(function(){return user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);this.isLoading=messaging.state.isLoading;this.isSyncing=messaging.state.isSyncing;this.isSaving=messaging.state.isSaving;this.threadID=ko.observable(null);this.thread=messaging.createWildcardItem();this.subject=ko.pureComputed(function(){var m=this.thread();return this.isLoading()?"Loading...":m&&(m.subject()||"").replace(/^\s+|\s+$/g,"")||"Conversation without subject"},this);this.bookingID=ko.pureComputed(function(){var msg=this.thread()&&this.thread().messages()[0];return msg&&"booking"===(msg.auxT()||"").toLowerCase()&&msg.auxID()?msg.auxID():null},this);this.linkToBooking=ko.pureComputed(function(){return"#!/viewBooking/"+this.bookingID()},this)}var Activity=require("../components/Activity"),user=require("../data/userProfile").data,onboarding=require("../data/onboarding"),messaging=require("../data/messaging"),showError=require("../modals/error").show,A=Activity.extend(function ConversationActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;var serviceProfessionalNavBar=Activity.createSubsectionNavBar("Inbox",{backLink:"/inbox",helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar("Inbox",{backLink:"/inbox",helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar;this.title("Conversation history")});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!onboarding.updateNavBar(this.navBar)){var nav=user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.threadID(0);this.viewModel.thread(null);this.updateNavBarState();var threadID=0|(state&&state.route&&state.route.segments||[])[0];this.viewModel.threadID(threadID);threadID?this.viewModel.thread.sync(threadID).catch(function(err){showError({title:"Error loading conversation",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this)):showError({title:"Conversation Not Found"}).then(function(){this.app.shell.goBack()}.bind(this))};var ko=require("knockout")},{"../components/Activity":255,"../data/messaging":290,"../data/onboarding":291,"../data/userProfile":309,"../modals/error":343,knockout:15}],290:[function(require,module,exports){"use strict";var Thread=require("../models/Thread"),CacheControl=require("./helpers/CacheControl"),ListRemoteModel=require("./helpers/ListRemoteModel"),session=require("./session"),remote=require("./drivers/restClient"),api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"threadID",Model:Thread});module.exports=api;api.addLocalforageSupport("messaging");api.addRestSupport(remote,"me/messaging");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()});var fullThreadsCache={},fetchThreadRemote=function(threadID){return remote.get("me/messaging/"+threadID,{limit:1e3}).then(function(thread){if(thread){thread=new Thread(thread);var cached=fullThreadsCache[threadID];if(cached){cached.control.latest=new Date;cached.thread=thread}else{fullThreadsCache[threadID]={control:new CacheControl({ttl:{minutes:1}}),thread:thread};fullThreadsCache[threadID].control.latest=new Date}return thread}throw new Error("Not Found")})},markAsEndedAndFollowUp=function(any){api.state.isSyncing(!1);api.state.isLoading(!1);return any};api.getItem=function getItem(threadID){var cached=fullThreadsCache[threadID];if(cached&&cached.thread){if(cached.control.mustRevalidate()){api.state.isSyncing(!0);return fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)}return Promise.resolve(cached.thread)}api.state.isLoading(!0);return fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)}},{"../models/Thread":415,"./drivers/restClient":271,"./helpers/CacheControl":276,"./helpers/ListRemoteModel":282,"./session":303}],415:[function(require,module,exports){"use strict";function Thread(values){Model(this);this.model.defProperties({threadID:0,clientUserID:null,serviceProfessionalUserID:null,jobTitleID:null,statusID:null,subject:null,messages:{isArray:!0,Model:Message},createdDate:null,updatedDate:null},values)}var Model=require("./Model"),Message=require("./Message");module.exports=Thread},{"./Message":384,"./Model":386}],384:[function(require,module,exports){"use strict";function Message(values){Model(this);this.model.defProperties({messageID:0,threadID:0,sentByUserID:null,typeID:null,auxT:null,auxID:null,bodyText:"",createdDate:null,updatedDate:null},values);this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this);this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this)}var ko=require("knockout"),Model=require("./Model"),moment=require("moment");module.exports=Message},{"./Model":386,knockout:15,moment:145}],197:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=onboarding.inProgress;this.message=ko.observable("");this.isSending=ko.observable(!1);this.vocElementID=ko.observable(0);this.emailSubject=ko.observable("");this.submitText=ko.pureComputed(function(){return this.isSending()?"Sending..":"Send"},this);this.isValid=ko.pureComputed(function(){var m=this.message();return m&&!/^\s*$/.test(m)},this);this.anonymousButtonUrl=ko.pureComputed(function(){return user.isAnonymous()?"mailto:support@loconomics.com?subject="+encodeURIComponent(this.emailSubject()||"I need help!")+"&body="+encodeURIComponent(this.message()):""},this);this.send=function send(){if(this.isValid()&&!user.isAnonymous()){this.isSending(!0);var msg=this.message();this.emailSubject()&&(msg=this.emailSubject()+": "+msg);feedback.postSupport({message:msg,vocElementID:this.vocElementID()}).then(function(){app.successSave({message:"Thank you, we'll be in touch soon!"});this.message("")}.bind(this)).catch(function(err){showError({title:"There was an error sending your feedback",error:err})}).then(function(){this.isSending(!1)}.bind(this))}}.bind(this)}var Activity=require("../components/Activity"),VocElementEnum=require("../models/VocElementEnum"),onboarding=require("../data/onboarding"),feedback=require("../data/feedback"),showError=require("../modals/error").show,A=Activity.extend(function ContactFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=null;this.navBar=Activity.createSubsectionNavBar("Back");this.navBar.rightAction(null);this.title("Contact us")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var elementName=(this.requestData.route.segments||[])[0]||"",elementID=0|VocElementEnum[elementName];this.viewModel.emailSubject(this.requestData.route.query.subject||"");this.viewModel.message(this.requestData.route.query.body||this.requestData.route.query.message||"");elementName?VocElementEnum.hasOwnProperty(elementName)||console.error("Feedback Support: given a bad VOC Element name:",elementName):console.log("Feedback Support: Accessing without specify an element, using General (0)");this.viewModel.vocElementID(elementID)};var ko=require("knockout"),user=require("../data/userProfile").data},{"../components/Activity":255,"../data/feedback":273,"../data/onboarding":291,"../data/userProfile":309,"../modals/error":343,"../models/VocElementEnum":428,knockout:15}],428:[function(require,module,exports){"use strict";module.exports={general:0,nps:1,signup:2,calendar:3,inbox:4,scheduling:5,cms:6,payments:7,performance:8,marketplaceProfile:9,mobileFriendly:10,desktopFriendly:11,coopBenefits:12,coopFee:13,senseOfCommunity:14,clientServiceAgents:15,helpPages:16,boardNomination:17,dashboard:18,booking:19,welcome:20}},{}],273:[function(require,module,exports){"use strict";var remote=require("./drivers/restClient"),getUserDeviceInfo=function getUserDeviceInfo(){var dev=window.device||{platform:"web",model:"unknow",cordova:"",version:""};return{userAgent:navigator.userAgent,platform:dev.platform,version:dev.version,model:dev.model,cordova:dev.cordova}};exports.postIdea=function postIdea(values){values.userDevice=JSON.stringify(getUserDeviceInfo());return remote.post("feedback/ideas",values)};exports.postSupport=function postSupport(values){values.userDevice=JSON.stringify(getUserDeviceInfo());return remote.post("feedback/support",values)}},{"./drivers/restClient":271}],196:[function(require,module,exports){"use strict";function ViewModel(){this.clients=clients.list;this.clientsCount=ko.pureComputed(function(){var cs=this.clients();return cs<=0?"0 clients":1===cs?"1 client":numeral(0|cs.length).format("0,0")+" clients"},this)}var Activity=require("../components/Activity"),ko=require("knockout"),clients=require("../data/clients"),showError=require("../modals/error").show,A=Activity.extend(function CmsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar(null);this.title("Client manager")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);clients.sync().catch(function(err){showError({title:"Error loading the clients list",error:err})})};var numeral=require("numeral")},{"../components/Activity":255,"../data/clients":269,"../modals/error":343,knockout:15,numeral:146}],195:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201966046-adding-new-clients";this.headerText=ko.observable("");this.isSelectionMode=ko.observable(!1);this.clients=clients.list;this.isLoading=clients.state.isLoading;this.isSyncing=clients.state.isSyncing;this.searchText=ko.observable("");this.getFilteredList=function getFilteredList(){var s=(this.searchText()||"").toLowerCase();return this.clients().filter(function(client){if(!client)return!1;if(client.deleted())return!1;var found=textSearch(s,client.fullName());return!!found||(!!(found=textSearch(s,client.email()))||(found=textSearch(s,client.phone())))})};this.filteredClients=ko.computed(function(){return this.getFilteredList()},this);this.groupedClients=ko.computed(function(){var groups=[],latestGroup=null,latestLetter=null;this.filteredClients().sort(function(clientA,clientB){var a=clientA.firstName().toLowerCase(),b=clientB.firstName().toLowerCase();return a===b?0:a>b?1:-1}).forEach(function(client){var letter=(client.firstName()[0]||"").toUpperCase();if(letter!==latestLetter){latestGroup={letter:letter,clients:[client]};groups.push(latestGroup);latestLetter=letter}else latestGroup.clients.push(client)});return groups},this);this.publicSearchResults=ko.observableArray([]);this.publicSearchRunning=ko.observable(null);ko.computed(function(){var filtered=this.filteredClients(),searchText=this.searchText(),request=null;if(0===filtered.length&&searchText){this.publicSearchResults([]);request=clients.publicSearch({fullName:searchText,email:searchText,phone:searchText});this.publicSearchRunning(request);request.then(function(r){this.publicSearchResults(r)}.bind(this)).catch(function(err){showError({title:"There was an error when on remote clients search",error:err})}).then(function(){this.publicSearchRunning()===request&&this.publicSearchRunning(null)}.bind(this))}else{this.publicSearchResults([]);if((request=this.publicSearchRunning())&&request.xhr&&request.xhr.abort){request.xhr.abort();this.publicSearchRunning(null)}}},this).extend({rateLimit:{timeout:400,method:"notifyWhenChangesStop"}});this.addRemoteClient=function(client,event){var data=client.model&&client.model.toPlainObject()||client,request=$.extend({},this.requestData,{presetData:data,returnNewAsSelected:this.isSelectionMode()});app.shell.go("clientEditor",request);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.addNew=function(data,event){event.preventDefault();event.stopImmediatePropagation();var request=$.extend({},this.requestData,{newForSearchText:this.searchText(),returnNewAsSelected:this.isSelectionMode()});app.shell.go("clientEditor",request)}.bind(this);this.selectedClient=ko.observable(null);this.selectClient=function(selectedClient,event){event.preventDefault();event.stopImmediatePropagation();this.selectedClient(selectedClient)}.bind(this)}var $=require("jquery"),ko=require("knockout"),Activity=require("../components/Activity"),textSearch=require("../utils/textSearch"),clients=require("../data/clients"),showError=require("../modals/error").show,A=Activity.extend(function ClientsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Clients",{backLink:"cms",helpLink:this.viewModel.helpLink});this.title("Your clients");this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject();this.$index=this.$activity.find("#clientsIndex");this.$listView=this.$activity.find("#clientsListView");this.registerHandler({target:this.viewModel.selectedClient,handler:function(theSelectedClient){if(this.requestData&&!0===this.requestData.selectClient&&theSelectedClient){this.requestData.selectedClientID=theSelectedClient.clientUserID();this.app.shell.goBack(this.requestData);this.requestData=null}}.bind(this)});this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var itIs=this.viewModel.isSelectionMode();this.viewModel.headerText(itIs?"Select a client":"My clients");this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title("");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction);this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):itIs||this.navBar.leftAction().handler(null)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.viewModel.selectedClient(null);this.viewModel.requestData=this.requestData;if(!0===state.returnNewAsSelected&&state.clientID)setTimeout(function(){delete state.returnNewAsSelected;this.requestData.selectedClientID=state.clientID;this.app.shell.goBack(this.requestData)}.bind(this),1);else{this.viewModel.isSelectionMode(!0===state.selectClient);this.updateNavBarState();clients.sync().catch(function(err){showError({title:"Error loading the clients list",error:err})})}}},{"../components/Activity":255,"../data/clients":269,"../modals/error":343,"../utils/textSearch":480,jquery:14,knockout:15}],480:[function(require,module,exports){"use strict";var removeAccent=require("./removeAccent");module.exports=function textSearch(search,text){var s=removeAccent(search||"").toLowerCase();return removeAccent(text||"").toLowerCase().indexOf(s)>-1}},{"./removeAccent":467}],467:[function(require,module,exports){"use strict";var map={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","ß":"s","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","ĝ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ħ":"H","ħ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Œ":"OE","œ":"oe","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ǻ":"A","ǻ":"a","Ǽ":"AE","ǽ":"ae","Ǿ":"O","ǿ":"o"};module.exports=function removeAccent(str){for(var res="",c,i=0,l=str.length;i<l;i++){c=str.charAt(i);res+=map[c]||c}return res}},{}],194:[function(require,module,exports){"use strict";function seemsAPhoneNumber(str){return/\d{3,}/.test(str||"")}function clientDataFromSearchText(txt,client){if(is.email(txt))client.email(txt);else if(seemsAPhoneNumber(txt))client.phone(txt);else{var nameParts=txt.split(" ",2);client.firstName(nameParts[0]);nameParts.length>1&&client.lastName(nameParts[1])}}function ViewModel(app){this.helpLink="/help/relatedArticles/201152639-managing-clients";this.clientID=ko.observable(0);this.clientVersion=ko.observable(null);this.client=ko.pureComputed(function(){var v=this.clientVersion();return v?v.version:null},this);this.header=ko.observable("");this.isLoadingServices=ko.observable(!1);this.isLoading=ko.pureComputed(function(){return clients.state.isLoading()||this.isLoadingServices()},this);this.isSyncing=clients.state.isSyncing;this.isSaving=clients.state.isSaving;this.isLocked=ko.pureComputed(function(){return clients.state.isLocked()||this.isDeleting()},this);this.isReadOnly=ko.pureComputed(function(){var c=this.client();return c&&!c.editable()},this);this.isDeleting=clients.state.isDeleting;this.wasRemoved=ko.observable(!1);this.isNew=ko.pureComputed(function(){var c=this.client();return!c||!c.updatedDate()},this);this.serviceSummaries=ko.observable([]);this.loadServices=function(clientID){var view=this;this.isLoadingServices(!0);Promise.all([serviceProfessionalServices.getClientSpecificServices(clientID),userJobProfile.getJobTitles(),pricingTypes.getList()]).then(function(models){var services=serviceProfessionalServices.asModel(models[0]),jobTitles=models[1],pricingTypes=models[2](),summaries=ServicesSummaryPresenter.summaries(jobTitles,services,pricingTypes).sort(ServicesSummaryPresenter.sortByJobTitle);view.serviceSummaries(summaries)}).catch(function(error){var messagePrefix="Unable to load special pricings",messageName=view.client()?" for "+view.client().firstName():"";showError({title:messagePrefix+messageName+".",error:error})}).then(function(){view.isLoadingServices(!1)})};this.submitText=ko.pureComputed(function(){var v=this.clientVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":this.isNew()?"Add client":v&&v.areDifferent()?"Save changes to client":"Client saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.clientVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting client...":"Delete client"},this);this.showServices=ko.pureComputed(function(){return!this.isNew()&&this.client()},this);this.save=function(){clients.setItem(this.client().model.toPlainObject()).then(function(serverData){this.client().model.updateWith(serverData);this.clientVersion().push({evenIfObsolete:!0});this.onSave(serverData.clientUserID)}.bind(this)).catch(function(err){showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){showConfirm({title:"Delete client",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){clients.delItem(this.clientID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this)).catch(function(err){showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.tapServiceSummary=function(serviceSummary,event){var url=new RouteParser("#!serviceProfessionalService/:jobTitleID/client/:clientID?mustReturn=#!clientEditor/:clientID").reverse({jobTitleID:serviceSummary.jobTitleID(),clientID:this.clientID()});app.shell.go(url);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.tapServiceSummaryNew=function(serviceSummary,event){var url=new RouteParser("#!serviceProfessionalService/:jobTitleID/client/:clientID/new").reverse({jobTitleID:serviceSummary.jobTitleID(),clientID:this.clientID()});app.shell.go(url,null);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]);this.selectedBirthMonth=ko.computed({read:function(){var c=this.client();if(c){var birthMonth=c.birthMonth();return birthMonth?this.months()[birthMonth-1]:null}return null},write:function(month){var c=this.client();c&&c.birthMonth(month&&month.id||null)},owner:this});this.monthDays=ko.observableArray([]);for(var iday=1;iday<=31;iday++)this.monthDays.push(iday);this.validEmail=ko.pureComputed(function(){var c=this.client();if(c){var e=c.email();return is.email(e)?e:""}return""},this);this.validPhone=ko.pureComputed(function(){var c=this.client();if(c){var e=c.phone();return seemsAPhoneNumber(e)?e:""}return""},this);var foundPublicUser=function foundPublicUser(user){var c=this.client();if(c&&c.clientUserID()!==user.clientUserID&&(c.email()===user.email||c.phone()===user.phone)){var msg="We`ve found an existing record for {0}. Would you like to add him to your clients?".replace(/\{0\}/g,user.firstName);showConfirm({title:"client found at loconomics.com",message:msg}).then(function(){var notes=c.notesAboutClient();c.model.updateWith(user);c.notesAboutClient(notes);this.clientID(user.clientUserID)}.bind(this)).catch(function(){})}}.bind(this);ko.computed(function(){var c=this.client();if(c){var email=c.email(),phone=c.phone();(email||phone)&&clients.publicSearch({email:email,phone:phone}).then(function(r){r&&r[0]&&foundPublicUser(r[0])}.bind(this)).catch(function(){})}},this).extend({rateLimit:{timeout:400,method:"notifyWhenChangesStop"}})}var Activity=require("../components/Activity"),is=require("is_js"),ServicesSummaryPresenter=require("../viewmodels/presenters/ServicesSummaryPresenter"),RouteParser=require("../utils/Router.js").RouteParser,clients=require("../data/clients"),serviceProfessionalServices=require("../data/serviceProfessionalServices"),userJobProfile=require("../data/userJobProfile"),pricingTypes=require("../data/pricingTypes"),ko=require("knockout"),showConfirm=require("../modals/confirm").show,showError=require("../modals/error").show,A=Activity.extend(function ClientEditionActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Clients",{backLink:"clients",helpLink:this.viewModel.helpLink});this.title=ko.pureComputed(function(){return this.header()},this.viewModel);this.registerHandler({target:this.viewModel.clientID,handler:function(clientID){if(clientID&&!(!0===this.requestData.returnNewAsSelected)){var found=/clientEditor\/(\-?\d+)/i.exec(window.location),urlID=found&&0|found[1];found&&urlID===clientID||this.app.shell.replaceState(null,null,"clientEditor/"+clientID)}}.bind(this)});this.registerHandler({target:this.viewModel.clientID,handler:function(clientID){this.viewModel.serviceSummaries([]);clientID&&this.viewModel.loadServices(clientID)}.bind(this)});this.viewModel.onSave=function(clientID){if(!0===this.requestData.returnNewAsSelected){this.requestData.clientID=clientID;this.app.shell.goBack(this.requestData)}else this.app.successSave()}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var referrerRoute=this.app.shell.referrerRoute,referrer=0===this.viewModel.clientID()?referrerRoute&&referrerRoute.url:null,link=this.requestData.cancelLink||referrer||"/clients";this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.clientID(0);var clientID=0|(state&&state.route&&state.route.segments||[])[0];if(clientID){this.viewModel.clientID(clientID);clients.createItemVersion(clientID).then(function(clientVersion){if(clientVersion){this.viewModel.clientVersion(clientVersion);this.viewModel.header("Edit client")}else{this.viewModel.clientVersion(null);this.viewModel.header("Deleted or unknown client")}}.bind(this)).catch(function(err){showError({title:"Error loading client data",error:err})})}else{var presetData=this.requestData.presetData||{};!1!==presetData.editable&&(presetData.editable=!0);this.viewModel.clientVersion(clients.newItem(presetData));this.viewModel.header("Add a client");this.requestData.newForSearchText&&clientDataFromSearchText(this.requestData.newForSearchText||"",this.viewModel.client())}this.updateNavBarState()}},{"../components/Activity":255,"../data/clients":269,"../data/pricingTypes":296,"../data/serviceProfessionalServices":302,"../data/userJobProfile":306,"../modals/confirm":342,"../modals/error":343,"../utils/Router.js":440,"../viewmodels/presenters/ServicesSummaryPresenter":514,is_js:13,knockout:15}],514:[function(require,module,exports){"use strict";var groupBy=require("../../utils/groupBy"),mapBy=require("../../utils/mapBy"),ServicesSummaryPresenter=function(jobTitle,services,pricingTypes){this._jobTitle=jobTitle;this._services=services;this._pricingTypesByID=mapBy(pricingTypes,function(p){return p.pricingTypeID()})};ServicesSummaryPresenter.prototype.hasServices=function(){return this._services.length>0};ServicesSummaryPresenter.prototype.jobTitle=function(){return this._jobTitle.singularName()};ServicesSummaryPresenter.prototype.jobTitleID=function(){return this._jobTitle.jobTitleID()};ServicesSummaryPresenter.prototype.summaryText=function(){return this.serviceTypeSummaries().sort().reverse().join(", ")};ServicesSummaryPresenter.prototype.serviceTypeSummaries=function(){var servicesByPricingTypeID=groupBy(this._services,function(s){return s.pricingTypeID()}),pricingTypeName=function(type,count){return 1==count?type.singularName():type.pluralName()};return Object.keys(servicesByPricingTypeID).map(function(pricingTypeID){var services=servicesByPricingTypeID[pricingTypeID],pricingType=this._pricingTypesByID[pricingTypeID];return services.length+" "+pricingTypeName(pricingType,services.length).toLowerCase()}.bind(this))};ServicesSummaryPresenter.summaries=function(jobTitles,services,pricingTypes){var jobTitlesByID=mapBy(jobTitles,function(t){return t.jobTitleID()}),servicesByJobTitleID=groupBy(services,function(s){return s.jobTitleID()},Object.keys(jobTitlesByID));return Object.keys(servicesByJobTitleID).map(function(jobTitleID){return new ServicesSummaryPresenter(jobTitlesByID[jobTitleID],servicesByJobTitleID[jobTitleID],pricingTypes)})};ServicesSummaryPresenter.sortByJobTitle=function(a,b){return a.jobTitle().localeCompare(b.jobTitle())};module.exports=ServicesSummaryPresenter},{"../../utils/groupBy":458,"../../utils/mapBy":463}],440:[function(require,module,exports){"use strict";var RouteParser=require("route-parser"),$=require("jquery"),Route=function(expression,defaults){this.routeParser=new RouteParser(expression);this.defaults=defaults||{}};Route.prototype.match=function(url){var match=this.routeParser.match(url);return!!match&&$.extend(this.defaults,match)};var RouteMatcher=function(routes,defaults){this.routes=routes;this.defaults=defaults||{}};RouteMatcher.prototype.match=function(url){var firstMatch=!1;this.routes.some(function(route){var m=route.match(url);if(m){firstMatch=m;return!0}});return!!firstMatch&&$.extend(this.defaults,firstMatch)};module.exports={RouteMatcher:RouteMatcher,Route:Route,RouteParser:RouteParser}},{jquery:14,"route-parser":148}],193:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201983163-making-changes-canceling-appointments";this.list=clientAppointments.list;this.currentIndex=ko.observable(-1);this.currentItem=new EditClientBookingCardVM(app);this.isLoading=ko.observable(!1);this.returnText=ko.observable("Back");this.isEditButtonVisible=ko.pureComputed(function(){return(this.canCancel()||this.canEdit())&&!this.isEditMode()&&!this.isCancelMode()},this.currentItem);this.isCancelEditButtonVisible=ko.pureComputed(function(){return(this.canCancel()||this.canEdit())&&(this.isEditMode()||this.isCancelMode())},this.currentItem);this.isEmpty=ko.pureComputed(function(){return-2===this.currentIndex()},this);var updateListIndex=function(){if(this.list().length&&-1===this.currentIndex()){var bID=this.currentItem.booking().bookingID();this.list().some(function(b,i){if(b.bookingID()===bID){this.currentIndex(i);return!0}}.bind(this))}}.bind(this);this.load=function(id){if(id){this.currentIndex(-1);this.currentItem.load(id).then(function(){clientAppointments.sync().then(updateListIndex)}).catch(function(err){showError({title:"Error loading the appointment",error:err})})}else{this.isLoading(!0);this.currentItem.reset();clientAppointments.sync().then(function(){var first=this.list().length?this.list()[0]:null;if(first){this.currentIndex(0);this.currentItem.load(first);updateListIndex();app.shell.replaceState(null,null,"/clientAppointment/"+first.bookingID())}else{this.currentIndex(-2);app.shell.replaceState(null,null,"/clientAppointment")}this.isLoading(!1)}.bind(this)).catch(function(err){this.isLoading(!1);showError({title:"Error loading appointments",error:err})}.bind(this))}}.bind(this);var goToIndex=function(i){var min=0,max=this.list().length-1;if(this.currentIndex()>=0){var ni=Math.max(0,Math.min(max,i));this.currentIndex(ni);var b=this.list()[ni];this.currentItem.load(b);app.shell.replaceState(null,null,"/clientAppointment/"+b.bookingID())}}.bind(this);this.goNext=function(){goToIndex(this.currentIndex()+1)}.bind(this);this.goPrevious=function(){goToIndex(this.currentIndex()-1)}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),EditClientBookingCardVM=require("../viewmodels/EditClientBookingCardVM"),clientAppointments=require("../data/clientAppointments"),showError=require("../modals/error").show,A=Activity.extend(function ClientAppointmentActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("",{backLink:"/myAppointments",helpLink:this.viewModel.helpLink});this.title("Your appointments")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var id=0|(options&&options.route&&options.route.segments)[0];this.viewModel.load(id);var returnText=options&&options.route&&options.route.query.returnText||"Back";this.viewModel.returnText(decodeURIComponent(returnText))}},{"../components/Activity":255,"../data/clientAppointments":268,"../modals/error":343,"../viewmodels/EditClientBookingCardVM":491,knockout:15}],491:[function(require,module,exports){"use strict";function EditClientBookingCardVM(app){BaseClientBookingCardVM.call(this,app);this.isLoadingBooking=ko.observable(!1);var baseIsLoading=this.isLoading;this.isLoading=ko.pureComputed(function(){return this.isLoadingBooking()||baseIsLoading()},this);var baseReset=this.reset;this.reset=function reset(){baseReset();this.isLoadingBooking(!1)}.bind(this);this.submitText=ko.pureComputed(function(){var v=this.editedVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);var baseCancel=this.cancel.bind(this);this.cancel=function cancel(){baseCancel();this.progress.go("confirm")}.bind(this);this.confirmCancel=function(){var v=this.editedVersion();v&&v.areDifferent()?showConfirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){this.cancel()}.bind(this)):this.cancel()};this.confirmCancelBookingByClient=function(){showConfirm({title:"Cancel booking",message:"Are you sure? Cancellation fees may apply.",yes:"Yes",no:"No"}).then(function(){this.cancelBookingByClient()}.bind(this))}.bind(this);this.load=function(bookingIdOrModel){if(bookingIdOrModel&&bookingIdOrModel.model){this.originalBooking(bookingIdOrModel);this.progress.reset().go("confirm");return Promise.resolve()}var bookingID=0|bookingIdOrModel;this.isLoadingBooking(!0);return bookings.getBooking(bookingID).then(function(booking){this.originalBooking(booking);this.progress.reset().go("confirm");this.isLoadingBooking(!1)}.bind(this)).catch(function(err){this.isLoadingBooking(!1);showError({error:err})}.bind(this))}.bind(this);var afterSaveBooking=function(serverBooking){this.originalBooking().model.updateWith(serverBooking,!0);this.editedVersion()&&this.editedVersion(null);this.isCancelMode(!1);var msg="You're all set! We'll notify {0} of your changes.".replace("{0}",this.serviceProfessionalInfo().profile().firstName());showNotification({title:"Done!",message:msg});this.isSaving(!1);availability.clearUserCache(this.originalBooking().serviceProfessionalUserID())}.bind(this);this.save=function(){this.isSaving(!0);bookings.setClientBooking(this.booking()).then(afterSaveBooking).catch(function(err){this.isSaving(!1);showError({error:err})}.bind(this))}.bind(this);this.cancelBookingByClient=function(){if(this.canCancel()){this.isSaving(!0);(this.booking().canBeCancelledByClient()?bookings.cancelBookingByClient:bookings.declineBookingByClient)(this.booking().bookingID()).then(afterSaveBooking).catch(function(err){showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}}}var ko=require("knockout"),BaseClientBookingCardVM=require("../viewmodels/BaseClientBookingCardVM"),bookings=require("../data/bookings"),availability=require("../data/availability"),showNotification=require("../modals/notification").show,showConfirm=require("../modals/confirm").show,showError=require("../modals/error").show,showError=require("../modals/error").show;EditClientBookingCardVM._inherits(BaseClientBookingCardVM);module.exports=EditClientBookingCardVM},{"../data/availability":261,"../data/bookings":262,"../modals/confirm":342,"../modals/error":343,"../modals/notification":344,"../viewmodels/BaseClientBookingCardVM":487,knockout:15}],268:[function(require,module,exports){"use strict";function loadLocalCopy(){return local.getItem("clientAppointments").then(function(data){if(data){data.latest&&(cache.latest=new Date(data.latest));data.data&&cache.data(data.data.map(function(b){return new Booking(b)}));if(data.range){cache.range.startTime=data.range.startTime?new Date(data.range.startTime):null;cache.range.endTime=data.range.endTime?new Date(data.range.endTime):null}}})}function saveLocalCopy(){return local.setItem("clientAppointments",{latest:cache.latest,data:cache.data().map(function(b){return b.model.toPlainObject(!0)})})}function isClientBooking(booking){return user.userID()===booking.clientUserID()}function sortBookingByDateComparator(a,b){return a.serviceDate().startTime()>b.serviceDate().startTime()?1:-1}function getFromRemote(options){if(remoteRequest)return remoteRequest;options=options||{};var start=new Date,end=moment().add(3,"month").toDate();return remoteRequest=bookings.getBookingsByDates(start,end).then(function(remoteData){remoteRequest=null;var d=remoteData().filter(isClientBooking).sort(sortBookingByDateComparator);if(d&&d.length){cache.range.startTime=d[0].serviceDate().startTime();cache.range.endTime=d[d.length-1].serviceDate().endTime();cache.touch();cache.data(d);saveLocalCopy()}else cache.data([])}).catch(function(er){remoteRequest=null;throw er})}function syncData(){var p=Promise.resolve();cache.localLoaded||(p=loadLocalCopy());cache.mustRevalidate()&&(p=p.then(getFromRemote));return p}var Booking=require("../models/Booking"),ko=require("knockout"),CacheControl=require("./helpers/CacheControl"),moment=require("moment"),user=require("./userProfile").data,session=require("./session"),local=require("./drivers/localforage"),bookings=require("./bookings"),cache=new CacheControl({ttl:{minutes:10},data:ko.observableArray([])});cache.localLoaded=!1;cache.range={startTime:null,endTime:null};var remoteRequest=null;exports.sync=syncData;exports.list=cache.data;exports.clearCache=function(){cache.data([]);cache.reset()};session.on.cacheCleaningRequested.subscribe(function(){exports.clearCache()})},{"../models/Booking":356,"./bookings":262,"./drivers/localforage":270,"./helpers/CacheControl":276,"./session":303,"./userProfile":309,knockout:15,moment:145}],192:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),cancellationPolicies=require("../data/cancellationPolicies"),ko=require("knockout");require("../kocomponents/tab-list");var A=Activity.extend(function CancellationPoliciesActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);this.title("Cancellation policies");var shell=this.app.shell,observableRoute=shell.getCurrentObservableRoute();this.activeTabName=ko.pureComputed({read:function(){var route=observableRoute();return route&&route.segments&&route.segments[0]},write:function(tabName){shell.replaceState(null,null,"#!cancellationPolicies/"+tabName)},owner:this});this.isLoading=cancellationPolicies.state.isLoading;this.policies=cancellationPolicies.list});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);cancellationPolicies.sync()}},{"../components/Activity":255,"../data/cancellationPolicies":266,"../kocomponents/tab-list":337,knockout:15}],191:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201959953-syncing-your-existing-calendar";var syncVersion=calendarSyncing.newVersion();syncVersion.isObsolete.subscribe(function(itIs){itIs&&syncVersion.pull({evenIfNewer:!0})});this.sync=syncVersion.version;this.isLocked=ko.pureComputed(function(){return this.isLocked()||this.isReseting()},calendarSyncing);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},calendarSyncing);this.resetText=ko.pureComputed(function(){return this.isReseting()?"reseting...":"Reset Private URL"},calendarSyncing);this.discard=function discard(){syncVersion.pull({evenIfNewer:!0})};this.save=function save(){syncVersion.pushSave().then(function(){app.successSave()}).catch(function(){})};this.reset=function reset(){calendarSyncing.resetExportUrl()}}var Activity=require("../components/Activity"),$=require("jquery"),ko=require("knockout"),calendarSyncing=require("../data/calendarSyncing"),showError=require("../modals/error").show,A=Activity.extend(function CalendarSyncingActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Calendar",{backLink:"calendar",helpLink:this.viewModel.helpLink});this.title("Syncing your calendars");this.registerHandler({target:this.$activity.find("#calendarSync-icalExportUrl"),event:"click",handler:function(){$(this).select()}});this.registerHandler({target:calendarSyncing,event:"error",handler:function(err){var msg="save"===err.task?"Error saving calendar syncing settings.":"Error loading calendar syncing settings.";showError({title:msg,error:err&&err.task&&err.error||err})}})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);calendarSyncing.sync();this.viewModel.discard()}},{"../components/Activity":255,"../data/calendarSyncing":265,"../modals/error":343,jquery:14,knockout:15}],265:[function(require,module,exports){"use strict";var ko=require("knockout"),CalendarSyncing=require("../models/CalendarSyncing"),RemoteModel=require("./helpers/RemoteModel"),session=require("./session"),remote=require("./drivers/restClient"),api=new RemoteModel({data:new CalendarSyncing,ttl:{minutes:1},localStorageName:"calendarSyncing",fetch:function fetch(){return remote.get("me/calendar-syncing")},push:function push(){return remote.put("me/calendar-syncing",this.data.model.toPlainObject())}});module.exports=api;api.isReseting=ko.observable(!1);api.resetExportUrl=function resetExportUrl(){api.isReseting(!0);return remote.post("me/calendar-syncing/reset-export-url").then(function(updatedSyncSettings){api.data.model.updateWith(updatedSyncSettings);api.isReseting(!1);return updatedSyncSettings})};session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/CalendarSyncing":359,"./drivers/restClient":271,"./helpers/RemoteModel":283,"./session":303,knockout:15}],359:[function(require,module,exports){"use strict";function CalendarSyncing(values){Model(this);this.model.defProperties({icalExportUrl:"",icalImportUrl:""},values)}var Model=require("./Model");module.exports=CalendarSyncing},{"./Model":386}],190:[function(require,module,exports){"use strict";function ViewModel(){this.currentDate=ko.observable(getDateWithoutTime());var fullDayFree=[Appointment.newFreeSlot({date:this.currentDate()})];this.currentDate.subscribe(function(date){if(date){fullDayFree[0].startTime(date);fullDayFree[0].endTime(date)}},this);this.slotsSource=ko.observable(fullDayFree);this.slots=ko.computed(function(){var slots=this.slotsSource();slots.length>1&&(slots=slots.filter(function(slot){return slot.id()!==Appointment.specialIds.unavailable}));return slots.map(TimeSlotViewModel.fromAppointment)},this);this.isLoading=ko.observable(!1);this.previousDate=this.currentDate().toISOString();this.currentDate.subscribe(function(date){if((date=new Date(Date.parse(date.toISOString()))).toISOString()!==this.previousDate){this.previousDate=date.toISOString();this.isLoading(!0);calendar.getDateAvailability(date).then(function(dateAvail){if(date.toISOString()===this.currentDate().toISOString()){this.slotsSource(dateAvail.list());this.isLoading(!1)}}.bind(this)).catch(function(err){this.slotsSource(fullDayFree);this.isLoading(!1);showError({title:"Error loading calendar events.",error:err})}.bind(this))}}.bind(this))}require("../components/DatePicker");var $=require("jquery"),moment=require("moment"),ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime"),datepickerAvailability=require("../utils/datepickerAvailability"),user=require("../data/userProfile").data,calendar=require("../data/calendar"),showError=require("../modals/error").show,Activity=require("../components/Activity"),Appointment=require("../models/Appointment"),TimeSlotViewModel=require("../viewmodels/TimeSlot"),A=Activity.extend(function CalendarActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.title("Your Calendar");this.$datepicker=this.$activity.find("#calendarDatePicker");this.$dailyView=this.$activity.find("#calendarDailyView");this.$dateTitle=this.$activity.find(".CalendarDateHeader > .btn");this.$chooseNew=$("#calendarChooseNew");this.$datepicker.show().datepicker({extraClasses:"DatePicker--tagged"});this.tagAvailability=datepickerAvailability.create(this.app,this.$datepicker,this.viewModel.isLoading);this.registerHandler({target:this.viewModel.currentDate,handler:function(date){if(date){var mdate=moment(date);if(mdate.isValid()){var isoDate=mdate.toISOString();this.hideDatepicker();this.$datepicker.datepicker("getValue").toISOString()!==isoDate&&this.$datepicker.datepicker("setValue",date,!0);this.app.shell.pushState(null,null,"calendar/"+isoDate);return}}this.viewModel.currentDate(getDateWithoutTime())}.bind(this)});this.registerHandler({target:this.$dailyView,event:"swipeleft swiperight",handler:function(e){e.preventDefault();var dir="swipeleft"===e.type?"next":"prev";$(document).trigger("touchend");this.$datepicker.datepicker("moveValue",dir,"date")}.bind(this)});this.hideDatepicker=function(){this.$datepicker.datepicker("hide")};this.viewModel.openDatePicker=function(d,e){this.$datepicker.datepicker("toggle",e);e.preventDefault();e.stopPropagation()}.bind(this);this.viewModel.nextDate=function(d,e){e.preventDefault();this.$datepicker.datepicker("moveValue","next","date")}.bind(this);this.viewModel.prevDate=function(d,e){e.preventDefault();this.$datepicker.datepicker("moveValue","prev","date")}.bind(this);this.registerHandler({target:this.$datepicker,event:"dateChanged",handler:function(e){"days"===e.viewMode&&this.viewModel.currentDate(getDateWithoutTime(e.date))}.bind(this)});this.viewModel.currentDate(getDateWithoutTime())});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.hideDatepicker();var sdate=options.route&&options.route.segments&&options.route.segments[0],date;if(sdate){var mdate=moment(sdate);date=mdate.isValid()?getDateWithoutTime(mdate.toDate()):null}date||(date=getDateWithoutTime());this.viewModel.previousDate=null;this.viewModel.currentDate(date);this.tagAvailability(date,user.userID(),!0)}},{"../components/Activity":255,"../components/DatePicker":256,"../data/calendar":263,"../data/userProfile":309,"../modals/error":343,"../models/Appointment":354,"../utils/datepickerAvailability":449,"../utils/getDateWithoutTime":454,"../viewmodels/TimeSlot":511,jquery:14,knockout:15,moment:145}],511:[function(require,module,exports){"use strict";function TimeSlotViewModel(params){this.startTime=getObservable(params.startTime||null);this.endTime=getObservable(params.endTime||null);this.summary=getObservable(params.summary||null);this.link=getObservable(params.link||null);this.price=getObservable(params.price||null);this.classNames=getObservable(params.classNames||null);this.apt=getObservable(params.apt||null);this.ariaLabel=ko.pureComputed(function(){var apt=this.apt();if(!apt)return"";var start=moment(this.startTime()).format("h:mma"),end=moment(this.endTime()).format("h:mma"),labelSummary="",clickAction="";if(Appointment.specialIds.free===apt.id()){clickAction=". Click to add a new booking or calendar block.";labelSummary=this.summary()}else if(apt.id()>0&&apt.sourceBooking().isRequest()){clickAction=". Click to respond to request.";labelSummary=this.summary()+", with total price of "+this.price()}else if(apt.id()>0&&apt.sourceBooking().isConfirmed()){clickAction=". Click to view booking details.";labelSummary=this.summary()+", with total price of "+this.price()}else clickAction=". Click to view details and make changes.";return labelSummary+", from "+start+" until "+end+clickAction},this)}var getObservable=require("../utils/getObservable"),numeral=require("numeral"),Appointment=require("../models/Appointment"),ko=require("knockout"),moment=require("moment"),user=require("../data/userProfile").data;module.exports=TimeSlotViewModel;TimeSlotViewModel.fromAppointment=function fromAppointment(apt){var link="#!appointment/"+apt.startTime().toISOString()+"/"+apt.id();apt.id()===Appointment.specialIds.preparationTime&&(link="#!schedulingPreferences?mustReturn=1");var classNames="",timeSlotSummary="";if(Appointment.specialIds.free===apt.id()){classNames="Item--tag-gray-lighter ";timeSlotSummary=apt.summary()}else if(apt.id()>0&&apt.sourceBooking()){var clientID=apt.sourceBooking().clientUserID();if(apt.sourceBooking().isRequest()){classNames="Item--tag-warning ";timeSlotSummary=clientID==user.userID()?"Request for "+apt.summary()+" by  professional":"Request for "+apt.summary()+" for  client"}else{classNames="Item--tag-primary ";timeSlotSummary=clientID==user.userID()?apt.summary()+" by  professional":apt.summary()+" for  client"}}else{classNames="Item--tag-danger ";timeSlotSummary=apt.summary()}return new TimeSlotViewModel({startTime:apt.startTime,endTime:apt.endTime,summary:timeSlotSummary,link:link,apt:apt,price:apt.sourceBooking()&&apt.sourceBooking().pricingSummary()?numeral(apt.sourceBooking().pricingSummary().totalPrice()||0).format("$0.00"):null,classNames:classNames})}},{"../data/userProfile":309,"../models/Appointment":354,"../utils/getObservable":455,knockout:15,moment:145,numeral:146}],189:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/sections/202884403-Setting-Your-Booking-Policies";this.jobTitleID=ko.observable(0);this.userJobTitle=ko.observable(null);this.jobTitleName=ko.observable("Job Title");this.selectedCancellationPolicyID=ko.observable(null);this.instantBooking=ko.observable(null);this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/bookingPolicies");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.validateInstantBooking=function(){return paymentAccount.whenLoaded().then(function(){return!this.instantBooking()||paymentAccount.data.isReady()}.bind(this))};var performSave=function(){var ujt=this.userJobTitle();if(ujt){this.isSaving(!0);var plain=ujt.model.toPlainObject();plain.cancellationPolicyID=this.selectedCancellationPolicyID();plain.instantBooking=this.instantBooking();userJobProfile.setUserJobTitle(plain).then(function(){this.isSaving(!1);app.successSave()}.bind(this)).catch(function(err){this.isSaving(!1);showError({title:"Unable to save booking policies",error:err})}.bind(this))}}.bind(this);this.save=function(){this.validateInstantBooking().then(function(isValid){isValid?performSave():payoutPreferenceRequired.show({reason:payoutPreferenceRequired.Reason.enablingInstantBooking}).then(function(done){done&&performSave()}).catch(function(err){showError({title:"Unable to set-up payout preference",error:err})})})}.bind(this);this.policies=cancellationPolicies.list}var ko=require("knockout"),Activity=require("../components/Activity"),jobTitles=require("../data/jobTitles"),userJobProfile=require("../data/userJobProfile"),cancellationPolicies=require("../data/cancellationPolicies"),showError=require("../modals/error").show,paymentAccount=require("../data/paymentAccount"),payoutPreferenceRequired=require("../modals/payoutPreferenceRequired"),A=Activity.extend(function BookingPoliciesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Listing",{backLink:"listingEditor",helpLink:this.viewModel.helpLink});this.title=ko.pureComputed(function(){return this.jobTitleName()+" booking policies"},this.viewModel);this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName())}.bind(this)).catch(function(err){showError({title:"Unable to load listing details.",error:err})}.bind(this));this.viewModel.isLoading(!0);userJobProfile.getUserJobTitle(jobTitleID).then(function(userJobTitle){this.viewModel.userJobTitle(userJobTitle);this.viewModel.selectedCancellationPolicyID(userJobTitle.cancellationPolicyID());this.viewModel.instantBooking(userJobTitle.instantBooking())}.bind(this)).catch(function(err){showError({title:"Unable to load policies.",error:err})}.bind(this)).then(function(){this.viewModel.isLoading(!1)}.bind(this));var found=/bookingPolicies\/(\d+)/i.exec(window.location);if((found&&0|found[1])!==jobTitleID){var url="/bookingPolicies/"+jobTitleID;this.app.shell.replaceState(null,null,url)}}else{this.viewModel.jobTitleName("Job Title");this.viewModel.userJobTitle(null);this.viewModel.selectedCancellationPolicyID(null);this.viewModel.instantBooking(null)}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){this.viewModel.jobTitleID(null);this.viewModel.selectedCancellationPolicyID(null);this.viewModel.instantBooking(null);Activity.prototype.show.call(this,state);var jid=0|(state&&state.route&&state.route.segments)[0];this.viewModel.jobTitleID(jid);cancellationPolicies.sync();paymentAccount.sync();jid||this.viewModel.jobTitles.sync()};var UserJobProfile=require("../viewmodels/UserJobProfile")},{"../components/Activity":255,"../data/cancellationPolicies":266,"../data/jobTitles":286,"../data/paymentAccount":293,"../data/userJobProfile":306,"../modals/error":343,"../modals/payoutPreferenceRequired":346,"../viewmodels/UserJobProfile":512,knockout:15}],512:[function(require,module,exports){"use strict";function UserJobProfileViewModel(app){function syncJobTitle(jobTitleID){return jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){jobTitlesIndex[jobTitleID]=jobTitle})}function attachJobTitle(userJobTitle){userJobTitle.jobTitle=ko.computed(function(){return jobTitlesIndex[this.jobTitleID()]},userJobTitle);userJobTitle.displayedSingularName=ko.computed(function(){return this.jobTitle()&&this.jobTitle().singularName()||"Unknow"},userJobTitle)}function attachMarketplaceStatus(userJobtitle){userJobtitle.marketplaceStatusHtml=ko.pureComputed(function(){var status=this.statusID(),isComplete=this.isComplete();return isComplete&&status===UserJobTitle.status.on?'Marketplace listing: <strong class="text-success">ON</strong>':isComplete&&status===UserJobTitle.status.off?'Marketplace listing: <strong class="text-danger">OFF</strong>':'<span class="text-danger">Steps remaining to activate listing</span>'},userJobtitle)}function attachExtras(userJobtitle){attachJobTitle(userJobtitle);attachMarketplaceStatus(userJobtitle)}this.showMarketplaceInfo=ko.observable(!1);var jobTitlesIndex={},showLoadingError=function showLoadingError(err){showError({title:"An error happening when loading your job profile.",error:err});this.isLoading(!1);this.isSyncing(!1);this.thereIsError(!0)}.bind(this);this.userJobProfile=ko.observableArray([]);userJobProfile.list.subscribe(function(list){Promise.all(list.map(function(userJobTitle){return syncJobTitle(userJobTitle.jobTitleID())})).then(function(){list.forEach(attachExtras);this.userJobProfile(list);this.isLoading(!1);this.isSyncing(!1);this.thereIsError(!1)}.bind(this)).catch(showLoadingError)},this);this.isFirstTime=ko.observable(!0);this.isLoading=ko.observable(!1);this.isSyncing=ko.observable(!1);this.thereIsError=ko.observable(!1);this.baseUrl=ko.observable("/jobtitles");this.selectJobTitle=function(jobTitle){app.shell.go(this.baseUrl()+"/"+jobTitle.jobTitleID());return!1}.bind(this);this.sync=function sync(){var firstTime=this.isFirstTime();this.isFirstTime(!1);firstTime?this.isLoading(!0):this.isSyncing(!0);userJobProfile.syncList().catch(showLoadingError)}.bind(this)}var ko=require("knockout"),UserJobTitle=require("../models/UserJobTitle"),jobTitles=require("../data/jobTitles"),userJobProfile=require("../data/userJobProfile"),showError=require("../modals/error").show;module.exports=UserJobProfileViewModel},{"../data/jobTitles":286,"../data/userJobProfile":306,"../modals/error":343,"../models/UserJobTitle":422,knockout:15}],188:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),NewClientBookingCardVM=require("../viewmodels/NewClientBookingCardVM"),A=Activity.extend(function BookingActivity(){Activity.apply(this,arguments);this.viewModel=new NewClientBookingCardVM(this.app);this.navBar=Activity.createSubsectionNavBar("Booking",{helpLink:"/help"});this.title("Booking");this.registerHandler({target:this.viewModel.progress.step,handler:function(){var load=this[this.viewModel.progress.currentStep()+"Load"];load&&load.call(this)}.bind(this)});var labelTpl=" (Step __step__ of __total__)",title=this.title;ko.computed(function(){var step=this.step()+1,total=this.totalSteps(),label="Booking";step>0&&total>1&&(label=labelTpl.replace("__step__",step).replace("__total__",total));title(label)},this.viewModel.progress)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var referrer=this.app.shell.referrerRoute,reg=/\/?booking/i;(referrer=referrer&&referrer.url)&&!reg.test(referrer)||(referrer="/");this.convertToCancelAction(this.navBar.leftAction(),referrer);var params=state&&state.route&&state.route.segments,bookCode=state&&state.route&&state.route.query.bookCode;this.viewModel.initBooking(0|params[0],0|params[1],bookCode)};A.prototype.hide=function hide(){Activity.prototype.hide.call(this);this.viewModel.isDone()||this.viewModel.saveState()};A.prototype.servicesLoad=function(){this.viewModel.loadServices()};A.prototype.selectLocationLoad=function(){this.viewModel.loadServiceAddresses()};A.prototype.selectTimesLoad=function(){};A.prototype.selectTimeLoad=function(){};A.prototype.paymentLoad=function(){};A.prototype.confirmLoad=function(){}},{"../components/Activity":255,"../viewmodels/NewClientBookingCardVM":498,knockout:15}],498:[function(require,module,exports){"use strict";function saveLastBooking(s){return new Promise(function(resolve){var d=JSON.stringify(s);sessionStorage.setItem("lastBooking",d);resolve(d)})}function loadLastBooking(){return new Promise(function(resolve){var d=sessionStorage.getItem("lastBooking");resolve(JSON.parse(d))})}function clearLastBooking(){return new Promise(function(resolve){sessionStorage.removeItem("lastBooking");resolve()})}function NewClientBookingCardVM(app){BaseClientBookingCardVM.call(this,app);this.newDataReady=ko.observable(!1);this.bookCode=ko.observable(null);this.makeRepeatBooking=ko.observable(!1);this.promotionalCode=ko.observable("");this.paymentMethod=ko.observable(null);this.signupVM=new SignupVM(app);this.signupVM.atBooking(!0);this.isLoadingNewBooking=ko.observable(!1);this.isRestoring=ko.observable(!1);this.isDone=ko.observable(!1);var baseIsLoading=this.isLoading;this.isLoading=ko.pureComputed(function(){return this.isLoadingNewBooking()||baseIsLoading()},this);var baseReset=this.reset;this.reset=function reset(){baseReset();this.newDataReady(!1);this.bookCode(null);this.promotionalCode("");this.paymentMethod(null);this.makeRepeatBooking(!1);this.signupVM.reset();this.signupVM.atBooking(!0);this.isSaving(!1);this.isDone(!1)}.bind(this);this.saveState=function saveState(){if(!this.booking())return Promise.resolve();var s={serviceProfessionalUserID:this.booking().serviceProfessionalUserID(),jobTitleID:this.booking().jobTitleID(),bookCode:this.bookCode()},services=this.serviceProfessionalServices.selectedServices();s.services=services.map(function(serv){return serv.serviceProfessionalServiceID()});s.presetGratuity=this.presetGratuity();s.gratuityAmount=this.gratuityAmount();s.promotionalCode=this.promotionalCode();var add=this.booking().serviceAddress();s.serviceAddress=add&&add.model.toPlainObject(!0)||null;s.serviceDate=this.booking().serviceDate();s.serviceDate=s.serviceDate?s.serviceDate.model.toPlainObject():null;s.alternativeDate1=this.booking().alternativeDate1();s.alternativeDate1=s.alternativeDate1?s.alternativeDate1.model.toPlainObject():null;s.alternativeDate2=this.booking().alternativeDate2();s.alternativeDate2=s.alternativeDate2?s.alternativeDate2.model.toPlainObject():null;s.specialRequests=this.booking().specialRequests();var pm=this.paymentMethod();s.paymentMethod=pm?pm.model.toPlainObject(!0):null;return saveLastBooking(s)}.bind(this);this.restoreState=function restoreState(){this.isRestoring(!0);return loadLastBooking().then(function(s){if(s){clearLastBooking();var spuid=this.booking().serviceProfessionalUserID(),jid=this.booking().jobTitleID();if(s.serviceProfessionalUserID===spuid&&s.jobTitleID===jid){this.bookCode(s.bookCode);this.serviceProfessionalServices.once("loaded",function(){this.isRestoring(!0);this.serviceProfessionalServices.list().forEach(function(serv){if(s.services.indexOf(serv.serviceProfessionalServiceID())>-1){serv.isSelected(!0);this.serviceProfessionalServices.selectedServices.push(serv)}}.bind(this));this.isRestoring(!1)}.bind(this));this.presetGratuity(s.presetGratuity);this.gratuityAmount(s.gratuityAmount);this.promotionalCode(s.promotionalCode);if(s.serviceAddress)var addressSubscription=this.isLoadingServiceAddresses.subscribe(function(isIn){if(!isIn){addressSubscription.dispose();this.isRestoring(!0);if(s.serviceAddress.addressID){var foundAddress,searchAddress=function(add){if(add.addressID()===s.serviceAddress.addressID){foundAddress=add;return!0}};this.serviceAddresses.addresses().some(searchAddress);if(foundAddress)this.serviceAddresses.selectedAddress(foundAddress);else{this.clientAddresses.addresses().some(searchAddress);foundAddress&&this.clientAddresses.selectedAddress(foundAddress)}}else{this.booking().serviceAddress(new Address(s.serviceAddress));this.addressEditorOpened(!0)}this.isRestoring(!1)}}.bind(this));this.booking().serviceDate(s.serviceDate?new EventDates(s.serviceDate):null);this.booking().alternativeDate1(s.alternativeDate1?new EventDates(s.alternativeDate1):null);this.booking().alternativeDate2(s.alternativeDate2?new EventDates(s.alternativeDate2):null);this.booking().specialRequests(s.specialRequests);var pm=s.paymentMethod;pm&&this.paymentMethod()&&this.paymentMethod().model.updateWith(pm,!0)}this.isRestoring(!1)}else this.isRestoring(!1)}.bind(this)).catch(function(err){console.error("Last Booking state could not being restored",err);this.isRestoring(!1)}.bind(this))}.bind(this);this.confirmBtnText=ko.pureComputed(function(){return this.isSaving()?"Confirming...":this.isAnonymous()?"Sign up and confirm":"Confirm"},this);this.paymentMethodDisplay=ko.pureComputed(function(){var n=this.booking().paymentLastFourCardNumberDigits();return n?"Card ending in "+n:""},this);ko.computed(function(){var pm=this.paymentMethod(),number=pm&&pm.cardNumber();if(number){var last=number.slice(-4);this.booking().paymentLastFourCardNumberDigits(last)}},this);this.initBooking=function(serviceProfessionalID,jobTitleID,bookCode){this.reset();this.bookCode(bookCode);this.isLoadingNewBooking(!0);bookings.getNewClientBooking({serviceProfessionalUserID:serviceProfessionalID,jobTitleID:jobTitleID,bookCode:bookCode}).then(function(bookingData){this.originalBooking(new Booking(bookingData));if(this.originalBooking().paymentEnabled()){var ipm=new InputPaymentMethod;ipm.billingAddress(new Address);this.paymentMethod(ipm)}return this.restoreState()}.bind(this)).then(function(){this.isLoadingNewBooking(!1);this.newDataReady(!0);this.edit();this.progress.reset();this.nextStep()}.bind(this)).catch(function(err){this.isLoadingNewBooking(!1);showError({error:err})}.bind(this))}.bind(this);this.bookingHeader=ko.pureComputed(function(){var v=this.booking()&&this.booking().instantBooking();return!0===v?"Your instant booking:":!1===v?"Your booking request:":""},this);this.save=function(){this.isSaving(!0);var saveIt=function(){var requestOptions={promotionalCode:this.promotionalCode(),bookCode:this.bookCode()};return bookings.requestClientBooking(this.booking(),requestOptions,this.paymentMethod())}.bind(this),success=function(serverBooking){this.isSaving(!1);this.originalBooking().model.updateWith(serverBooking,!0);this.editedVersion(null);availability.clearUserCache(this.originalBooking().serviceProfessionalUserID());this.isDone(!0);showNotification({title:"Done!",message:"Your booking was created!"}).then(function(){app.shell.go("/")})}.bind(this),onerror=function(err){this.isSaving(!1);showError({error:err})}.bind(this);this.isAnonymous()?this.signupVM.performSignup().then(saveIt).then(success).catch(onerror):saveIt().then(success).catch(onerror)}.bind(this);this.goLogin=function(d,e){app.shell.go("/login",{redirectUrl:app.shell.currentRoute.url});if(e){e.preventDefault();e.stopImmediatePropagation()}}.bind(this)}var ko=require("knockout"),Booking=require("../models/Booking"),BaseClientBookingCardVM=require("../viewmodels/BaseClientBookingCardVM"),InputPaymentMethod=require("../models/InputPaymentMethod"),SignupVM=require("../viewmodels/Signup"),Address=require("../models/Address"),EventDates=require("../models/EventDates"),bookings=require("../data/bookings"),availability=require("../data/availability"),showNotification=require("../modals/notification").show,showError=require("../modals/error").show;NewClientBookingCardVM._inherits(BaseClientBookingCardVM);module.exports=NewClientBookingCardVM},{"../data/availability":261,"../data/bookings":262,"../modals/error":343,"../modals/notification":344,"../models/Address":353,"../models/Booking":356,"../models/EventDates":364,"../models/InputPaymentMethod":370,"../viewmodels/BaseClientBookingCardVM":487,"../viewmodels/Signup":510,knockout:15}],487:[function(require,module,exports){"use strict";function BaseClientBookingCardVM(app){this.app=app;this.originalBooking=ko.observable();this.editedVersion=ko.observable(null);this.serviceProfessionalServices=new ServiceProfessionalServiceVM(app);this.serviceProfessionalServices.isSelectionMode(!0);this.serviceProfessionalServices.preSelectedServices([]);this.serviceProfessionalServices.serviceListGroupsFactory=serviceListGroupFactories.clientBookedServices;this.serviceAddresses=new ServiceAddresses;this.serviceAddresses.isSelectionMode(!0);this.isLoadingServiceAddresses=ko.observable(!1);this.clientAddresses=new ServiceAddresses;this.clientAddresses.isSelectionMode(!0);this.addressEditorOpened=new ko.observable(!1);this.supportsGratuity=ko.observable(!1);this.presetGratuity=ko.observable(0);this.gratuityAmount=ko.observable(0);this.serviceStartDatePickerView=ko.observable(null);this.timeFieldToBeSelected=ko.observable("");this.progress=new BookingProgress({step:-1});this.isSaving=ko.observable(!1);this.isCancelMode=ko.observable(!1);this.postalCodeVM=ko.observable(null);var siteUrl=(require("../data/appPresets").siteUrl||"https://loconomics.com")+"/";this.urlTos=ko.observable(siteUrl+"#!terms/terms-of-service?mustReturn=true");this.urlPp=ko.observable(siteUrl+"#!terms/privacy-policy?mustReturn=true");this.urlBcp=ko.observable(siteUrl+"#!terms/background-check-policy?mustReturn=true");this.errorMessages={postalCode:ko.observable("")};this.reset=function reset(){this.originalBooking(null);this.editedVersion(null);this.serviceProfessionalServices.reset();this.serviceProfessionalServices.isSelectionMode(!0);this.serviceProfessionalServices.preSelectedServices([]);this.serviceAddresses.reset();this.serviceAddresses.isSelectionMode(!0);this.isLoadingServiceAddresses(!1);this.clientAddresses.reset();this.clientAddresses.isSelectionMode(!0);this.addressEditorOpened(!1);this.supportsGratuity(!1);this.presetGratuity(0);this.gratuityAmount(0);this.timeFieldToBeSelected("");this.isSaving(!1);this.isCancelMode(!1);this.progress.reset();this.postalCodeVM(null);this.errorMessages.postalCode("")}.bind(this);this.isEditMode=ko.pureComputed(function(){return!!this.editedVersion()},this);this.isLoading=ko.pureComputed(function(){return this.isLoadingServiceProfessionalInfo()||this.serviceProfessionalServices.isLoading()},this);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.canEdit=ko.pureComputed(function(){return!(!this.originalBooking()||!this.booking())&&(!this.booking().bookingID()||this.booking().instantBooking()&&this.booking().isConfirmed())},this);this.canCancel=ko.pureComputed(function(){return this.originalBooking()&&(this.originalBooking().canBeCancelledByClient()||this.originalBooking().canBeDeclinedByClient())},this);this.isAnonymous=user.isAnonymous;this.edit=function edit(){if(!this.isLocked()){this.canCancel()&&this.isCancelMode(!0);if(this.canEdit()){var version=new ModelVersion(this.originalBooking());Booking.editable(version.version);version.version.connectToSelectableServicesView(this.serviceProfessionalServices);this.postalCodeVM(new PostalCodeVM({address:version.version.serviceAddress,postalCodeError:this.errorMessages.postalCode,enabled:this.addressEditorOpened}));this.editedVersion(version);version.version.pricingSummary().details().length&&this.loadServices();version.version.serviceAddress()&&version.version.serviceAddress().addressID()&&this.loadServiceAddresses()}}}.bind(this);this.cancel=function cancel(){if(!this.isLocked()){this.isCancelMode(!1);this.editedVersion()&&this.editedVersion().pull({evenIfNewer:!0});this.editedVersion(null);this.progress.reset()}}.bind(this);this.booking=ko.pureComputed(function(){var v=this.editedVersion();return v?v.version:this.originalBooking()},this);this.gratuityPercentage=ko.pureComputed(function(){var preset=this.presetGratuity();return"custom"===preset?0:preset},this);this.gratuityPercentage.subscribe(function(v){this.booking()&&this.booking().pricingSummary().gratuityPercentage(v)},this);this.gratuityAmount.subscribe(function(v){this.booking()&&this.booking().pricingSummary().gratuityAmount(v)},this);this.hasServicesSelected=ko.pureComputed(function(){var s=this.serviceProfessionalServices.selectedServices();return s&&s.length>0||!1},this);var setAddress=function(add){add&&this.booking()&&this.booking().serviceAddress(add)}.bind(this);this.serviceAddresses.selectedAddress.subscribe(function(add){if(add){setAddress(add);this.clientAddresses.selectedAddress(null)}}.bind(this));this.clientAddresses.selectedAddress.subscribe(function(add){if(add){setAddress(add);this.serviceAddresses.selectedAddress(null)}}.bind(this));this.hasServiceArea=ko.pureComputed(function(){return this.serviceAddresses.serviceAreas().length>0},this);this.addAddress=function(serviceArea,event){event.preventDefault();this.booking().serviceAddress(new Address);this.postalCodeVM().onFormLoaded();this.addressEditorOpened(!0)}.bind(this);this.serviceProfessionalInfo=ko.observable(new PublicUser);this.isLoadingServiceProfessionalInfo=ko.observable(!1);ko.computed(function(){var userID=this.booking()&&this.booking().serviceProfessionalUserID();if(userID){this.isLoadingServiceProfessionalInfo(!0);users.getUser(userID).then(function(info){info.selectedJobTitleID=this.booking().jobTitleID();this.serviceProfessionalInfo().model.updateWith(info,!0);this.isLoadingServiceProfessionalInfo(!1)}.bind(this)).catch(function(err){this.isLoadingServiceProfessionalInfo(!1);showError({error:err})}.bind(this))}else{this.serviceProfessionalInfo().model.reset();this.isLoadingServiceProfessionalInfo(!1)}},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.urlCp=ko.pureComputed(function(){var info=this.serviceProfessionalInfo(),id=(info=info&&info.selectedJobTitle())&&info.cancellationPolicyID()||"";return siteUrl+"#!cancellationPolicies/"+id+"?mustReturn=true"},this);this.singleTimeOption=ko.pureComputed(function(){return this.originalBooking()?this.originalBooking().instantBooking()||!(this.originalBooking().isRequest()||this.originalBooking().isIncomplete()):null},this);ko.computed(function triggerSelectedDatetime(){if(this.booking()){var v=this.serviceStartDatePickerView(),dt=v&&v.selectedDatetime(),current=this.booking().serviceDate(),field=this.timeFieldToBeSelected.peek();if(dt&&field&&dt.toString()!==(current&&current.startTime().toString())){this.booking()[field](new EventDates({startTime:dt}));this.booking()[field]().duration({minutes:this.booking().pricingSummary().firstSessionDurationMinutes()});this.timeFieldToBeSelected("");this.singleTimeOption()&&this.progress.next()}}},this);ko.computed(function(){var b=this.booking();if(b){var minutes=b.pricingSummary().firstSessionDurationMinutes();this.serviceStartDatePickerView()&&minutes&&this.serviceStartDatePickerView().requiredDurationMinutes(minutes)}},this);this.pickServiceDate=function(){this.timeFieldToBeSelected("serviceDate")}.bind(this);this.pickAlternativeDate1=function(){this.timeFieldToBeSelected("alternativeDate1")}.bind(this);this.pickAlternativeDate2=function(){this.timeFieldToBeSelected("alternativeDate2")}.bind(this);this.hasSomeDateSelected=ko.pureComputed(function(){var b=this.booking();return!!b&&(b.serviceDate()&&b.serviceDate().startTime()||b.alternativeDate1()&&b.alternativeDate1().startTime()||b.alternativeDate2()&&b.alternativeDate2().startTime())},this);this.isPhoneServiceOnly=ko.pureComputed(function(){return this.isEditMode()&&!this.serviceProfessionalServices.isLoading()?this.serviceProfessionalServices.selectedServices().every(function(service){return service.isPhone()}):!this.booking()||!this.booking().serviceAddress()},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.specialRequestsPlaceholder=ko.pureComputed(function(){var sp=this.serviceProfessionalInfo();return(sp=sp.profile()&&sp.profile().firstName())?"Add notes to "+sp:"Add notes"},this);this.pickSpecialRequests=function(){showTextEditor({title:this.specialRequestsPlaceholder(),text:this.booking().specialRequests()}).then(function(text){this.booking().specialRequests(text)}.bind(this)).catch(function(err){err&&showError({error:err})})}.bind(this);this.nextStep=function(){this.progress.next()}.bind(this);this.getStepLabel=function(stepName){return stepsLabels[stepName]||stepName};this.isAtSelectTimes=this.progress.observeStep("selectTimes");this.isAtSelectTime=this.progress.observeStep("selectTime");this.isAtServices=this.progress.observeStep("services");this.isAtLocation=this.progress.observeStep("selectLocation");this.isAtPayment=this.progress.observeStep("payment");this.isAtConfirm=this.progress.observeStep("confirm");this.pickDateTime=function(){var single=this.singleTimeOption();this.progress.go(single?"selectTime":"selectTimes")}.bind(this);this.pickLocation=function(){this.progress.go("selectLocation")}.bind(this);this.pickServices=function(){this.progress.go("services")}.bind(this);this.pickPayment=function(){this.progress.go("payment")}.bind(this);ko.computed(function(){if(this.booking())switch(this.progress.currentStep()){case"selectTime":this.prepareDatePicker("serviceDate");break;case"selectTimes":this.prepareDatePicker("")}},this);ko.computed(function(){var list=["services"];if(this.originalBooking()&&this.booking()){this.isPhoneServiceOnly()||list.push("selectLocation");list.push(this.singleTimeOption()?"selectTime":"selectTimes");this.booking().paymentEnabled()&&this.booking().pricingSummary().totalPrice()>0&&list.push("payment")}list.push("confirm");this.progress.stepsList(list)},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}var ko=require("knockout"),Booking=require("../models/Booking.editable"),ServiceProfessionalServiceVM=require("../viewmodels/ServiceProfessionalService"),ServiceAddresses=require("../viewmodels/ServiceAddresses"),BookingProgress=require("../viewmodels/BookingProgress"),Address=require("../models/Address"),EventDates=require("../models/EventDates"),PublicUser=require("../models/PublicUser"),ModelVersion=require("../utils/ModelVersion"),serviceListGroupFactories=require("../viewmodels/ServiceListGroupFactories"),PostalCodeVM=require("../viewmodels/PostalCode"),user=require("../data/userProfile").data,users=require("../data/users"),serviceAddresses=require("../data/serviceAddresses"),showTextEditor=require("../modals/textEditor").show,showError=require("../modals/error").show,stepsLabels={services:"Select offering(s)",selectLocation:"Select location",selectTimes:"Select preferred time(s)",selectTime:"Select time",payment:"Complete payment",confirm:"Confirm booking"};module.exports=BaseClientBookingCardVM;BaseClientBookingCardVM.prototype.loadServices=function(){var b=this.booking();this.serviceProfessionalServices.preSelectedServices(this.booking().pricingSummary().details().map(function(s){return s.model.toPlainObject()}));var spid=b.serviceProfessionalUserID(),jid=b.jobTitleID();if(this.serviceProfessionalServices.serviceProfessionalID()!==spid||this.serviceProfessionalServices.jobTitleID()!==jid){var servicesPromise=users.getServiceProfessionalServices(spid,jid);return this.serviceProfessionalServices.loadData(spid,jid,servicesPromise)}};BaseClientBookingCardVM.prototype.loadServiceAddresses=function(){var add=this.booking().serviceAddress();add&&add.addressID()&&this.serviceAddresses.selectedAddress(add);this.serviceAddresses.sourceAddresses([]);this.isLoadingServiceAddresses(!0);return users.getServiceAddresses(this.booking().serviceProfessionalUserID(),this.booking().jobTitleID()).then(function(list){this.serviceAddresses.sourceAddresses(serviceAddresses.asModel(list));return this.serviceAddresses.serviceAreas().length&&!this.isAnonymous()?serviceAddresses.getList(0):null}.bind(this)).then(function(clientList){clientList&&this.clientAddresses.sourceAddresses(clientList.map(function(a){a.isServiceLocation=!0;return serviceAddresses.asModel(a)}.bind(this)));this.isLoadingServiceAddresses(!1)}.bind(this)).catch(function(err){this.isLoadingServiceAddresses(!1);showError({error:err})}.bind(this))};BaseClientBookingCardVM.prototype.prepareDatePicker=function(fieldToBeSelected){this.timeFieldToBeSelected(fieldToBeSelected);var picker=this.serviceStartDatePickerView();picker.selectedDatetime(null);picker.userID(this.booking().serviceProfessionalUserID());picker.selectedDate(new Date);var ptz=this.serviceProfessionalInfo().profile().timeZone();picker.specialTimeZones([{id:ptz,label:"Service Professional's Time Zone ("+ptz+")"}]);picker.timeZone(ptz)}},{"../data/appPresets":259,"../data/serviceAddresses":300,"../data/userProfile":309,"../data/users":311,"../modals/error":343,"../modals/textEditor":347,"../models/Address":353,"../models/Booking.editable":355,"../models/EventDates":364,"../models/PublicUser":398,"../utils/ModelVersion":437,"../viewmodels/BookingProgress":488,"../viewmodels/PostalCode":502,"../viewmodels/ServiceAddresses":505,"../viewmodels/ServiceListGroupFactories":508,"../viewmodels/ServiceProfessionalService":509,knockout:15}],509:[function(require,module,exports){"use strict";function ServiceProfessionalServiceViewModel(app){EventEmitter.call(this);this.list=ko.observableArray([]);this.jobTitleID=ko.observable(0);this.serviceProfessionalID=ko.observable(null);this.jobTitle=ko.observable(null);this.pricingTypes=ko.observableArray([]);this.isAdditionMode=ko.observable(!1);this.isSelectionMode=ko.observable(!1);this.selectedServices=ko.observableArray([]);this.preSelectedServices=ko.observableArray([]);this.isLoading=ko.observable(!1);this.reset=function(){this.isLoading(!1);this.list([]);this.jobTitleID(0);this.pricingTypes([]);this.serviceProfessionalID(null);this.jobTitle(null);this.isAdditionMode(!1);this.isSelectionMode(!1);this.selectedServices([]);this.preSelectedServices([])};this.serviceListGroupsFactory=function(){return[]};this.serviceListGroups=ko.computed(function(){return this.serviceListGroupsFactory(this.list(),this.pricingTypes())},this);var toggleAtSelectedServices=function(service){var inIndex=-1;this.selectedServices().some(function(item,index){if(item===service){inIndex=index;return!0}})?this.selectedServices.splice(inIndex,1):this.selectedServices.push(service)}.bind(this);this.toggleServiceSelection=function(service){service.isSelected(!service.isSelected());toggleAtSelectedServices(service)}.bind(this);this.editServiceURL=function(jobTitleID,serviceID){return"#!serviceProfessionalServiceEditor/"+jobTitleID+"/"+serviceID}.bind(this);this.editServiceRequest=function(){return{}}.bind(this);this.editService=function(service){app.shell.go(this.editServiceURL(this.jobTitleID(),service.serviceProfessionalServiceID()),this.editServiceRequest())}.bind(this);this.tapService=function(service,event){this.isSelectionMode()?this.toggleServiceSelection(service):this.editService(service);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.onCheckboxChange=function(service){toggleAtSelectedServices(service)}.bind(this);this.newServiceURL=function(jobTitleID,pricingTypeID){return"#!serviceProfessionalServiceEditor/"+jobTitleID+"/pricingType/"+pricingTypeID+"/new"}.bind(this);this.newServiceRequest=function(){return{}}.bind(this);this.tapNewService=function(newButton,event){var url=this.newServiceURL(this.jobTitleID(),newButton.pricingTypeID,newButton.isClientSpecific),request=$.extend({},this.newServiceRequest(),{selectedJobTitleID:this.jobTitleID()});this.isSelectionMode()&&(request.selectedServices=this.selectedServices().map(this.selectedServiceRequest));app.shell.go(url,request);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.selectedServiceRequest=function(pricing){return{serviceProfessionalServiceID:ko.unwrap(pricing.serviceProfessionalServiceID),totalPrice:ko.unwrap(pricing.totalPrice)}};this.loadData=function(serviceProfessionalID,jobTitleID,servicesPromise){this.serviceProfessionalID(serviceProfessionalID);this.jobTitleID(jobTitleID);this.isLoading(!0);return jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.jobTitle(jobTitle);var pricingTypeIDs=jobTitle.pricingTypes().map(function(type){return type.pricingTypeID()});return pricingTypes.getListByIDs(pricingTypeIDs)}.bind(this)).then(function(pricingTypes){this.pricingTypes(pricingTypes);return servicesPromise}.bind(this)).then(function(list){list=serviceProfessionalServices.asModel(list);var preset=this.preSelectedServices(),selection=this.selectedServices;list.forEach(function(item){var preSelected=preset.some(function(pr){if(pr.serviceProfessionalServiceID===item.serviceProfessionalServiceID())return!0})||!1;item.isSelected=ko.observable(preSelected);preSelected&&selection.push(item)});this.list(list);this.isLoading(!1);this.emit("loaded")}.bind(this)).catch(function(err){this.isLoading(!1);showError({title:"There was an error while loading.",error:err})}.bind(this))}.bind(this);this.clearData=function(){this.serviceProfessionalID(null);this.list([]);this.jobTitle(null)}.bind(this)}var ko=require("knockout"),$=require("jquery"),EventEmitter=require("events").EventEmitter,jobTitles=require("../data/jobTitles"),pricingTypes=require("../data/pricingTypes"),serviceProfessionalServices=require("../data/serviceProfessionalServices"),showError=require("../modals/error").show;ServiceProfessionalServiceViewModel._inherits(EventEmitter);module.exports=ServiceProfessionalServiceViewModel},{"../data/jobTitles":286,"../data/pricingTypes":296,"../data/serviceProfessionalServices":302,"../modals/error":343,events:12,jquery:14,knockout:15}],296:[function(require,module,exports){"use strict";var PricingType=require("../models/PricingType"),session=require("./session"),ListRemoteModel=require("./helpers/ListRemoteModel"),remote=require("./drivers/restClient"),api=new ListRemoteModel({listTtl:{days:1},itemIdField:"pricingTypeID",Model:PricingType});module.exports=api;api.addLocalforageSupport("pricing-types");api.addRestSupport(remote,"pricing-types");session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()});api.getListByIDs=function(pricingTypeIDs){return api.getList().then(function(pricingTypes){return pricingTypes().filter(function(pricingType){return pricingTypeIDs.indexOf(pricingType.pricingTypeID())>-1})})}},{"../models/PricingType":395,"./drivers/restClient":271,"./helpers/ListRemoteModel":282,"./session":303}],395:[function(require,module,exports){"use strict";function PricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,singularName:"",pluralName:"",slugName:"",addNewLabel:null,serviceProfessionalDescription:null,priceCalculation:null,isAddon:!1,namePlaceHolder:null,suggestedName:null,fixedName:null,durationLabel:null,priceLabel:null,priceNote:null,firstTimeClientsOnlyLabel:null,descriptionPlaceHolder:null,priceRateQuantityLabel:null,priceRateUnitLabel:null,noPriceRateLabel:null,numberOfSessionsLabel:null,inPersonPhoneLabel:null,successOnDelete:null,errorOnDelete:null,successOnSave:null,errorOnSave:null,priceRateIsRequiredValidationError:null,priceRateUnitIsRequiredValidationError:null,learnMoreLabel:null,learnMoreText:null,priceRateLearnMoreLabel:null,priceRateLearnMoreText:null,noPriceRateLearnMoreLabel:null,noPriceRateLearnMoreText:null,requireDuration:!1,includeServiceAttributes:!1,includeSpecialPromotion:!1,summaryFormat:null,summaryFormatMultipleSessions:null,summaryFormatNoDuration:null,summaryFormatMultipleSessionsNoDuration:null,withoutServiceAttributesClientMessage:null,withoutServiceAttributesServiceProfessionalMessage:null,firstTimeClientsOnlyListText:null,priceRateQuantityListLabel:null,priceRateUnitListLabel:null,noPriceRateListMessage:null,nameAndSummaryFormat:null,nameAndSummaryFormatMultipleSessions:null,nameAndSummaryFormatNoDuration:null,nameAndSummaryFormatMultipleSessionsNoDuration:null,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID"])}var Model=require("./Model");module.exports=PricingType;var PriceCalculationType={FixedPrice:1,HourlyPrice:2};PricingType.PriceCalculationType=PriceCalculationType},{"./Model":386}],508:[function(require,module,exports){"use strict";var ServiceCollection=require("../models/ServiceCollection"),ServiceListGroup=require("./ServiceListGroup"),ServiceList=require("./ServiceList"),$=require("jquery"),Factories={},ClientBookedServicesListGroup=function(options){ServiceListGroup.call(this,options)};ClientBookedServicesListGroup._inherits(ServiceListGroup);ClientBookedServicesListGroup.prototype.listTitle=function(options){return(options.pricingType&&options.pricingType.pluralName()||"Services")+(this.isClientSpecific?" Just For You":"")};ClientBookedServicesListGroup.prototype.newButtons=function(){return[]};Factories.clientBookedServices=function(services,pricingTypes){var serviceCollection=new ServiceCollection(services),options={pricingTypes:pricingTypes};return[new ClientBookedServicesListGroup($.extend(options,{services:serviceCollection.clientSpecificServices(),isClientSpecific:!0})),new ClientBookedServicesListGroup($.extend(options,{services:serviceCollection.publicServices(),isClientSpecific:!1}))]};var ProviderBookedServicesListGroup=function(options){ServiceListGroup.call(this,options)};ProviderBookedServicesListGroup._inherits(ServiceListGroup);ProviderBookedServicesListGroup.prototype.listTitle=function(options){return options.pricingType&&options.pricingType.pluralName()||"Services"};var ProviderBookedClientServicesListGroup=function(options){this.clientName=options.clientName;this.pricingTypes=options.pricingTypes;this.services=options.services;this.title="Offerings only available to "+options.clientName};ProviderBookedClientServicesListGroup.prototype.newButtons=function(){var clientName=this.clientName;return this.pricingTypes.map(function(pricingType){return new ServiceList.NewButton({label:pricingType.addNewLabel()+" just for "+clientName,pricingTypeID:pricingType.pricingTypeID(),isClientSpecific:!0})})};ProviderBookedClientServicesListGroup.prototype.serviceLists=function(){return[new ServiceList({services:this.services,title:"",newButtons:this.newButtons()})]};Factories.providerBookedServices=function(services,pricingTypes,clientName){services=new ServiceCollection(services);var options={pricingTypes:pricingTypes};return[new ProviderBookedClientServicesListGroup($.extend(options,{services:services.clientSpecificServices(),clientName:clientName})),new ProviderBookedServicesListGroup($.extend(options,{services:services.publicServices(),isClientSpecific:!1,defaultPricingTypes:pricingTypes,title:"Offerings Available to Everyone"}))]};var ProviderManagedServicesListGroup=function(options){this.clientName=options.clientName;ServiceListGroup.call(this,options)};ProviderManagedServicesListGroup._inherits(ServiceListGroup);ProviderManagedServicesListGroup.prototype.listTitle=function(options){var clientPostfix=this.clientName.length>0?" for "+this.clientName:"",pricingType=options.pricingType;return(pricingType&&pricingType.pluralName()||"Services")+clientPostfix};Factories.providerManagedServices=function(services,pricingTypes,clientName,isClientSpecific){return[new ProviderManagedServicesListGroup({services:services,clientName:clientName,pricingTypes:pricingTypes,defaultPricingTypes:pricingTypes,isClientSpecific:isClientSpecific})]};module.exports=Factories},{"../models/ServiceCollection":412,"./ServiceList":506,"./ServiceListGroup":507,jquery:14}],507:[function(require,module,exports){"use strict";var groupBy=require("../utils/groupBy"),mapBy=require("../utils/mapBy"),ServiceList=require("./ServiceList"),$=require("jquery"),ServiceListGroup=function(options){var optionsDefaults={title:"",services:[],pricingTypes:[],defaultPricingTypes:[],isClientSpecific:!1};options=$.extend(optionsDefaults,options);this.title=options.title;this.services=options.services;this.pricingTypes=options.pricingTypes;this.defaultPricingTypes=options.defaultPricingTypes;this.isClientSpecific=options.isClientSpecific};ServiceListGroup.prototype.serviceLists=function(){var groups=groupBy(this.services,function(service){return service.pricingTypeID()},this.defaultGroups());return Object.keys(groups).map(function(pricingTypeID){var pricingType=this.pricingTypesByID()[pricingTypeID],listTitle=this.listTitle({pricingType:pricingType});return new ServiceList({services:groups[pricingTypeID],title:listTitle,newButtons:this.newButtons({pricingType:pricingType})})}.bind(this))};ServiceListGroup.prototype.listTitle=function(options){return options.pricingType.pluralName()||"Services"};ServiceListGroup.prototype.newButtonLabel=function(options){return options.pricingType.addNewLabel()};ServiceListGroup.prototype.newButtons=function(options){var newButtonOptions={label:this.newButtonLabel({pricingType:options.pricingType}),pricingTypeID:options.pricingType.pricingTypeID(),isClientSpecific:this.isClientSpecific};return[new ServiceList.NewButton(newButtonOptions)]};ServiceListGroup.prototype.defaultGroups=function(){return this.defaultPricingTypes.map(function(type){return type.pricingTypeID()})};ServiceListGroup.prototype.pricingTypesByID=function(){return mapBy(this.pricingTypes,function(type){return type.pricingTypeID()})};module.exports=ServiceListGroup},{"../utils/groupBy":458,"../utils/mapBy":463,"./ServiceList":506,jquery:14}],463:[function(require,module,exports){"use strict";function mapBy(collection,mapping){var mapped={};collection.forEach(function(object){mapped[mapping(object)]=object});return mapped}module.exports=mapBy},{}],458:[function(require,module,exports){"use strict";function groupBy(collection,iteratee,defaultKeys){var defaultGroups={};(defaultKeys=defaultKeys||[]).forEach(function(key){defaultGroups[key]=[]});return $.extend(defaultGroups,lodashGroupBy(collection,iteratee))}var lodashGroupBy=require("lodash/groupBy"),$=require("jquery");module.exports=groupBy},{jquery:14,"lodash/groupBy":123}],506:[function(require,module,exports){"use strict";var ServiceList=function(options){this.services=options.services;this.title=options.title;this.newButtons=options.newButtons||[]};ServiceList.NewButton=function(options){this.label=options.label;this.pricingTypeID=options.pricingTypeID;this.isClientSpecific=options.isClientSpecific};module.exports=ServiceList},{}],412:[function(require,module,exports){"use strict";var ServiceCollection=function(services){this.services=services};ServiceCollection.prototype.clientSpecificServices=function(){return this.services.filter(function(s){return s.isClientSpecific()})};ServiceCollection.prototype.publicServices=function(){return this.services.filter(function(s){return!s.isClientSpecific()})};module.exports=ServiceCollection},{}],505:[function(require,module,exports){"use strict";function ServiceAddressesViewModel(){this.isSelectionMode=ko.observable(!1);this.sourceAddresses=ko.observableArray([]);this.selectedAddress=ko.observable(null);this.reset=function(){this.isSelectionMode(!1);this.sourceAddresses([]);this.selectedAddress(null)};this.addresses=ko.pureComputed(function(){var list=this.sourceAddresses();this.isSelectionMode()&&(list=list.filter(function(add){return add.isServiceLocation()}));return list},this);this.hasAddresses=ko.pureComputed(function(){var adds=this.addresses();return adds&&adds.length>0},this);this.serviceAreas=ko.pureComputed(function(){return this.sourceAddresses().filter(function(add){return add.isServiceArea()})},this);this.selectAddress=function(selectedAddress,event){this.selectedAddress(selectedAddress);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.selectedAddressID=ko.pureComputed({read:function(){var add=this.selectedAddress();return add&&ko.unwrap(add.addressID)||null},write:function(id){var selAdd=null;this.addresses().some(function(add){if(ko.unwrap(add.addressID)==id){selAdd=add;return!0}});this.selectedAddress(selAdd)},owner:this});this.observerSelected=function(item){return ko.pureComputed(function(){return(this.selectedAddress()&&ko.unwrap(this.selectedAddress().addressID))===(item&&ko.unwrap(item.addressID))},this)}.bind(this);this.presetSelectedAddressID=function(addressID){if(this.isSelectionMode()){this.selectedAddress(null);this.addresses().some(function(add){if(add.addressID()===addressID){this.selectedAddress(add);return!0}}.bind(this))}}.bind(this)}var ko=require("knockout");module.exports=ServiceAddressesViewModel},{knockout:15}],488:[function(require,module,exports){"use strict";function BookingProgress(values){Model(this);this.model.defProperties({currentStep:"",stepsList:[]},values);this.step=ko.pureComputed({read:function(){return this.stepsList().indexOf(this.currentStep())},write:function(index){var name=this.stepsList()[index]||"";this.currentStep(name)},owner:this});this.totalSteps=ko.pureComputed(function(){return this.stepsList().length},this);var maxStepReachedEver=ko.observable(-1);ko.computed(function(){var s=this.step();s>maxStepReachedEver()&&maxStepReachedEver(s)},this);this.ended=ko.pureComputed(function(){return this.totalSteps()-1<=maxStepReachedEver()},this);this.reset=function(){maxStepReachedEver(-1);this.currentStep("");return this}}var Model=require("../models/Model"),ko=require("knockout");module.exports=BookingProgress;BookingProgress.prototype.next=function(){if(this.ended())this.step(this.totalSteps()-1);else{var step=Math.max(0,Math.min(this.step()+1,this.totalSteps()-1));this.step(step)}return this};BookingProgress.prototype.observeStep=function(stepName){return ko.pureComputed(function(){return this.currentStep()===stepName},this)};BookingProgress.prototype.isStep=function(stepName){return this.currentStep()===stepName};BookingProgress.prototype.go=function(stepName){this.currentStep(stepName);return this}},{"../models/Model":386,knockout:15}],355:[function(require,module,exports){"use strict";var Booking=require("./Booking");module.exports=Booking;var PricingSummary=require("./PricingSummary.editable");Booking.editable=function(obj){var booking;booking=obj&&obj instanceof Booking?obj:new Booking(obj&&obj.model&&obj.model.toPlainObject?obj.model.toPlainObject(!0):obj);PricingSummary.editable(booking.pricingSummary());booking.connectToSelectableServicesView=function(serviceProfessionalServices){this.pricingSummary().connectToSelectableServicesView(serviceProfessionalServices)}}},{"./Booking":356,"./PricingSummary.editable":392}],392:[function(require,module,exports){"use strict";var PricingSummary=require("./PricingSummary");module.exports=PricingSummary;var ko=require("knockout"),numeral=require("numeral"),PricingSummaryDetail=require("./PricingSummaryDetail");PricingSummary.editable=function(obj){var pricingSummary;(pricingSummary=obj&&obj instanceof PricingSummary?obj:new PricingSummary(obj&&obj.model&&obj.model.toPlainObject?obj.model.toPlainObject(!0):obj)).gratuityPercentage=ko.observable(0);pricingSummary.gratuityAmount=ko.observable(0);pricingSummary.gratuity=ko.pureComputed(function(){var percentage=0|this.gratuityPercentage(),amount=0|this.gratuityAmount();return percentage>0?this.subtotalPrice()*(percentage/100):amount<0?0:amount},pricingSummary);ko.computed(function(){var r=this.details().reduce(function(total,item){return total+=item.price()},0);this.subtotalPrice(r)},pricingSummary);ko.computed(function(){var t=+this.subtotalPrice(),f=+this.firstTimeServiceFeeFixed(),p=+this.firstTimeServiceFeePercentage(),min=+this.firstTimeServiceFeeMinimum(),max=+this.firstTimeServiceFeeMaximum();if(0===t)this.clientServiceFeePrice(0);else{var a=Math.round(100*(f+p/100*t))/100,r=Math.min(Math.max(a,min),max);this.clientServiceFeePrice(r)}},pricingSummary);ko.computed(function(){var r=this.subtotalPrice()+this.clientServiceFeePrice()+this.gratuity();this.totalPrice(r)},pricingSummary);ko.computed(function(){var r=this.details().reduce(function(total,item){return total+=item.serviceDurationMinutes()},0);this.serviceDurationMinutes(r)},pricingSummary);ko.computed(function(){var r=this.details().reduce(function(total,item){return total+=item.firstSessionDurationMinutes()},0);this.firstSessionDurationMinutes(r)},pricingSummary);pricingSummary.feesMessage=ko.pureComputed(function(){var f=numeral(this.clientServiceFeePrice()).format("$#,##0.00");return"*The first-time __fees__ booking fee applies only to the very first time you connect with a professional and helps cover costs of running the marketplace. There are no fees for subsequent bookings with this professional.".replace(/__fees__/g,f)},pricingSummary);pricingSummary.items=ko.pureComputed(function(){var items=this.details().slice(),gratuity=this.gratuity();if(gratuity>0){var gratuityLabel=this.gratuityPercentage()?"Gratuity (__gratuity__%)".replace(/__gratuity__/g,0|this.gratuityPercentage()):"Gratuity";items.push(new PricingSummaryDetail({serviceName:gratuityLabel,price:gratuity}))}var fees=this.clientServiceFeePrice();if(fees>0){var feesLabel="First-time booking fee*";items.push(new PricingSummaryDetail({serviceName:feesLabel,price:fees}))}return items},pricingSummary);var duration2Language=require("../utils/duration2Language");pricingSummary.serviceDurationDisplay=ko.pureComputed(function(){return duration2Language({minutes:this.serviceDurationMinutes()})},pricingSummary);pricingSummary.firstSessionDurationDisplay=ko.pureComputed(function(){return duration2Language({minutes:this.firstSessionDurationMinutes()})},pricingSummary);pricingSummary.connectToSelectableServicesView=function(serviceProfessionalServices){serviceProfessionalServices.selectedServices.subscribe(function(services){this.details(services.map(function(service){return PricingSummaryDetail.fromServiceProfessionalService(service)}))},this)}}},{"../utils/duration2Language":450,"./PricingSummary":393,"./PricingSummaryDetail":394,knockout:15,numeral:146}],311:[function(require,module,exports){"use strict";var GroupRemoteModel=require("./helpers/GroupRemoteModel"),PublicUserProfile=require("../models/PublicUserProfile"),remote=require("./drivers/restClient"),cancellationPolicies=require("./cancellationPolicies");exports.getUser=function(userID,options){return remote.get("users/"+(0|userID),options).then(function(user){var policiesPerJobTitle=user.jobProfile.map(function(userJobTitle){return cancellationPolicies.getItem(userJobTitle.cancellationPolicyID)});return Promise.all(policiesPerJobTitle).then(function(policies){user.jobProfile.forEach(function(userJobTitle,index){userJobTitle.cancellationPolicy=policies[index]});return user})})};var profile=new GroupRemoteModel({ttl:{minutes:10},Model:PublicUserProfile,itemIdField:"userID"});profile.addRestSupport(remote,"users/","/profile");profile.addLocalforageSupport("userProfiles/");exports.getProfile=function(userID){return profile.getItem(userID)};exports.getJobProfile=function(userID){return remote.get("users/"+(0|userID)+"/job-profile")};exports.getJobTitle=function(userID,jobTitleID){return remote.get("users/"+(0|userID)+"/job-profile/"+(0|jobTitleID))};var getRatings=function getRatings(modifier,userID){return remote.get("users/"+(0|userID)+"/ratings"+(modifier?"/"+modifier:""))};exports.getUserRatings=getRatings.bind(exports,null);exports.getClientRatings=getRatings.bind(exports,"client");exports.getServiceProfessionalRatings=getRatings.bind(exports,"service-professional");exports.getJobTitleRatings=function(userID,jobTitleID){return getRatings(0|jobTitleID,userID)};exports.getServiceAddresses=function(userID,jobTitleID){return remote.get("users/"+(0|userID)+"/service-addresses/"+(0|jobTitleID))};exports.getServiceProfessionalServices=function(serviceProfessionalUserID,jobTitleID){return remote.get("users/"+(0|serviceProfessionalUserID)+"/service-professional-services/"+(0|jobTitleID))};var getVerificationsSummary=function getVerificationsSummary(modifier,userID){return remote.get("users/"+(0|userID)+"/verifications-summary"+(modifier?"/"+modifier:""))};exports.getUserVerificationsSummary=getVerificationsSummary.bind(exports,null);exports.getClientVerificationsSummary=getVerificationsSummary.bind(exports,"client");exports.getServiceProfessionalVerificationsSummary=getVerificationsSummary.bind(exports,"service-professional");exports.getJobTitleVerificationsSummary=function(userID,jobTitleID){return getVerificationsSummary(0|jobTitleID,userID)};exports.getServiceAttributes=function getServiceAttributes(userID,jobTitleID){return remote.get("users/"+(0|userID)+"/service-attributes/"+(0|jobTitleID))};exports.getReviews=function getReviews(userID,jobTitleID,options){return remote.get("users/"+(0|userID)+"/reviews"+(jobTitleID?"/"+(0|jobTitleID):""),options)}},{"../models/PublicUserProfile":402,"./cancellationPolicies":266,"./drivers/restClient":271,"./helpers/GroupRemoteModel":279}],279:[function(require,module,exports){"use strict";function required(val,msg){if(null===val||void 0===val)throw new Error(msg||"Required parameter");return val}function GroupRemoteModel(settings){function notImplemented(){throw new Error("Not Implemented")}(settings=settings||{}).ttl=required(settings.ttl,"ttl is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=required(settings.Model,"Model is required");this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache={},getCacheItem=function(id){var c=cache[id];c||(c=cache[id]=new CacheControl({ttl:settings.ttl}));return c},setCacheItem=function(id,rawData){var c=getCacheItem(id);c.data?c.data.model.updateWith(rawData,!0):c.data=new settings.Model(rawData);c.touch();return c};this.clearCache=function(){cache={}};this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);this.fetchItemFromLocal=notImplemented;this.fetchItemFromRemote=notImplemented;this.pushItemToLocal=notImplemented;this.pushItemToRemote=notImplemented;this.removeItemFromLocal=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;api.getItem=function getItem(itemID,forceRemoteLoad){var cacheEntry=getCacheItem(itemID);if(cacheEntry.request)return cacheEntry.request;if(forceRemoteLoad||cacheEntry.mustRevalidate()){if(cacheEntry.data){api.state.isSyncing(!0);cacheEntry.request=this.fetchItemFromRemote(itemID).then(function(data){var cached=setCacheItem(itemID,data);this.pushItemToLocal(itemID,data);api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;return cached.data}.bind(this)).catch(function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}api.state.isLoading(!0);cacheEntry.request=this.fetchItemFromLocal(itemID).then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchItemFromRemote(itemID).then(function(serverData){var cached=setCacheItem(itemID,serverData);this.pushItemToLocal(itemID,serverData);api.state.isSyncing(!1);return cached.data}.bind(this));return data||remotePromise}.bind(this)).then(function(data){var cached=setCacheItem(itemID,data);api.state.isLoading(!1);cacheEntry.request=null;return cached.data}.bind(this)).catch(function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}return Promise.resolve(cacheEntry.data)};api.setItem=function setItem(data){data=data&&data.model&&data.model.toPlainObject(!0)||data;api.state.isSaving(!0);return this.pushItemToRemote(data[settings.itemIdField],data).then(function(serverData){var cached;if(serverData){var itemID=serverData[settings.itemIdField];cached=setCacheItem(serverData[settings.itemIdField],serverData);this.pushItemToLocal(itemID,cached.data.model.toPlainObject(!0))}api.state.isSaving(!1);return cached&&cached.data}.bind(this)).catch(function(err){api.state.isSaving(!1);throw err})};api.delItem=function delItem(itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(itemID).then(function(removedData){delete cache[itemID];this.removeItemFromLocal(itemID);api.state.isDeleting(!1);return removedData}.bind(this)).catch(function(err){api.state.isDeleting(!1);throw err})};var ModelVersion=require("../../utils/ModelVersion");api.getItemVersion=function getItemVersion(itemID){var cached=cache[itemID],initialModel=cached&&cached.data||new settings.Model,version=new ModelVersion(initialModel);version.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),lastError:ko.observable(null)};if(itemID&&(!cached||cached.mustRevalidate())){version.state.isLoading(!0);api.getItem(itemID).then(function(model){version.state.lastError(null);version.state.isLoading(!1);version.original.model.updateWith(model,!0);version.version.model.updateWith(model,!0)}).catch(function(err){version.state.lastError(err);version.state.isLoading(!1)})}version.load=function load(newItemID,forceRemoteLoad){version.state.isSyncing(!0);var oItemID=newItemID||version.original[settings.itemIdField]();return api.getItem(oItemID,forceRemoteLoad).then(function(model){version.state.lastError(null);version.state.isSyncing(!1);version.original.model.updateWith(model,!0);version.pull({evenIfNewer:!0});return model}).catch(function(err){version.state.lastError(err);version.state.isSyncing(!1);throw err})};version.reset=function reset(){version.original.model.reset();version.version.model.reset()};version.save=function save(){version.state.isSaving(!0);return api.setItem(version.version).then(function(model){version.state.lastError(null);version.state.isSaving(!1);version.version.model.updateWith(model,!0);version.push({evenIfObsolete:!0});return model}).catch(function(err){version.state.lastError(err);version.state.isSaving(!1);throw err})};return version};api.newItemVersion=function newItemVersion(values){var version=api.getItemVersion();values&&version.version.model.updateWith(values,!0);version.version.model.touch();return version}}var ko=require("knockout"),CacheControl=require("./CacheControl");module.exports=GroupRemoteModel;GroupRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("../drivers/localforage");this.fetchItemFromLocal=function fetchFromLocal(itemID){return localforage.getItem(baseName+itemID)};this.pushItemToLocal=function pushToLocal(itemID,data){return localforage.setItem(baseName+itemID,data)};this.remoteItemFromLocal=function remoteFromLocal(itemID){return localforage.removeItem(baseName+itemID)}};GroupRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl,suffixUrl){suffixUrl=suffixUrl||"";this.fetchItemFromRemote=function fetchFromRemote(itemID){return restClient.get(baseUrl+itemID+suffixUrl)};this.pushItemToRemote=function pushToRemote(itemID,data){var method=itemID?"put":"post",url=baseUrl+(itemID?"/"+itemID:"")+suffixUrl;return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return restClient.delete(baseUrl+itemID+suffixUrl)}}},{"../../utils/ModelVersion":437,"../drivers/localforage":270,"./CacheControl":276,knockout:15}],266:[function(require,module,exports){"use strict";var CancellationPolicy=require("../models/CancellationPolicy"),ListRemoteModel=require("./helpers/ListRemoteModel"),session=require("./session"),data=[{cancellationPolicyID:3,name:"Flexible",description:"No cancellation fees if changed or cancelled at least 24 hours in advance, otherwise a cancellation fee of 50% the price of booked services apply (including no-shows).",hoursRequired:24,cancellationFeeBefore:0,cancellationFeeAfter:.5},{cancellationPolicyID:2,name:"Moderate",description:"No cancellation fees if changed or cancelled at least 24 hours in advance, otherwise a cancellation fee of 100% the price of booked services apply (including no-shows).",hoursRequired:24,cancellationFeeBefore:0,cancellationFeeAfter:1},{cancellationPolicyID:1,name:"Strict",description:"Cancellation fees of 50% of the price of booked services up to 5 days before the booking start time and 100% after.",hoursRequired:120,cancellationFeeBefore:.5,cancellationFeeAfter:1}],api=new ListRemoteModel({listTtl:{days:1},itemIdField:"cancellationPolicyID",Model:CancellationPolicy});module.exports=api;session.on.cacheCleaningRequested.subscribe(function(){});api.list=data;api.getList=function(){return Promise.resolve(api.list)}},{"../models/CancellationPolicy":360,"./helpers/ListRemoteModel":282,"./session":303}],370:[function(require,module,exports){"use strict";function InputPaymentMethod(values){Model(this);this.model.defProperties({paymentMethodID:"",nameOnCard:"",cardNumber:null,expirationMonth:null,expirationYear:null,securityCode:null,billingAddress:{Model:Address},savePayment:!1},values);this.expirationMonthYear=ko.computed({read:function(){var m=this.expirationMonth(),y=this.expirationYear();return m||y?padLeft(m,2,"0")+"/"+padLeft(y,4,"0"):""},write:function(value){var parts=value.split("/");if(2===parts.length){this.expirationMonth(padLeft(0|parts[0],2,"0"));this.expirationYear(padLeft(0|parts[1],4,"0"))}},owner:this})}function padLeft(v,length,padLetter){if(!v)return"";v=v.toString();for(;v.length<length;)v=padLetter+v;return v}var Address=require("./Address"),Model=require("./Model"),ko=require("knockout");module.exports=InputPaymentMethod},{"./Address":353,"./Model":386,knockout:15}],187:[function(require,module,exports){"use strict";function ViewModel(){this.helpLink="/help/relatedArticles/201959943-add-scheduling-to-your-website";this.jobTitleName=ko.observable("Job Title");this.bookCode=ko.computed(function(){return marketplaceProfile.data.bookCode()});this.jobTitleID=ko.observable(0);this.copyText=ko.observable("Copy");this.type=ko.observable("icon");this.type.subscribe(function(){this.copyText("Copy")}.bind(this));this.isLocked=marketplaceProfile.isLocked;var buttonTemplate='\x3c!-- begin Loconomics book-me-button --\x3e<a style="display:inline-block"><img alt="" style="border:none" width="200" height="50" /></a>\x3c!-- end Loconomics book-me-button --\x3e',linkTemplate="\x3c!-- begin Loconomics book-me-button --\x3e<a><span></span></a>\x3c!-- end Loconomics book-me-button --\x3e";this.buttonHtmlCode=ko.pureComputed(function(){if(marketplaceProfile.isLoading())return"loading...";var type=this.type(),tpl=buttonTemplate;"link"===type&&(tpl=linkTemplate);var siteUrl=$("html").attr("data-site-url")||window.location.origin;return generateButtonCode({tpl:tpl,label:"Click here to book me now (on loconomics.com)",linkUrl:siteUrl+"/book/"+this.bookCode()+"/"+this.jobTitleID()+"/",imgUrl:siteUrl+"/img/extern/book-me-now-button.svg"})},this);this.sendByEmailURL=ko.pureComputed(function(){var btn=this.buttonHtmlCode().replace(/\n+/,"");return"mailto:?body="+encodeURIComponent("Loconomics Book Me Now Button HTML code: "+btn)},this);this.userJobTitle=ko.observable(null);this.bookMeButtonReady=ko.pureComputed(function(){var j=this.userJobTitle();return j&&j.bookMeButtonReady()||!1},this);this.collectPaymentAtBookMeButtonString=ko.pureComputed({read:function(){var j=this.userJobTitle();return j&&j.collectPaymentAtBookMeButton()&&"true"||"false"},write:function(val){var j=this.userJobTitle();j&&("true"===val?j.collectPaymentAtBookMeButton(!0):j.collectPaymentAtBookMeButton(!1))},owner:this});this.copyCode=function(){var text=this.buttonHtmlCode(),errMsg=clipboard.copy(text);errMsg?showError({error:errMsg}):this.copyText("Copied!")}.bind(this);this.save=function(){var ujt=this.userJobTitle();if(ujt){var plain=ujt.model.toPlainObject();plain.collectPaymentAtBookMeButton=ujt.collectPaymentAtBookMeButton();userJobProfile.setUserJobTitle(plain).then(function(){}.bind(this)).catch(function(err){showError({title:'Error saving your "collect payment" preference',error:err})}.bind(this))}}.bind(this)}function generateButtonCode(options){var $btn=$($.parseHTML("<div>"+options.tpl+"</div>"));$btn.find("a").attr("href",options.linkUrl).find("span").text(options.label);$btn.find("img").attr("src",options.imgUrl).attr("alt",options.label);return $btn.html()}var Activity=require("../components/Activity"),ko=require("knockout"),$=require("jquery"),clipboard=require("../utils/clipboard"),marketplaceProfile=require("../data/marketplaceProfile"),userJobProfile=require("../data/userJobProfile"),showError=require("../modals/error").show,A=Activity.extend(function BookMeButtonActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Website scheduling",{backLink:"scheduling",helpLink:this.viewModel.helpLink});this.title("Add scheduling to your website");this.registerHandler({target:this.$activity,event:"click",selector:"textarea",handler:function(){$(this).select();this.setSelectionRange(0,99999)}});this.registerHandler({target:marketplaceProfile,event:"error",handler:function(err){err&&"save"===err.task||showError({title:"Error loading data to build the Button.",error:err&&err.task&&err.error||err})}.bind(this)});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID)userJobProfile.getUserJobTitleAndJobTitle(jobTitleID).then(function(job){this.viewModel.userJobTitle(job.userJobTitle);this.viewModel.jobTitleName(job.jobTitle.singularName())}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err})}.bind(this));else{this.viewModel.jobTitleName("Job Title");this.viewModel.userJobTitle(null)}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){this.viewModel.jobTitleID(!1);Activity.prototype.show.call(this,state);marketplaceProfile.sync();var jobID=0|state.route.segments[0];this.viewModel.jobTitleID(jobID);this.viewModel.copyText("Copy")}},{"../components/Activity":255,"../data/marketplaceProfile":289,"../data/userJobProfile":306,"../modals/error":343,"../utils/clipboard":447,jquery:14,knockout:15}],447:[function(require,module,exports){"use strict";function copyText(text){var errMsg;try{if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.clipboard)window.cordova.plugins.clipboard.copy(text);else{var focusedElement=document.activeElement,$code=$('<textarea style="position:absolute;left:-90999px;z-index:-9000"/>"');$code.appendTo("body").val(text).select().get(0).setSelectionRange(0,99999);document.execCommand("copy")||(errMsg="Impossible to copy text.");focusedElement.focus();$code.remove()}}catch(err){console.error("clipboard.copyText",err);errMsg="Impossible to copy text."}return errMsg}var $=require("jquery");exports.copy=function(value){if(null===value||void 0===value)return"Nothing to copy";"number"==typeof value&&(value=value.toString());return"string"==typeof value?copyText(value):"Cannot copy: "+typeof value}},{jquery:14}],289:[function(require,module,exports){"use strict";var MarketplaceProfile=require("../models/MarketplaceProfile"),session=require("./session"),RemoteModel=require("./helpers/RemoteModel"),remote=require("./drivers/restClient"),api=new RemoteModel({data:new MarketplaceProfile,ttl:{minutes:1},localStorageName:"marketplaceProfile",fetch:function fetch(){return remote.get("me/marketplace-profile")},push:function push(){return remote.put("me/marketplace-profile",this.data.model.toPlainObject())}});module.exports=api;session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()})},{"../models/MarketplaceProfile":383,"./drivers/restClient":271,"./helpers/RemoteModel":283,"./session":303}],383:[function(require,module,exports){"use strict";function MarketplaceProfile(values){Model(this);this.model.defProperties({userID:0,publicBio:"",businessName:"",serviceProfessionalProfileUrlSlug:"",serviceProfessionalProfileUrl:"",serviceProfessionalWebsiteUrl:"",bookCode:"",photoUrl:"",hasUploadedPhoto:!1,createdDate:null,updatedDate:null},values)}var Model=require("./Model");module.exports=MarketplaceProfile},{"./Model":386}],186:[function(require,module,exports){"use strict";function ViewModel(){this.helpLink="/help/relatedArticles/201959913-electing-board-members"}var Activity=require("../components/Activity"),A=Activity.extend(function BoardMemberNominationsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel;this.navBar=Activity.createSubsectionNavBar("Cooperative",{backLink:"/ownerInfo",helpLink:this.viewModel.helpLink});this.title("Board nominations")});module.exports=A},{"../components/Activity":255}],185:[function(require,module,exports){"use strict";function ViewModel(){this.blog=ko.observableArray([]);this.searchText=ko.observable("");this.searchDate=ko.observable("");this.searchTags=ko.observable("");this.isLoading=ko.observable(!1);this.params=ko.observable("");this.viewType=ko.observable("");this.tailId=ko.observable("");this.selectedPostId=ko.observable(0);this.fullPostData=ko.pureComputed(function(){var selectedPostId=this.selectedPostId(),result=this.blog().filter(function(post){return post.id()===selectedPostId});return result.length?result[0]:null},this);this.filteredPostsBySearch=ko.pureComputed(function(){var s=this.searchText().toLowerCase();return this.blog().filter(function(v){var n=v&&v.title()||"";n+=v&&v.content()||"";n+=v&&v.date()||"";return(n=(n+=v&&v.tags()||"").toLowerCase()).indexOf(s)>-1})},this);this.filteredPostsByDate=ko.pureComputed(function(){var s=this.searchDate();return this.blog().filter(function(v){var n=v&&v.date()||"";return(n=n.toLowerCase()).indexOf(s)>-1})},this);this.filteredPostsByTags=ko.pureComputed(function(){var s=this.searchTags().toLowerCase();return this.blog().filter(function(v){var n=v&&v.tags()||"";return(n=n.toLowerCase()).indexOf(s)>-1})},this);this.nothingFound=ko.pureComputed(function(){return!this.filteredPostsBySearch().length+("blogView"==this.viewType()&&!this.filteredPostsBySearch().length)},this)}function Post(values){Model(this);this.model.defProperties({id:0,date:"",title:"",author:"",content:"",excerpt:"",tags:"",tail:"",urlPath:""},values)}function slug(str){str=(str=str.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var from="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;'",to="aaaaaeeeeeiiiiooooouuuunc-------",i=0,l=from.length;i<l;i++)str=str.replace(new RegExp(from.charAt(i),"g"),to.charAt(i));return str=str.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}var Activity=require("../components/Activity"),A=Activity.extend(function HelpActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=null;this.navBar=Activity.createSectionNavBar("Blog");this.title("Loconomics blog");this.currentLabels="";this.loadPosts=function(){if(!(this.viewModel.blog().length>0)){var url="https://public-api.wordpress.com/rest/v1.1/sites/loconomics.wordpress.com/posts/"+encodeURIComponent(this.currentLabels);this.viewModel.isLoading(!0);var $=require("jquery");Promise.resolve($.get(url)).then(function(resPosts){resPosts?this.viewModel.blog(resPosts.posts.map(function(post){var tail=post.ID+"-"+slug(post.title);return new Post({id:post.ID,date:post.date,title:post.title,author:post.author.first_name+""+post.author.last_name,content:post.content,excerpt:post.excerpt,tags:post.tags,tail:tail,urlPath:"/blog/posts/"+tail})})):this.viewModel.blog([]);this.viewModel.isLoading(!1)}.bind(this)).catch(function(){this.viewModel.isLoading(!1)}.bind(this))}}.bind(this);this.subSectionFunction={posts:function(tailId){this.viewModel.selectedPostId(parseInt(tailId,10));this.viewModel.viewType("postView")}.bind(this)};this.renderSubSection=function(subSectionPath,tail){var tailId=tail.split("-")[0];""===tailId?"posts"===subSectionPath?this.viewModel.viewType("postView"):this.viewModel.viewType("blogView"):this.subSectionFunction[subSectionPath](tailId)}});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.loadPosts();var params=state&&state.route&&state.route.segments,subSections=["posts"];this.viewModel.viewType("");if(params){var subSectionPath=params[0]||"",tail=params[1]||"";subSections.indexOf(subSectionPath)>-1?this.renderSubSection(subSectionPath,tail):""===subSectionPath?this.viewModel.viewType("blogView"):this.viewModel.viewType("404")}};var ko=require("knockout"),Model=require("../models/Model")},{"../components/Activity":255,"../models/Model":386,jquery:14,knockout:15}],184:[function(require,module,exports){"use strict";function ViewModel(){this.isSyncing=ko.observable(!1);this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.list=ko.observableArray(testdata())}function testdata(){var verA=new BackgroundCheck({name:"Database Search"}),verB=new BackgroundCheck({name:"Basic Criminal"}),verC=new BackgroundCheck({name:"Risk Adverse"}),verD=new BackgroundCheck({name:"Healthcare Check"});return[new UserBackgroundCheck({statusID:Verification.status.confirmed,lastVerifiedDate:new Date(2015,1,12,10,23,32),backgroundCheck:verA}),new UserBackgroundCheck({statusID:Verification.status.revoked,lastVerifiedDate:new Date(2015,5,20,16,4,0),backgroundCheck:verB}),new UserBackgroundCheck({statusID:Verification.status.pending,lastVerifiedDate:new Date(2014,11,30,19,54,4),backgroundCheck:verC}),new UserBackgroundCheck({statusID:Verification.status.obsolete,lastVerifiedDate:new Date(2014,11,30,19,54,4),backgroundCheck:verD})]}function UserBackgroundCheck(values){Model(this);this.model.defProperties({statusID:0,lastVerifiedDate:null,backgroundCheck:{Model:BackgroundCheck}},values);this.statusText=ko.pureComputed(function(){return{"verification.status.confirmed":"Confirmed","verification.status.pending":"Pending","verification.status.revoked":"Revoked","verification.status.obsolete":"Obsolete"}["verification.status."+enumGetName(this.statusID(),Verification.status)]},this);this.isStatus=function(statusName){var id=this.statusID();return Verification.status[statusName]===id}.bind(this)}function BackgroundCheck(values){Model(this);this.model.defProperties({name:""},values)}function enumGetName(value,enumList){var found=null;Object.keys(enumList).some(function(k){if(enumList[k]===value){found=k;return!0}});return found}var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity.extend(function BackgroundCheckActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Marketplace Profile",{backLink:"/marketplaceProfile"});this.title(" Your background checks")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options)};var Verification=function(){};Verification.status={confirmed:1,pending:2,revoked:3,obsolete:4};var Model=require("../models/Model")},{"../components/Activity":255,"../models/Model":386,knockout:15}],183:[function(require,module,exports){"use strict";function findAppointmentInList(list,id){var found=null,index=-1;list.some(function(apt,i){if(apt.id()===id){found=apt;index=i;return!0}});return{item:found,index:index}}function ViewModel(app){this.app=app;this.currentDate=ko.observable(new Date);this.currentID=ko.observable(0);this.currentIndex=ko.observable(0);this.editMode=ko.observable(!1);this.isLoading=ko.observable(!1);this.dateAvailability=ko.observable();this.appointments=ko.pureComputed(function(){var dateAvail=this.dateAvailability();return dateAvail&&dateAvail.appointmentsList()||[]},this);this.specialAppointmentIds=Appointment.specialIds;this.isNewCard=ko.pureComputed(function(){var id=this.currentID();return id===Appointment.specialIds.newBooking||id===Appointment.specialIds.newEvent},this);this.formattedCurrentDate=ko.pureComputed(function(){var date=this.currentDate();return date?moment(date).format("dddd [(]M/D[)]"):""},this);this.defaultBackToCalendarUrl="calendar/";this.backToCalendarUrl=ko.pureComputed(function(){var date=this.currentDate();return date?this.defaultBackToCalendarUrl+date.toISOString():this.defaultBackToCalendarUrl},this);this.appointmentCardView=ko.observable(null);this.isEditButtonVisible=ko.pureComputed(function(){var a=this.appointmentCardView();return this.currentID()>0&&a&&!a.isLocked()&&!a.editMode()},this);var loadingAppointment=new Appointment({id:Appointment.specialIds.loading,summary:"Loading..."}),newEmptyDateAppointment=function newEmptyDateAppointment(){return new Appointment({id:Appointment.specialIds.emptyDate,summary:"You have nothing scheduled",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newUnavailableAppointment=function newUnavailableAppointment(){return new Appointment({id:Appointment.specialIds.unavailable,summary:"You`re unavailable all day",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newFreeAppointment=function newFreeAppointment(){return new Appointment({id:Appointment.specialIds.free,summary:"Free",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newEventAppointment=function newEventAppointment(){return new Appointment({id:Appointment.specialIds.newEvent,summary:"New event...",sourceEvent:new CalendarEvent})},newBookingAppointment=function newBookingAppointment(){return new Appointment({id:Appointment.specialIds.newBooking,summary:"New booking...",sourceEvent:new CalendarEvent,sourceBooking:new Booking})};this.currentAppointment=ko.observable(loadingAppointment);this.updateUrl=function updateUrl(){var apt=this.currentAppointment(),aptId=apt.id(),found=/appointment\/([^\/]+)\/(\-?\d+)/i.exec(window.location),urlId=found&&0|found[2],urlDate=found&&found[1],curDateStr=getDateWithoutTime(apt.startTime()).toISOString();if(!found||urlId!==aptId.toString()||urlDate!==curDateStr){var url="appointment/"+curDateStr+"/"+aptId;""===urlId?this.app.shell.replaceState(null,null,url):this.app.shell.pushState(null,null,url)}};this.goPrevious=function goPrevious(){if(!this.editMode()){var index=this.currentIndex()-1;if(index<0){var m=moment(this.currentDate());m.isValid()||(m=moment(new Date));var prevDate=m.subtract(1,"days").toDate();this.setCurrent(prevDate).then(function(){this.updateUrl()}.bind(this))}else{index%=this.appointments().length;var apt=this.appointments()[index];this.currentIndex(index);this.currentID(apt.id());this.currentAppointment(apt);this.updateUrl()}}};this.goNext=function goNext(){if(!this.editMode()){var index=this.currentIndex()+1;if(index>=this.appointments().length){var m=moment(this.currentDate());m.isValid()||(m=moment(new Date));var nextDate=m.add(1,"days").toDate();this.setCurrent(nextDate).then(function(){this.updateUrl()}.bind(this))}else{index%=this.appointments().length;var apt=this.appointments()[index];this.currentIndex(index);this.currentID(apt.id());this.currentAppointment(apt);this.updateUrl()}}};this.getSpecialItem=function(id){switch(id){default:return newEmptyDateAppointment();case Appointment.specialIds.free:return newFreeAppointment();case Appointment.specialIds.newEvent:return newEventAppointment();case Appointment.specialIds.newBooking:return newBookingAppointment();case Appointment.specialIds.loading:return loadingAppointment;case Appointment.specialIds.unavailable:return newUnavailableAppointment()}};this.setItemFromCurrentList=function(id){var list=this.appointments(),index,item;if(id<-1){item=this.getSpecialItem(id);index=-1}else if(0===list.length){index=-1;item=0===this.dateAvailability().workDayMinutes()?newUnavailableAppointment():newEmptyDateAppointment()}else{item=list[0];index=0;if(id)if(id>0){var found=findAppointmentInList(list,id);if(found.item){item=found.item;index=found.index}}else{item=this.getSpecialItem(id);index=-1}}this.currentID(item.id());this.currentIndex(index);this.currentAppointment(item)};var _setCurrent=function setCurrent(date,id,type){(date=date&&getDateWithoutTime(date)||null)&&this.currentDate(date);if(date){this.isLoading(!0);return calendar.getDateAvailability(date).then(function(dateAvail){this.isLoading(!1);this.dateAvailability(dateAvail);this.setItemFromCurrentList(id)}.bind(this)).catch(function(err){this.isLoading(!1);showError({title:"Error loading calendar events.",error:err})}.bind(this))}if(id>0){this.isLoading(!0);var notFound=function notFound(){this.isLoading(!1);return _setCurrent(new Date)}.bind(this),ids={};"booking"===type?ids.bookingID=id:ids.calendarEventID=id;return calendar.getAppointment(ids).then(function(item){if(item){var itDate=getDateWithoutTime(item.startTime());this.isLoading(!1);return _setCurrent(itDate,item.id())}return notFound()}.bind(this)).catch(notFound)}return id<0?_setCurrent(new Date,id):_setCurrent(new Date)}.bind(this),promiseSetCurrent=Promise.resolve();this.setCurrent=function setCurrent(date,id,type){return promiseSetCurrent=promiseSetCurrent.then(function(){return _setCurrent(date,id,type)})}}require("../components/DatePicker");var $=require("jquery"),moment=require("moment"),Appointment=require("../models/Appointment"),ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime"),AppointmentCardViewModel=require("../viewmodels/AppointmentCard"),Listener=require("../utils/EventEmitterListener"),calendar=require("../data/calendar"),showError=require("../modals/error").show,Activity=require("../components/Activity"),A=Activity.extend(function AppointmentActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.menuItem="calendar";this.$appointmentView=this.$activity.find("#calendarAppointmentView");this.$chooseNew=$("#calendarChooseNew");this.viewModel=new ViewModel(this.app);this.appointmentListeners=[];var backActionSettings={link:this.viewModel.defaultBackToCalendarUrl,icon:Activity.NavAction.goBack.icon(),isTitle:!0,text:"Calendar"};this.navBar=new Activity.NavBar({title:"",leftAction:new Activity.NavAction(backActionSettings),rightAction:Activity.NavAction.goHelpIndex});this.viewModel.cardTitle=ko.pureComputed(function(){return this.appointmentCardView()&&this.appointmentCardView().item()&&this.appointmentCardView().item().summary()||"Appointment"},this.viewModel);this.title=ko.pureComputed(function(){return this.currentID()==this.specialAppointmentIds.newBooking?"Add a new booking":this.currentID()==this.specialAppointmentIds.newEvent?"Add a calendar block":this.isNewCard()?"Add":this.cardTitle()},this.viewModel);ko.computed(function(){var editMode=this.viewModel.editMode(),isNew=this.viewModel.appointmentCardView()&&this.viewModel.appointmentCardView().isNew();if(editMode)if(isNew){var cancelLink=this.viewModel.appointmentCardView();cancelLink=cancelLink&&cancelLink.progress&&cancelLink.progress.cancelLink;this.convertToCancelAction(this.navBar.leftAction(),cancelLink||this.requestData.cancelLink)}else this.navBar.leftAction().model.updateWith({link:null,text:"cancel",handler:this.viewModel.appointmentCardView().confirmCancel.bind(this)});else{var defBackText=backActionSettings.text,link=this.viewModel.backToCalendarUrl(),text=this.viewModel.formattedCurrentDate()||defBackText;this.navBar.leftAction().model.updateWith($.extend({},backActionSettings,{link:link,text:text,handler:null}))}},this);this.registerHandler({target:this.viewModel.currentAppointment,handler:function(apt){if(apt&&(apt.id()===Appointment.specialIds.newBooking||apt.id()===Appointment.specialIds.newEvent)&&!apt.__idDateHandlersAttached){apt.__idDateHandlersAttached=!0;var prevID=apt.id();apt.id.subscribe(function relocateList(){var id=apt.id();if(!(prevID>0||id<=0)){prevID=id;this.viewModel.setCurrent(null,id).then(function(){this.viewModel.updateUrl()}.bind(this))}}.bind(this))}}.bind(this)._delayed(10)});this.registerHandler({target:this.viewModel.currentAppointment,handler:function(){this.registerAppointmentListeners()}.bind(this)});this.registerHandler({target:this.viewModel.appointmentCardView,handler:function(){this.registerAppointmentListeners()}.bind(this)})});exports.init=A.init;A.prototype.registerAppointmentListeners=function(){var listeners=[],events=AppointmentCardViewModel.events,cardView=this.viewModel.appointmentCardView(),viewModel=this.viewModel,app=this.app;this.disposeAppointmentListeners();if(cardView){listeners.push(new Listener(cardView,events.confirmed,function(appointment){viewModel.setCurrent(null,appointment.sourceBooking().bookingID(),"booking")}));listeners.push(new Listener(cardView,events.declined,function(appointment){app.shell.go("calendar/"+appointment.startTime().toISOString())}));listeners.push(new Listener(cardView,events.cancelled,function(appointment){app.shell.go("calendar/"+appointment.startTime().toISOString())}));this.appointmentListeners=listeners}};A.prototype.disposeAppointmentListeners=function(){this.appointmentListeners.forEach(function(listener){listener.dispose()})};A.prototype.show=function show(options){options&&options.appointment?this.resetScroll=!1:this.resetScroll=!0;Activity.prototype.show.call(this,options);if(!this.requestData.cancelLink){var referrer=this.app.shell.referrerRoute,reg=/\/?appointment\/([^\/]*)\/((\-3)|(\-4))/i;(referrer=referrer&&referrer.url)&&reg.test(referrer)&&(referrer=referrer.replace(reg,"/appointment/$1/"));this.requestData.cancelLink=referrer}var s1=options&&options.route&&options.route.segments[0],s2=options&&options.route&&options.route.segments[1],s3=options&&options.route&&options.route.segments[2],date,datetime,id,type;if(/^\-?\d+$/.test(s1)){id=0|s1;type=s2}else{date=getDateWithoutTime(s1);datetime=s1&&new Date(s1)||date;id=0|s2;type=s3}var setupCard=function(){var cardApi=this.viewModel.appointmentCardView();if(cardApi){this.viewModel.appointmentCardView().currentID()<=0&&this.viewModel.appointmentCardView().item().startTime(datetime);cardApi.passIn(this.requestData)}else setTimeout(setupCard,80)}.bind(this);this.viewModel.setCurrent(date,id,type).then(setupCard)};A.prototype.hide=function hide(){Activity.prototype.hide.call(this);this.disposeAppointmentListeners()};var CalendarEvent=require("../models/CalendarEvent"),Booking=require("../models/Booking")},{"../components/Activity":255,"../components/DatePicker":256,"../data/calendar":263,"../modals/error":343,"../models/Appointment":354,"../models/Booking":356,"../models/CalendarEvent":358,"../utils/EventEmitterListener":433,"../utils/getDateWithoutTime":454,"../viewmodels/AppointmentCard":485,jquery:14,knockout:15,moment:145}],433:[function(require,module,exports){"use strict";var EventEmitterListener=function(target,event,handler){this.target=target;this.event=event;this.handler=handler;target.on(event,handler)};EventEmitterListener.prototype.dispose=function(){this.target.removeListener(this.event,this.handler)};module.exports=EventEmitterListener},{}],182:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201965996-setting-your-service-locations-areas";this.isInOnboarding=onboarding.inProgress;this.titleIcon=ko.observable("ion-ios-location-outline");this.formInstructions=ko.observable("");this.errorMessages={postalCode:ko.observable("")};this.jobTitleID=ko.observable(0);this.addressID=ko.observable(0);this.clientUserID=ko.observable(0);this.jobTitleName=ko.observable("Job Title");this.addressVersion=ko.observable(null);this.address=ko.pureComputed(function(){var v=this.addressVersion();return v?v.version:null},this);this.postalCodeVM=new PostalCodeVM({address:this.address,postalCodeError:this.errorMessages.postalCode});this.isLoading=serviceAddresses.state.isLoading;this.isSaving=serviceAddresses.state.isSaving;this.isDeleting=serviceAddresses.state.isDeleting;this.wasRemoved=ko.observable(!1);this.isLocked=ko.computed(function(){return this.isDeleting()||serviceAddresses.state.isLocked()},this);this.isNew=ko.pureComputed(function(){var add=this.address();return!add||!add.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.addressVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.addressVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){this.clientUserID()?this.onSave():serviceAddresses.setItem(this.address().model.toPlainObject()).then(function(serverData){this.address().model.updateWith(serverData);this.addressVersion().push({evenIfObsolete:!0});this.onSave(serverData.addressID)}.bind(this)).catch(function(err){showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){showConfirm({title:"Delete location",message:"Are you sure? This cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){serviceAddresses.delItem(this.jobTitleID(),this.addressID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this)).catch(function(err){showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.serviceRadiusOptions=ko.observableArray([{value:.5,label:"0.5 miles"},{value:1,label:"1 mile"},{value:2,label:"2 miles"},{value:3,label:"3 miles"},{value:4,label:"4 miles"},{value:5,label:"5 miles"},{value:10,label:"10 miles"},{value:25,label:"25 miles"},{value:50,label:"50 miles"},{value:5e3,label:"I work remotely"}])}var ko=require("knockout"),Address=require("../models/Address"),Activity=require("../components/Activity"),PostalCodeVM=require("../viewmodels/PostalCode"),onboarding=require("../data/onboarding"),jobTitles=require("../data/jobTitles"),serviceAddresses=require("../data/serviceAddresses"),showConfirm=require("../modals/confirm").show,showError=require("../modals/error").show,A=Activity.extend(function AddressEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Locations",{backLink:"/scheduling",helpLink:this.viewModel.helpLink});this.title("Edit location");this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){jobTitleID?jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName())}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err})}):this.viewModel.jobTitleName("Job Title")}.bind(this)});this.viewModel.onSave=function(addressID){if(!0===this.requestData.returnNewAsSelected){this.viewModel.clientUserID()?this.requestData.address=this.viewModel.address().model.toPlainObject(!0):this.requestData.addressID=addressID;this.app.shell.goBack(this.requestData)}else if(onboarding.inProgress()){this.app.shell.goBack();setTimeout(function(){onboarding.goNext()},100)}else this.app.successSave()}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/serviceAddresses/"+this.viewModel.jobTitleID();this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.wasRemoved(!1);var params=options&&options.route&&options.route.segments||[],isService=(params[0]||"")===Address.kind.service,jobTitleID=isService?0|params[1]:0,addressID=isService?0|params[2]:0|params[1],serviceType=params[2]||"",clientUserID="clientLocation"===serviceType?params[3]:null;this.viewModel.jobTitleID(jobTitleID);this.viewModel.addressID(addressID);this.viewModel.clientUserID(clientUserID);this.updateNavBarState();if(addressID)serviceAddresses.getItemVersion(jobTitleID,addressID).then(function(addressVersion){if(addressVersion){this.viewModel.addressVersion(addressVersion);var address=addressVersion.original,title=address.isServiceLocation()&&address.kind()==Address.kind.service?"Edit this place of work":"Edit this service area",formInstructions=address.isServiceLocation()&&address.kind()==Address.kind.service?"This is an address of a location where clients come to receive your ":"This is an area where you are willing to go to a client's home or business to perform your ";this.title(title);this.viewModel.formInstructions(formInstructions)}else{this.viewModel.addressVersion(null);this.title("Unknown or deleted location");this.viewModel.formInstructions("")}this.viewModel.postalCodeVM.onFormLoaded()}.bind(this)).catch(function(err){showError({title:"There was an error while loading.",error:err})});else{this.viewModel.addressVersion(serviceAddresses.newItemVersion({jobTitleID:jobTitleID}));this.viewModel.formInstructions("");this.viewModel.postalCodeVM.onFormLoaded();switch(serviceType){case"serviceArea":this.viewModel.address().isServiceArea(!0);this.viewModel.address().isServiceLocation(!1);this.title("Add an area where you work");this.viewModel.titleIcon("ion-pinpoint");this.viewModel.formInstructions("Enter a zip code and a distance from that zip code to create an area where you are willing to go to a client's home or business to perform your ");break;case"serviceLocation":this.viewModel.address().isServiceArea(!1);this.viewModel.address().isServiceLocation(!0);this.title("Add a place where you work");this.viewModel.titleIcon("ion-ios-location-outline");this.viewModel.formInstructions("Enter the address of the location where clients come to receive your ");break;case"clientLocation":this.viewModel.address().userID(clientUserID);this.viewModel.address().isServiceArea(!1);this.viewModel.address().isServiceLocation(!0);this.title("Add a client location");this.viewModel.titleIcon("ion-ios-location-outline");this.viewModel.formInstructions("Enter your client's address where you'll perform your ");break;default:this.viewModel.address().isServiceArea(!0);this.viewModel.address().isServiceLocation(!0);this.title("Add a location for your ");this.viewModel.titleIcon("ion-ios-location-outline")}}}},{"../components/Activity":255,"../data/jobTitles":286,"../data/onboarding":291,"../data/serviceAddresses":300,"../modals/confirm":342,"../modals/error":343,"../models/Address":353,"../viewmodels/PostalCode":502,knockout:15}],181:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=onboarding.inProgress;this.isSaving=ko.observable(!1);this.isLocked=this.isSaving;this.selectedJobTitle=ko.observable(null);this.onSelectJobTitle=function(value,jobTitle){var item=null;item=jobTitle&&jobTitle.jobTitleID?{value:jobTitle.jobTitleID(),label:jobTitle.singularName()}:{value:0,label:value};this.selectedJobTitle(item);return{value:ActionForValue.copySelected}}.bind(this);this.submitText=ko.pureComputed(function(){return onboarding.inProgress()?"Create and continue":this.isSaving()?"Creating...":"Create"},this);this.save=function save(){if(this.selectedJobTitle()){this.isSaving(!0);var becomingProfessional=!user.isServiceProfessional(),jobTitle=this.selectedJobTitle();return userJobProfile.createUserJobTitle({jobTitleID:jobTitle.value,jobTitleName:jobTitle.label}).then(function(result){var onEnd=function onEnd(){this.isSaving(!1);if(onboarding.inProgress()){onboarding.selectedJobTitleID(result.jobTitleID());onboarding.goNext()}else app.shell.go("/listingEditor/"+result.jobTitleID())}.bind(this);if(becomingProfessional)return userProfile.load({forceRemoteUpdate:!0}).then(function(){onEnd()});onEnd()}.bind(this)).catch(function(error){this.isSaving(!1);showError({title:"Unable to create your listing",error:error})}.bind(this))}}.bind(this)}var Activity=require("../components/Activity"),userProfile=require("../data/userProfile"),user=userProfile.data,onboarding=require("../data/onboarding"),userJobProfile=require("../data/userJobProfile"),ActionForValue=require("../kocomponents/job-title-autocomplete").ActionForValue,showError=require("../modals/error").show,ko=require("knockout"),A=Activity.extend(function AddJobTitleActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Scheduler",{backLink:"/marketplaceProfile",helpLink:this.viewModel.helpLink});this.title("Create a new listing");this.helpLink="/help/relatedArticles/201211055-adding-job-profiles";this.viewModel.helpLink=this.helpLink});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url||"/marketplaceProfile";var link=this.requestData.cancelLink||referrer;onboarding.updateNavBar(this.navBar)||this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);if(onboarding.inProgress()&&onboarding.selectedJobTitleID())setTimeout(function(){onboarding.goNext()},10);else{this.updateNavBarState();var s=options.route.query.s;if(s&&"true"===options.route.query.autoAddNew){this.viewModel.selectedJobTitle({value:0|options.route.query.id,label:s});this.viewModel.save()}}}},{"../components/Activity":255,"../data/onboarding":291,"../data/userJobProfile":306,"../data/userProfile":309,"../kocomponents/job-title-autocomplete":316,"../modals/error":343,knockout:15}],316:[function(require,module,exports){"use strict";function ViewModel(params){this.isLoading=ko.observable(!1);this.value=ko.observable();this.queryTerm=ko.pureComputed(function(){var s=this.value();return s&&s.length>=MIN_LENGTH?s:null},this);this.suggestions={jobTitles:ko.observableArray([])};this.suggestions.length=ko.pureComputed(function(){var count=this.suggestions.jobTitles().length;if(this.isAddJobTitle()){var hasQuery=!!this.queryTerm();return Math.max(hasQuery?1:0,this.suggestions.jobTitles().length)}return count},this);"function"==typeof params.value&&this.value.subscribe(params.value);this.onSelect=params.onSelect;this.suggestionButtonText=getObservable(params.suggestionButtonText);this.id=getObservable(params.id);this.label=getObservable(params.label||"Job title");this.visuallyHiddenLabel=getObservable(params.visuallyHiddenLabel);this.target=getObservable(params.target);this.isAddJobTitle=ko.pureComputed(function(){return this.target()===Target.addJobTitle},this);var loadSuggestions=function(){var s=this.value();if(s){this.isLoading(!0);return search.jobTitleAutocomplete(s).then(function(results){results?this.suggestions.jobTitles(results.map(function(item){return new JobTitleSearchResult(item)})):this.suggestions.jobTitles.removeAll();this.isLoading(!1)}.bind(this)).catch(function(err){this.isLoading(!1);if(err&&"abort"===err.statusText)return null}.bind(this))}this.suggestions.jobTitles.removeAll()}.bind(this);ko.computed(function(){loadSuggestions()}).extend({rateLimit:{timeout:120}})}var TAG_NAME="job-title-autocomplete",TEMPLATE=require("../../html/kocomponents/job-title-autocomplete.html"),ko=require("knockout"),getObservable=require("../utils/getObservable");exports.ActionForValue=require("./input-autocomplete").ActionForValue;var JobTitleSearchResult=require("../models/JobTitleSearchResult"),search=require("../data/search"),MIN_LENGTH=3,Target={search:"search",addJobTitle:"addJobTitle"};ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:ViewModel,synchronous:!0});exports.Target=Target},{"../../html/kocomponents/job-title-autocomplete.html":158,"../data/search":299,"../models/JobTitleSearchResult":377,"../utils/getObservable":455,"./input-autocomplete":315,knockout:15}],377:[function(require,module,exports){"use strict";function JobTitleSearchResult(values){Model(this);this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",description:"",searchDescription:"",averageRating:"",totalRatings:"",averageResponseTimeMinutes:0,averageHourlyRate:0,minServicePrice:0,minHourlyRate:0,minServiceValue:"",serviceProfessionalsCount:0},values)}var Model=require("./Model");module.exports=JobTitleSearchResult},{"./Model":386}],315:[function(require,module,exports){"use strict";function ActiveSuggestionManager(activeSuggestionElement,root){return{activeSuggestionElement:activeSuggestionElement,unset:function(element){element&&element.removeAttribute&&element.removeAttribute("aria-selected")},set:function(element){this.unset(this.activeSuggestionElement());element&&element.setAttribute&&element.setAttribute("aria-selected","true");this.activeSuggestionElement(element||null)},fixIndex:function(index,total){return index<0?total-1:index>=total?0:index},shiftTo:function(offset){var el=this.activeSuggestionElement(),suggestions=root.querySelectorAll(SUGGESTION_ATTR_NAME_SELECTOR),activeIndex=(suggestions=Array.prototype.slice.call(suggestions)).indexOf(el);if(activeIndex>-1){var newEl=suggestions[this.fixIndex(activeIndex+offset,suggestions.length)];this.set(newEl)}else this.set(suggestions[0])},SHIFT_TO_NEXT:1,SHIFT_TO_PREVIOUS:-1,clear:function(){this.unset(this.activeSuggestionElement());this.activeSuggestionElement(null)}}}function LiveNotificationManager(notificationText){this.message=notificationText;var NOTIFICATION_DISPOSE_MS=6e3,notifyTimeout=null;this.notify=function(message){if(this.message()!==message){if(notifyTimeout){clearTimeout(notifyTimeout);notifyTimeout=null}this.message(message);notifyTimeout=setTimeout(function(){this.message("")}.bind(this),6e3)}};var AVAILABLE_SUGGESTIONS_ZERO="There are no suggestions.",AVAILABLE_SUGGESTIONS_ONE="There are 1 suggestion.",AVAILABLE_SUGGESTIONS_MORE="There are {0} suggestions.";this.getAvailableSuggestionsMessage=function(count){return count<=0?AVAILABLE_SUGGESTIONS_ZERO:1===count?"There are 1 suggestion.":AVAILABLE_SUGGESTIONS_MORE.replace("{0}",count)};var THROTTLE_SUGGESTIONS_MS=1200,INSTRUCTIONS_MESSAGE="Press down arrow to review the suggestions and then Press enter to select one.",availableSuggestionsTimeout=null;this.notifyAvailableSuggestions=function(count){this.cancelPendingAvailableSuggestionsNotification();availableSuggestionsTimeout=setTimeout(function(){var message=this.getAvailableSuggestionsMessage(count);message+=" "+INSTRUCTIONS_MESSAGE;this.notify(message)}.bind(this),1200)};this.cancelPendingAvailableSuggestionsNotification=function(){if(availableSuggestionsTimeout){clearTimeout(availableSuggestionsTimeout);availableSuggestionsTimeout=null}}}function ViewModel(params,refs,children){this.id=getObservable(params.id);this.name=getObservable(params.name);this.icon=getObservable(params.icon);this.placeholder=getObservable(params.placeholder);this.value=getObservable(params.value);this.suggestions=getObservable(params.suggestions);this.isBusy=getObservable(params.isBusy);this.extraData=ko.unwrap(params.extraData)||{};this.onSelect=function(textValue,contextData){var actions=DEFAULT_ACTIONS_AFTER_SELECT;"function"==typeof params.onSelect&&(actions=extend({},actions,params.onSelect(textValue,contextData)));switch(actions.value){case ActionForValue.clear:this.value("");break;case ActionForValue.copySelected:this.value(textValue);break;case ActionForValue.keepUserInput:break;default:throw new Error("Invalid ActionForValue option:",actions.value)}if(!0===actions.keepExpanded){this.collapsedRequested(!1);this.getInputElement().focus()}else this.collapsedRequested(!0)}.bind(this);this.size=getObservable(params.size);this.isDisabled=getObservable(params.isDisabled);this.notificationText=ko.observable("");this.activeSuggestionElement=ko.observable(null);this.collapsedRequested=ko.observable(!1);this.getInputElement=function getInputElement(){return getInputElement._cached?getInputElement._cached:getInputElement._cached=refs.root.querySelector("input")};this.isExpanded=ko.pureComputed(function(){return!(this.collapsedRequested()||!this.isBusy()&&!ko.unwrap(this.suggestions().length))},this).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}});this.listBoxID=ko.pureComputed(function(){return this.id()+"-input-autocomplete-listBox"},this);this.activeSuggestionData=ko.pureComputed(function(){var el=this.activeSuggestionElement();return el?ko.dataFor(el):null},this);this.activeSuggestionID=ko.pureComputed(function(){var el=this.activeSuggestionElement(),id=el?el.getAttribute("id"):null;el&&!id&&console.error("input-autocomplete: an active suggestion element has not a required ID attribute value",el);return id},this);this.activeSuggestionValue=ko.pureComputed(function(){var el=this.activeSuggestionElement();if(el&&el.getAttribute){var valEl=el.getAttribute(SUGGESTION_ATTR_NAME);return valEl||el.innerText}return null},this);this.groupClasses=ko.pureComputed(function(){var size=this.size();return size===Size.large?"input-group-lg":size===Size.small?"input-group-md":""},this);this.value.subscribe(function(){this.collapsedRequested(!1)}.bind(this));var liveNotificationManager=new LiveNotificationManager(this.notificationText);ko.computed(function(){var isExpandedNow=this.isExpanded(),count=ko.unwrap(this.suggestions().length);isExpandedNow?liveNotificationManager.notifyAvailableSuggestions(count):liveNotificationManager.cancelPendingAvailableSuggestionsNotification()},this);this.isBusyTemplate=children.isBusyTemplate;this.suggestionsTemplate=children.suggestionsTemplate;this.afterInputElement=children.afterInputElement;var activeSuggestionManager=new ActiveSuggestionManager(this.activeSuggestionElement,refs.root);this.selectActiveSuggestion=function(){var textValue=this.activeSuggestionValue();if(textValue){var contextData=this.activeSuggestionData();this.onSelect(textValue,contextData);activeSuggestionManager.clear()}}.bind(this);var KEY_ENTER=13,KEY_UP=38,KEY_DOWN=40,KEY_SPACE=32,KEY_ESC=27,pressExpand=function(e){if(e.ctrlKey&&e.altKey&&32===e.which){this.collapsedRequested(!1);return!0}}.bind(this),pressCollapse=function(e){if(27===e.which){this.isExpanded()?this.collapsedRequested(!0):this.value("");return!0}}.bind(this),pressNext=function(e){if(40===e.which){activeSuggestionManager.shiftTo(activeSuggestionManager.SHIFT_TO_NEXT);this.collapsedRequested(!1);return!0}}.bind(this),pressPrevious=function(e){if(38===e.which){activeSuggestionManager.shiftTo(activeSuggestionManager.SHIFT_TO_PREVIOUS);this.collapsedRequested(!1);return!0}}.bind(this),pressSelect=function(e){if(13===e.which){this.selectActiveSuggestion();return!0}}.bind(this);this.onKeyPress=function(data,e){e=e.originalEvent||e;if(!pressSelect(e))return!0};this.onClick=function(d,e){var el=e.target.closest(SUGGESTION_ATTR_NAME_SELECTOR);if(!el)return!0;this.activeSuggestionElement(el);this.selectActiveSuggestion()}.bind(this);this.onKeyDown=function(data,e){e=e.originalEvent||e;if(!(pressExpand(e)||pressCollapse(e)||pressNext(e)||pressPrevious(e)))return!0};this.onBlur=function(){setTimeout(function(){document.activeElement!==this.getInputElement()&&this.collapsedRequested(!0)}.bind(this),310)}.bind(this);this.onFocus=function(){this.collapsedRequested(!1)}.bind(this)}var TAG_NAME="input-autocomplete",TEMPLATE=require("../../html/kocomponents/input-autocomplete.html"),CSS_CLASS="InputAutocomplete",SUGGESTION_ATTR_NAME="data-input-autocomplete-suggestion",SUGGESTION_ATTR_NAME_SELECTOR="["+SUGGESTION_ATTR_NAME+"]",ko=require("knockout"),getObservable=require("../utils/getObservable"),extend=require("jquery").extend,Size={large:"lg",medium:"md",small:"sm"},ActionForValue={clear:1,keepUserInput:2,copySelected:3},DEFAULT_ACTIONS_AFTER_SELECT={value:ActionForValue.copySelected},validateAfterInputElement=function(element){if(!(element.classList.contains("input-group-btn")||element.classList.contains("input-group-addon")))throw new Error('The given afterInput element for input-autocomplete must have a valid "input-group-*" class')},create=function(params,componentInfo){componentInfo.element.classList.add(CSS_CLASS);var isBusyTemplate,suggestionsTemplate,afterInputElement;componentInfo.templateNodes.forEach(function(node){switch(node.getAttribute&&node.getAttribute("slot")){case"isBusy":isBusyTemplate=node.content||node;break;case"suggestions":suggestionsTemplate=node.content||node;break;case"afterInput":afterInputElement=node}});suggestionsTemplate||(suggestionsTemplate=componentInfo.element.querySelector("template[name=defaultSuggestions]"));afterInputElement&&validateAfterInputElement(afterInputElement);return new ViewModel(params,{root:componentInfo.element},{isBusyTemplate:isBusyTemplate,suggestionsTemplate:suggestionsTemplate,afterInputElement:afterInputElement})};ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:{createViewModel:create},synchronous:!0});exports.Size=Size;exports.ActionForValue=ActionForValue},{"../../html/kocomponents/input-autocomplete.html":157,"../utils/getObservable":455,jquery:14,knockout:15}],299:[function(require,module,exports){"use strict";var remote=require("./drivers/restClient");exports.DEFAULT_LOCATION={lat:"37.788479",lng:"-122.40297199999998",searchDistance:30,city:"San Francisco, CA USA"};exports.byTerm=function(searchTerm,lat,lng,searchDistance){exports.byTerm.latestRequest&&exports.byTerm.latestRequest.xhr.abort();exports.byTerm.latestRequest=remote.get("search",{searchTerm:searchTerm,origLat:lat||exports.DEFAULT_LOCATION.lat,origLong:lng||exports.DEFAULT_LOCATION.lng,searchDistance:searchDistance||exports.DEFAULT_LOCATION.searchDistance});return exports.byTerm.latestRequest};exports.getCategory=function(categoryID,lat,lng,searchDistance){exports.getCategory.latestRequest&&exports.getCategory.latestRequest.xhr.abort();exports.getCategory.latestRequest=remote.get("search/categories/"+categoryID,{origLat:lat,origLong:lng,searchDistance:searchDistance});return exports.getCategory.latestRequest};exports.jobTitlesByCategory=function(categoryID,lat,lng,searchDistance){exports.jobTitlesByCategory.latestRequest&&exports.jobTitlesByCategory.latestRequest.xhr.abort();exports.jobTitlesByCategory.latestRequest=remote.get("search/job-titles/by-category",{categoryID:categoryID,origLat:lat,origLong:lng,searchDistance:searchDistance});return exports.jobTitlesByCategory.latestRequest};exports.getJobTitle=function(jobTitleID,lat,lng,searchDistance){exports.getJobTitle.latestRequest&&exports.getJobTitle.latestRequest.xhr.abort();exports.getJobTitle.latestRequest=remote.get("search/job-titles/"+jobTitleID,{origLat:lat,origLong:lng,searchDistance:searchDistance});return exports.getJobTitle.latestRequest};exports.serviceProfessionalsByJobTitle=function(jobTitleID,lat,lng,searchDistance){exports.serviceProfessionalsByJobTitle.latestRequest&&exports.serviceProfessionalsByJobTitle.latestRequest.xhr.abort();exports.serviceProfessionalsByJobTitle.latestRequest=remote.get("search/service-professionals/by-job-title",{jobTitleID:jobTitleID,origLat:lat,origLong:lng,searchDistance:searchDistance});return exports.serviceProfessionalsByJobTitle.latestRequest};exports.jobTitleAutocomplete=function(searchTerm){exports.jobTitleAutocomplete.latestRequest&&exports.jobTitleAutocomplete.latestRequest.xhr.abort();exports.jobTitleAutocomplete.latestRequest=remote.get("search/job-titles/autocomplete",{searchTerm:searchTerm});return exports.jobTitleAutocomplete.latestRequest}},{"./drivers/restClient":271}],306:[function(require,module,exports){"use strict";function mapToUserJobProfile(rawItems){cache.userJobProfile.list=[];cache.userJobTitles={};rawItems&&rawItems.forEach(function(rawItem){var m=new UserJobTitle(rawItem);m.isBeingDeleted=ko.observable(!1);cache.userJobProfile.list.push(m);setGetUserJobTitleToCache(rawItem)});exports.list(cache.userJobProfile.list);cache.userJobProfile.cache.latest=new Date;return cache.userJobProfile.list}function getUserJobProfileFromLocal(){return local.getItem("userJobProfile").then(function(userJobProfile){return userJobProfile?mapToUserJobProfile(userJobProfile):null})}function deleteUserJobTitleFromCache(jobTitleID){delete cache.userJobTitles[jobTitleID];exports.list.remove(function(j){return j.jobTitleID()===jobTitleID});cache.userJobProfile.cache.touch()}function setGetUserJobTitleToCache(rawItem){var c=cache.userJobTitles[rawItem.jobTitleID]||{};if(c.model)c.model.model.updateWith(rawItem);else{c.model=new UserJobTitle(rawItem);c.model.isBeingDeleted=ko.observable(!1)}c.cache?c.cache.latest=new Date:c.cache=new CacheControl({ttl:defaultTtl});var fullList=cache.userJobProfile.list;if(fullList){var found=null;fullList.some(function(it){if(it.jobTitleID()===rawItem.jobTitleID){found=it;return!0}});found?found.model.updateWith(rawItem):fullList.push(c.model)}return c.model}var UserJobTitle=require("../models/UserJobTitle"),CacheControl=require("./helpers/CacheControl"),local=require("./drivers/localforage"),remote=require("./drivers/restClient"),ko=require("knockout"),$=require("jquery"),session=require("./session"),jobTitles=require("./jobTitles"),defaultTtl={minutes:1},cache={userJobProfile:{cache:new CacheControl({ttl:defaultTtl}),list:null},userJobTitles:{}};exports.list=ko.observableArray([]);exports.syncList=function syncList(){return exports.getUserJobProfile().then(function(list){exports.list(list);return list})};exports.clearCache=function clearCache(){cache.userJobProfile.cache.latest=null;cache.userJobProfile.list=[];cache.userJobTitles={}};session.on.cacheCleaningRequested.subscribe(function(){exports.clearCache()});var fetchUserJobProfile=function(){return remote.get("me/user-job-profile").then(function(raw){local.setItem("userJobProfile",raw);return mapToUserJobProfile(raw)})},saveCacheToLocal=function(){var raw=cache.userJobProfile.list.map(function(j){return j.model.toPlainObject(!0)});local.setItem("userJobProfile",raw)};exports.getUserJobProfile=function(){return cache.userJobProfile.cache.mustRevalidate()?cache.userJobProfile.list?fetchUserJobProfile():getUserJobProfileFromLocal().then(function(data){var remotePromise=fetchUserJobProfile();return data||remotePromise}):Promise.resolve(cache.userJobProfile.list)};var fetchUserJobTitle=function(jobTitleID){return remote.get("me/user-job-profile/"+jobTitleID).then(function(raw){return setGetUserJobTitleToCache(raw)})},pushNewUserJobTitle=function(values){return remote.post("me/user-job-profile",$.extend({jobTitleID:0,jobTitleName:"",intro:"",cancellationPolicyID:null,instantBooking:!1},values)).then(function(raw){return setGetUserJobTitleToCache(raw)})};exports.getUserJobTitle=function(jobTitleID){return jobTitleID?!cache.userJobTitles[jobTitleID]||cache.userJobTitles[jobTitleID].cache.mustRevalidate()?fetchUserJobTitle(jobTitleID):cache.userJobTitles[jobTitleID]&&cache.userJobTitles[jobTitleID].model?Promise.resolve(cache.userJobTitles[jobTitleID].model):getUserJobProfileFromLocal().then(function(){return cache.userJobTitles[jobTitleID].model}).catch(fetchUserJobTitle.bind(null,jobTitleID)):Promise.reject("Job Title ID required")};exports.setUserJobTitle=function(values){return remote.put("me/user-job-profile/"+values.jobTitleID,values).then(function(raw){return setGetUserJobTitleToCache(raw)})};exports.createUserJobTitle=function(values){return pushNewUserJobTitle(values)};exports.deactivateUserJobTitle=function(jobTitleID){return remote.post("me/user-job-profile/"+(0|jobTitleID)+"/deactivate").then(function(raw){return setGetUserJobTitleToCache(raw)})};exports.reactivateUserJobTitle=function(jobTitleID){return remote.post("me/user-job-profile/"+(0|jobTitleID)+"/reactivate").then(function(raw){return setGetUserJobTitleToCache(raw)})};exports.deleteUserJobTitle=function(jobTitleID){var found=exports.list().filter(function(j){j.jobTitleID()===jobTitleID&&j.isBeingDeleted(!0)});return remote.delete("me/user-job-profile/"+(0|jobTitleID)).then(function(){deleteUserJobTitleFromCache(jobTitleID);saveCacheToLocal();return null}).catch(function(err){found.forEach(function(j){j.isBeingDeleted(!1)});throw err})};exports.getUserJobTitleAndJobTitle=function getUserJobTitleAndJobTitle(jobTitleID){return exports.getUserJobTitle(jobTitleID).then(function(userJobTitle){if(!userJobTitle)throw{name:"Not Found",message:"We don't have a record of this job titleIt may have been recently deleted."};return Promise.all([userJobTitle,jobTitles.getJobTitle(jobTitleID)])}).then(function(all){var jobTitle=all[1];if(!jobTitle)throw{name:"Not Found",message:"The job title does not exist."};return{jobTitleID:jobTitleID,userJobTitle:all[0],jobTitle:jobTitle}})};exports.getJobTitles=function(){return exports.getUserJobProfile().then(function(list){return Promise.all(list.map(function(userJobTitle){return jobTitles.getJobTitle(userJobTitle.jobTitleID())}))})}},{"../models/UserJobTitle":422,"./drivers/localforage":270,"./drivers/restClient":271,"./helpers/CacheControl":276,"./jobTitles":286,"./session":303,jquery:14,knockout:15}],422:[function(require,module,exports){"use strict";function UserJobTitle(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,intro:null,statusID:0,cancellationPolicyID:0,instantBooking:!1,bookMeButtonReady:!1,collectPaymentAtBookMeButton:!1,createdDate:null,updatedDate:null,alerts:{isArray:!0,Model:ProfileAlert}},values);this.model.defID(["userID","jobTitleID"]);this.requiredAlerts=ko.pureComputed(function(){return this.alerts().filter(function(profileAlert){return profileAlert.isRequired()})},this);this.isComplete=ko.pureComputed(function(){var statusComplete=this.statusID()===UserJobTitle.status.on||this.statusID()===UserJobTitle.status.off,hasRequiredAlerts=this.requiredAlerts().length>0;return statusComplete&&!hasRequiredAlerts},this)}var ko=require("knockout"),Model=require("./Model"),ProfileAlert=require("./ProfileAlert");module.exports=UserJobTitle;UserJobTitle.status={on:1,incomplete:2,off:3}},{"./Model":386,"./ProfileAlert":397,knockout:15}],397:[function(require,module,exports){"use strict";function ProfileAlert(values){Model(this);this.model.defProperties({alertID:0,alertName:"",displayRank:9999,isRequired:!1},values)}var Model=require("./Model");module.exports=ProfileAlert},{"./Model":386}],286:[function(require,module,exports){"use strict";var JobTitle=require("../models/JobTitle"),ko=require("knockout"),CacheControl=require("./helpers/CacheControl"),session=require("./session"),local=require("./drivers/localforage"),remote=require("./drivers/restClient");exports.state={isLoading:ko.observable(!1)};var cache={jobTitles:{}},getCacheItem=function(id){var c=cache.jobTitles[id];c||(c=cache.jobTitles[id]=new CacheControl({ttl:{minutes:60}}));return c},setCacheItem=function(id,rawData){var c=getCacheItem(id);c.data?c.data.model.updateWith(rawData,!0):c.data=new JobTitle(rawData);c.touch();return c};exports.clearCache=function clearCache(){cache.jobTitles={}};session.on.cacheCleaningRequested.subscribe(function(){exports.clearCache()});exports.getJobTitle=function getJobTitle(id){if(!id)return Promise.reject("Needs an ID to get a Job Title");var c=getCacheItem(id);if(c.request)return c.request;if(c.mustRevalidate()){exports.state.isLoading(!0);c.request=local.getItem("jobTitles/"+id).then(function(jobTitle){jobTitle&&(c.latest=new Date(jobTitle.updatedDate));if(c.mustRevalidate())return remote.get("job-titles/"+id).then(function(raw){local.setItem("jobTitles/"+id,raw);exports.state.isLoading(!1);c.request=null;return setCacheItem(id,raw).data});exports.state.isLoading(!1);c.request=null;return setCacheItem(id,jobTitle).data}).catch(function(err){exports.state.isLoading(!1);c.request=null;throw err});return c.request}return Promise.resolve(c.data)}},{"../models/JobTitle":371,"./drivers/localforage":270,"./drivers/restClient":271,"./helpers/CacheControl":276,"./session":303,knockout:15}],371:[function(require,module,exports){"use strict";function JobTitle(values){Model(this);this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",aliases:"",description:null,searchDescription:null,createdDate:null,updatedDate:null},values);this.model.defID(["jobTitleID"]);this.pricingTypes=ko.observableArray([]);values&&values.pricingTypes&&values.pricingTypes.forEach(function(jobpricing){this.pricingTypes.push(new JobTitlePricingType(jobpricing))}.bind(this))}var ko=require("knockout"),Model=require("./Model"),JobTitlePricingType=require("./JobTitlePricingType");module.exports=JobTitle},{"./JobTitlePricingType":376,"./Model":386,knockout:15}],376:[function(require,module,exports){"use strict";function JobTitlePricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,clientTypeID:1,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID","clientTypeID"])}var Model=require("./Model");module.exports=JobTitlePricingType},{"./Model":386}],180:[function(require,module,exports){"use strict";function ViewModel(){this.isServiceProfessional=user.isServiceProfessional;this.activeUserPaymentPlan=userPaymentPlan.data}var Activity=require("../components/Activity"),user=require("../data/userProfile").data,userPaymentPlan=require("../data/userPaymentPlan"),A=Activity.extend(function AccountActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel;this.navBar=Activity.createSectionNavBar(null);this.title("Your Account")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);userPaymentPlan.sync()}},{"../components/Activity":255,"../data/userPaymentPlan":308,"../data/userProfile":309}],308:[function(require,module,exports){"use strict";var UserPaymentPlan=require("../models/UserPaymentPlan"),RemoteModel=require("./helpers/RemoteModel"),local=require("./drivers/localforage"),remote=require("./drivers/restClient"),session=require("./session"),api=new RemoteModel({data:new UserPaymentPlan,ttl:{minutes:1},localStorageName:"userPaymentPlan",fetch:function fetch(){return remote.get("me/payment-plan")},push:function push(){throw{name:"Raw update of payment plan is not supported; use specialized methods"}}});module.exports=api;session.on.cacheCleaningRequested.subscribe(function(){api.clearCache()});api.createSubscription=function createSubscription(data){api.isSaving(!0);return remote.post("me/payment-plan",data).then(function(serverData){api.data.model.updateWith(serverData,!0);local.setItem(api.localStorageName,serverData);api.isSaving(!1)}).catch(function(err){api.isSaving(!1);throw err})}},{"../models/UserPaymentPlan":425,"./drivers/localforage":270,"./drivers/restClient":271,"./helpers/RemoteModel":283,"./session":303}],425:[function(require,module,exports){"use strict";function UserPaymentPlan(values){Model(this);this.model.defProperties({userPaymentPlanID:0,userID:0,subscriptionID:"",paymentPlan:"",paymentMethod:"",paymentPlanLastChangedDate:null,nextPaymentDueDate:null,nextPaymentAmount:null,firstBillingDate:null,subscriptionEndDate:null,paymentMethodToken:null,paymentExpiryDate:null,planStatus:"",daysPastDue:null},values);this.isNew=ko.pureComputed(function(){return!this.userPaymentPlanID()},this)}var Model=require("../models/Model"),ko=require("knockout");module.exports=UserPaymentPlan},{"../models/Model":386,knockout:15}],179:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),DEFAULT_TAB="us";require("../kocomponents/tab-list");var A=Activity.extend(function AboutActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);var shell=this.app.shell,observableRoute=shell.getCurrentObservableRoute();this.activeTabName=ko.pureComputed({read:function(){var route=observableRoute();return route&&route.segments&&route.segments[0]},write:function(tabName){shell.replaceState(null,null,"#!about/"+tabName)},owner:this});this.title=ko.pureComputed(function(){switch(this.activeTabName()){case"press":return"Press";case"careers":return"Careers";default:return"About Loconomics cooperative"}},this)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.activeTabName()||this.activeTabName("us")}},{"../components/Activity":255,"../kocomponents/tab-list":337,knockout:15}],337:[function(require,module,exports){"use strict";function ViewModel(params){this.prefix=ko.unwrap(params.prefix)||"";this.active=getObservable(params.active);this.data=getObservable(params.data)}var TAG_NAME="tab-list",TEMPLATE=require("../../html/kocomponents/tab-list.html"),ACTIVE_TAB_CLASS="active",ko=require("knockout"),getObservable=require("../utils/getObservable"),$=require("jquery"),escapeSelector=require("../utils/escapeSelector"),create=function(params,componentInfo){var vm=new ViewModel(params),$root=$(componentInfo.element);vm.afterRender=function(){var $tabLinks=$root.find('a[href^="'+escapeSelector(vm.prefix)+'"]');$root.attr("role","tablist");$tabLinks.attr("role","tab").attr("tabindex","-1").each(function(i,tabLink){var link=(tabLink=$(tabLink)).attr("href"),id=link.replace(/^#/,"");tabLink.attr("aria-controls",id);$(link).attr("role","tabpanel")});var setElementAsActive=function(tabElement,e){var link=$(tabElement).attr("href"),isPrefix=0===link.indexOf(vm.prefix);if(isPrefix){var tabName=isPrefix?link.replace(vm.prefix,""):link;vm.active(tabName);if(e){e.preventDefault();e.stopImmediatePropagation()}}};$root.on("click","a[href]",function(e){setElementAsActive(this,e)});var disableActiveTab=function(){$tabLinks.removeClass("active").attr("aria-selected",null).attr("tabindex","-1").parent("li").removeClass("active").each(function(i,tab){var prevUrl=tab.getAttribute("href");prevUrl&&$("#"+escapeSelector(prevUrl.substr(1))).removeClass("active").attr("aria-selected",null).hide()})},onEmptyActive=function(){disableActiveTab();var url=$tabLinks.first().attr("href");if(url){var name=url.replace(vm.prefix,"");vm.active(name);return name}},updateActive=function(tabName){if(!tabName){tabName=onEmptyActive();console.error("Not found first tab or valid name/href for that one in tab-list, it can behaves wrongly for keyboard users");if(!tabName)return}var url=vm.prefix+tabName;/^#/.test(url)||(url="#"+url);var tab=$root.find('[href="'+escapeSelector(url)+'"]'),panel=$("#"+escapeSelector(url.substr(1)));if(tab.length&&panel.length){disableActiveTab();tab.addClass("active").attr("aria-selected","true").attr("tabindex","0");tab.parent("li").addClass("active");panel.addClass("active").attr("aria-selected","true").show()}else{clearTimeout(updateActive.retry);updateActive.retry=setTimeout(function(){vm.active()===tabName&&updateActive(tabName)},60)}};ko.computed(function(){updateActive(vm.active())});var goTabIndexOffset=function(indexOffset){var active=$tabLinks.filter(".active"),index=$tabLinks.index(active),last=$tabLinks.length-1;(index+=indexOffset)<0?index=last:index>last&&(index=0);var newTab=$tabLinks.eq(index);setElementAsActive(newTab);newTab.focus()},goPrevious=function(){goTabIndexOffset(-1)},goNext=function(){goTabIndexOffset(1)},LEFT_KEY=37,RIGHT_KEY=39;$root.on("keydown",function(e){switch(e.which){case 37:goPrevious();break;case 39:goNext()}})};return vm};ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:{createViewModel:create},synchronous:!0})},{"../../html/kocomponents/tab-list.html":163,"../utils/escapeSelector":452,"../utils/getObservable":455,jquery:14,knockout:15}],452:[function(require,module,exports){"use strict";var specials=["#","&","~","=",">","'",":",'"',"!",";",","],regexSpecials=[".","*","+","|","[","]","(",")","/","^","$"],sRE=new RegExp("("+specials.join("|")+"|\\"+regexSpecials.join("|\\")+")","g");module.exports=function(selector){return selector.replace(sRE,"\\$1")}},{}],178:[function(require,module,exports){"use strict";require("../kocomponents/utilities/icon-dec.js");var Activity=require("../components/Activity"),A=Activity.extend(function _styleGuideActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser});exports.init=A.init},{"../components/Activity":255,"../kocomponents/utilities/icon-dec.js":338}],338:[function(require,module,exports){"use strict";function ViewModel(params){this.icon=getObservable(params.icon);this.iconClass=ko.pureComputed(function(){return this.icon().match(/^fa-.*$/)?"fa "+this.icon():this.icon().match(/^ion-.*$/)?"ion "+this.icon():this.icon()},this)}var TAG_NAME="icon-dec",TEMPLATE=require("../../../html/kocomponents/utilities/icon-dec.html"),getObservable=require("../../utils/getObservable"),ko=require("knockout");ko.components.register(TAG_NAME,{template:TEMPLATE,viewModel:ViewModel})},{"../../../html/kocomponents/utilities/icon-dec.html":164,"../../utils/getObservable":455,knockout:15}],177:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),showAnnouncement=require("../modals/announcement").show,showConfirm=require("../modals/confirm").show,showError=require("../modals/error").show,showNotification=require("../modals/notification").show,showTextEditor=require("../modals/textEditor").show,showTimePicker=require("../modals/timePicker").show,A=Activity.extend(function _modalsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel={announcement1:function(){showAnnouncement()},announcement2:function(){showAnnouncement({message:"We're an app for booking local services that's cooperatively owned by service professionals. Right now we're busy recruiting service professional owners in San Francisco and Oakland. Click below to learn more.",primaryButtonText:"I'm a service professional",primaryButtonLink:"#!/learnMoreProfessionals",secondaryButtonText:"I'm a potential client",secondaryButtonLink:"#!/"})},confirm1:function(){showConfirm()},confirm2:function(){showConfirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"})},confirm3:function(){showConfirm({title:"Delete item",message:"You will delete item 34",yes:"Delete",no:"Keep"})},error1:function(){showError()},error2:function(){showError({title:"Unable so save data",error:new Error("Server Error: impossible to save item")})},error3:function(){showError({title:"Unable so load your availability preferences",error:{name:"XMLHttpRequest Error",message:"No response from server"}})},notification1:function(){showNotification()},notification2:function(){showNotification({title:"Confirmation request",message:"A message was sent to your inbox to confirm your email address. Click the link inside and you are done",buttonText:"Got it!"})},textEditor1:function(){showTextEditor({title:"Text editor"})},textEditor2:function(){showTextEditor({title:"Add notes about the client",text:"Previous typed notes"})},timePicker1:function(){showTimePicker()},timePicker2:function(){showTimePicker({title:"Schedule an unavailable time",selectedTime:null,unsetLabel:"Cancel"})},timePicker3:function(){showTimePicker({title:"Change selected time",selectedTime:"11:40",stepInMinutes:10,unsetLabel:"Reset",selectLabel:"Update"})}}});exports.init=A.init},{"../components/Activity":255,"../modals/announcement":341,"../modals/confirm":342,"../modals/error":343,"../modals/notification":344,"../modals/textEditor":347,"../modals/timePicker":348}],341:[function(require,module,exports){"use strict";var ariaHideElements=require("./utils/ariaHideElements"),fixFocus=require("./utils/fixFocus"),TEMPLATE=require("../../html/modals/announcement.html"),createElement=require("./utils/createElement");require("../utils/jquery.multiline");exports.show=function showAnnouncementModal(options){var modal=createElement(TEMPLATE);fixFocus(modal);var primaryBtn=modal.find("#announcementModal-primaryBtn"),secondaryBtn=modal.find("#announcementModal-secondaryBtn"),body=modal.find("#announcementModal-body"),msg=(options=options||{}).message||body.data("default-text");body.multiline(msg);primaryBtn.text(options.primaryButtonText||primaryBtn.data("default-text"));primaryBtn.attr("href",options.primaryButtonLink||"#");secondaryBtn.toggle(!!options.secondaryButtonText);secondaryBtn.text(options.secondaryButtonText);secondaryBtn.attr("href",options.secondaryButtonLink||"#");return new Promise(function(resolve){modal.modal("show");var handle=ariaHideElements.keep(modal.get(0));modal.off("hide.bs.modal").one("hide.bs.modal",function(){handle.revert();resolve()})})}},{"../../html/modals/announcement.html":165,"../utils/jquery.multiline":460,"./utils/ariaHideElements":349,"./utils/createElement":350,"./utils/fixFocus":351}],176:[function(require,module,exports){module.exports="<ul class=IconList> <li> <i class=ion-ios-plus-outline aria-hidden=true></i> <p>Everything in the Growth & Pro plans <strong>plus:</strong></p> </li> <li> <i class=ion-arrow-graph-up-right aria-hidden=true></i> <p>Get on track with a half-day biz assessment from experts</p> </li> <li> <i class=ion-social-usd-outline aria-hidden=true></i> <p>Save $78 with this option</p> </li> </ul>"},{}],175:[function(require,module,exports){module.exports='<ul class=IconList> <li> <i class=ion-ios-plus-outline aria-hidden=true></i> <p>Everything in the Growth plan <strong>plus:</strong></p> </li> <li> <i class=ion-android-calendar aria-hidden=true></i> <p>Get organized with our scheduling and client management software</p> </li> <li> <i class=ion-ios-pricetags-outline aria-hidden=true></i> <p>Attract more clients by adding scheduling to your website</p> </li> <li> <i class=ion-ios-bolt-outline aria-hidden=true></i> <p>Increase your income & allow clients to schedule you instantly</p> </li> <li> <i class="fa fa-vcard-o" aria-hidden=true></i> <p>Build loyalty with client-specific pricing</p> </li> <li> <i class="fa fa-bank" aria-hidden=true></i> <p>Apply for a zero-interest loan through our partnership with Kiva</p> </li> </ul>'},{}],174:[function(require,module,exports){module.exports='<ul class=IconList> <li> <i class=ion-ios-plus-outline aria-hidden=true></i> <p>Everything in the Free plan <strong>plus:</strong></p> </li> <li> <i class=ion-ios-glasses-outline aria-hidden=true></i> <p>Learn new skills to grow your biz at our monthly workshops</p> </li> <li> <i class="fa fa-handshake-o" aria-hidden=true></i> <p>Meet & match with referral partners in the cooperative</p> </li> <li> <i class=ion-ios-cart-outline aria-hidden=true></i> <p>Preferred listing placement</p> </li> <li> <i class=ion-ios-color-filter-outline aria-hidden=true></i> <p>Ownership-Earn patronage & vote/run for board of directors</p> </li> </ul>'},{}],173:[function(require,module,exports){module.exports="<ul class=IconList> <li> <i class=ion-ios-list-outline aria-hidden=true></i> <p>Find new clients with one listing</p> </li> <li> <i class=ion-cash aria-hidden=true></i> <p>Invoice clients directly and get paid easily</p> </li> <li> <i class=ion-umbrella aria-hidden=true></i> <p>Protect you and your clients with access to insurance</p> </li> <li> <i class=ion-ios-close-outline aria-hidden=true></i> <p>Reduce no-shows with our standard cancellation policy</p> </li> <li> <i class=ion-ios-help-outline aria-hidden=true></i> <p>Find support and expertise in our community forums</p> </li> </ul>"},{}],165:[function(require,module,exports){module.exports='<div id=announcementModal class="modal fade" tabindex=-1 role=dialog aria-labelledby=announcementModal-label aria-describedby=announcementModal-content aria-hidden=true> <div class=modal-dialog role=document> <div class=modal-content> <div class=modal-header> <button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button> <h2 class=modal-title id=announcementModal-label>Welcome to Loconomics!</h2> </div> <div class=modal-body id=announcementModal-content> <p id=announcementModal-body data-default-text=Welcome!></p> </div> <div class=modal-footer> <ul class=list-unstyled> <li><a id=announcementModal-primaryBtn href=# class="btn btn-secondary" data-dismiss=modal data-default-text=Go!></a></li> <li><a id=announcementModal-secondaryBtn href=# class="btn btn-link text-secondary" data-dismiss=modal></a></li> </ul> </div> </div> </div> </div>'},{}],164:[function(require,module,exports){module.exports='<i data-bind="css: iconClass" aria-hidden=true></i>'},{}],163:[function(require,module,exports){module.exports="\x3c!-- ko template: { nodes: $componentTemplateNodes } --\x3e\x3c!-- /ko --\x3e\x3c!-- ko template: { afterRender: afterRender } --\x3e\x3c!-- /ko --\x3e"},{}],162:[function(require,module,exports){module.exports='<input type=checkbox data-bind="disabled: disabled, checked: checked, attr: { id: id }"> <span aria-hidden=true class=SwitchCheckbox-drawer></span> <span aria-hidden=true class=SwitchCheckbox-marker><span>✓</span></span>'},{}],161:[function(require,module,exports){module.exports="<a class=SmartNavBar-btn href=# data-bind=\"visible: action && !action.isMenu(), attr: { href: action && action.getHref(), 'data-target': action && action.getModalTarget(), 'data-toggle': action && action.isModal() ? 'modal' : '', 'data-shell': action && action.getShellCommand() }, event: { click: action && action.runHandler }\"> <span data-bind=\"attr: { 'class': action && action.icon() }\" class=icon></span> <span data-bind=\"visible: action && action.isTitle(), text: action && action.text()\"></span><span data-bind=\"visible: action && !action.isTitle(), text: action && action.text()\"></span> </a> <button type=button class=\"SmartNavBar-btn navbar-toggle collapsed\" data-bind=\"visible: action && action.isMenu(), attr: { 'data-target': action && action.getMenuLink(), 'aria-controls': action && action.getMenuID() }\" data-toggle=collapse data-target=#menuOut aria-expanded=false aria-controls=menuOut> <span data-bind=\"visible: action && action.icon() === 'menu'\"> <span class=\"fa ion-navicon ion icon\"></span>  </span> <span data-bind=\"visible: (action && action.icon()) !== 'menu'\"> <span data-bind=\"attr: { 'class': action && action.icon() }\"></span> <span data-bind=\"visible: action && !action.isTitle(), text: action && action.text()\"></span> </span> </button>"},{}],160:[function(require,module,exports){module.exports='<div> <input-autocomplete params="\r\n        id: id,\r\n        name: name,\r\n        placeholder: \'Select suggested or add new\',\r\n        value: value,\r\n        suggestions: suggestions,\r\n        onSelect: selectAttribute,\r\n        isDisabled: isDisabled,\r\n        extraData: {\r\n            clearValue: clearValue,\r\n            expandedByUser: expandedByUser,\r\n            expandAutocomplete: expandAutocomplete,\r\n            collapseAutocomplete: collapseAutocomplete,\r\n            availableAttributes: availableAttributes\r\n        }"> <div slot=afterInput class=input-group-btn> \x3c!-- ko if: value --\x3e <button type=button class="btn btn-default" title=Clear data-bind="click: extraData.clearValue, disable: isDisabled"> <icon-dec params="icon: \'ion-android-close\'"></icon-dec> <span class=sr-only>Clear</span> </button> \x3c!-- /ko --\x3e \x3c!-- ko if: !value() && !extraData.availableAttributes().length --\x3e <div class="btn btn-default" title="You\'ve added all suggestions." tabindex=0> <icon-dec params="icon: \'ion-minus-round\'"></icon-dec> <span class=sr-only>You\'ve added all suggestions.</span> </div> \x3c!-- /ko --\x3e \x3c!-- ko if: !value() && !extraData.expandedByUser() && extraData.availableAttributes().length --\x3e <button type=button class="btn btn-default" title="Show all" data-bind="click: extraData.expandAutocomplete, disable: isDisabled"> <icon-dec params="icon: \'ion-arrow-down-b\'"></icon-dec> <span class=sr-only>Show all</span> </button> \x3c!-- /ko --\x3e \x3c!-- ko if: !value() && extraData.expandedByUser() && extraData.availableAttributes().length --\x3e <button type=button class="btn btn-default" title=Close data-bind="click: extraData.collapseAutocomplete, disable: isDisabled"> <icon-dec params="icon: \'ion-arrow-up-b\'"></icon-dec> <span class=sr-only>Close</span> </button> \x3c!-- /ko --\x3e </div> <template slot=suggestions> <div class=SearchResultsPreview> <h2 class=SearchResultsPreview-h>Suggestions (or add new):</h2> <ul data-bind="foreach: suggestions"> <li class=Result data-bind="attr: {\r\n                            id: $parent.id() + \'-suggestion\' + $index(),\r\n                            \'data-input-autocomplete-suggestion\': name\r\n                        }"> <div class=Result-info> <span class=Result-name><span data-bind="ifnot: serviceAttributeID">Add new: </span><span data-bind="text: name"></span> <span class="Result-description hidden-xs hidden-sm" data-bind="text: description, visible: description"></span> </span></div> <span class="btn btn-secondary btn-md btn-inline">Add</span> </li> </ul> </div> </template> </input-autocomplete> </div>'},{}],159:[function(require,module,exports){module.exports="<div class=form-group> <label for=homeLocation class=sr-only>Where?</label> <input-autocomplete params=\"\r\n        id: 'homeLocation',\r\n        name: 'location',\r\n        icon: 'ion-ios-location-outline',\r\n        size: 'lg',\r\n        value: value,\r\n        suggestions: suggestions,\r\n        onSelect: onSelect\r\n    \"> <template slot=suggestions> <ul data-bind=\"foreach: suggestions\" class=list-unstyled> <li class=Result data-input-autocomplete-suggestion data-bind=\"attr: { id: $parent.id() + '-suggestion-' + $index() }, text: description\"> </li> </ul> </template> </input-autocomplete> <div id=google-maps-places-attribution></div> </div>"},{}],158:[function(require,module,exports){module.exports='<div class=form-group> <label data-bind="attr: { for: id }, text: label, css: { \'sr-only\': visuallyHiddenLabel }"></label> <input-autocomplete params="id: id, name: \'jobTitle\', icon: \'ion-ios-search\',\r\n        placeholder: isAddJobTitle() ? \'Search for your profession\' : \'Search for professionals\',\r\n        size: \'lg\',\r\n        value: value,\r\n        suggestions: suggestions,\r\n        onSelect: onSelect,\r\n        extraData: { suggestionButtonText: suggestionButtonText, isAddJobTitle: isAddJobTitle }"> <template slot=suggestions> <div class=SearchResultsPreview> <h3 data-bind="if: extraData.isAddJobTitle" class=SearchResultsPreview-h>Sound like you?</h3> <div data-bind="if: suggestions().jobTitles().length"> <ul data-bind="foreach: suggestions().jobTitles()"> <li class=Result data-bind="attr: {\r\n                                id: $parent.id() + \'-suggestion-\' + $index(),\r\n                                \'data-input-autocomplete-suggestion\': singularName\r\n                            }"> <div class=Result-info> <span class=Result-name data-bind="text: singularName"></span> <span class=Result-description data-bind="text: $parent.extraData.isAddJobTitle() ? description : searchDescription"></span> </div> <div aria-hidden=true class="btn btn-secondary btn-md btn-inline" data-bind="visible: $parent.extraData.suggestionButtonText, text: $parent.extraData.suggestionButtonText"></div> </li> </ul> <ul data-bind="if: extraData.isAddJobTitle"> <li class=Result data-bind="attr: {\r\n                                id: id() + \'-suggestion-new\',\r\n                                \'data-input-autocomplete-suggestion\': value\r\n                            }"> <div class=Result-info> <span class=Result-name>No?</span> <span class=Result-description>Fear not, if you provide a local service, we\'ll create a job title for you.</span> </div> <div aria-hidden=true class="btn btn-secondary btn-md btn-inline" data-bind="visible: extraData.suggestionButtonText, text: extraData.suggestionButtonText"></div> </li> </ul> </div> <div data-bind="if: suggestions().jobTitles().length === 0 && extraData.isAddJobTitle()"> <ul> <li class=Result data-bind="attr: {\r\n                                id: id() + \'-suggestion-new\',\r\n                                \'data-input-autocomplete-suggestion\': value\r\n                            }"> <div class=Result-info> <span class=Result-name>You\'re our first!</span> <span class=Result-description>Fear not, if you provide a local service, we\'ll create a job title for you.</span> </div> <div aria-hidden=true class="btn btn-secondary btn-md btn-inline" data-bind="visible: extraData.suggestionButtonText, text: extraData.suggestionButtonText"></div> </li> </ul> </div> </div> </template> </input-autocomplete> </div>'},{}],157:[function(require,module,exports){module.exports='<div class="InputAutocomplete-field input-group" data-bind="css: groupClasses"> \x3c!-- ko if: icon --\x3e<span class="input-group-addon inset"><icon-dec params="icon: icon"></icon-dec></span>\x3c!-- /ko --\x3e <input type=text autocomplete=off role=combobox aria-expanded=false aria-autocomplete=list class="form-control inset" data-bind="textInput: value, attr: {\r\n            id: id,\r\n            \'aria-owns\': listBoxID,\r\n            \'aria-expanded\': isExpanded,\r\n            placeholder: placeholder,\r\n            \'aria-activedescendant\': activeSuggestionID,\r\n            disable: isDisabled\r\n        },\r\n        event: { keypress: onKeyPress, keydown: onKeyDown, blur: onBlur, focus: onFocus }"> \x3c!-- ko template: { if: afterInputElement, nodes: afterInputElement && [afterInputElement], data: $component } --\x3e\x3c!-- /ko --\x3e </div> <div role=listbox class=InputAutocomplete-listBox data-bind="visible: isExpanded, attr: { id: listBoxID }"> <div data-bind="template: { if: isBusy, nodes: isBusyTemplate && isBusyTemplate.children, data: $component }"></div> <div data-bind="template: { ifnot: isBusy, nodes: suggestionsTemplate.children, data: $component }, click: onClick"></div> </div> <template name=defaultSuggestions> <ul data-bind="foreach: $data"> <li data-input-autocomplete-suggestion data-bind="attr: { id: id() + \'-suggestion-\' + $index() }, text: $data"> </li> </ul> </template> <div aria-live=polite aria-atomic=true class=sr-only data-bind="text: notificationText"> </div>'},{}],156:[function(require,module,exports){module.exports='\x3c!-- ko template: { nodes: $componentTemplateNodes, data: $data } --\x3e\x3c!-- /ko --\x3e <input type=file data-bind="disable: disabled, attr: { id: id, accept: accept }" tabindex=-1>'},{}],148:[function(require,module,exports){"use strict";var Route=require("./lib/route");module.exports=Route},{"./lib/route":149}],149:[function(require,module,exports){"use strict";function Route(spec){var route;route=this?this:Object.create(Route.prototype);if(void 0===spec)throw new Error("A route spec is required");route.spec=spec;route.ast=Parser.parse(spec);return route}var Parser=require("./route/parser"),RegexpVisitor=require("./route/visitors/regexp"),ReverseVisitor=require("./route/visitors/reverse");Route.prototype=Object.create(null);Route.prototype.match=function(path){var matched=RegexpVisitor.visit(this.ast).match(path);return matched||!1};Route.prototype.reverse=function(params){return ReverseVisitor.visit(this.ast,params)};module.exports=Route},{"./route/parser":152,"./route/visitors/regexp":154,"./route/visitors/reverse":155}],155:[function(require,module,exports){"use strict";var ReverseVisitor=require("./create_visitor")({Concat:function(node,context){var childResults=node.children.map(function(child){return this.visit(child,context)}.bind(this));return!childResults.some(function(c){return!1===c})&&childResults.join("")},Literal:function(node){return decodeURI(node.props.value)},Splat:function(node,context){return!!context[node.props.name]&&context[node.props.name]},Param:function(node,context){return!!context[node.props.name]&&context[node.props.name]},Optional:function(node,context){var childResult=this.visit(node.children[0],context);return childResult||""},Root:function(node,context){context=context||{};var childResult=this.visit(node.children[0],context);return!!childResult&&encodeURI(childResult)}});module.exports=ReverseVisitor},{"./create_visitor":153}],154:[function(require,module,exports){"use strict";function Matcher(options){this.captures=options.captures;this.re=options.re}var createVisitor=require("./create_visitor"),escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;Matcher.prototype.match=function(path){var match=this.re.exec(path),matchParams={};if(match){this.captures.forEach(function(capture,i){void 0===match[i+1]?matchParams[capture]=void 0:matchParams[capture]=decodeURIComponent(match[i+1])});return matchParams}};var RegexpVisitor=createVisitor({Concat:function(node){return node.children.reduce(function(memo,child){var childResult=this.visit(child);return{re:memo.re+childResult.re,captures:memo.captures.concat(childResult.captures)}}.bind(this),{re:"",captures:[]})},Literal:function(node){return{re:node.props.value.replace(escapeRegExp,"\\$&"),captures:[]}},Splat:function(node){return{re:"([^?]*?)",captures:[node.props.name]}},Param:function(node){return{re:"([^\\/\\?]+)",captures:[node.props.name]}},Optional:function(node){var child=this.visit(node.children[0]);return{re:"(?:"+child.re+")?",captures:child.captures}},Root:function(node){var childResult=this.visit(node.children[0]);return new Matcher({re:new RegExp("^"+childResult.re+"(?=\\?|$)"),captures:childResult.captures})}});module.exports=RegexpVisitor},{"./create_visitor":153}],153:[function(require,module,exports){"use strict";function createVisitor(handlers){nodeTypes.forEach(function(nodeType){if(void 0===handlers[nodeType])throw new Error("No handler defined for "+nodeType.displayName)});return{visit:function(node,context){return this.handlers[node.displayName].call(this,node,context)},handlers:handlers}}var nodeTypes=Object.keys(require("../nodes"));module.exports=createVisitor},{"../nodes":151}],152:[function(require,module,exports){"use strict";var parser=require("./compiled-grammar").parser;parser.yy=require("./nodes");module.exports=parser},{"./compiled-grammar":150,"./nodes":151}],151:[function(require,module,exports){"use strict";function createNode(displayName){return function(props,children){return{displayName:displayName,props:props,children:children||[]}}}module.exports={Root:createNode("Root"),Concat:createNode("Concat"),Literal:createNode("Literal"),Splat:createNode("Splat"),Param:createNode("Param"),Optional:createNode("Optional")}},{}],150:[function(require,module,exports){var parser=function(){function Parser(){this.yy={}}var o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,9],$V1=[1,10],$V2=[1,11],$V3=[1,12],$V4=[5,11,12,13,14,15],parser={trace:function trace(){},yy:{},symbols_:{error:2,root:3,expressions:4,EOF:5,expression:6,optional:7,literal:8,splat:9,param:10,"(":11,")":12,LITERAL:13,SPLAT:14,PARAM:15,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",11:"(",12:")",13:"LITERAL",14:"SPLAT",15:"PARAM"},productions_:[0,[3,2],[3,1],[4,2],[4,1],[6,1],[6,1],[6,1],[6,1],[7,3],[8,1],[9,1],[10,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return new yy.Root({},[$$[$0-1]]);case 2:return new yy.Root({},[new yy.Literal({value:""})]);case 3:this.$=new yy.Concat({},[$$[$0-1],$$[$0]]);break;case 4:case 5:this.$=$$[$0];break;case 6:this.$=new yy.Literal({value:$$[$0]});break;case 7:this.$=new yy.Splat({name:$$[$0]});break;case 8:this.$=new yy.Param({name:$$[$0]});break;case 9:this.$=new yy.Optional({},[$$[$0-1]]);break;case 10:this.$=yytext;break;case 11:case 12:this.$=yytext.slice(1)}},table:[{3:1,4:2,5:[1,3],6:4,7:5,8:6,9:7,10:8,11:$V0,13:$V1,14:$V2,15:$V3},{1:[3]},{5:[1,13],6:14,7:5,8:6,9:7,10:8,11:$V0,13:$V1,14:$V2,15:$V3},{1:[2,2]},o($V4,[2,4]),o($V4,[2,5]),o($V4,[2,6]),o($V4,[2,7]),o($V4,[2,8]),{4:15,6:4,7:5,8:6,9:7,10:8,11:$V0,13:$V1,14:$V2,15:$V3},o($V4,[2,10]),o($V4,[2,11]),o($V4,[2,12]),{1:[2,1]},o($V4,[2,3]),{6:14,7:5,8:6,9:7,10:8,11:$V0,12:[1,16],13:$V1,14:$V2,15:$V3},o($V4,[2,9])],defaultActions:{3:[2,2],13:[2,1]},parseError:function parseError(str,hash){function _parseError(msg,hash){this.message=msg;this.hash=hash}if(!hash.recoverable){_parseError.prototype=Error;throw new _parseError(str,hash)}this.trace(str)},parse:function parse(input){function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}var self=this,stack=[0],tstack=[],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1,args=lstack.slice.call(arguments,1),lexer=Object.create(this.lexer),sharedState={yy:{}};for(var k in this.yy)Object.prototype.hasOwnProperty.call(this.yy,k)&&(sharedState.yy[k]=this.yy[k]);lexer.setInput(input,sharedState.yy);sharedState.yy.lexer=lexer;sharedState.yy.parser=this;void 0===lexer.yylloc&&(lexer.yylloc={});var yyloc=lexer.yylloc;lstack.push(yyloc);var ranges=lexer.options&&lexer.options.ranges;"function"==typeof sharedState.yy.parseError?this.parseError=sharedState.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var lex=function(){var token;"number"!=typeof(token=lexer.lex()||1)&&(token=self.symbols_[token]||token);return token},symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;;){state=stack[stack.length-1];if(this.defaultActions[state])action=this.defaultActions[state];else{null!==symbol&&void 0!==symbol||(symbol=lex());action=table[state]&&table[state][symbol]}if(void 0===action||!action.length||!action[0]){var errStr="";expected=[];for(p in table[state])this.terminals_[p]&&p>2&&expected.push("'"+this.terminals_[p]+"'");errStr=lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(1==symbol?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'");this.parseError(errStr,{text:lexer.match,token:this.terminals_[symbol]||symbol,line:lexer.yylineno,loc:yyloc,expected:expected})}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol);vstack.push(lexer.yytext);lstack.push(lexer.yylloc);stack.push(action[1]);symbol=null;if(preErrorSymbol){symbol=preErrorSymbol;preErrorSymbol=null}else{yyleng=lexer.yyleng;yytext=lexer.yytext;yylineno=lexer.yylineno;yyloc=lexer.yylloc;recovering>0&&recovering--}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]);if(void 0!==(r=this.performAction.apply(yyval,[yytext,yyleng,yylineno,sharedState.yy,action[1],vstack,lstack].concat(args))))return r;if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return!0}}return!0}},lexer={EOF:1,parseError:function parseError(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input,yy){this.yy=yy||this.yy||{};this._input=input;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;if(ch.match(/(?:\r\n?|\n).*/g)){this.yylineno++;this.yylloc.last_line++}else this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(!this.options.backtrack_lexer)return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});this._backtrack=!0;return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;next.length<20&&(next+=this._input.substr(0,20-next.length));return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer){backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};this.options.ranges&&(backup.yylloc.range=this.yylloc.range.slice(0))}(lines=match[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=lines.length);this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._more=!1;this._backtrack=!1;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(token)return token;if(this._backtrack){for(var k in backup)this[k]=backup[k];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var token,match,tempMatch,index;if(!this._more){this.yytext="";this.match=""}for(var rules=this._currentRules(),i=0;i<rules.length;i++)if((tempMatch=this._input.match(this.rules[rules[i]]))&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(this.options.backtrack_lexer){if(!1!==(token=this.test_match(tempMatch,rules[i])))return token;if(this._backtrack){match=!1;continue}return!1}if(!this.options.flex)break}return match?!1!==(token=this.test_match(match,rules[index]))&&token:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function lex(){var r=this.next();return r||this.lex()},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function _currentRules(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function topState(n){return(n=this.conditionStack.length-1-Math.abs(n||0))>=0?this.conditionStack[n]:"INITIAL"},pushState:function pushState(condition){this.begin(condition)},stateStackSize:function stateStackSize(){return this.conditionStack.length},options:{},performAction:function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:return"(";case 1:return")";case 2:return"SPLAT";case 3:return"PARAM";case 4:case 5:return"LITERAL";case 6:return"EOF"}},rules:[/^(?:\()/,/^(?:\))/,/^(?:\*+\w+)/,/^(?::+\w+)/,/^(?:[\w%\-~\n]+)/,/^(?:.)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6],inclusive:!0}}};parser.lexer=lexer;Parser.prototype=parser;parser.Parser=Parser;return new Parser}();if(void 0!==require&&void 0!==exports){exports.parser=parser;exports.Parser=parser.Parser;exports.parse=function(){return parser.parse.apply(parser,arguments)}}},{}],123:[function(require,module,exports){var baseAssignValue=require("./_baseAssignValue"),createAggregator=require("./_createAggregator"),hasOwnProperty=Object.prototype.hasOwnProperty,groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):baseAssignValue(result,key,[value])});module.exports=groupBy},{"./_baseAssignValue":37,"./_createAggregator":63}],63:[function(require,module,exports){function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,baseIteratee(iteratee,2),accumulator)}}var arrayAggregator=require("./_arrayAggregator"),baseAggregator=require("./_baseAggregator"),baseIteratee=require("./_baseIteratee"),isArray=require("./isArray");module.exports=createAggregator},{"./_arrayAggregator":29,"./_baseAggregator":36,"./_baseIteratee":51,"./isArray":127}],51:[function(require,module,exports){function baseIteratee(value){return"function"==typeof value?value:null==value?identity:"object"==typeof value?isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}var baseMatches=require("./_baseMatches"),baseMatchesProperty=require("./_baseMatchesProperty"),identity=require("./identity"),isArray=require("./isArray"),property=require("./property");module.exports=baseIteratee},{"./_baseMatches":53,"./_baseMatchesProperty":54,"./identity":125,"./isArray":127,"./property":138}],138:[function(require,module,exports){function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}var baseProperty=require("./_baseProperty"),basePropertyDeep=require("./_basePropertyDeep"),isKey=require("./_isKey"),toKey=require("./_toKey");module.exports=property},{"./_baseProperty":55,"./_basePropertyDeep":56,"./_isKey":86,"./_toKey":119}],56:[function(require,module,exports){function basePropertyDeep(path){return function(object){return baseGet(object,path)}}var baseGet=require("./_baseGet");module.exports=basePropertyDeep},{"./_baseGet":41}],55:[function(require,module,exports){function baseProperty(key){return function(object){return null==object?void 0:object[key]}}module.exports=baseProperty},{}],125:[function(require,module,exports){function identity(value){return value}module.exports=identity},{}],54:[function(require,module,exports){function baseMatchesProperty(path,srcValue){return isKey(path)&&isStrictComparable(srcValue)?matchesStrictComparable(toKey(path),srcValue):function(object){var objValue=get(object,path);return void 0===objValue&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}var baseIsEqual=require("./_baseIsEqual"),get=require("./get"),hasIn=require("./hasIn"),isKey=require("./_isKey"),isStrictComparable=require("./_isStrictComparable"),matchesStrictComparable=require("./_matchesStrictComparable"),toKey=require("./_toKey"),COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;module.exports=baseMatchesProperty},{"./_baseIsEqual":46,"./_isKey":86,"./_isStrictComparable":90,"./_matchesStrictComparable":102,"./_toKey":119,"./get":122,"./hasIn":124}],124:[function(require,module,exports){function hasIn(object,path){return null!=object&&hasPath(object,path,baseHasIn)}var baseHasIn=require("./_baseHasIn"),hasPath=require("./_hasPath");module.exports=hasIn},{"./_baseHasIn":44,"./_hasPath":79}],79:[function(require,module,exports){function hasPath(object,path,hasFunc){for(var index=-1,length=(path=castPath(path,object)).length,result=!1;++index<length;){var key=toKey(path[index]);if(!(result=null!=object&&hasFunc(object,key)))break;object=object[key]}return result||++index!=length?result:!!(length=null==object?0:object.length)&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}var castPath=require("./_castPath"),isArguments=require("./isArguments"),isArray=require("./isArray"),isIndex=require("./_isIndex"),isLength=require("./isLength"),toKey=require("./_toKey");module.exports=hasPath},{"./_castPath":61,"./_isIndex":85,"./_toKey":119,"./isArguments":126,"./isArray":127,"./isLength":131}],122:[function(require,module,exports){function get(object,path,defaultValue){var result=null==object?void 0:baseGet(object,path);return void 0===result?defaultValue:result}var baseGet=require("./_baseGet");module.exports=get},{"./_baseGet":41}],53:[function(require,module,exports){function baseMatches(source){var matchData=getMatchData(source);return 1==matchData.length&&matchData[0][2]?matchesStrictComparable(matchData[0][0],matchData[0][1]):function(object){return object===source||baseIsMatch(object,source,matchData)}}var baseIsMatch=require("./_baseIsMatch"),getMatchData=require("./_getMatchData"),matchesStrictComparable=require("./_matchesStrictComparable");module.exports=baseMatches},{"./_baseIsMatch":48,"./_getMatchData":73,"./_matchesStrictComparable":102}],102:[function(require,module,exports){function matchesStrictComparable(key,srcValue){return function(object){return null!=object&&(object[key]===srcValue&&(void 0!==srcValue||key in Object(object)))}}module.exports=matchesStrictComparable},{}],73:[function(require,module,exports){function getMatchData(object){for(var result=keys(object),length=result.length;length--;){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}var isStrictComparable=require("./_isStrictComparable"),keys=require("./keys");module.exports=getMatchData},{"./_isStrictComparable":90,"./keys":136}],90:[function(require,module,exports){function isStrictComparable(value){return value===value&&!isObject(value)}var isObject=require("./isObject");module.exports=isStrictComparable},{"./isObject":132}],48:[function(require,module,exports){function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;object=Object(object);for(;index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){var key=(data=matchData[index])[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(void 0===objValue&&!(key in object))return!1}else{var stack=new Stack;if(customizer)var result=customizer(objValue,srcValue,key,object,source,stack);if(!(void 0===result?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result))return!1}}return!0}var Stack=require("./_Stack"),baseIsEqual=require("./_baseIsEqual"),COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;module.exports=baseIsMatch},{"./_Stack":25,"./_baseIsEqual":46}],46:[function(require,module,exports){function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack))}var baseIsEqualDeep=require("./_baseIsEqualDeep"),isObjectLike=require("./isObjectLike");module.exports=baseIsEqual},{"./_baseIsEqualDeep":47,"./isObjectLike":133}],47:[function(require,module,exports){function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other),objIsObj=(objTag=objTag==argsTag?objectTag:objTag)==objectTag,othIsObj=(othTag=othTag==argsTag?objectTag:othTag)==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other))return!1;objIsArr=!0;objIsObj=!1}if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack)}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag)return!1;stack||(stack=new Stack);return equalObjects(object,other,bitmask,customizer,equalFunc,stack)}var Stack=require("./_Stack"),equalArrays=require("./_equalArrays"),equalByTag=require("./_equalByTag"),equalObjects=require("./_equalObjects"),getTag=require("./_getTag"),isArray=require("./isArray"),isBuffer=require("./isBuffer"),isTypedArray=require("./isTypedArray"),COMPARE_PARTIAL_FLAG=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=baseIsEqualDeep},{"./_Stack":25,"./_equalArrays":67,"./_equalByTag":68,"./_equalObjects":69,"./_getTag":77,"./isArray":127,"./isBuffer":129,"./isTypedArray":135}],77:[function(require,module,exports){var DataView=require("./_DataView"),Map=require("./_Map"),Promise=require("./_Promise"),Set=require("./_Set"),WeakMap=require("./_WeakMap"),baseGetTag=require("./_baseGetTag"),toSource=require("./_toSource"),mapTag="[object Map]",objectTag="[object Object]",promiseTag="[object Promise]",setTag="[object Set]",weakMapTag="[object WeakMap]",dataViewTag="[object DataView]",dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),getTag=baseGetTag;(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag)&&(getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:void 0,ctorString=Ctor?toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return result});module.exports=getTag},{"./_DataView":17,"./_Map":20,"./_Promise":22,"./_Set":23,"./_WeakMap":28,"./_baseGetTag":43,"./_toSource":120}],69:[function(require,module,exports){function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length;if(objLength!=getAllKeys(other).length&&!isPartial)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key)))return!1}var stacked=stack.get(object);if(stacked&&stack.get(other))return stacked==other;var result=!0;stack.set(object,other);stack.set(other,object);for(var skipCtor=isPartial;++index<objLength;){var objValue=object[key=objProps[index]],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(void 0===compared?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor)&&(result=!1)}stack.delete(object);stack.delete(other);return result}var getAllKeys=require("./_getAllKeys"),COMPARE_PARTIAL_FLAG=1,hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=equalObjects},{"./_getAllKeys":71}],71:[function(require,module,exports){function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}var baseGetAllKeys=require("./_baseGetAllKeys"),getSymbols=require("./_getSymbols"),keys=require("./keys");module.exports=getAllKeys},{"./_baseGetAllKeys":42,"./_getSymbols":76,"./keys":136}],76:[function(require,module,exports){var arrayFilter=require("./_arrayFilter"),stubArray=require("./stubArray"),propertyIsEnumerable=Object.prototype.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols?function(object){if(null==object)return[];object=Object(object);return arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)})}:stubArray;module.exports=getSymbols},{"./_arrayFilter":30,"./stubArray":139}],139:[function(require,module,exports){function stubArray(){return[]}module.exports=stubArray},{}],68:[function(require,module,exports){function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer;other=other.buffer;case arrayBufferTag:return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=COMPARE_UNORDERED_FLAG;stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack.delete(object);return result;case symbolTag:if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}var Symbol=require("./_Symbol"),Uint8Array=require("./_Uint8Array"),eq=require("./eq"),equalArrays=require("./_equalArrays"),mapToArray=require("./_mapToArray"),setToArray=require("./_setToArray"),COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;module.exports=equalByTag},{"./_Symbol":26,"./_Uint8Array":27,"./_equalArrays":67,"./_mapToArray":101,"./_setToArray":112,"./eq":121}],112:[function(require,module,exports){function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}module.exports=setToArray},{}],101:[function(require,module,exports){function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}module.exports=mapToArray},{}],67:[function(require,module,exports){function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var stacked=stack.get(array);if(stacked&&stack.get(other))return stacked==other;var index=-1,result=!0,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:void 0;stack.set(array,other);stack.set(other,array);for(;++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(void 0!==compared){if(compared)continue;result=!1;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex)})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}stack.delete(array);stack.delete(other);return result}var SetCache=require("./_SetCache"),arraySome=require("./_arraySome"),cacheHas=require("./_cacheHas"),COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;module.exports=equalArrays},{"./_SetCache":24,"./_arraySome":34,"./_cacheHas":60}],60:[function(require,module,exports){function cacheHas(cache,key){return cache.has(key)}module.exports=cacheHas},{}],44:[function(require,module,exports){function baseHasIn(object,key){return null!=object&&key in Object(object)}module.exports=baseHasIn},{}],42:[function(require,module,exports){function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}var arrayPush=require("./_arrayPush"),isArray=require("./isArray");module.exports=baseGetAllKeys},{"./_arrayPush":33,"./isArray":127}],41:[function(require,module,exports){function baseGet(object,path){for(var index=0,length=(path=castPath(path,object)).length;null!=object&&index<length;)object=object[toKey(path[index++])];return index&&index==length?object:void 0}var castPath=require("./_castPath"),toKey=require("./_toKey");module.exports=baseGet},{"./_castPath":61,"./_toKey":119}],119:[function(require,module,exports){function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}var isSymbol=require("./isSymbol"),INFINITY=1/0;module.exports=toKey},{"./isSymbol":134}],61:[function(require,module,exports){function castPath(value,object){return isArray(value)?value:isKey(value,object)?[value]:stringToPath(toString(value))}var isArray=require("./isArray"),isKey=require("./_isKey"),stringToPath=require("./_stringToPath"),toString=require("./toString");module.exports=castPath},{"./_isKey":86,"./_stringToPath":118,"./isArray":127,"./toString":141}],141:[function(require,module,exports){function toString(value){return null==value?"":baseToString(value)}var baseToString=require("./_baseToString");module.exports=toString},{"./_baseToString":58}],58:[function(require,module,exports){function baseToString(value){if("string"==typeof value)return value;if(isArray(value))return arrayMap(value,baseToString)+"";if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}var Symbol=require("./_Symbol"),arrayMap=require("./_arrayMap"),isArray=require("./isArray"),isSymbol=require("./isSymbol"),INFINITY=1/0,symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;module.exports=baseToString},{"./_Symbol":26,"./_arrayMap":32,"./isArray":127,"./isSymbol":134}],118:[function(require,module,exports){var reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=require("./_memoizeCapped")(function(string){var result=[];reLeadingDot.test(string)&&result.push("");string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});module.exports=stringToPath},{"./_memoizeCapped":103}],103:[function(require,module,exports){function memoizeCapped(func){var result=memoize(func,function(key){cache.size===MAX_MEMOIZE_SIZE&&cache.clear();return key}),cache=result.cache;return result}var memoize=require("./memoize"),MAX_MEMOIZE_SIZE=500;module.exports=memoizeCapped},{"./memoize":137}],137:[function(require,module,exports){function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}var MapCache=require("./_MapCache"),FUNC_ERROR_TEXT="Expected a function";memoize.Cache=MapCache;module.exports=memoize},{"./_MapCache":21}],86:[function(require,module,exports){function isKey(value,object){if(isArray(value))return!1;var type=typeof value;return!("number"!=type&&"symbol"!=type&&"boolean"!=type&&null!=value&&!isSymbol(value))||(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))}var isArray=require("./isArray"),isSymbol=require("./isSymbol"),reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;module.exports=isKey},{"./isArray":127,"./isSymbol":134}],134:[function(require,module,exports){function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&baseGetTag(value)==symbolTag}var baseGetTag=require("./_baseGetTag"),isObjectLike=require("./isObjectLike"),symbolTag="[object Symbol]";module.exports=isSymbol},{"./_baseGetTag":43,"./isObjectLike":133}],37:[function(require,module,exports){function baseAssignValue(object,key,value){"__proto__"==key&&defineProperty?defineProperty(object,key,{configurable:!0,enumerable:!0,value:value,writable:!0}):object[key]=value}var defineProperty=require("./_defineProperty");module.exports=baseAssignValue},{"./_defineProperty":66}],66:[function(require,module,exports){var getNative=require("./_getNative"),defineProperty=function(){try{var func=getNative(Object,"defineProperty");func({},"",{});return func}catch(e){}}();module.exports=defineProperty},{"./_getNative":74}],36:[function(require,module,exports){function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)});return accumulator}var baseEach=require("./_baseEach");module.exports=baseAggregator},{"./_baseEach":38}],38:[function(require,module,exports){var baseForOwn=require("./_baseForOwn"),baseEach=require("./_createBaseEach")(baseForOwn);module.exports=baseEach},{"./_baseForOwn":40,"./_createBaseEach":64}],64:[function(require,module,exports){function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}var isArrayLike=require("./isArrayLike");module.exports=createBaseEach},{"./isArrayLike":128}],40:[function(require,module,exports){function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}var baseFor=require("./_baseFor"),keys=require("./keys");module.exports=baseForOwn},{"./_baseFor":39,"./keys":136}],136:[function(require,module,exports){function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}var arrayLikeKeys=require("./_arrayLikeKeys"),baseKeys=require("./_baseKeys"),isArrayLike=require("./isArrayLike");module.exports=keys},{"./_arrayLikeKeys":31,"./_baseKeys":52,"./isArrayLike":128}],128:[function(require,module,exports){function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}var isFunction=require("./isFunction"),isLength=require("./isLength");module.exports=isArrayLike},{"./isFunction":130,"./isLength":131}],52:[function(require,module,exports){function baseKeys(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}var isPrototype=require("./_isPrototype"),nativeKeys=require("./_nativeKeys"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=baseKeys},{"./_isPrototype":89,"./_nativeKeys":105}],105:[function(require,module,exports){var nativeKeys=require("./_overArg")(Object.keys,Object);module.exports=nativeKeys},{"./_overArg":108}],108:[function(require,module,exports){function overArg(func,transform){return function(arg){return func(transform(arg))}}module.exports=overArg},{}],89:[function(require,module,exports){function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}var objectProto=Object.prototype;module.exports=isPrototype},{}],39:[function(require,module,exports){var baseFor=require("./_createBaseFor")();module.exports=baseFor},{"./_createBaseFor":65}],65:[function(require,module,exports){function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}module.exports=createBaseFor},{}],34:[function(require,module,exports){function arraySome(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}module.exports=arraySome},{}],33:[function(require,module,exports){function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}module.exports=arrayPush},{}],32:[function(require,module,exports){function arrayMap(array,iteratee){for(var index=-1,length=null==array?0:array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}module.exports=arrayMap},{}],31:[function(require,module,exports){function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}var baseTimes=require("./_baseTimes"),isArguments=require("./isArguments"),isArray=require("./isArray"),isBuffer=require("./isBuffer"),isIndex=require("./_isIndex"),isTypedArray=require("./isTypedArray"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=arrayLikeKeys},{"./_baseTimes":57,"./_isIndex":85,"./isArguments":126,"./isArray":127,"./isBuffer":129,"./isTypedArray":135}],135:[function(require,module,exports){var baseIsTypedArray=require("./_baseIsTypedArray"),baseUnary=require("./_baseUnary"),nodeUtil=require("./_nodeUtil"),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;module.exports=isTypedArray},{"./_baseIsTypedArray":50,"./_baseUnary":59,"./_nodeUtil":106}],106:[function(require,module,exports){var freeGlobal=require("./_freeGlobal"),freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,freeProcess=freeModule&&freeModule.exports===freeExports&&freeGlobal.process,nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();module.exports=nodeUtil},{"./_freeGlobal":70}],59:[function(require,module,exports){function baseUnary(func){return function(value){return func(value)}}module.exports=baseUnary},{}],50:[function(require,module,exports){function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}var baseGetTag=require("./_baseGetTag"),isLength=require("./isLength"),isObjectLike=require("./isObjectLike"),argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags["[object Float32Array]"]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;module.exports=baseIsTypedArray},{"./_baseGetTag":43,"./isLength":131,"./isObjectLike":133}],131:[function(require,module,exports){function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var MAX_SAFE_INTEGER=9007199254740991;module.exports=isLength},{}],129:[function(require,module,exports){var root=require("./_root"),stubFalse=require("./stubFalse"),freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,Buffer=freeModule&&freeModule.exports===freeExports?root.Buffer:void 0,isBuffer=(Buffer?Buffer.isBuffer:void 0)||stubFalse;module.exports=isBuffer},{"./_root":109,"./stubFalse":140}],140:[function(require,module,exports){function stubFalse(){return!1}module.exports=stubFalse},{}],127:[function(require,module,exports){var isArray=Array.isArray;module.exports=isArray},{}],126:[function(require,module,exports){var baseIsArguments=require("./_baseIsArguments"),isObjectLike=require("./isObjectLike"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,propertyIsEnumerable=objectProto.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};module.exports=isArguments},{"./_baseIsArguments":45,"./isObjectLike":133}],45:[function(require,module,exports){function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}var baseGetTag=require("./_baseGetTag"),isObjectLike=require("./isObjectLike"),argsTag="[object Arguments]";module.exports=baseIsArguments},{"./_baseGetTag":43,"./isObjectLike":133}],133:[function(require,module,exports){function isObjectLike(value){return null!=value&&"object"==typeof value}module.exports=isObjectLike},{}],85:[function(require,module,exports){function isIndex(value,length){return!!(length=null==length?MAX_SAFE_INTEGER:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}var MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;module.exports=isIndex},{}],57:[function(require,module,exports){function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}module.exports=baseTimes},{}],30:[function(require,module,exports){function arrayFilter(array,predicate){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}module.exports=arrayFilter},{}],29:[function(require,module,exports){function arrayAggregator(array,setter,iteratee,accumulator){for(var index=-1,length=null==array?0:array.length;++index<length;){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}module.exports=arrayAggregator},{}],28:[function(require,module,exports){var WeakMap=require("./_getNative")(require("./_root"),"WeakMap");module.exports=WeakMap},{"./_getNative":74,"./_root":109}],27:[function(require,module,exports){var Uint8Array=require("./_root").Uint8Array;module.exports=Uint8Array},{"./_root":109}],25:[function(require,module,exports){function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}var ListCache=require("./_ListCache"),stackClear=require("./_stackClear"),stackDelete=require("./_stackDelete"),stackGet=require("./_stackGet"),stackHas=require("./_stackHas"),stackSet=require("./_stackSet");Stack.prototype.clear=stackClear;Stack.prototype.delete=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;module.exports=Stack},{"./_ListCache":19,"./_stackClear":113,"./_stackDelete":114,"./_stackGet":115,"./_stackHas":116,"./_stackSet":117}],117:[function(require,module,exports){function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this}data=this.__data__=new MapCache(pairs)}data.set(key,value);this.size=data.size;return this}var ListCache=require("./_ListCache"),Map=require("./_Map"),MapCache=require("./_MapCache"),LARGE_ARRAY_SIZE=200;module.exports=stackSet},{"./_ListCache":19,"./_Map":20,"./_MapCache":21}],116:[function(require,module,exports){function stackHas(key){return this.__data__.has(key)}module.exports=stackHas},{}],115:[function(require,module,exports){function stackGet(key){return this.__data__.get(key)}module.exports=stackGet},{}],114:[function(require,module,exports){function stackDelete(key){var data=this.__data__,result=data.delete(key);this.size=data.size;return result}module.exports=stackDelete},{}],113:[function(require,module,exports){function stackClear(){this.__data__=new ListCache;this.size=0}var ListCache=require("./_ListCache");module.exports=stackClear},{"./_ListCache":19}],24:[function(require,module,exports){function SetCache(values){var index=-1,length=null==values?0:values.length;this.__data__=new MapCache;for(;++index<length;)this.add(values[index])}var MapCache=require("./_MapCache"),setCacheAdd=require("./_setCacheAdd"),setCacheHas=require("./_setCacheHas");SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;module.exports=SetCache},{"./_MapCache":21,"./_setCacheAdd":110,"./_setCacheHas":111}],111:[function(require,module,exports){function setCacheHas(value){return this.__data__.has(value)}module.exports=setCacheHas},{}],110:[function(require,module,exports){function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this}var HASH_UNDEFINED="__lodash_hash_undefined__";module.exports=setCacheAdd},{}],23:[function(require,module,exports){var Set=require("./_getNative")(require("./_root"),"Set");module.exports=Set},{"./_getNative":74,"./_root":109}],22:[function(require,module,exports){var Promise=require("./_getNative")(require("./_root"),"Promise");module.exports=Promise},{"./_getNative":74,"./_root":109}],21:[function(require,module,exports){function MapCache(entries){var index=-1,length=null==entries?0:entries.length;this.clear();for(;++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}var mapCacheClear=require("./_mapCacheClear"),mapCacheDelete=require("./_mapCacheDelete"),mapCacheGet=require("./_mapCacheGet"),mapCacheHas=require("./_mapCacheHas"),mapCacheSet=require("./_mapCacheSet");MapCache.prototype.clear=mapCacheClear;MapCache.prototype.delete=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;module.exports=MapCache},{"./_mapCacheClear":96,"./_mapCacheDelete":97,"./_mapCacheGet":98,"./_mapCacheHas":99,"./_mapCacheSet":100}],100:[function(require,module,exports){function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this}var getMapData=require("./_getMapData");module.exports=mapCacheSet},{"./_getMapData":72}],99:[function(require,module,exports){function mapCacheHas(key){return getMapData(this,key).has(key)}var getMapData=require("./_getMapData");module.exports=mapCacheHas},{"./_getMapData":72}],98:[function(require,module,exports){function mapCacheGet(key){return getMapData(this,key).get(key)}var getMapData=require("./_getMapData");module.exports=mapCacheGet},{"./_getMapData":72}],97:[function(require,module,exports){function mapCacheDelete(key){var result=getMapData(this,key).delete(key);this.size-=result?1:0;return result}var getMapData=require("./_getMapData");module.exports=mapCacheDelete},{"./_getMapData":72}],72:[function(require,module,exports){function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data["string"==typeof key?"string":"hash"]:data.map}var isKeyable=require("./_isKeyable");module.exports=getMapData},{"./_isKeyable":87}],87:[function(require,module,exports){function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}module.exports=isKeyable},{}],96:[function(require,module,exports){function mapCacheClear(){this.size=0;this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}var Hash=require("./_Hash"),ListCache=require("./_ListCache"),Map=require("./_Map");module.exports=mapCacheClear},{"./_Hash":18,"./_ListCache":19,"./_Map":20}],20:[function(require,module,exports){var Map=require("./_getNative")(require("./_root"),"Map");module.exports=Map},{"./_getNative":74,"./_root":109}],19:[function(require,module,exports){function ListCache(entries){var index=-1,length=null==entries?0:entries.length;this.clear();for(;++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}var listCacheClear=require("./_listCacheClear"),listCacheDelete=require("./_listCacheDelete"),listCacheGet=require("./_listCacheGet"),listCacheHas=require("./_listCacheHas"),listCacheSet=require("./_listCacheSet");ListCache.prototype.clear=listCacheClear;ListCache.prototype.delete=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;module.exports=ListCache},{"./_listCacheClear":91,"./_listCacheDelete":92,"./_listCacheGet":93,"./_listCacheHas":94,"./_listCacheSet":95}],95:[function(require,module,exports){function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value])}else data[index][1]=value;return this}var assocIndexOf=require("./_assocIndexOf");module.exports=listCacheSet},{"./_assocIndexOf":35}],94:[function(require,module,exports){function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}var assocIndexOf=require("./_assocIndexOf");module.exports=listCacheHas},{"./_assocIndexOf":35}],93:[function(require,module,exports){function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]}var assocIndexOf=require("./_assocIndexOf");module.exports=listCacheGet},{"./_assocIndexOf":35}],92:[function(require,module,exports){function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0)return!1;index==data.length-1?data.pop():splice.call(data,index,1);--this.size;return!0}var assocIndexOf=require("./_assocIndexOf"),splice=Array.prototype.splice;module.exports=listCacheDelete},{"./_assocIndexOf":35}],35:[function(require,module,exports){function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}var eq=require("./eq");module.exports=assocIndexOf},{"./eq":121}],121:[function(require,module,exports){function eq(value,other){return value===other||value!==value&&other!==other}module.exports=eq},{}],91:[function(require,module,exports){function listCacheClear(){this.__data__=[];this.size=0}module.exports=listCacheClear},{}],18:[function(require,module,exports){function Hash(entries){var index=-1,length=null==entries?0:entries.length;this.clear();for(;++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}var hashClear=require("./_hashClear"),hashDelete=require("./_hashDelete"),hashGet=require("./_hashGet"),hashHas=require("./_hashHas"),hashSet=require("./_hashSet");Hash.prototype.clear=hashClear;Hash.prototype.delete=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;module.exports=Hash},{"./_hashClear":80,"./_hashDelete":81,"./_hashGet":82,"./_hashHas":83,"./_hashSet":84}],84:[function(require,module,exports){function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&void 0===value?HASH_UNDEFINED:value;return this}var nativeCreate=require("./_nativeCreate"),HASH_UNDEFINED="__lodash_hash_undefined__";module.exports=hashSet},{"./_nativeCreate":104}],83:[function(require,module,exports){function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)}var nativeCreate=require("./_nativeCreate"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=hashHas},{"./_nativeCreate":104}],82:[function(require,module,exports){function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0}var nativeCreate=require("./_nativeCreate"),HASH_UNDEFINED="__lodash_hash_undefined__",hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=hashGet},{"./_nativeCreate":104}],81:[function(require,module,exports){function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result}module.exports=hashDelete},{}],80:[function(require,module,exports){function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0}var nativeCreate=require("./_nativeCreate");module.exports=hashClear},{"./_nativeCreate":104}],104:[function(require,module,exports){var nativeCreate=require("./_getNative")(Object,"create");module.exports=nativeCreate},{"./_getNative":74}],17:[function(require,module,exports){var DataView=require("./_getNative")(require("./_root"),"DataView");module.exports=DataView},{"./_getNative":74,"./_root":109}],74:[function(require,module,exports){function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:void 0}var baseIsNative=require("./_baseIsNative"),getValue=require("./_getValue");module.exports=getNative},{"./_baseIsNative":49,"./_getValue":78}],78:[function(require,module,exports){function getValue(object,key){return null==object?void 0:object[key]}module.exports=getValue},{}],49:[function(require,module,exports){function baseIsNative(value){return!(!isObject(value)||isMasked(value))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value))}var isFunction=require("./isFunction"),isMasked=require("./_isMasked"),isObject=require("./isObject"),toSource=require("./_toSource"),reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");module.exports=baseIsNative},{"./_isMasked":88,"./_toSource":120,"./isFunction":130,"./isObject":132}],130:[function(require,module,exports){function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}var baseGetTag=require("./_baseGetTag"),isObject=require("./isObject"),asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";module.exports=isFunction},{"./_baseGetTag":43,"./isObject":132}],132:[function(require,module,exports){function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}module.exports=isObject},{}],43:[function(require,module,exports){function baseGetTag(value){return null==value?void 0===value?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}var Symbol=require("./_Symbol"),getRawTag=require("./_getRawTag"),objectToString=require("./_objectToString"),nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol?Symbol.toStringTag:void 0;module.exports=baseGetTag},{"./_Symbol":26,"./_getRawTag":75,"./_objectToString":107}],107:[function(require,module,exports){function objectToString(value){return nativeObjectToString.call(value)}var nativeObjectToString=Object.prototype.toString;module.exports=objectToString},{}],75:[function(require,module,exports){function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=void 0;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]);return result}var Symbol=require("./_Symbol"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=Symbol?Symbol.toStringTag:void 0;module.exports=getRawTag},{"./_Symbol":26}],26:[function(require,module,exports){var Symbol=require("./_root").Symbol;module.exports=Symbol},{"./_root":109}],120:[function(require,module,exports){function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}var funcToString=Function.prototype.toString;module.exports=toSource},{}],88:[function(require,module,exports){function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var coreJsData=require("./_coreJsData"),maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();module.exports=isMasked},{"./_coreJsData":62}],62:[function(require,module,exports){var coreJsData=require("./_root")["__core-js_shared__"];module.exports=coreJsData},{"./_root":109}],109:[function(require,module,exports){var freeGlobal=require("./_freeGlobal"),freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();module.exports=root},{"./_freeGlobal":70}],70:[function(require,module,exports){(function(global){var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global;module.exports=freeGlobal}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(require,module,exports){!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory(require("jquery")):factory(jQuery)}(function($){function onTouchEnd(){this.removeEventListener("touchmove",onTouchMove);this.removeEventListener("touchend",onTouchEnd);isMoving=!1}function onTouchMove(e){$.detectSwipe.preventDefault&&e.preventDefault();if(isMoving){var x=e.touches[0].pageX,y=e.touches[0].pageY,dx=startX-x,dy=startY-y,dir,ratio=window.devicePixelRatio||1;Math.abs(dx)*ratio>=$.detectSwipe.threshold?dir=dx>0?"left":"right":Math.abs(dy)*ratio>=$.detectSwipe.threshold&&(dir=dy>0?"up":"down");if(dir){onTouchEnd.call(this);$(this).trigger("swipe",dir).trigger("swipe"+dir)}}}function onTouchStart(e){if(1==e.touches.length){startX=e.touches[0].pageX;startY=e.touches[0].pageY;isMoving=!0;this.addEventListener("touchmove",onTouchMove,!1);this.addEventListener("touchend",onTouchEnd,!1)}}function setup(){this.addEventListener&&this.addEventListener("touchstart",onTouchStart,!1)}function teardown(){this.removeEventListener("touchstart",onTouchStart)}$.detectSwipe={version:"2.1.2",enabled:"ontouchstart"in document.documentElement,preventDefault:!0,threshold:20};var startX,startY,isMoving=!1;$.event.special.swipe={setup:setup};$.each(["left","up","down","right"],function(){$.event.special["swipe"+this]={setup:function(){$(this).on("swipe",$.noop)}}})})},{jquery:14}],2:[function(require,module,exports){!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","load-image-meta","load-image-scale","load-image-exif","canvas-to-blob","./jquery.fileupload-process"],factory):"object"==typeof exports?factory(require("jquery"),require("blueimp-load-image/js/load-image"),require("blueimp-load-image/js/load-image-meta"),require("blueimp-load-image/js/load-image-scale"),require("blueimp-load-image/js/load-image-exif"),require("blueimp-canvas-to-blob"),require("./jquery.fileupload-process")):factory(window.jQuery,window.loadImage)}(function($,loadImage){"use strict";$.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"});$.widget("blueimp.fileupload",$.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(data,options){if(options.disabled)return data;var that=this,file=data.files[data.index],dfd=$.Deferred();return"number"===$.type(options.maxFileSize)&&file.size>options.maxFileSize||options.fileTypes&&!options.fileTypes.test(file.type)||!loadImage(file,function(img){img.src&&(data.img=img);dfd.resolveWith(that,[data])},options)?data:dfd.promise()},resizeImage:function(data,options){if(options.disabled||!data.canvas&&!data.img)return data;options=$.extend({canvas:!0},options);var that=this,dfd=$.Deferred(),img=options.canvas&&data.canvas||data.img,resolve=function(newImg){newImg&&(newImg.width!==img.width||newImg.height!==img.height||options.forceResize)&&(data[newImg.getContext?"canvas":"img"]=newImg);data.preview=newImg;dfd.resolveWith(that,[data])},thumbnail;if(data.exif){!0===options.orientation&&(options.orientation=data.exif.get("Orientation"));if(options.thumbnail&&(thumbnail=data.exif.get("Thumbnail"))){loadImage(thumbnail,resolve,options);return dfd.promise()}data.orientation?delete options.orientation:data.orientation=options.orientation}if(img){resolve(loadImage.scale(img,options));return dfd.promise()}return data},saveImage:function(data,options){if(!data.canvas||options.disabled)return data;var that=this,file=data.files[data.index],dfd=$.Deferred();if(!data.canvas.toBlob)return data;data.canvas.toBlob(function(blob){blob.name||(file.type===blob.type?blob.name=file.name:file.name&&(blob.name=file.name.replace(/\.\w+$/,"."+blob.type.substr(6))));file.type!==blob.type&&delete data.imageHead;data.files[data.index]=blob;dfd.resolveWith(that,[data])},options.type||file.type,options.quality);return dfd.promise()},loadImageMetaData:function(data,options){if(options.disabled)return data;var that=this,dfd=$.Deferred();loadImage.parseMetaData(data.files[data.index],function(result){$.extend(data,result);dfd.resolveWith(that,[data])},options);return dfd.promise()},saveImageMetaData:function(data,options){if(!(data.imageHead&&data.canvas&&data.canvas.toBlob)||options.disabled)return data;var file=data.files[data.index],blob=new Blob([data.imageHead,this._blobSlice.call(file,20)],{type:file.type});blob.name=file.name;data.files[data.index]=blob;return data},setImage:function(data,options){data.preview&&!options.disabled&&(data.files[data.index][options.name||"preview"]=data.preview);return data},deleteImageReferences:function(data,options){if(!options.disabled){delete data.img;delete data.canvas;delete data.preview;delete data.imageHead}return data}}})})},{"./jquery.fileupload-process":3,"blueimp-canvas-to-blob":1,"blueimp-load-image/js/load-image":9,"blueimp-load-image/js/load-image-exif":6,"blueimp-load-image/js/load-image-meta":7,"blueimp-load-image/js/load-image-scale":8,jquery:14}],8:[function(require,module,exports){!function(factory){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],factory):factory("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)}(function(loadImage){"use strict";var originalTransform=loadImage.transform;loadImage.transform=function(img,options,callback,file,data){originalTransform.call(loadImage,loadImage.scale(img,options,data),options,callback,file,data)};loadImage.transformCoordinates=function(){};loadImage.getTransformedOptions=function(img,options){var aspectRatio=options.aspectRatio,newOptions,i,width,height;if(!aspectRatio)return options;newOptions={};for(i in options)options.hasOwnProperty(i)&&(newOptions[i]=options[i]);newOptions.crop=!0;if((width=img.naturalWidth||img.width)/(height=img.naturalHeight||img.height)>aspectRatio){newOptions.maxWidth=height*aspectRatio;newOptions.maxHeight=height}else{newOptions.maxWidth=width;newOptions.maxHeight=width/aspectRatio}return newOptions};loadImage.renderImageToCanvas=function(canvas,img,sourceX,sourceY,sourceWidth,sourceHeight,destX,destY,destWidth,destHeight){canvas.getContext("2d").drawImage(img,sourceX,sourceY,sourceWidth,sourceHeight,destX,destY,destWidth,destHeight);return canvas};loadImage.hasCanvasOption=function(options){return options.canvas||options.crop||!!options.aspectRatio};loadImage.scale=function(img,options,data){function scaleUp(){var scale=Math.max((minWidth||destWidth)/destWidth,(minHeight||destHeight)/destHeight);if(scale>1){destWidth*=scale;destHeight*=scale}}function scaleDown(){var scale=Math.min((maxWidth||destWidth)/destWidth,(maxHeight||destHeight)/destHeight);if(scale<1){destWidth*=scale;destHeight*=scale}}options=options||{};var canvas=document.createElement("canvas"),useCanvas=img.getContext||loadImage.hasCanvasOption(options)&&canvas.getContext,width=img.naturalWidth||img.width,height=img.naturalHeight||img.height,destWidth=width,destHeight=height,maxWidth,maxHeight,minWidth,minHeight,sourceWidth,sourceHeight,sourceX,sourceY,pixelRatio,downsamplingRatio,tmp;if(useCanvas){sourceX=(options=loadImage.getTransformedOptions(img,options,data)).left||0;sourceY=options.top||0;if(options.sourceWidth){sourceWidth=options.sourceWidth;void 0!==options.right&&void 0===options.left&&(sourceX=width-sourceWidth-options.right)}else sourceWidth=width-sourceX-(options.right||0);if(options.sourceHeight){sourceHeight=options.sourceHeight;void 0!==options.bottom&&void 0===options.top&&(sourceY=height-sourceHeight-options.bottom)}else sourceHeight=height-sourceY-(options.bottom||0);destWidth=sourceWidth;destHeight=sourceHeight}maxWidth=options.maxWidth;maxHeight=options.maxHeight;minWidth=options.minWidth;minHeight=options.minHeight;if(useCanvas&&maxWidth&&maxHeight&&options.crop){destWidth=maxWidth;destHeight=maxHeight;if((tmp=sourceWidth/sourceHeight-maxWidth/maxHeight)<0){sourceHeight=maxHeight*sourceWidth/maxWidth;void 0===options.top&&void 0===options.bottom&&(sourceY=(height-sourceHeight)/2)}else if(tmp>0){sourceWidth=maxWidth*sourceHeight/maxHeight;void 0===options.left&&void 0===options.right&&(sourceX=(width-sourceWidth)/2)}}else{if(options.contain||options.cover){minWidth=maxWidth=maxWidth||minWidth;minHeight=maxHeight=maxHeight||minHeight}if(options.cover){scaleDown();scaleUp()}else{scaleUp();scaleDown()}}if(useCanvas){if((pixelRatio=options.pixelRatio)>1){canvas.style.width=destWidth+"px";canvas.style.height=destHeight+"px";destWidth*=pixelRatio;destHeight*=pixelRatio;canvas.getContext("2d").scale(pixelRatio,pixelRatio)}if((downsamplingRatio=options.downsamplingRatio)>0&&downsamplingRatio<1&&destWidth<sourceWidth&&destHeight<sourceHeight)for(;sourceWidth*downsamplingRatio>destWidth;){canvas.width=sourceWidth*downsamplingRatio;canvas.height=sourceHeight*downsamplingRatio;loadImage.renderImageToCanvas(canvas,img,sourceX,sourceY,sourceWidth,sourceHeight,0,0,canvas.width,canvas.height);sourceX=0;sourceY=0;sourceWidth=canvas.width;sourceHeight=canvas.height;(img=document.createElement("canvas")).width=sourceWidth;img.height=sourceHeight;loadImage.renderImageToCanvas(img,canvas,0,0,sourceWidth,sourceHeight,0,0,sourceWidth,sourceHeight)}canvas.width=destWidth;canvas.height=destHeight;loadImage.transformCoordinates(canvas,options);return loadImage.renderImageToCanvas(canvas,img,sourceX,sourceY,sourceWidth,sourceHeight,0,0,destWidth,destHeight)}img.width=destWidth;img.height=destHeight;return img}})},{"./load-image":9}],6:[function(require,module,exports){!function(factory){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],factory):"object"==typeof module&&module.exports?factory(require("./load-image"),require("./load-image-meta")):factory(window.loadImage)}(function(loadImage){"use strict";loadImage.ExifMap=function(){return this};loadImage.ExifMap.prototype.map={Orientation:274};loadImage.ExifMap.prototype.get=function(id){return this[id]||this[this.map[id]]};loadImage.getExifThumbnail=function(dataView,offset,length){var hexData,i,b;if(length&&!(offset+length>dataView.byteLength)){hexData=[];for(i=0;i<length;i+=1){b=dataView.getUint8(offset+i);hexData.push((b<16?"0":"")+b.toString(16))}return"data:image/jpeg,%"+hexData.join("%")}console.log("Invalid Exif data: Invalid thumbnail data.")};loadImage.exifTagTypes={1:{getValue:function(dataView,dataOffset){return dataView.getUint8(dataOffset)},size:1},2:{getValue:function(dataView,dataOffset){return String.fromCharCode(dataView.getUint8(dataOffset))},size:1,ascii:!0},3:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getUint16(dataOffset,littleEndian)},size:2},4:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getUint32(dataOffset,littleEndian)},size:4},5:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getUint32(dataOffset,littleEndian)/dataView.getUint32(dataOffset+4,littleEndian)},size:8},9:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getInt32(dataOffset,littleEndian)},size:4},10:{getValue:function(dataView,dataOffset,littleEndian){return dataView.getInt32(dataOffset,littleEndian)/dataView.getInt32(dataOffset+4,littleEndian)},size:8}};loadImage.exifTagTypes[7]=loadImage.exifTagTypes[1];loadImage.getExifValue=function(dataView,tiffOffset,offset,type,length,littleEndian){var tagType=loadImage.exifTagTypes[type],tagSize,dataOffset,values,i,str,c;if(tagType){if(!((dataOffset=(tagSize=tagType.size*length)>4?tiffOffset+dataView.getUint32(offset+8,littleEndian):offset+8)+tagSize>dataView.byteLength)){if(1===length)return tagType.getValue(dataView,dataOffset,littleEndian);values=[];for(i=0;i<length;i+=1)values[i]=tagType.getValue(dataView,dataOffset+i*tagType.size,littleEndian);if(tagType.ascii){str="";for(i=0;i<values.length&&"\0"!==(c=values[i]);i+=1)str+=c;return str}return values}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")};loadImage.parseExifTag=function(dataView,tiffOffset,offset,littleEndian,data){var tag=dataView.getUint16(offset,littleEndian);data.exif[tag]=loadImage.getExifValue(dataView,tiffOffset,offset,dataView.getUint16(offset+2,littleEndian),dataView.getUint32(offset+4,littleEndian),littleEndian)};loadImage.parseExifTags=function(dataView,tiffOffset,dirOffset,littleEndian,data){var tagsNumber,dirEndOffset,i;if(dirOffset+6>dataView.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((dirEndOffset=dirOffset+2+12*(tagsNumber=dataView.getUint16(dirOffset,littleEndian)))+4>dataView.byteLength)){for(i=0;i<tagsNumber;i+=1)this.parseExifTag(dataView,tiffOffset,dirOffset+2+12*i,littleEndian,data);return dataView.getUint32(dirEndOffset,littleEndian)}console.log("Invalid Exif data: Invalid directory size.")}};loadImage.parseExifData=function(dataView,offset,length,data,options){if(!options.disableExif){var tiffOffset=offset+10,littleEndian,dirOffset,thumbnailData;if(1165519206===dataView.getUint32(offset+4))if(tiffOffset+8>dataView.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===dataView.getUint16(offset+8)){switch(dataView.getUint16(tiffOffset)){case 18761:littleEndian=!0;break;case 19789:littleEndian=!1;break;default:console.log("Invalid Exif data: Invalid byte alignment marker.");return}if(42===dataView.getUint16(tiffOffset+2,littleEndian)){dirOffset=dataView.getUint32(tiffOffset+4,littleEndian);data.exif=new loadImage.ExifMap;if((dirOffset=loadImage.parseExifTags(dataView,tiffOffset,tiffOffset+dirOffset,littleEndian,data))&&!options.disableExifThumbnail){thumbnailData={exif:{}};dirOffset=loadImage.parseExifTags(dataView,tiffOffset,tiffOffset+dirOffset,littleEndian,thumbnailData);thumbnailData.exif[513]&&(data.exif.Thumbnail=loadImage.getExifThumbnail(dataView,tiffOffset+thumbnailData.exif[513],thumbnailData.exif[514]))}data.exif[34665]&&!options.disableExifSub&&loadImage.parseExifTags(dataView,tiffOffset,tiffOffset+data.exif[34665],littleEndian,data);data.exif[34853]&&!options.disableExifGps&&loadImage.parseExifTags(dataView,tiffOffset,tiffOffset+data.exif[34853],littleEndian,data)}else console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}};loadImage.metaDataParsers.jpeg[65505].push(loadImage.parseExifData)})},{"./load-image":9,"./load-image-meta":7}],7:[function(require,module,exports){!function(factory){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],factory):factory("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)}(function(loadImage){"use strict";var hasblobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);loadImage.blobSlice=hasblobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)};loadImage.metaDataParsers={jpeg:{65505:[]}};loadImage.parseMetaData=function(file,callback,options,data){options=options||{};data=data||{};var that=this,maxMetaDataSize=options.maxMetaDataSize||262144;!!(window.DataView&&file&&file.size>=12&&"image/jpeg"===file.type&&loadImage.blobSlice)&&loadImage.readFile(loadImage.blobSlice.call(file,0,maxMetaDataSize),function(e){if(e.target.error){console.log(e.target.error);callback(data)}else{var buffer=e.target.result,dataView=new DataView(buffer),offset=2,maxOffset=dataView.byteLength-4,headLength=offset,markerBytes,markerLength,parsers,i;if(65496===dataView.getUint16(0)){for(;offset<maxOffset&&((markerBytes=dataView.getUint16(offset))>=65504&&markerBytes<=65519||65534===markerBytes);){if(offset+(markerLength=dataView.getUint16(offset+2)+2)>dataView.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(parsers=loadImage.metaDataParsers.jpeg[markerBytes])for(i=0;i<parsers.length;i+=1)parsers[i].call(that,dataView,offset,markerLength,data,options);headLength=offset+=markerLength}!options.disableImageHead&&headLength>6&&(buffer.slice?data.imageHead=buffer.slice(0,headLength):data.imageHead=new Uint8Array(buffer).subarray(0,headLength))}else console.log("Invalid JPEG file: Missing JPEG marker.");callback(data)}},"readAsArrayBuffer")||callback(data)};loadImage.hasMetaOption=function(options){return options&&options.meta};var originalTransform=loadImage.transform;loadImage.transform=function(img,options,callback,file,data){loadImage.hasMetaOption(options)?loadImage.parseMetaData(file,function(data){originalTransform.call(loadImage,img,options,callback,file,data)},options,data):originalTransform.apply(loadImage,arguments)}})},{"./load-image":9}],9:[function(require,module,exports){!function($){"use strict";function loadImage(file,callback,options){var img=document.createElement("img"),url;img.onerror=function(event){return loadImage.onerror(img,event,file,callback,options)};img.onload=function(event){return loadImage.onload(img,event,file,callback,options)};if("string"==typeof file){loadImage.fetchBlob(file,function(blob){if(blob){file=blob;url=loadImage.createObjectURL(file)}else{url=file;options&&options.crossOrigin&&(img.crossOrigin=options.crossOrigin)}img.src=url},options);return img}if(loadImage.isInstanceOf("Blob",file)||loadImage.isInstanceOf("File",file)){if(url=img._objectURL=loadImage.createObjectURL(file)){img.src=url;return img}return loadImage.readFile(file,function(e){var target=e.target;target&&target.result?img.src=target.result:callback&&callback(e)})}}function revokeHelper(img,options){if(img._objectURL&&(!options||!options.noRevoke)){loadImage.revokeObjectURL(img._objectURL);delete img._objectURL}}var urlAPI=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;loadImage.fetchBlob=function(url,callback,options){callback()};loadImage.isInstanceOf=function(type,obj){return Object.prototype.toString.call(obj)==="[object "+type+"]"};loadImage.transform=function(img,options,callback,file,data){callback(img,data)};loadImage.onerror=function(img,event,file,callback,options){revokeHelper(img,options);callback&&callback.call(img,event)};loadImage.onload=function(img,event,file,callback,options){revokeHelper(img,options);callback&&loadImage.transform(img,options,callback,file,{})};loadImage.createObjectURL=function(file){return!!urlAPI&&urlAPI.createObjectURL(file)};loadImage.revokeObjectURL=function(url){return!!urlAPI&&urlAPI.revokeObjectURL(url)};loadImage.readFile=function(file,callback,method){if(window.FileReader){var fileReader=new FileReader;fileReader.onload=fileReader.onerror=callback;if(fileReader[method=method||"readAsDataURL"]){fileReader[method](file);return fileReader}}return!1};"function"==typeof define&&define.amd?define(function(){return loadImage}):"object"==typeof module&&module.exports?module.exports=loadImage:$.loadImage=loadImage}(window)},{}],3:[function(require,module,exports){!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload"],factory):"object"==typeof exports?factory(require("jquery"),require("./jquery.fileupload")):factory(window.jQuery)}(function($){"use strict";var originalAdd=$.blueimp.fileupload.prototype.options.add;$.widget("blueimp.fileupload",$.blueimp.fileupload,{options:{processQueue:[],add:function(e,data){var $this=$(this);data.process(function(){return $this.fileupload("process",data)});originalAdd.call(this,e,data)}},processActions:{},_processFile:function(data,originalData){var that=this,chain=$.Deferred().resolveWith(that,[data]).promise();this._trigger("process",null,data);$.each(data.processQueue,function(i,settings){var func=function(data){return originalData.errorThrown?$.Deferred().rejectWith(that,[originalData]).promise():that.processActions[settings.action].call(that,data,settings)};chain=chain.then(func,settings.always&&func)});chain.done(function(){that._trigger("processdone",null,data);that._trigger("processalways",null,data)}).fail(function(){that._trigger("processfail",null,data);that._trigger("processalways",null,data)});return chain},_transformProcessQueue:function(options){var processQueue=[];$.each(options.processQueue,function(){var settings={},action=this.action,prefix=!0===this.prefix?action:this.prefix;$.each(this,function(key,value){"string"===$.type(value)&&"@"===value.charAt(0)?settings[key]=options[value.slice(1)||(prefix?prefix+key.charAt(0).toUpperCase()+key.slice(1):key)]:settings[key]=value});processQueue.push(settings)});options.processQueue=processQueue},processing:function(){return this._processing},process:function(data){var that=this,options=$.extend({},this.options,data);if(options.processQueue&&options.processQueue.length){this._transformProcessQueue(options);0===this._processing&&this._trigger("processstart");$.each(data.files,function(index){var opts=index?$.extend({},options):options,func=function(){return data.errorThrown?$.Deferred().rejectWith(that,[data]).promise():that._processFile(opts,data)};opts.index=index;that._processing+=1;that._processingQueue=that._processingQueue.then(func,func).always(function(){that._processing-=1;0===that._processing&&that._trigger("processstop")})})}return this._processingQueue},_create:function(){this._super();this._processing=0;this._processingQueue=$.Deferred().resolveWith(this).promise()}})})},{"./jquery.fileupload":4,jquery:14}],4:[function(require,module,exports){!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],factory):"object"==typeof exports?factory(require("jquery"),require("./vendor/jquery.ui.widget")):factory(window.jQuery)}(function($){"use strict";function getDragHandler(type){var isDragOver="dragover"===type;return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var dataTransfer=e.dataTransfer;if(dataTransfer&&-1!==$.inArray("Files",dataTransfer.types)&&!1!==this._trigger(type,$.Event(type,{delegatedEvent:e}))){e.preventDefault();isDragOver&&(dataTransfer.dropEffect="copy")}}}$.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||$('<input type="file">').prop("disabled"));$.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader);$.support.xhrFormDataFileUpload=!!window.FormData;$.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);$.widget("blueimp.fileupload",{options:{dropZone:$(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(message,context){message=this.messages[message]||message.toString();context&&$.each(context,function(key,value){message=message.replace("{"+key+"}",value)});return message},formData:function(form){return form.serializeArray()},add:function(e,data){if(e.isDefaultPrevented())return!1;(data.autoUpload||!1!==data.autoUpload&&$(this).fileupload("option","autoUpload"))&&data.process().done(function(){data.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:$.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(now,loaded,interval){var timeDiff=now-this.timestamp;if(!this.bitrate||!interval||timeDiff>interval){this.bitrate=(loaded-this.loaded)*(1e3/timeDiff)*8;this.loaded=loaded;this.timestamp=now}return this.bitrate}},_isXHRUpload:function(options){return!options.forceIframeTransport&&(!options.multipart&&$.support.xhrFileUpload||$.support.xhrFormDataFileUpload)},_getFormData:function(options){var formData;if("function"===$.type(options.formData))return options.formData(options.form);if($.isArray(options.formData))return options.formData;if("object"===$.type(options.formData)){formData=[];$.each(options.formData,function(name,value){formData.push({name:name,value:value})});return formData}return[]},_getTotal:function(files){var total=0;$.each(files,function(index,file){total+=file.size||1});return total},_initProgressObject:function(obj){var progress={loaded:0,total:0,bitrate:0};obj._progress?$.extend(obj._progress,progress):obj._progress=progress},_initResponseObject:function(obj){var prop;if(obj._response)for(prop in obj._response)obj._response.hasOwnProperty(prop)&&delete obj._response[prop];else obj._response={}},_onProgress:function(e,data){if(e.lengthComputable){var now=Date.now?Date.now():(new Date).getTime(),loaded;if(data._time&&data.progressInterval&&now-data._time<data.progressInterval&&e.loaded!==e.total)return;data._time=now;loaded=Math.floor(e.loaded/e.total*(data.chunkSize||data._progress.total))+(data.uploadedBytes||0);this._progress.loaded+=loaded-data._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(now,this._progress.loaded,data.bitrateInterval);data._progress.loaded=data.loaded=loaded;data._progress.bitrate=data.bitrate=data._bitrateTimer.getBitrate(now,loaded,data.bitrateInterval);this._trigger("progress",$.Event("progress",{delegatedEvent:e}),data);this._trigger("progressall",$.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();if(xhr.upload){$(xhr.upload).bind("progress",function(e){var oe=e.originalEvent;e.lengthComputable=oe.lengthComputable;e.loaded=oe.loaded;e.total=oe.total;that._onProgress(e,options)});options.xhr=function(){return xhr}}},_isInstanceOf:function(type,obj){return Object.prototype.toString.call(obj)==="[object "+type+"]"},_initXHRData:function(options){var that=this,formData,file=options.files[0],multipart=options.multipart||!$.support.xhrFileUpload,paramName="array"===$.type(options.paramName)?options.paramName[0]:options.paramName;options.headers=$.extend({},options.headers);options.contentRange&&(options.headers["Content-Range"]=options.contentRange);multipart&&!options.blob&&this._isInstanceOf("File",file)||(options.headers["Content-Disposition"]='attachment; filename="'+encodeURI(file.name)+'"');if(multipart){if($.support.xhrFormDataFileUpload){if(options.postMessage){formData=this._getFormData(options);options.blob?formData.push({name:paramName,value:options.blob}):$.each(options.files,function(index,file){formData.push({name:"array"===$.type(options.paramName)&&options.paramName[index]||paramName,value:file})})}else{if(that._isInstanceOf("FormData",options.formData))formData=options.formData;else{formData=new FormData;$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value)})}options.blob?formData.append(paramName,options.blob,file.name):$.each(options.files,function(index,file){(that._isInstanceOf("File",file)||that._isInstanceOf("Blob",file))&&formData.append("array"===$.type(options.paramName)&&options.paramName[index]||paramName,file,file.uploadName||file.name)})}options.data=formData}}else{options.contentType=file.type||"application/octet-stream";options.data=options.blob||file}options.blob=null},_initIframeSettings:function(options){var targetHost=$("<a></a>").prop("href",options.url).prop("host");options.dataType="iframe "+(options.dataType||"");options.formData=this._getFormData(options);options.redirect&&targetHost&&targetHost!==location.host&&options.formData.push({name:options.redirectParamName||"redirect",value:options.redirect})},_initDataSettings:function(options){if(this._isXHRUpload(options)){if(!this._chunkedUpload(options,!0)){options.data||this._initXHRData(options);this._initProgressListener(options)}options.postMessage&&(options.dataType="postmessage "+(options.dataType||""))}else this._initIframeSettings(options)},_getParamName:function(options){var fileInput=$(options.fileInput),paramName=options.paramName;if(paramName)$.isArray(paramName)||(paramName=[paramName]);else{paramName=[];fileInput.each(function(){for(var input=$(this),name=input.prop("name")||"files[]",i=(input.prop("files")||[1]).length;i;){paramName.push(name);i-=1}});paramName.length||(paramName=[fileInput.prop("name")||"files[]"])}return paramName},_initFormSettings:function(options){if(!options.form||!options.form.length){options.form=$(options.fileInput.prop("form"));options.form.length||(options.form=$(this.options.fileInput.prop("form")))}options.paramName=this._getParamName(options);options.url||(options.url=options.form.prop("action")||location.href);options.type=(options.type||"string"===$.type(options.form.prop("method"))&&options.form.prop("method")||"").toUpperCase();"POST"!==options.type&&"PUT"!==options.type&&"PATCH"!==options.type&&(options.type="POST");options.formAcceptCharset||(options.formAcceptCharset=options.form.attr("accept-charset"))},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);this._initFormSettings(options);this._initDataSettings(options);return options},_getDeferredState:function(deferred){return deferred.state?deferred.state():deferred.isResolved()?"resolved":deferred.isRejected()?"rejected":"pending"},_enhancePromise:function(promise){promise.success=promise.done;promise.error=promise.fail;promise.complete=promise.always;return promise},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();context=context||this.options.context||promise;!0===resolveOrReject?dfd.resolveWith(context,args):!1===resolveOrReject&&dfd.rejectWith(context,args);promise.abort=dfd.promise;return this._enhancePromise(promise)},_addConvenienceMethods:function(e,data){var that=this,getPromise=function(args){return $.Deferred().resolveWith(that,args).promise()};data.process=function(resolveFunc,rejectFunc){(resolveFunc||rejectFunc)&&(data._processQueue=this._processQueue=(this._processQueue||getPromise([this])).then(function(){return data.errorThrown?$.Deferred().rejectWith(that,[data]).promise():getPromise(arguments)}).then(resolveFunc,rejectFunc));return this._processQueue||getPromise([this])};data.submit=function(){"pending"!==this.state()&&(data.jqXHR=this.jqXHR=!1!==that._trigger("submit",$.Event("submit",{delegatedEvent:e}),this)&&that._onSend(e,this));return this.jqXHR||that._getXHRPromise()};data.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";that._trigger("fail",null,this);return that._getXHRPromise(!1)};data.state=function(){return this.jqXHR?that._getDeferredState(this.jqXHR):this._processQueue?that._getDeferredState(this._processQueue):void 0};data.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===that._getDeferredState(this._processQueue)};data.progress=function(){return this._progress};data.response=function(){return this._response}},_getUploadedBytes:function(jqXHR){var range=jqXHR.getResponseHeader("Range"),parts=range&&range.split("-"),upperBytesPos=parts&&parts.length>1&&parseInt(parts[1],10);return upperBytesPos&&upperBytesPos+1},_chunkedUpload:function(options,testOnly){options.uploadedBytes=options.uploadedBytes||0;var that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes,mcs=options.maxChunkSize||fs,slice=this._blobSlice,dfd=$.Deferred(),promise=dfd.promise(),jqXHR,upload;if(!(this._isXHRUpload(options)&&slice&&(ub||("function"===$.type(mcs)?mcs(options):mcs)<fs))||options.data)return!1;if(testOnly)return!0;if(ub>=fs){file.error=options.i18n("uploadedBytes");return this._getXHRPromise(!1,options.context,[null,"error",file.error])}upload=function(){var o=$.extend({},options),currentLoaded=o._progress.loaded;o.blob=slice.call(file,ub,ub+("function"===$.type(mcs)?mcs(o):mcs),file.type);o.chunkSize=o.blob.size;o.contentRange="bytes "+ub+"-"+(ub+o.chunkSize-1)+"/"+fs;that._initXHRData(o);that._initProgressListener(o);jqXHR=(!1!==that._trigger("chunksend",null,o)&&$.ajax(o)||that._getXHRPromise(!1,o.context)).done(function(result,textStatus,jqXHR){ub=that._getUploadedBytes(jqXHR)||ub+o.chunkSize;currentLoaded+o.chunkSize-o._progress.loaded&&that._onProgress($.Event("progress",{lengthComputable:!0,loaded:ub-o.uploadedBytes,total:ub-o.uploadedBytes}),o);options.uploadedBytes=o.uploadedBytes=ub;o.result=result;o.textStatus=textStatus;o.jqXHR=jqXHR;that._trigger("chunkdone",null,o);that._trigger("chunkalways",null,o);ub<fs?upload():dfd.resolveWith(o.context,[result,textStatus,jqXHR])}).fail(function(jqXHR,textStatus,errorThrown){o.jqXHR=jqXHR;o.textStatus=textStatus;o.errorThrown=errorThrown;that._trigger("chunkfail",null,o);that._trigger("chunkalways",null,o);dfd.rejectWith(o.context,[jqXHR,textStatus,errorThrown])})};this._enhancePromise(promise);promise.abort=function(){return jqXHR.abort()};upload();return promise},_beforeSend:function(e,data){if(0===this._active){this._trigger("start");this._bitrateTimer=new this._BitrateTimer;this._progress.loaded=this._progress.total=0;this._progress.bitrate=0}this._initResponseObject(data);this._initProgressObject(data);data._progress.loaded=data.loaded=data.uploadedBytes||0;data._progress.total=data.total=this._getTotal(data.files)||1;data._progress.bitrate=data.bitrate=0;this._active+=1;this._progress.loaded+=data.loaded;this._progress.total+=data.total},_onDone:function(result,textStatus,jqXHR,options){var total=options._progress.total,response=options._response;options._progress.loaded<total&&this._onProgress($.Event("progress",{lengthComputable:!0,loaded:total,total:total}),options);response.result=options.result=result;response.textStatus=options.textStatus=textStatus;response.jqXHR=options.jqXHR=jqXHR;this._trigger("done",null,options)},_onFail:function(jqXHR,textStatus,errorThrown,options){var response=options._response;if(options.recalculateProgress){this._progress.loaded-=options._progress.loaded;this._progress.total-=options._progress.total}response.jqXHR=options.jqXHR=jqXHR;response.textStatus=options.textStatus=textStatus;response.errorThrown=options.errorThrown=errorThrown;this._trigger("fail",null,options)},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._trigger("always",null,options)},_onSend:function(e,data){data.submit||this._addConvenienceMethods(e,data);var that=this,jqXHR,aborted,slot,pipe,options=that._getAJAXSettings(data),send=function(){that._sending+=1;options._bitrateTimer=new that._BitrateTimer;return jqXHR=jqXHR||((aborted||!1===that._trigger("send",$.Event("send",{delegatedEvent:e}),options))&&that._getXHRPromise(!1,options.context,aborted)||that._chunkedUpload(options)||$.ajax(options)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options)}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options)}).always(function(jqXHRorResult,textStatus,jqXHRorError){that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options);that._sending-=1;that._active-=1;if(options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending)for(var nextSlot=that._slots.shift();nextSlot;){if("pending"===that._getDeferredState(nextSlot)){nextSlot.resolve();break}nextSlot=that._slots.shift()}0===that._active&&that._trigger("stop")})};this._beforeSend(e,options);if(this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending){if(this.options.limitConcurrentUploads>1){slot=$.Deferred();this._slots.push(slot);pipe=slot.then(send)}else{this._sequence=this._sequence.then(send,send);pipe=this._sequence}pipe.abort=function(){aborted=[void 0,"abort","abort"];if(!jqXHR){slot&&slot.rejectWith(options.context,aborted);return send()}return jqXHR.abort()};return this._enhancePromise(pipe)}return send()},_onAdd:function(e,data){var that=this,result=!0,options=$.extend({},this.options,data),files=data.files,filesLength=files.length,limit=options.limitMultiFileUploads,limitSize=options.limitMultiFileUploadSize,overhead=options.limitMultiFileUploadSizeOverhead,batchSize=0,paramName=this._getParamName(options),paramNameSet,paramNameSlice,fileSet,i,j=0;if(!filesLength)return!1;limitSize&&void 0===files[0].size&&(limitSize=void 0);if((options.singleFileUploads||limit||limitSize)&&this._isXHRUpload(options))if(options.singleFileUploads||limitSize||!limit)if(!options.singleFileUploads&&limitSize){fileSet=[];paramNameSet=[];for(i=0;i<filesLength;i+=1){batchSize+=files[i].size+overhead;if(i+1===filesLength||batchSize+files[i+1].size+overhead>limitSize||limit&&i+1-j>=limit){fileSet.push(files.slice(j,i+1));(paramNameSlice=paramName.slice(j,i+1)).length||(paramNameSlice=paramName);paramNameSet.push(paramNameSlice);j=i+1;batchSize=0}}}else paramNameSet=paramName;else{fileSet=[];paramNameSet=[];for(i=0;i<filesLength;i+=limit){fileSet.push(files.slice(i,i+limit));(paramNameSlice=paramName.slice(i,i+limit)).length||(paramNameSlice=paramName);paramNameSet.push(paramNameSlice)}}else{fileSet=[files];paramNameSet=[paramName]}data.originalFiles=files;$.each(fileSet||files,function(index,element){var newData=$.extend({},data);newData.files=fileSet?element:[element];newData.paramName=paramNameSet[index];that._initResponseObject(newData);that._initProgressObject(newData);that._addConvenienceMethods(e,newData);return result=that._trigger("add",$.Event("add",{delegatedEvent:e}),newData)});return result},_replaceFileInput:function(data){var input=data.fileInput,inputClone=input.clone(!0),restoreFocus=input.is(document.activeElement);data.fileInputClone=inputClone;$("<form></form>").append(inputClone)[0].reset();input.after(inputClone).detach();restoreFocus&&inputClone.focus();$.cleanData(input.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(i,el){return el===input[0]?inputClone[0]:el});input[0]===this.element[0]&&(this.element=inputClone)},_handleFileTreeEntry:function(entry,path){var that=this,dfd=$.Deferred(),entries=[],dirReader,errorHandler=function(e){e&&!e.entry&&(e.entry=entry);dfd.resolve([e])},successHandler=function(entries){that._handleFileTreeEntries(entries,path+entry.name+"/").done(function(files){dfd.resolve(files)}).fail(errorHandler)},readEntries=function(){dirReader.readEntries(function(results){if(results.length){entries=entries.concat(results);readEntries()}else successHandler(entries)},errorHandler)};path=path||"";if(entry.isFile)if(entry._file){entry._file.relativePath=path;dfd.resolve(entry._file)}else entry.file(function(file){file.relativePath=path;dfd.resolve(file)},errorHandler);else if(entry.isDirectory){dirReader=entry.createReader();readEntries()}else dfd.resolve([]);return dfd.promise()},_handleFileTreeEntries:function(entries,path){var that=this;return $.when.apply($,$.map(entries,function(entry){return that._handleFileTreeEntry(entry,path)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(dataTransfer){var items=(dataTransfer=dataTransfer||{}).items;return items&&items.length&&(items[0].webkitGetAsEntry||items[0].getAsEntry)?this._handleFileTreeEntries($.map(items,function(item){var entry;if(item.webkitGetAsEntry){(entry=item.webkitGetAsEntry())&&(entry._file=item.getAsFile());return entry}return item.getAsEntry()})):$.Deferred().resolve($.makeArray(dataTransfer.files)).promise()},_getSingleFileInputFiles:function(fileInput){var entries=(fileInput=$(fileInput)).prop("webkitEntries")||fileInput.prop("entries"),files,value;if(entries&&entries.length)return this._handleFileTreeEntries(entries);if((files=$.makeArray(fileInput.prop("files"))).length)void 0===files[0].name&&files[0].fileName&&$.each(files,function(index,file){file.name=file.fileName;file.size=file.fileSize});else{if(!(value=fileInput.prop("value")))return $.Deferred().resolve([]).promise();files=[{name:value.replace(/^.*\\/,"")}]}return $.Deferred().resolve(files).promise()},_getFileInputFiles:function(fileInput){return fileInput instanceof $&&1!==fileInput.length?$.when.apply($,$.map(fileInput,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(fileInput)},_onChange:function(e){var that=this,data={fileInput:$(e.target),form:$(e.target.form)};this._getFileInputFiles(data.fileInput).always(function(files){data.files=files;that.options.replaceFileInput&&that._replaceFileInput(data);!1!==that._trigger("change",$.Event("change",{delegatedEvent:e}),data)&&that._onAdd(e,data)})},_onPaste:function(e){var items=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,data={files:[]};if(items&&items.length){$.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();file&&data.files.push(file)});!1!==this._trigger("paste",$.Event("paste",{delegatedEvent:e}),data)&&this._onAdd(e,data)}},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var that=this,dataTransfer=e.dataTransfer,data={};if(dataTransfer&&dataTransfer.files&&dataTransfer.files.length){e.preventDefault();this._getDroppedFiles(dataTransfer).always(function(files){data.files=files;!1!==that._trigger("drop",$.Event("drop",{delegatedEvent:e}),data)&&that._onAdd(e,data)})}},_onDragOver:getDragHandler("dragover"),_onDragEnter:getDragHandler("dragenter"),_onDragLeave:getDragHandler("dragleave"),_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave});this._on(this.options.pasteZone,{paste:this._onPaste})}$.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(key,value){var reinit=-1!==$.inArray(key,this._specialOptions);reinit&&this._destroyEventHandlers();this._super(key,value);if(reinit){this._initSpecialOptions();this._initEventHandlers()}},_initSpecialOptions:function(){var options=this.options;void 0===options.fileInput?options.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):options.fileInput instanceof $||(options.fileInput=$(options.fileInput));options.dropZone instanceof $||(options.dropZone=$(options.dropZone));options.pasteZone instanceof $||(options.pasteZone=$(options.pasteZone))},_getRegExp:function(str){var parts=str.split("/"),modifiers=parts.pop();parts.shift();return new RegExp(parts.join("/"),modifiers)},_isRegExpOption:function(key,value){return"url"!==key&&"string"===$.type(value)&&/^\/.*\/[igm]{0,3}$/.test(value)},_initDataAttributes:function(){var that=this,options=this.options,data=this.element.data();$.each(this.element[0].attributes,function(index,attr){var key=attr.name.toLowerCase(),value;if(/^data-/.test(key)){key=key.slice(5).replace(/-[a-z]/g,function(str){return str.charAt(1).toUpperCase()});value=data[key];that._isRegExpOption(key,value)&&(value=that._getRegExp(value));options[key]=value}})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(data){var that=this;if(data&&!this.options.disabled)if(data.fileInput&&!data.files)this._getFileInputFiles(data.fileInput).always(function(files){data.files=files;that._onAdd(null,data)});else{data.files=$.makeArray(data.files);this._onAdd(null,data)}},send:function(data){if(data&&!this.options.disabled){if(data.fileInput&&!data.files){var that=this,dfd=$.Deferred(),promise=dfd.promise(),jqXHR,aborted;promise.abort=function(){aborted=!0;if(jqXHR)return jqXHR.abort();dfd.reject(null,"abort","abort");return promise};this._getFileInputFiles(data.fileInput).always(function(files){if(!aborted)if(files.length){data.files=files;(jqXHR=that._onSend(null,data)).then(function(result,textStatus,jqXHR){dfd.resolve(result,textStatus,jqXHR)},function(jqXHR,textStatus,errorThrown){dfd.reject(jqXHR,textStatus,errorThrown)})}else dfd.reject()});return this._enhancePromise(promise)}data.files=$.makeArray(data.files);if(data.files.length)return this._onSend(null,data)}return this._getXHRPromise(!1,data&&data.context)}})})},{"./vendor/jquery.ui.widget":5,jquery:14}],5:[function(require,module,exports){!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){var widget_uuid=0,widget_slice=Array.prototype.slice;$.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;null!=(elem=elems[i]);i++)try{(events=$._data(elem,"events"))&&events.remove&&$(elem).triggerHandler("remove")}catch(e){}orig(elems)}}($.cleanData);$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget)return new constructor(options,element);arguments.length&&this._createWidget(options,element)};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});(basePrototype=new base).options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){$.isFunction(value)?proxiedPrototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}():proxiedPrototype[prop]=value});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else base._childConstructors.push(constructor);$.widget.bridge(name,constructor);return constructor};$.widget.extend=function(target){for(var input=widget_slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;inputIndex<inputLength;inputIndex++)for(key in input[inputIndex]){value=input[inputIndex][key];input[inputIndex].hasOwnProperty(key)&&void 0!==value&&($.isPlainObject(value)?target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):target[key]=value)}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=widget_slice.call(arguments,1),returnValue=this;if(isMethodCall)this.each(function(){var methodValue,instance=$.data(this,fullName);if("instance"===options){returnValue=instance;return!1}if(!instance)return $.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'");if(!$.isFunction(instance[options])||"_"===options.charAt(0))return $.error("no such method '"+options+"' for "+name+" widget instance");if((methodValue=instance[options].apply(instance,args))!==instance&&void 0!==methodValue){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return!1}});else{args.length&&(options=$.widget.extend.apply(null,[options].concat(args)));this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});instance._init&&instance._init()}else $.data(this,fullName,new object(options,this))})}return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widget_uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var options=key,parts,curOption,i;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key){options={};key=(parts=key.split(".")).shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(1===arguments.length)return void 0===curOption[key]?null:curOption[key];curOption[key]=value}else{if(1===arguments.length)return void 0===this.options[key]?null:this.options[key];options[key]=value}}this._setOptions(options);return this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){this.options[key]=value;if("disabled"===key){this.widget().toggleClass(this.widgetFullName+"-disabled",!!value);if(value){this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}}return this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if("boolean"!=typeof suppressDisabledCheck){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=!1}if(handlers){element=delegateElement=$(element);this.bindings=this.bindings.add(element)}else{handlers=element;element=this.element;delegateElement=this.widget()}$.each(handlers,function(event,handler){function handlerProxy(){if(suppressDisabledCheck||!0!==instance.options.disabled&&!$(this).hasClass("ui-state-disabled"))return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^([\w:-]*)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.delegate(selector,eventName,handlerProxy):element.bind(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName);this.bindings=$(this.bindings.not(element).get());this.focusable=$(this.focusable.not(element).get());this.hoverable=$(this.hoverable.not(element).get())},_delay:function(handler,delay){function handlerProxy(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};(event=$.Event(event)).type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];if(orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);this.element.trigger(event,data);return!($.isFunction(callback)&&!1===callback.apply(this.element[0],[event].concat(data))||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){"string"==typeof options&&(options={effect:options});var hasOptions,effectName=options?!0===options||"number"==typeof options?defaultEffect:options.effect||defaultEffect:method;"number"==typeof(options=options||{})&&(options={duration:options});hasOptions=!$.isEmptyObject(options);options.complete=callback;options.delay&&element.delay(options.delay);hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method]();callback&&callback.call(element[0]);next()})}});var widget=$.widget})},{jquery:14}],1:[function(require,module,exports){!function(window){"use strict";var CanvasPrototype=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype,hasBlobConstructor=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,dataURIPattern=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,dataURLtoBlob=(hasBlobConstructor||BlobBuilder)&&window.atob&&window.ArrayBuffer&&window.Uint8Array&&function(dataURI){var matches,mediaType,isBase64,dataString,byteString,arrayBuffer,intArray,i,bb;if(!(matches=dataURI.match(dataURIPattern)))throw new Error("invalid data URI");mediaType=matches[2]?matches[1]:"text/plain"+(matches[3]||";charset=US-ASCII");isBase64=!!matches[4];dataString=dataURI.slice(matches[0].length);byteString=isBase64?atob(dataString):decodeURIComponent(dataString);arrayBuffer=new ArrayBuffer(byteString.length);intArray=new Uint8Array(arrayBuffer);for(i=0;i<byteString.length;i+=1)intArray[i]=byteString.charCodeAt(i);if(hasBlobConstructor)return new Blob([hasArrayBufferViewSupport?intArray:arrayBuffer],{type:mediaType});(bb=new BlobBuilder).append(arrayBuffer);return bb.getBlob(mediaType)};window.HTMLCanvasElement&&!CanvasPrototype.toBlob&&(CanvasPrototype.mozGetAsFile?CanvasPrototype.toBlob=function(callback,type,quality){callback(quality&&CanvasPrototype.toDataURL&&dataURLtoBlob?dataURLtoBlob(this.toDataURL(type,quality)):this.mozGetAsFile("blob",type))}:CanvasPrototype.toDataURL&&dataURLtoBlob&&(CanvasPrototype.toBlob=function(callback,type,quality){callback(dataURLtoBlob(this.toDataURL(type,quality)))}));"function"==typeof define&&define.amd?define(function(){return dataURLtoBlob}):"object"==typeof module&&module.exports?module.exports=dataURLtoBlob:window.dataURLtoBlob=dataURLtoBlob}(window)},{}]},{},[253]);